function VC(t,e){for(var n=0;n<e.length;n++){const s=e[n];if(typeof s!="string"&&!Array.isArray(s)){for(const r in s)if(r!=="default"&&!(r in t)){const i=Object.getOwnPropertyDescriptor(s,r);i&&Object.defineProperty(t,r,i.get?i:{enumerable:!0,get:()=>s[r]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function n(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(r){if(r.ep)return;r.ep=!0;const i=n(r);fetch(r.href,i)}})();var aa=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function UC(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function t3(t){if(t.__esModule)return t;var e=t.default;if(typeof e=="function"){var n=function s(){return this instanceof s?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach(function(s){var r=Object.getOwnPropertyDescriptor(t,s);Object.defineProperty(n,s,r.get?r:{enumerable:!0,get:function(){return t[s]}})}),n}var GC={exports:{}},cf={},HC={exports:{}},Ne={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var bu=Symbol.for("react.element"),n3=Symbol.for("react.portal"),s3=Symbol.for("react.fragment"),r3=Symbol.for("react.strict_mode"),i3=Symbol.for("react.profiler"),o3=Symbol.for("react.provider"),a3=Symbol.for("react.context"),l3=Symbol.for("react.forward_ref"),c3=Symbol.for("react.suspense"),u3=Symbol.for("react.memo"),d3=Symbol.for("react.lazy"),cw=Symbol.iterator;function h3(t){return t===null||typeof t!="object"?null:(t=cw&&t[cw]||t["@@iterator"],typeof t=="function"?t:null)}var KC={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},qC=Object.assign,XC={};function Rl(t,e,n){this.props=t,this.context=e,this.refs=XC,this.updater=n||KC}Rl.prototype.isReactComponent={};Rl.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};Rl.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function YC(){}YC.prototype=Rl.prototype;function nx(t,e,n){this.props=t,this.context=e,this.refs=XC,this.updater=n||KC}var sx=nx.prototype=new YC;sx.constructor=nx;qC(sx,Rl.prototype);sx.isPureReactComponent=!0;var uw=Array.isArray,QC=Object.prototype.hasOwnProperty,rx={current:null},JC={key:!0,ref:!0,__self:!0,__source:!0};function ZC(t,e,n){var s,r={},i=null,o=null;if(e!=null)for(s in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(i=""+e.key),e)QC.call(e,s)&&!JC.hasOwnProperty(s)&&(r[s]=e[s]);var a=arguments.length-2;if(a===1)r.children=n;else if(1<a){for(var l=Array(a),c=0;c<a;c++)l[c]=arguments[c+2];r.children=l}if(t&&t.defaultProps)for(s in a=t.defaultProps,a)r[s]===void 0&&(r[s]=a[s]);return{$$typeof:bu,type:t,key:i,ref:o,props:r,_owner:rx.current}}function p3(t,e){return{$$typeof:bu,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function ix(t){return typeof t=="object"&&t!==null&&t.$$typeof===bu}function f3(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var dw=/\/+/g;function ug(t,e){return typeof t=="object"&&t!==null&&t.key!=null?f3(""+t.key):e.toString(36)}function Dh(t,e,n,s,r){var i=typeof t;(i==="undefined"||i==="boolean")&&(t=null);var o=!1;if(t===null)o=!0;else switch(i){case"string":case"number":o=!0;break;case"object":switch(t.$$typeof){case bu:case n3:o=!0}}if(o)return o=t,r=r(o),t=s===""?"."+ug(o,0):s,uw(r)?(n="",t!=null&&(n=t.replace(dw,"$&/")+"/"),Dh(r,e,n,"",function(c){return c})):r!=null&&(ix(r)&&(r=p3(r,n+(!r.key||o&&o.key===r.key?"":(""+r.key).replace(dw,"$&/")+"/")+t)),e.push(r)),1;if(o=0,s=s===""?".":s+":",uw(t))for(var a=0;a<t.length;a++){i=t[a];var l=s+ug(i,a);o+=Dh(i,e,n,l,r)}else if(l=h3(t),typeof l=="function")for(t=l.call(t),a=0;!(i=t.next()).done;)i=i.value,l=s+ug(i,a++),o+=Dh(i,e,n,l,r);else if(i==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function eh(t,e,n){if(t==null)return t;var s=[],r=0;return Dh(t,s,"","",function(i){return e.call(n,i,r++)}),s}function m3(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var Nn={current:null},Fh={transition:null},g3={ReactCurrentDispatcher:Nn,ReactCurrentBatchConfig:Fh,ReactCurrentOwner:rx};function eS(){throw Error("act(...) is not supported in production builds of React.")}Ne.Children={map:eh,forEach:function(t,e,n){eh(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return eh(t,function(){e++}),e},toArray:function(t){return eh(t,function(e){return e})||[]},only:function(t){if(!ix(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};Ne.Component=Rl;Ne.Fragment=s3;Ne.Profiler=i3;Ne.PureComponent=nx;Ne.StrictMode=r3;Ne.Suspense=c3;Ne.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=g3;Ne.act=eS;Ne.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var s=qC({},t.props),r=t.key,i=t.ref,o=t._owner;if(e!=null){if(e.ref!==void 0&&(i=e.ref,o=rx.current),e.key!==void 0&&(r=""+e.key),t.type&&t.type.defaultProps)var a=t.type.defaultProps;for(l in e)QC.call(e,l)&&!JC.hasOwnProperty(l)&&(s[l]=e[l]===void 0&&a!==void 0?a[l]:e[l])}var l=arguments.length-2;if(l===1)s.children=n;else if(1<l){a=Array(l);for(var c=0;c<l;c++)a[c]=arguments[c+2];s.children=a}return{$$typeof:bu,type:t.type,key:r,ref:i,props:s,_owner:o}};Ne.createContext=function(t){return t={$$typeof:a3,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:o3,_context:t},t.Consumer=t};Ne.createElement=ZC;Ne.createFactory=function(t){var e=ZC.bind(null,t);return e.type=t,e};Ne.createRef=function(){return{current:null}};Ne.forwardRef=function(t){return{$$typeof:l3,render:t}};Ne.isValidElement=ix;Ne.lazy=function(t){return{$$typeof:d3,_payload:{_status:-1,_result:t},_init:m3}};Ne.memo=function(t,e){return{$$typeof:u3,type:t,compare:e===void 0?null:e}};Ne.startTransition=function(t){var e=Fh.transition;Fh.transition={};try{t()}finally{Fh.transition=e}};Ne.unstable_act=eS;Ne.useCallback=function(t,e){return Nn.current.useCallback(t,e)};Ne.useContext=function(t){return Nn.current.useContext(t)};Ne.useDebugValue=function(){};Ne.useDeferredValue=function(t){return Nn.current.useDeferredValue(t)};Ne.useEffect=function(t,e){return Nn.current.useEffect(t,e)};Ne.useId=function(){return Nn.current.useId()};Ne.useImperativeHandle=function(t,e,n){return Nn.current.useImperativeHandle(t,e,n)};Ne.useInsertionEffect=function(t,e){return Nn.current.useInsertionEffect(t,e)};Ne.useLayoutEffect=function(t,e){return Nn.current.useLayoutEffect(t,e)};Ne.useMemo=function(t,e){return Nn.current.useMemo(t,e)};Ne.useReducer=function(t,e,n){return Nn.current.useReducer(t,e,n)};Ne.useRef=function(t){return Nn.current.useRef(t)};Ne.useState=function(t){return Nn.current.useState(t)};Ne.useSyncExternalStore=function(t,e,n){return Nn.current.useSyncExternalStore(t,e,n)};Ne.useTransition=function(){return Nn.current.useTransition()};Ne.version="18.3.1";HC.exports=Ne;var W=HC.exports;const tS=UC(W),y3=VC({__proto__:null,default:tS},[W]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var x3=W,v3=Symbol.for("react.element"),b3=Symbol.for("react.fragment"),w3=Object.prototype.hasOwnProperty,k3=x3.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,C3={key:!0,ref:!0,__self:!0,__source:!0};function nS(t,e,n){var s,r={},i=null,o=null;n!==void 0&&(i=""+n),e.key!==void 0&&(i=""+e.key),e.ref!==void 0&&(o=e.ref);for(s in e)w3.call(e,s)&&!C3.hasOwnProperty(s)&&(r[s]=e[s]);if(t&&t.defaultProps)for(s in e=t.defaultProps,e)r[s]===void 0&&(r[s]=e[s]);return{$$typeof:v3,type:t,key:i,ref:o,props:r,_owner:k3.current}}cf.Fragment=b3;cf.jsx=nS;cf.jsxs=nS;GC.exports=cf;var m=GC.exports,sS={exports:{}},rs={},rS={exports:{}},iS={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(E,D){var V=E.length;E.push(D);e:for(;0<V;){var X=V-1>>>1,Z=E[X];if(0<r(Z,D))E[X]=D,E[V]=Z,V=X;else break e}}function n(E){return E.length===0?null:E[0]}function s(E){if(E.length===0)return null;var D=E[0],V=E.pop();if(V!==D){E[0]=V;e:for(var X=0,Z=E.length,ee=Z>>>1;X<ee;){var ie=2*(X+1)-1,j=E[ie],Q=ie+1,ne=E[Q];if(0>r(j,V))Q<Z&&0>r(ne,j)?(E[X]=ne,E[Q]=V,X=Q):(E[X]=j,E[ie]=V,X=ie);else if(Q<Z&&0>r(ne,V))E[X]=ne,E[Q]=V,X=Q;else break e}}return D}function r(E,D){var V=E.sortIndex-D.sortIndex;return V!==0?V:E.id-D.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;t.unstable_now=function(){return i.now()}}else{var o=Date,a=o.now();t.unstable_now=function(){return o.now()-a}}var l=[],c=[],u=1,d=null,h=3,p=!1,f=!1,g=!1,x=typeof setTimeout=="function"?setTimeout:null,y=typeof clearTimeout=="function"?clearTimeout:null,v=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function b(E){for(var D=n(c);D!==null;){if(D.callback===null)s(c);else if(D.startTime<=E)s(c),D.sortIndex=D.expirationTime,e(l,D);else break;D=n(c)}}function w(E){if(g=!1,b(E),!f)if(n(l)!==null)f=!0,P(k);else{var D=n(c);D!==null&&H(w,D.startTime-E)}}function k(E,D){f=!1,g&&(g=!1,y(C),C=-1),p=!0;var V=h;try{for(b(D),d=n(l);d!==null&&(!(d.expirationTime>D)||E&&!_());){var X=d.callback;if(typeof X=="function"){d.callback=null,h=d.priorityLevel;var Z=X(d.expirationTime<=D);D=t.unstable_now(),typeof Z=="function"?d.callback=Z:d===n(l)&&s(l),b(D)}else s(l);d=n(l)}if(d!==null)var ee=!0;else{var ie=n(c);ie!==null&&H(w,ie.startTime-D),ee=!1}return ee}finally{d=null,h=V,p=!1}}var S=!1,I=null,C=-1,$=5,R=-1;function _(){return!(t.unstable_now()-R<$)}function M(){if(I!==null){var E=t.unstable_now();R=E;var D=!0;try{D=I(!0,E)}finally{D?B():(S=!1,I=null)}}else S=!1}var B;if(typeof v=="function")B=function(){v(M)};else if(typeof MessageChannel<"u"){var A=new MessageChannel,F=A.port2;A.port1.onmessage=M,B=function(){F.postMessage(null)}}else B=function(){x(M,0)};function P(E){I=E,S||(S=!0,B())}function H(E,D){C=x(function(){E(t.unstable_now())},D)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(E){E.callback=null},t.unstable_continueExecution=function(){f||p||(f=!0,P(k))},t.unstable_forceFrameRate=function(E){0>E||125<E?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):$=0<E?Math.floor(1e3/E):5},t.unstable_getCurrentPriorityLevel=function(){return h},t.unstable_getFirstCallbackNode=function(){return n(l)},t.unstable_next=function(E){switch(h){case 1:case 2:case 3:var D=3;break;default:D=h}var V=h;h=D;try{return E()}finally{h=V}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(E,D){switch(E){case 1:case 2:case 3:case 4:case 5:break;default:E=3}var V=h;h=E;try{return D()}finally{h=V}},t.unstable_scheduleCallback=function(E,D,V){var X=t.unstable_now();switch(typeof V=="object"&&V!==null?(V=V.delay,V=typeof V=="number"&&0<V?X+V:X):V=X,E){case 1:var Z=-1;break;case 2:Z=250;break;case 5:Z=1073741823;break;case 4:Z=1e4;break;default:Z=5e3}return Z=V+Z,E={id:u++,callback:D,priorityLevel:E,startTime:V,expirationTime:Z,sortIndex:-1},V>X?(E.sortIndex=V,e(c,E),n(l)===null&&E===n(c)&&(g?(y(C),C=-1):g=!0,H(w,V-X))):(E.sortIndex=Z,e(l,E),f||p||(f=!0,P(k))),E},t.unstable_shouldYield=_,t.unstable_wrapCallback=function(E){var D=h;return function(){var V=h;h=D;try{return E.apply(this,arguments)}finally{h=V}}}})(iS);rS.exports=iS;var S3=rS.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var I3=W,ns=S3;function oe(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var oS=new Set,jc={};function la(t,e){rl(t,e),rl(t+"Capture",e)}function rl(t,e){for(jc[t]=e,t=0;t<e.length;t++)oS.add(e[t])}var Wr=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),ly=Object.prototype.hasOwnProperty,$3=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,hw={},pw={};function T3(t){return ly.call(pw,t)?!0:ly.call(hw,t)?!1:$3.test(t)?pw[t]=!0:(hw[t]=!0,!1)}function E3(t,e,n,s){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return s?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function R3(t,e,n,s){if(e===null||typeof e>"u"||E3(t,e,n,s))return!0;if(s)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function An(t,e,n,s,r,i,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=s,this.attributeNamespace=r,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=i,this.removeEmptyString=o}var en={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){en[t]=new An(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];en[e]=new An(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){en[t]=new An(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){en[t]=new An(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){en[t]=new An(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){en[t]=new An(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){en[t]=new An(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){en[t]=new An(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){en[t]=new An(t,5,!1,t.toLowerCase(),null,!1,!1)});var ox=/[\-:]([a-z])/g;function ax(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(ox,ax);en[e]=new An(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(ox,ax);en[e]=new An(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(ox,ax);en[e]=new An(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){en[t]=new An(t,1,!1,t.toLowerCase(),null,!1,!1)});en.xlinkHref=new An("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){en[t]=new An(t,1,!1,t.toLowerCase(),null,!0,!0)});function lx(t,e,n,s){var r=en.hasOwnProperty(e)?en[e]:null;(r!==null?r.type!==0:s||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(R3(e,n,r,s)&&(n=null),s||r===null?T3(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):r.mustUseProperty?t[r.propertyName]=n===null?r.type===3?!1:"":n:(e=r.attributeName,s=r.attributeNamespace,n===null?t.removeAttribute(e):(r=r.type,n=r===3||r===4&&n===!0?"":""+n,s?t.setAttributeNS(s,e,n):t.setAttribute(e,n))))}var Zr=I3.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,th=Symbol.for("react.element"),Na=Symbol.for("react.portal"),Aa=Symbol.for("react.fragment"),cx=Symbol.for("react.strict_mode"),cy=Symbol.for("react.profiler"),aS=Symbol.for("react.provider"),lS=Symbol.for("react.context"),ux=Symbol.for("react.forward_ref"),uy=Symbol.for("react.suspense"),dy=Symbol.for("react.suspense_list"),dx=Symbol.for("react.memo"),pi=Symbol.for("react.lazy"),cS=Symbol.for("react.offscreen"),fw=Symbol.iterator;function nc(t){return t===null||typeof t!="object"?null:(t=fw&&t[fw]||t["@@iterator"],typeof t=="function"?t:null)}var gt=Object.assign,dg;function fc(t){if(dg===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);dg=e&&e[1]||""}return`
`+dg+t}var hg=!1;function pg(t,e){if(!t||hg)return"";hg=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(c){var s=c}Reflect.construct(t,[],e)}else{try{e.call()}catch(c){s=c}t.call(e.prototype)}else{try{throw Error()}catch(c){s=c}t()}}catch(c){if(c&&s&&typeof c.stack=="string"){for(var r=c.stack.split(`
`),i=s.stack.split(`
`),o=r.length-1,a=i.length-1;1<=o&&0<=a&&r[o]!==i[a];)a--;for(;1<=o&&0<=a;o--,a--)if(r[o]!==i[a]){if(o!==1||a!==1)do if(o--,a--,0>a||r[o]!==i[a]){var l=`
`+r[o].replace(" at new "," at ");return t.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",t.displayName)),l}while(1<=o&&0<=a);break}}}finally{hg=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?fc(t):""}function N3(t){switch(t.tag){case 5:return fc(t.type);case 16:return fc("Lazy");case 13:return fc("Suspense");case 19:return fc("SuspenseList");case 0:case 2:case 15:return t=pg(t.type,!1),t;case 11:return t=pg(t.type.render,!1),t;case 1:return t=pg(t.type,!0),t;default:return""}}function hy(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case Aa:return"Fragment";case Na:return"Portal";case cy:return"Profiler";case cx:return"StrictMode";case uy:return"Suspense";case dy:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case lS:return(t.displayName||"Context")+".Consumer";case aS:return(t._context.displayName||"Context")+".Provider";case ux:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case dx:return e=t.displayName||null,e!==null?e:hy(t.type)||"Memo";case pi:e=t._payload,t=t._init;try{return hy(t(e))}catch{}}return null}function A3(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return hy(e);case 8:return e===cx?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Vi(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function uS(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function _3(t){var e=uS(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),s=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var r=n.get,i=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return r.call(this)},set:function(o){s=""+o,i.call(this,o)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return s},setValue:function(o){s=""+o},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function nh(t){t._valueTracker||(t._valueTracker=_3(t))}function dS(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),s="";return t&&(s=uS(t)?t.checked?"true":"false":t.value),t=s,t!==n?(e.setValue(t),!0):!1}function Qh(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function py(t,e){var n=e.checked;return gt({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function mw(t,e){var n=e.defaultValue==null?"":e.defaultValue,s=e.checked!=null?e.checked:e.defaultChecked;n=Vi(e.value!=null?e.value:n),t._wrapperState={initialChecked:s,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function hS(t,e){e=e.checked,e!=null&&lx(t,"checked",e,!1)}function fy(t,e){hS(t,e);var n=Vi(e.value),s=e.type;if(n!=null)s==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(s==="submit"||s==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?my(t,e.type,n):e.hasOwnProperty("defaultValue")&&my(t,e.type,Vi(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function gw(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var s=e.type;if(!(s!=="submit"&&s!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function my(t,e,n){(e!=="number"||Qh(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var mc=Array.isArray;function Ua(t,e,n,s){if(t=t.options,e){e={};for(var r=0;r<n.length;r++)e["$"+n[r]]=!0;for(n=0;n<t.length;n++)r=e.hasOwnProperty("$"+t[n].value),t[n].selected!==r&&(t[n].selected=r),r&&s&&(t[n].defaultSelected=!0)}else{for(n=""+Vi(n),e=null,r=0;r<t.length;r++){if(t[r].value===n){t[r].selected=!0,s&&(t[r].defaultSelected=!0);return}e!==null||t[r].disabled||(e=t[r])}e!==null&&(e.selected=!0)}}function gy(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(oe(91));return gt({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function yw(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(oe(92));if(mc(n)){if(1<n.length)throw Error(oe(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:Vi(n)}}function pS(t,e){var n=Vi(e.value),s=Vi(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),s!=null&&(t.defaultValue=""+s)}function xw(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function fS(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function yy(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?fS(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var sh,mS=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,s,r){MSApp.execUnsafeLocalFunction(function(){return t(e,n,s,r)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(sh=sh||document.createElement("div"),sh.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=sh.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function Bc(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var $c={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},D3=["Webkit","ms","Moz","O"];Object.keys($c).forEach(function(t){D3.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),$c[e]=$c[t]})});function gS(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||$c.hasOwnProperty(t)&&$c[t]?(""+e).trim():e+"px"}function yS(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var s=n.indexOf("--")===0,r=gS(n,e[n],s);n==="float"&&(n="cssFloat"),s?t.setProperty(n,r):t[n]=r}}var F3=gt({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function xy(t,e){if(e){if(F3[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(oe(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(oe(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(oe(61))}if(e.style!=null&&typeof e.style!="object")throw Error(oe(62))}}function vy(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var by=null;function hx(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var wy=null,Ga=null,Ha=null;function vw(t){if(t=Cu(t)){if(typeof wy!="function")throw Error(oe(280));var e=t.stateNode;e&&(e=ff(e),wy(t.stateNode,t.type,e))}}function xS(t){Ga?Ha?Ha.push(t):Ha=[t]:Ga=t}function vS(){if(Ga){var t=Ga,e=Ha;if(Ha=Ga=null,vw(t),e)for(t=0;t<e.length;t++)vw(e[t])}}function bS(t,e){return t(e)}function wS(){}var fg=!1;function kS(t,e,n){if(fg)return t(e,n);fg=!0;try{return bS(t,e,n)}finally{fg=!1,(Ga!==null||Ha!==null)&&(wS(),vS())}}function Wc(t,e){var n=t.stateNode;if(n===null)return null;var s=ff(n);if(s===null)return null;n=s[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(s=!s.disabled)||(t=t.type,s=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!s;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(oe(231,e,typeof n));return n}var ky=!1;if(Wr)try{var sc={};Object.defineProperty(sc,"passive",{get:function(){ky=!0}}),window.addEventListener("test",sc,sc),window.removeEventListener("test",sc,sc)}catch{ky=!1}function O3(t,e,n,s,r,i,o,a,l){var c=Array.prototype.slice.call(arguments,3);try{e.apply(n,c)}catch(u){this.onError(u)}}var Tc=!1,Jh=null,Zh=!1,Cy=null,P3={onError:function(t){Tc=!0,Jh=t}};function M3(t,e,n,s,r,i,o,a,l){Tc=!1,Jh=null,O3.apply(P3,arguments)}function L3(t,e,n,s,r,i,o,a,l){if(M3.apply(this,arguments),Tc){if(Tc){var c=Jh;Tc=!1,Jh=null}else throw Error(oe(198));Zh||(Zh=!0,Cy=c)}}function ca(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function CS(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function bw(t){if(ca(t)!==t)throw Error(oe(188))}function z3(t){var e=t.alternate;if(!e){if(e=ca(t),e===null)throw Error(oe(188));return e!==t?null:t}for(var n=t,s=e;;){var r=n.return;if(r===null)break;var i=r.alternate;if(i===null){if(s=r.return,s!==null){n=s;continue}break}if(r.child===i.child){for(i=r.child;i;){if(i===n)return bw(r),t;if(i===s)return bw(r),e;i=i.sibling}throw Error(oe(188))}if(n.return!==s.return)n=r,s=i;else{for(var o=!1,a=r.child;a;){if(a===n){o=!0,n=r,s=i;break}if(a===s){o=!0,s=r,n=i;break}a=a.sibling}if(!o){for(a=i.child;a;){if(a===n){o=!0,n=i,s=r;break}if(a===s){o=!0,s=i,n=r;break}a=a.sibling}if(!o)throw Error(oe(189))}}if(n.alternate!==s)throw Error(oe(190))}if(n.tag!==3)throw Error(oe(188));return n.stateNode.current===n?t:e}function SS(t){return t=z3(t),t!==null?IS(t):null}function IS(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=IS(t);if(e!==null)return e;t=t.sibling}return null}var $S=ns.unstable_scheduleCallback,ww=ns.unstable_cancelCallback,j3=ns.unstable_shouldYield,B3=ns.unstable_requestPaint,St=ns.unstable_now,W3=ns.unstable_getCurrentPriorityLevel,px=ns.unstable_ImmediatePriority,TS=ns.unstable_UserBlockingPriority,ep=ns.unstable_NormalPriority,V3=ns.unstable_LowPriority,ES=ns.unstable_IdlePriority,uf=null,hr=null;function U3(t){if(hr&&typeof hr.onCommitFiberRoot=="function")try{hr.onCommitFiberRoot(uf,t,void 0,(t.current.flags&128)===128)}catch{}}var Gs=Math.clz32?Math.clz32:K3,G3=Math.log,H3=Math.LN2;function K3(t){return t>>>=0,t===0?32:31-(G3(t)/H3|0)|0}var rh=64,ih=4194304;function gc(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function tp(t,e){var n=t.pendingLanes;if(n===0)return 0;var s=0,r=t.suspendedLanes,i=t.pingedLanes,o=n&268435455;if(o!==0){var a=o&~r;a!==0?s=gc(a):(i&=o,i!==0&&(s=gc(i)))}else o=n&~r,o!==0?s=gc(o):i!==0&&(s=gc(i));if(s===0)return 0;if(e!==0&&e!==s&&!(e&r)&&(r=s&-s,i=e&-e,r>=i||r===16&&(i&4194240)!==0))return e;if(s&4&&(s|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=s;0<e;)n=31-Gs(e),r=1<<n,s|=t[n],e&=~r;return s}function q3(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function X3(t,e){for(var n=t.suspendedLanes,s=t.pingedLanes,r=t.expirationTimes,i=t.pendingLanes;0<i;){var o=31-Gs(i),a=1<<o,l=r[o];l===-1?(!(a&n)||a&s)&&(r[o]=q3(a,e)):l<=e&&(t.expiredLanes|=a),i&=~a}}function Sy(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function RS(){var t=rh;return rh<<=1,!(rh&4194240)&&(rh=64),t}function mg(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function wu(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-Gs(e),t[e]=n}function Y3(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var s=t.eventTimes;for(t=t.expirationTimes;0<n;){var r=31-Gs(n),i=1<<r;e[r]=0,s[r]=-1,t[r]=-1,n&=~i}}function fx(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var s=31-Gs(n),r=1<<s;r&e|t[s]&e&&(t[s]|=e),n&=~r}}var Ue=0;function NS(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var AS,mx,_S,DS,FS,Iy=!1,oh=[],Ei=null,Ri=null,Ni=null,Vc=new Map,Uc=new Map,gi=[],Q3="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function kw(t,e){switch(t){case"focusin":case"focusout":Ei=null;break;case"dragenter":case"dragleave":Ri=null;break;case"mouseover":case"mouseout":Ni=null;break;case"pointerover":case"pointerout":Vc.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Uc.delete(e.pointerId)}}function rc(t,e,n,s,r,i){return t===null||t.nativeEvent!==i?(t={blockedOn:e,domEventName:n,eventSystemFlags:s,nativeEvent:i,targetContainers:[r]},e!==null&&(e=Cu(e),e!==null&&mx(e)),t):(t.eventSystemFlags|=s,e=t.targetContainers,r!==null&&e.indexOf(r)===-1&&e.push(r),t)}function J3(t,e,n,s,r){switch(e){case"focusin":return Ei=rc(Ei,t,e,n,s,r),!0;case"dragenter":return Ri=rc(Ri,t,e,n,s,r),!0;case"mouseover":return Ni=rc(Ni,t,e,n,s,r),!0;case"pointerover":var i=r.pointerId;return Vc.set(i,rc(Vc.get(i)||null,t,e,n,s,r)),!0;case"gotpointercapture":return i=r.pointerId,Uc.set(i,rc(Uc.get(i)||null,t,e,n,s,r)),!0}return!1}function OS(t){var e=Io(t.target);if(e!==null){var n=ca(e);if(n!==null){if(e=n.tag,e===13){if(e=CS(n),e!==null){t.blockedOn=e,FS(t.priority,function(){_S(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function Oh(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=$y(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var s=new n.constructor(n.type,n);by=s,n.target.dispatchEvent(s),by=null}else return e=Cu(n),e!==null&&mx(e),t.blockedOn=n,!1;e.shift()}return!0}function Cw(t,e,n){Oh(t)&&n.delete(e)}function Z3(){Iy=!1,Ei!==null&&Oh(Ei)&&(Ei=null),Ri!==null&&Oh(Ri)&&(Ri=null),Ni!==null&&Oh(Ni)&&(Ni=null),Vc.forEach(Cw),Uc.forEach(Cw)}function ic(t,e){t.blockedOn===e&&(t.blockedOn=null,Iy||(Iy=!0,ns.unstable_scheduleCallback(ns.unstable_NormalPriority,Z3)))}function Gc(t){function e(r){return ic(r,t)}if(0<oh.length){ic(oh[0],t);for(var n=1;n<oh.length;n++){var s=oh[n];s.blockedOn===t&&(s.blockedOn=null)}}for(Ei!==null&&ic(Ei,t),Ri!==null&&ic(Ri,t),Ni!==null&&ic(Ni,t),Vc.forEach(e),Uc.forEach(e),n=0;n<gi.length;n++)s=gi[n],s.blockedOn===t&&(s.blockedOn=null);for(;0<gi.length&&(n=gi[0],n.blockedOn===null);)OS(n),n.blockedOn===null&&gi.shift()}var Ka=Zr.ReactCurrentBatchConfig,np=!0;function eF(t,e,n,s){var r=Ue,i=Ka.transition;Ka.transition=null;try{Ue=1,gx(t,e,n,s)}finally{Ue=r,Ka.transition=i}}function tF(t,e,n,s){var r=Ue,i=Ka.transition;Ka.transition=null;try{Ue=4,gx(t,e,n,s)}finally{Ue=r,Ka.transition=i}}function gx(t,e,n,s){if(np){var r=$y(t,e,n,s);if(r===null)Ig(t,e,s,sp,n),kw(t,s);else if(J3(r,t,e,n,s))s.stopPropagation();else if(kw(t,s),e&4&&-1<Q3.indexOf(t)){for(;r!==null;){var i=Cu(r);if(i!==null&&AS(i),i=$y(t,e,n,s),i===null&&Ig(t,e,s,sp,n),i===r)break;r=i}r!==null&&s.stopPropagation()}else Ig(t,e,s,null,n)}}var sp=null;function $y(t,e,n,s){if(sp=null,t=hx(s),t=Io(t),t!==null)if(e=ca(t),e===null)t=null;else if(n=e.tag,n===13){if(t=CS(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return sp=t,null}function PS(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(W3()){case px:return 1;case TS:return 4;case ep:case V3:return 16;case ES:return 536870912;default:return 16}default:return 16}}var ki=null,yx=null,Ph=null;function MS(){if(Ph)return Ph;var t,e=yx,n=e.length,s,r="value"in ki?ki.value:ki.textContent,i=r.length;for(t=0;t<n&&e[t]===r[t];t++);var o=n-t;for(s=1;s<=o&&e[n-s]===r[i-s];s++);return Ph=r.slice(t,1<s?1-s:void 0)}function Mh(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function ah(){return!0}function Sw(){return!1}function is(t){function e(n,s,r,i,o){this._reactName=n,this._targetInst=r,this.type=s,this.nativeEvent=i,this.target=o,this.currentTarget=null;for(var a in t)t.hasOwnProperty(a)&&(n=t[a],this[a]=n?n(i):i[a]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?ah:Sw,this.isPropagationStopped=Sw,this}return gt(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=ah)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=ah)},persist:function(){},isPersistent:ah}),e}var Nl={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},xx=is(Nl),ku=gt({},Nl,{view:0,detail:0}),nF=is(ku),gg,yg,oc,df=gt({},ku,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:vx,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==oc&&(oc&&t.type==="mousemove"?(gg=t.screenX-oc.screenX,yg=t.screenY-oc.screenY):yg=gg=0,oc=t),gg)},movementY:function(t){return"movementY"in t?t.movementY:yg}}),Iw=is(df),sF=gt({},df,{dataTransfer:0}),rF=is(sF),iF=gt({},ku,{relatedTarget:0}),xg=is(iF),oF=gt({},Nl,{animationName:0,elapsedTime:0,pseudoElement:0}),aF=is(oF),lF=gt({},Nl,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),cF=is(lF),uF=gt({},Nl,{data:0}),$w=is(uF),dF={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},hF={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},pF={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function fF(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=pF[t])?!!e[t]:!1}function vx(){return fF}var mF=gt({},ku,{key:function(t){if(t.key){var e=dF[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=Mh(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?hF[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:vx,charCode:function(t){return t.type==="keypress"?Mh(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?Mh(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),gF=is(mF),yF=gt({},df,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Tw=is(yF),xF=gt({},ku,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:vx}),vF=is(xF),bF=gt({},Nl,{propertyName:0,elapsedTime:0,pseudoElement:0}),wF=is(bF),kF=gt({},df,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),CF=is(kF),SF=[9,13,27,32],bx=Wr&&"CompositionEvent"in window,Ec=null;Wr&&"documentMode"in document&&(Ec=document.documentMode);var IF=Wr&&"TextEvent"in window&&!Ec,LS=Wr&&(!bx||Ec&&8<Ec&&11>=Ec),Ew=" ",Rw=!1;function zS(t,e){switch(t){case"keyup":return SF.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function jS(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var _a=!1;function $F(t,e){switch(t){case"compositionend":return jS(e);case"keypress":return e.which!==32?null:(Rw=!0,Ew);case"textInput":return t=e.data,t===Ew&&Rw?null:t;default:return null}}function TF(t,e){if(_a)return t==="compositionend"||!bx&&zS(t,e)?(t=MS(),Ph=yx=ki=null,_a=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return LS&&e.locale!=="ko"?null:e.data;default:return null}}var EF={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Nw(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!EF[t.type]:e==="textarea"}function BS(t,e,n,s){xS(s),e=rp(e,"onChange"),0<e.length&&(n=new xx("onChange","change",null,n,s),t.push({event:n,listeners:e}))}var Rc=null,Hc=null;function RF(t){JS(t,0)}function hf(t){var e=Oa(t);if(dS(e))return t}function NF(t,e){if(t==="change")return e}var WS=!1;if(Wr){var vg;if(Wr){var bg="oninput"in document;if(!bg){var Aw=document.createElement("div");Aw.setAttribute("oninput","return;"),bg=typeof Aw.oninput=="function"}vg=bg}else vg=!1;WS=vg&&(!document.documentMode||9<document.documentMode)}function _w(){Rc&&(Rc.detachEvent("onpropertychange",VS),Hc=Rc=null)}function VS(t){if(t.propertyName==="value"&&hf(Hc)){var e=[];BS(e,Hc,t,hx(t)),kS(RF,e)}}function AF(t,e,n){t==="focusin"?(_w(),Rc=e,Hc=n,Rc.attachEvent("onpropertychange",VS)):t==="focusout"&&_w()}function _F(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return hf(Hc)}function DF(t,e){if(t==="click")return hf(e)}function FF(t,e){if(t==="input"||t==="change")return hf(e)}function OF(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var Ys=typeof Object.is=="function"?Object.is:OF;function Kc(t,e){if(Ys(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),s=Object.keys(e);if(n.length!==s.length)return!1;for(s=0;s<n.length;s++){var r=n[s];if(!ly.call(e,r)||!Ys(t[r],e[r]))return!1}return!0}function Dw(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function Fw(t,e){var n=Dw(t);t=0;for(var s;n;){if(n.nodeType===3){if(s=t+n.textContent.length,t<=e&&s>=e)return{node:n,offset:e-t};t=s}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=Dw(n)}}function US(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?US(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function GS(){for(var t=window,e=Qh();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=Qh(t.document)}return e}function wx(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function PF(t){var e=GS(),n=t.focusedElem,s=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&US(n.ownerDocument.documentElement,n)){if(s!==null&&wx(n)){if(e=s.start,t=s.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var r=n.textContent.length,i=Math.min(s.start,r);s=s.end===void 0?i:Math.min(s.end,r),!t.extend&&i>s&&(r=s,s=i,i=r),r=Fw(n,i);var o=Fw(n,s);r&&o&&(t.rangeCount!==1||t.anchorNode!==r.node||t.anchorOffset!==r.offset||t.focusNode!==o.node||t.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(r.node,r.offset),t.removeAllRanges(),i>s?(t.addRange(e),t.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var MF=Wr&&"documentMode"in document&&11>=document.documentMode,Da=null,Ty=null,Nc=null,Ey=!1;function Ow(t,e,n){var s=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;Ey||Da==null||Da!==Qh(s)||(s=Da,"selectionStart"in s&&wx(s)?s={start:s.selectionStart,end:s.selectionEnd}:(s=(s.ownerDocument&&s.ownerDocument.defaultView||window).getSelection(),s={anchorNode:s.anchorNode,anchorOffset:s.anchorOffset,focusNode:s.focusNode,focusOffset:s.focusOffset}),Nc&&Kc(Nc,s)||(Nc=s,s=rp(Ty,"onSelect"),0<s.length&&(e=new xx("onSelect","select",null,e,n),t.push({event:e,listeners:s}),e.target=Da)))}function lh(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var Fa={animationend:lh("Animation","AnimationEnd"),animationiteration:lh("Animation","AnimationIteration"),animationstart:lh("Animation","AnimationStart"),transitionend:lh("Transition","TransitionEnd")},wg={},HS={};Wr&&(HS=document.createElement("div").style,"AnimationEvent"in window||(delete Fa.animationend.animation,delete Fa.animationiteration.animation,delete Fa.animationstart.animation),"TransitionEvent"in window||delete Fa.transitionend.transition);function pf(t){if(wg[t])return wg[t];if(!Fa[t])return t;var e=Fa[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in HS)return wg[t]=e[n];return t}var KS=pf("animationend"),qS=pf("animationiteration"),XS=pf("animationstart"),YS=pf("transitionend"),QS=new Map,Pw="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Qi(t,e){QS.set(t,e),la(e,[t])}for(var kg=0;kg<Pw.length;kg++){var Cg=Pw[kg],LF=Cg.toLowerCase(),zF=Cg[0].toUpperCase()+Cg.slice(1);Qi(LF,"on"+zF)}Qi(KS,"onAnimationEnd");Qi(qS,"onAnimationIteration");Qi(XS,"onAnimationStart");Qi("dblclick","onDoubleClick");Qi("focusin","onFocus");Qi("focusout","onBlur");Qi(YS,"onTransitionEnd");rl("onMouseEnter",["mouseout","mouseover"]);rl("onMouseLeave",["mouseout","mouseover"]);rl("onPointerEnter",["pointerout","pointerover"]);rl("onPointerLeave",["pointerout","pointerover"]);la("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));la("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));la("onBeforeInput",["compositionend","keypress","textInput","paste"]);la("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));la("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));la("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var yc="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),jF=new Set("cancel close invalid load scroll toggle".split(" ").concat(yc));function Mw(t,e,n){var s=t.type||"unknown-event";t.currentTarget=n,L3(s,e,void 0,t),t.currentTarget=null}function JS(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var s=t[n],r=s.event;s=s.listeners;e:{var i=void 0;if(e)for(var o=s.length-1;0<=o;o--){var a=s[o],l=a.instance,c=a.currentTarget;if(a=a.listener,l!==i&&r.isPropagationStopped())break e;Mw(r,a,c),i=l}else for(o=0;o<s.length;o++){if(a=s[o],l=a.instance,c=a.currentTarget,a=a.listener,l!==i&&r.isPropagationStopped())break e;Mw(r,a,c),i=l}}}if(Zh)throw t=Cy,Zh=!1,Cy=null,t}function rt(t,e){var n=e[Dy];n===void 0&&(n=e[Dy]=new Set);var s=t+"__bubble";n.has(s)||(ZS(e,t,2,!1),n.add(s))}function Sg(t,e,n){var s=0;e&&(s|=4),ZS(n,t,s,e)}var ch="_reactListening"+Math.random().toString(36).slice(2);function qc(t){if(!t[ch]){t[ch]=!0,oS.forEach(function(n){n!=="selectionchange"&&(jF.has(n)||Sg(n,!1,t),Sg(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[ch]||(e[ch]=!0,Sg("selectionchange",!1,e))}}function ZS(t,e,n,s){switch(PS(e)){case 1:var r=eF;break;case 4:r=tF;break;default:r=gx}n=r.bind(null,e,n,t),r=void 0,!ky||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(r=!0),s?r!==void 0?t.addEventListener(e,n,{capture:!0,passive:r}):t.addEventListener(e,n,!0):r!==void 0?t.addEventListener(e,n,{passive:r}):t.addEventListener(e,n,!1)}function Ig(t,e,n,s,r){var i=s;if(!(e&1)&&!(e&2)&&s!==null)e:for(;;){if(s===null)return;var o=s.tag;if(o===3||o===4){var a=s.stateNode.containerInfo;if(a===r||a.nodeType===8&&a.parentNode===r)break;if(o===4)for(o=s.return;o!==null;){var l=o.tag;if((l===3||l===4)&&(l=o.stateNode.containerInfo,l===r||l.nodeType===8&&l.parentNode===r))return;o=o.return}for(;a!==null;){if(o=Io(a),o===null)return;if(l=o.tag,l===5||l===6){s=i=o;continue e}a=a.parentNode}}s=s.return}kS(function(){var c=i,u=hx(n),d=[];e:{var h=QS.get(t);if(h!==void 0){var p=xx,f=t;switch(t){case"keypress":if(Mh(n)===0)break e;case"keydown":case"keyup":p=gF;break;case"focusin":f="focus",p=xg;break;case"focusout":f="blur",p=xg;break;case"beforeblur":case"afterblur":p=xg;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":p=Iw;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":p=rF;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":p=vF;break;case KS:case qS:case XS:p=aF;break;case YS:p=wF;break;case"scroll":p=nF;break;case"wheel":p=CF;break;case"copy":case"cut":case"paste":p=cF;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":p=Tw}var g=(e&4)!==0,x=!g&&t==="scroll",y=g?h!==null?h+"Capture":null:h;g=[];for(var v=c,b;v!==null;){b=v;var w=b.stateNode;if(b.tag===5&&w!==null&&(b=w,y!==null&&(w=Wc(v,y),w!=null&&g.push(Xc(v,w,b)))),x)break;v=v.return}0<g.length&&(h=new p(h,f,null,n,u),d.push({event:h,listeners:g}))}}if(!(e&7)){e:{if(h=t==="mouseover"||t==="pointerover",p=t==="mouseout"||t==="pointerout",h&&n!==by&&(f=n.relatedTarget||n.fromElement)&&(Io(f)||f[Vr]))break e;if((p||h)&&(h=u.window===u?u:(h=u.ownerDocument)?h.defaultView||h.parentWindow:window,p?(f=n.relatedTarget||n.toElement,p=c,f=f?Io(f):null,f!==null&&(x=ca(f),f!==x||f.tag!==5&&f.tag!==6)&&(f=null)):(p=null,f=c),p!==f)){if(g=Iw,w="onMouseLeave",y="onMouseEnter",v="mouse",(t==="pointerout"||t==="pointerover")&&(g=Tw,w="onPointerLeave",y="onPointerEnter",v="pointer"),x=p==null?h:Oa(p),b=f==null?h:Oa(f),h=new g(w,v+"leave",p,n,u),h.target=x,h.relatedTarget=b,w=null,Io(u)===c&&(g=new g(y,v+"enter",f,n,u),g.target=b,g.relatedTarget=x,w=g),x=w,p&&f)t:{for(g=p,y=f,v=0,b=g;b;b=Sa(b))v++;for(b=0,w=y;w;w=Sa(w))b++;for(;0<v-b;)g=Sa(g),v--;for(;0<b-v;)y=Sa(y),b--;for(;v--;){if(g===y||y!==null&&g===y.alternate)break t;g=Sa(g),y=Sa(y)}g=null}else g=null;p!==null&&Lw(d,h,p,g,!1),f!==null&&x!==null&&Lw(d,x,f,g,!0)}}e:{if(h=c?Oa(c):window,p=h.nodeName&&h.nodeName.toLowerCase(),p==="select"||p==="input"&&h.type==="file")var k=NF;else if(Nw(h))if(WS)k=FF;else{k=_F;var S=AF}else(p=h.nodeName)&&p.toLowerCase()==="input"&&(h.type==="checkbox"||h.type==="radio")&&(k=DF);if(k&&(k=k(t,c))){BS(d,k,n,u);break e}S&&S(t,h,c),t==="focusout"&&(S=h._wrapperState)&&S.controlled&&h.type==="number"&&my(h,"number",h.value)}switch(S=c?Oa(c):window,t){case"focusin":(Nw(S)||S.contentEditable==="true")&&(Da=S,Ty=c,Nc=null);break;case"focusout":Nc=Ty=Da=null;break;case"mousedown":Ey=!0;break;case"contextmenu":case"mouseup":case"dragend":Ey=!1,Ow(d,n,u);break;case"selectionchange":if(MF)break;case"keydown":case"keyup":Ow(d,n,u)}var I;if(bx)e:{switch(t){case"compositionstart":var C="onCompositionStart";break e;case"compositionend":C="onCompositionEnd";break e;case"compositionupdate":C="onCompositionUpdate";break e}C=void 0}else _a?zS(t,n)&&(C="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(C="onCompositionStart");C&&(LS&&n.locale!=="ko"&&(_a||C!=="onCompositionStart"?C==="onCompositionEnd"&&_a&&(I=MS()):(ki=u,yx="value"in ki?ki.value:ki.textContent,_a=!0)),S=rp(c,C),0<S.length&&(C=new $w(C,t,null,n,u),d.push({event:C,listeners:S}),I?C.data=I:(I=jS(n),I!==null&&(C.data=I)))),(I=IF?$F(t,n):TF(t,n))&&(c=rp(c,"onBeforeInput"),0<c.length&&(u=new $w("onBeforeInput","beforeinput",null,n,u),d.push({event:u,listeners:c}),u.data=I))}JS(d,e)})}function Xc(t,e,n){return{instance:t,listener:e,currentTarget:n}}function rp(t,e){for(var n=e+"Capture",s=[];t!==null;){var r=t,i=r.stateNode;r.tag===5&&i!==null&&(r=i,i=Wc(t,n),i!=null&&s.unshift(Xc(t,i,r)),i=Wc(t,e),i!=null&&s.push(Xc(t,i,r))),t=t.return}return s}function Sa(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function Lw(t,e,n,s,r){for(var i=e._reactName,o=[];n!==null&&n!==s;){var a=n,l=a.alternate,c=a.stateNode;if(l!==null&&l===s)break;a.tag===5&&c!==null&&(a=c,r?(l=Wc(n,i),l!=null&&o.unshift(Xc(n,l,a))):r||(l=Wc(n,i),l!=null&&o.push(Xc(n,l,a)))),n=n.return}o.length!==0&&t.push({event:e,listeners:o})}var BF=/\r\n?/g,WF=/\u0000|\uFFFD/g;function zw(t){return(typeof t=="string"?t:""+t).replace(BF,`
`).replace(WF,"")}function uh(t,e,n){if(e=zw(e),zw(t)!==e&&n)throw Error(oe(425))}function ip(){}var Ry=null,Ny=null;function Ay(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var _y=typeof setTimeout=="function"?setTimeout:void 0,VF=typeof clearTimeout=="function"?clearTimeout:void 0,jw=typeof Promise=="function"?Promise:void 0,UF=typeof queueMicrotask=="function"?queueMicrotask:typeof jw<"u"?function(t){return jw.resolve(null).then(t).catch(GF)}:_y;function GF(t){setTimeout(function(){throw t})}function $g(t,e){var n=e,s=0;do{var r=n.nextSibling;if(t.removeChild(n),r&&r.nodeType===8)if(n=r.data,n==="/$"){if(s===0){t.removeChild(r),Gc(e);return}s--}else n!=="$"&&n!=="$?"&&n!=="$!"||s++;n=r}while(n);Gc(e)}function Ai(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function Bw(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var Al=Math.random().toString(36).slice(2),ur="__reactFiber$"+Al,Yc="__reactProps$"+Al,Vr="__reactContainer$"+Al,Dy="__reactEvents$"+Al,HF="__reactListeners$"+Al,KF="__reactHandles$"+Al;function Io(t){var e=t[ur];if(e)return e;for(var n=t.parentNode;n;){if(e=n[Vr]||n[ur]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=Bw(t);t!==null;){if(n=t[ur])return n;t=Bw(t)}return e}t=n,n=t.parentNode}return null}function Cu(t){return t=t[ur]||t[Vr],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function Oa(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(oe(33))}function ff(t){return t[Yc]||null}var Fy=[],Pa=-1;function Ji(t){return{current:t}}function it(t){0>Pa||(t.current=Fy[Pa],Fy[Pa]=null,Pa--)}function Ze(t,e){Pa++,Fy[Pa]=t.current,t.current=e}var Ui={},xn=Ji(Ui),zn=Ji(!1),zo=Ui;function il(t,e){var n=t.type.contextTypes;if(!n)return Ui;var s=t.stateNode;if(s&&s.__reactInternalMemoizedUnmaskedChildContext===e)return s.__reactInternalMemoizedMaskedChildContext;var r={},i;for(i in n)r[i]=e[i];return s&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=r),r}function jn(t){return t=t.childContextTypes,t!=null}function op(){it(zn),it(xn)}function Ww(t,e,n){if(xn.current!==Ui)throw Error(oe(168));Ze(xn,e),Ze(zn,n)}function eI(t,e,n){var s=t.stateNode;if(e=e.childContextTypes,typeof s.getChildContext!="function")return n;s=s.getChildContext();for(var r in s)if(!(r in e))throw Error(oe(108,A3(t)||"Unknown",r));return gt({},n,s)}function ap(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||Ui,zo=xn.current,Ze(xn,t),Ze(zn,zn.current),!0}function Vw(t,e,n){var s=t.stateNode;if(!s)throw Error(oe(169));n?(t=eI(t,e,zo),s.__reactInternalMemoizedMergedChildContext=t,it(zn),it(xn),Ze(xn,t)):it(zn),Ze(zn,n)}var Ar=null,mf=!1,Tg=!1;function tI(t){Ar===null?Ar=[t]:Ar.push(t)}function qF(t){mf=!0,tI(t)}function Zi(){if(!Tg&&Ar!==null){Tg=!0;var t=0,e=Ue;try{var n=Ar;for(Ue=1;t<n.length;t++){var s=n[t];do s=s(!0);while(s!==null)}Ar=null,mf=!1}catch(r){throw Ar!==null&&(Ar=Ar.slice(t+1)),$S(px,Zi),r}finally{Ue=e,Tg=!1}}return null}var Ma=[],La=0,lp=null,cp=0,ds=[],hs=0,jo=null,Fr=1,Or="";function xo(t,e){Ma[La++]=cp,Ma[La++]=lp,lp=t,cp=e}function nI(t,e,n){ds[hs++]=Fr,ds[hs++]=Or,ds[hs++]=jo,jo=t;var s=Fr;t=Or;var r=32-Gs(s)-1;s&=~(1<<r),n+=1;var i=32-Gs(e)+r;if(30<i){var o=r-r%5;i=(s&(1<<o)-1).toString(32),s>>=o,r-=o,Fr=1<<32-Gs(e)+r|n<<r|s,Or=i+t}else Fr=1<<i|n<<r|s,Or=t}function kx(t){t.return!==null&&(xo(t,1),nI(t,1,0))}function Cx(t){for(;t===lp;)lp=Ma[--La],Ma[La]=null,cp=Ma[--La],Ma[La]=null;for(;t===jo;)jo=ds[--hs],ds[hs]=null,Or=ds[--hs],ds[hs]=null,Fr=ds[--hs],ds[hs]=null}var Jn=null,Yn=null,ct=!1,Ls=null;function sI(t,e){var n=ms(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function Uw(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,Jn=t,Yn=Ai(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,Jn=t,Yn=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=jo!==null?{id:Fr,overflow:Or}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=ms(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,Jn=t,Yn=null,!0):!1;default:return!1}}function Oy(t){return(t.mode&1)!==0&&(t.flags&128)===0}function Py(t){if(ct){var e=Yn;if(e){var n=e;if(!Uw(t,e)){if(Oy(t))throw Error(oe(418));e=Ai(n.nextSibling);var s=Jn;e&&Uw(t,e)?sI(s,n):(t.flags=t.flags&-4097|2,ct=!1,Jn=t)}}else{if(Oy(t))throw Error(oe(418));t.flags=t.flags&-4097|2,ct=!1,Jn=t}}}function Gw(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;Jn=t}function dh(t){if(t!==Jn)return!1;if(!ct)return Gw(t),ct=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!Ay(t.type,t.memoizedProps)),e&&(e=Yn)){if(Oy(t))throw rI(),Error(oe(418));for(;e;)sI(t,e),e=Ai(e.nextSibling)}if(Gw(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(oe(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){Yn=Ai(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}Yn=null}}else Yn=Jn?Ai(t.stateNode.nextSibling):null;return!0}function rI(){for(var t=Yn;t;)t=Ai(t.nextSibling)}function ol(){Yn=Jn=null,ct=!1}function Sx(t){Ls===null?Ls=[t]:Ls.push(t)}var XF=Zr.ReactCurrentBatchConfig;function ac(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(oe(309));var s=n.stateNode}if(!s)throw Error(oe(147,t));var r=s,i=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===i?e.ref:(e=function(o){var a=r.refs;o===null?delete a[i]:a[i]=o},e._stringRef=i,e)}if(typeof t!="string")throw Error(oe(284));if(!n._owner)throw Error(oe(290,t))}return t}function hh(t,e){throw t=Object.prototype.toString.call(e),Error(oe(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function Hw(t){var e=t._init;return e(t._payload)}function iI(t){function e(y,v){if(t){var b=y.deletions;b===null?(y.deletions=[v],y.flags|=16):b.push(v)}}function n(y,v){if(!t)return null;for(;v!==null;)e(y,v),v=v.sibling;return null}function s(y,v){for(y=new Map;v!==null;)v.key!==null?y.set(v.key,v):y.set(v.index,v),v=v.sibling;return y}function r(y,v){return y=Oi(y,v),y.index=0,y.sibling=null,y}function i(y,v,b){return y.index=b,t?(b=y.alternate,b!==null?(b=b.index,b<v?(y.flags|=2,v):b):(y.flags|=2,v)):(y.flags|=1048576,v)}function o(y){return t&&y.alternate===null&&(y.flags|=2),y}function a(y,v,b,w){return v===null||v.tag!==6?(v=Fg(b,y.mode,w),v.return=y,v):(v=r(v,b),v.return=y,v)}function l(y,v,b,w){var k=b.type;return k===Aa?u(y,v,b.props.children,w,b.key):v!==null&&(v.elementType===k||typeof k=="object"&&k!==null&&k.$$typeof===pi&&Hw(k)===v.type)?(w=r(v,b.props),w.ref=ac(y,v,b),w.return=y,w):(w=Uh(b.type,b.key,b.props,null,y.mode,w),w.ref=ac(y,v,b),w.return=y,w)}function c(y,v,b,w){return v===null||v.tag!==4||v.stateNode.containerInfo!==b.containerInfo||v.stateNode.implementation!==b.implementation?(v=Og(b,y.mode,w),v.return=y,v):(v=r(v,b.children||[]),v.return=y,v)}function u(y,v,b,w,k){return v===null||v.tag!==7?(v=Do(b,y.mode,w,k),v.return=y,v):(v=r(v,b),v.return=y,v)}function d(y,v,b){if(typeof v=="string"&&v!==""||typeof v=="number")return v=Fg(""+v,y.mode,b),v.return=y,v;if(typeof v=="object"&&v!==null){switch(v.$$typeof){case th:return b=Uh(v.type,v.key,v.props,null,y.mode,b),b.ref=ac(y,null,v),b.return=y,b;case Na:return v=Og(v,y.mode,b),v.return=y,v;case pi:var w=v._init;return d(y,w(v._payload),b)}if(mc(v)||nc(v))return v=Do(v,y.mode,b,null),v.return=y,v;hh(y,v)}return null}function h(y,v,b,w){var k=v!==null?v.key:null;if(typeof b=="string"&&b!==""||typeof b=="number")return k!==null?null:a(y,v,""+b,w);if(typeof b=="object"&&b!==null){switch(b.$$typeof){case th:return b.key===k?l(y,v,b,w):null;case Na:return b.key===k?c(y,v,b,w):null;case pi:return k=b._init,h(y,v,k(b._payload),w)}if(mc(b)||nc(b))return k!==null?null:u(y,v,b,w,null);hh(y,b)}return null}function p(y,v,b,w,k){if(typeof w=="string"&&w!==""||typeof w=="number")return y=y.get(b)||null,a(v,y,""+w,k);if(typeof w=="object"&&w!==null){switch(w.$$typeof){case th:return y=y.get(w.key===null?b:w.key)||null,l(v,y,w,k);case Na:return y=y.get(w.key===null?b:w.key)||null,c(v,y,w,k);case pi:var S=w._init;return p(y,v,b,S(w._payload),k)}if(mc(w)||nc(w))return y=y.get(b)||null,u(v,y,w,k,null);hh(v,w)}return null}function f(y,v,b,w){for(var k=null,S=null,I=v,C=v=0,$=null;I!==null&&C<b.length;C++){I.index>C?($=I,I=null):$=I.sibling;var R=h(y,I,b[C],w);if(R===null){I===null&&(I=$);break}t&&I&&R.alternate===null&&e(y,I),v=i(R,v,C),S===null?k=R:S.sibling=R,S=R,I=$}if(C===b.length)return n(y,I),ct&&xo(y,C),k;if(I===null){for(;C<b.length;C++)I=d(y,b[C],w),I!==null&&(v=i(I,v,C),S===null?k=I:S.sibling=I,S=I);return ct&&xo(y,C),k}for(I=s(y,I);C<b.length;C++)$=p(I,y,C,b[C],w),$!==null&&(t&&$.alternate!==null&&I.delete($.key===null?C:$.key),v=i($,v,C),S===null?k=$:S.sibling=$,S=$);return t&&I.forEach(function(_){return e(y,_)}),ct&&xo(y,C),k}function g(y,v,b,w){var k=nc(b);if(typeof k!="function")throw Error(oe(150));if(b=k.call(b),b==null)throw Error(oe(151));for(var S=k=null,I=v,C=v=0,$=null,R=b.next();I!==null&&!R.done;C++,R=b.next()){I.index>C?($=I,I=null):$=I.sibling;var _=h(y,I,R.value,w);if(_===null){I===null&&(I=$);break}t&&I&&_.alternate===null&&e(y,I),v=i(_,v,C),S===null?k=_:S.sibling=_,S=_,I=$}if(R.done)return n(y,I),ct&&xo(y,C),k;if(I===null){for(;!R.done;C++,R=b.next())R=d(y,R.value,w),R!==null&&(v=i(R,v,C),S===null?k=R:S.sibling=R,S=R);return ct&&xo(y,C),k}for(I=s(y,I);!R.done;C++,R=b.next())R=p(I,y,C,R.value,w),R!==null&&(t&&R.alternate!==null&&I.delete(R.key===null?C:R.key),v=i(R,v,C),S===null?k=R:S.sibling=R,S=R);return t&&I.forEach(function(M){return e(y,M)}),ct&&xo(y,C),k}function x(y,v,b,w){if(typeof b=="object"&&b!==null&&b.type===Aa&&b.key===null&&(b=b.props.children),typeof b=="object"&&b!==null){switch(b.$$typeof){case th:e:{for(var k=b.key,S=v;S!==null;){if(S.key===k){if(k=b.type,k===Aa){if(S.tag===7){n(y,S.sibling),v=r(S,b.props.children),v.return=y,y=v;break e}}else if(S.elementType===k||typeof k=="object"&&k!==null&&k.$$typeof===pi&&Hw(k)===S.type){n(y,S.sibling),v=r(S,b.props),v.ref=ac(y,S,b),v.return=y,y=v;break e}n(y,S);break}else e(y,S);S=S.sibling}b.type===Aa?(v=Do(b.props.children,y.mode,w,b.key),v.return=y,y=v):(w=Uh(b.type,b.key,b.props,null,y.mode,w),w.ref=ac(y,v,b),w.return=y,y=w)}return o(y);case Na:e:{for(S=b.key;v!==null;){if(v.key===S)if(v.tag===4&&v.stateNode.containerInfo===b.containerInfo&&v.stateNode.implementation===b.implementation){n(y,v.sibling),v=r(v,b.children||[]),v.return=y,y=v;break e}else{n(y,v);break}else e(y,v);v=v.sibling}v=Og(b,y.mode,w),v.return=y,y=v}return o(y);case pi:return S=b._init,x(y,v,S(b._payload),w)}if(mc(b))return f(y,v,b,w);if(nc(b))return g(y,v,b,w);hh(y,b)}return typeof b=="string"&&b!==""||typeof b=="number"?(b=""+b,v!==null&&v.tag===6?(n(y,v.sibling),v=r(v,b),v.return=y,y=v):(n(y,v),v=Fg(b,y.mode,w),v.return=y,y=v),o(y)):n(y,v)}return x}var al=iI(!0),oI=iI(!1),up=Ji(null),dp=null,za=null,Ix=null;function $x(){Ix=za=dp=null}function Tx(t){var e=up.current;it(up),t._currentValue=e}function My(t,e,n){for(;t!==null;){var s=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,s!==null&&(s.childLanes|=e)):s!==null&&(s.childLanes&e)!==e&&(s.childLanes|=e),t===n)break;t=t.return}}function qa(t,e){dp=t,Ix=za=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(Pn=!0),t.firstContext=null)}function Cs(t){var e=t._currentValue;if(Ix!==t)if(t={context:t,memoizedValue:e,next:null},za===null){if(dp===null)throw Error(oe(308));za=t,dp.dependencies={lanes:0,firstContext:t}}else za=za.next=t;return e}var $o=null;function Ex(t){$o===null?$o=[t]:$o.push(t)}function aI(t,e,n,s){var r=e.interleaved;return r===null?(n.next=n,Ex(e)):(n.next=r.next,r.next=n),e.interleaved=n,Ur(t,s)}function Ur(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var fi=!1;function Rx(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function lI(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function zr(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function _i(t,e,n){var s=t.updateQueue;if(s===null)return null;if(s=s.shared,Me&2){var r=s.pending;return r===null?e.next=e:(e.next=r.next,r.next=e),s.pending=e,Ur(t,n)}return r=s.interleaved,r===null?(e.next=e,Ex(s)):(e.next=r.next,r.next=e),s.interleaved=e,Ur(t,n)}function Lh(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var s=e.lanes;s&=t.pendingLanes,n|=s,e.lanes=n,fx(t,n)}}function Kw(t,e){var n=t.updateQueue,s=t.alternate;if(s!==null&&(s=s.updateQueue,n===s)){var r=null,i=null;if(n=n.firstBaseUpdate,n!==null){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};i===null?r=i=o:i=i.next=o,n=n.next}while(n!==null);i===null?r=i=e:i=i.next=e}else r=i=e;n={baseState:s.baseState,firstBaseUpdate:r,lastBaseUpdate:i,shared:s.shared,effects:s.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function hp(t,e,n,s){var r=t.updateQueue;fi=!1;var i=r.firstBaseUpdate,o=r.lastBaseUpdate,a=r.shared.pending;if(a!==null){r.shared.pending=null;var l=a,c=l.next;l.next=null,o===null?i=c:o.next=c,o=l;var u=t.alternate;u!==null&&(u=u.updateQueue,a=u.lastBaseUpdate,a!==o&&(a===null?u.firstBaseUpdate=c:a.next=c,u.lastBaseUpdate=l))}if(i!==null){var d=r.baseState;o=0,u=c=l=null,a=i;do{var h=a.lane,p=a.eventTime;if((s&h)===h){u!==null&&(u=u.next={eventTime:p,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var f=t,g=a;switch(h=e,p=n,g.tag){case 1:if(f=g.payload,typeof f=="function"){d=f.call(p,d,h);break e}d=f;break e;case 3:f.flags=f.flags&-65537|128;case 0:if(f=g.payload,h=typeof f=="function"?f.call(p,d,h):f,h==null)break e;d=gt({},d,h);break e;case 2:fi=!0}}a.callback!==null&&a.lane!==0&&(t.flags|=64,h=r.effects,h===null?r.effects=[a]:h.push(a))}else p={eventTime:p,lane:h,tag:a.tag,payload:a.payload,callback:a.callback,next:null},u===null?(c=u=p,l=d):u=u.next=p,o|=h;if(a=a.next,a===null){if(a=r.shared.pending,a===null)break;h=a,a=h.next,h.next=null,r.lastBaseUpdate=h,r.shared.pending=null}}while(!0);if(u===null&&(l=d),r.baseState=l,r.firstBaseUpdate=c,r.lastBaseUpdate=u,e=r.shared.interleaved,e!==null){r=e;do o|=r.lane,r=r.next;while(r!==e)}else i===null&&(r.shared.lanes=0);Wo|=o,t.lanes=o,t.memoizedState=d}}function qw(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var s=t[e],r=s.callback;if(r!==null){if(s.callback=null,s=n,typeof r!="function")throw Error(oe(191,r));r.call(s)}}}var Su={},pr=Ji(Su),Qc=Ji(Su),Jc=Ji(Su);function To(t){if(t===Su)throw Error(oe(174));return t}function Nx(t,e){switch(Ze(Jc,e),Ze(Qc,t),Ze(pr,Su),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:yy(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=yy(e,t)}it(pr),Ze(pr,e)}function ll(){it(pr),it(Qc),it(Jc)}function cI(t){To(Jc.current);var e=To(pr.current),n=yy(e,t.type);e!==n&&(Ze(Qc,t),Ze(pr,n))}function Ax(t){Qc.current===t&&(it(pr),it(Qc))}var pt=Ji(0);function pp(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var Eg=[];function _x(){for(var t=0;t<Eg.length;t++)Eg[t]._workInProgressVersionPrimary=null;Eg.length=0}var zh=Zr.ReactCurrentDispatcher,Rg=Zr.ReactCurrentBatchConfig,Bo=0,ft=null,Pt=null,Ut=null,fp=!1,Ac=!1,Zc=0,YF=0;function ln(){throw Error(oe(321))}function Dx(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!Ys(t[n],e[n]))return!1;return!0}function Fx(t,e,n,s,r,i){if(Bo=i,ft=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,zh.current=t===null||t.memoizedState===null?eO:tO,t=n(s,r),Ac){i=0;do{if(Ac=!1,Zc=0,25<=i)throw Error(oe(301));i+=1,Ut=Pt=null,e.updateQueue=null,zh.current=nO,t=n(s,r)}while(Ac)}if(zh.current=mp,e=Pt!==null&&Pt.next!==null,Bo=0,Ut=Pt=ft=null,fp=!1,e)throw Error(oe(300));return t}function Ox(){var t=Zc!==0;return Zc=0,t}function rr(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ut===null?ft.memoizedState=Ut=t:Ut=Ut.next=t,Ut}function Ss(){if(Pt===null){var t=ft.alternate;t=t!==null?t.memoizedState:null}else t=Pt.next;var e=Ut===null?ft.memoizedState:Ut.next;if(e!==null)Ut=e,Pt=t;else{if(t===null)throw Error(oe(310));Pt=t,t={memoizedState:Pt.memoizedState,baseState:Pt.baseState,baseQueue:Pt.baseQueue,queue:Pt.queue,next:null},Ut===null?ft.memoizedState=Ut=t:Ut=Ut.next=t}return Ut}function eu(t,e){return typeof e=="function"?e(t):e}function Ng(t){var e=Ss(),n=e.queue;if(n===null)throw Error(oe(311));n.lastRenderedReducer=t;var s=Pt,r=s.baseQueue,i=n.pending;if(i!==null){if(r!==null){var o=r.next;r.next=i.next,i.next=o}s.baseQueue=r=i,n.pending=null}if(r!==null){i=r.next,s=s.baseState;var a=o=null,l=null,c=i;do{var u=c.lane;if((Bo&u)===u)l!==null&&(l=l.next={lane:0,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null}),s=c.hasEagerState?c.eagerState:t(s,c.action);else{var d={lane:u,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null};l===null?(a=l=d,o=s):l=l.next=d,ft.lanes|=u,Wo|=u}c=c.next}while(c!==null&&c!==i);l===null?o=s:l.next=a,Ys(s,e.memoizedState)||(Pn=!0),e.memoizedState=s,e.baseState=o,e.baseQueue=l,n.lastRenderedState=s}if(t=n.interleaved,t!==null){r=t;do i=r.lane,ft.lanes|=i,Wo|=i,r=r.next;while(r!==t)}else r===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function Ag(t){var e=Ss(),n=e.queue;if(n===null)throw Error(oe(311));n.lastRenderedReducer=t;var s=n.dispatch,r=n.pending,i=e.memoizedState;if(r!==null){n.pending=null;var o=r=r.next;do i=t(i,o.action),o=o.next;while(o!==r);Ys(i,e.memoizedState)||(Pn=!0),e.memoizedState=i,e.baseQueue===null&&(e.baseState=i),n.lastRenderedState=i}return[i,s]}function uI(){}function dI(t,e){var n=ft,s=Ss(),r=e(),i=!Ys(s.memoizedState,r);if(i&&(s.memoizedState=r,Pn=!0),s=s.queue,Px(fI.bind(null,n,s,t),[t]),s.getSnapshot!==e||i||Ut!==null&&Ut.memoizedState.tag&1){if(n.flags|=2048,tu(9,pI.bind(null,n,s,r,e),void 0,null),Ht===null)throw Error(oe(349));Bo&30||hI(n,e,r)}return r}function hI(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=ft.updateQueue,e===null?(e={lastEffect:null,stores:null},ft.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function pI(t,e,n,s){e.value=n,e.getSnapshot=s,mI(e)&&gI(t)}function fI(t,e,n){return n(function(){mI(e)&&gI(t)})}function mI(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!Ys(t,n)}catch{return!0}}function gI(t){var e=Ur(t,1);e!==null&&Hs(e,t,1,-1)}function Xw(t){var e=rr();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:eu,lastRenderedState:t},e.queue=t,t=t.dispatch=ZF.bind(null,ft,t),[e.memoizedState,t]}function tu(t,e,n,s){return t={tag:t,create:e,destroy:n,deps:s,next:null},e=ft.updateQueue,e===null?(e={lastEffect:null,stores:null},ft.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(s=n.next,n.next=t,t.next=s,e.lastEffect=t)),t}function yI(){return Ss().memoizedState}function jh(t,e,n,s){var r=rr();ft.flags|=t,r.memoizedState=tu(1|e,n,void 0,s===void 0?null:s)}function gf(t,e,n,s){var r=Ss();s=s===void 0?null:s;var i=void 0;if(Pt!==null){var o=Pt.memoizedState;if(i=o.destroy,s!==null&&Dx(s,o.deps)){r.memoizedState=tu(e,n,i,s);return}}ft.flags|=t,r.memoizedState=tu(1|e,n,i,s)}function Yw(t,e){return jh(8390656,8,t,e)}function Px(t,e){return gf(2048,8,t,e)}function xI(t,e){return gf(4,2,t,e)}function vI(t,e){return gf(4,4,t,e)}function bI(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function wI(t,e,n){return n=n!=null?n.concat([t]):null,gf(4,4,bI.bind(null,e,t),n)}function Mx(){}function kI(t,e){var n=Ss();e=e===void 0?null:e;var s=n.memoizedState;return s!==null&&e!==null&&Dx(e,s[1])?s[0]:(n.memoizedState=[t,e],t)}function CI(t,e){var n=Ss();e=e===void 0?null:e;var s=n.memoizedState;return s!==null&&e!==null&&Dx(e,s[1])?s[0]:(t=t(),n.memoizedState=[t,e],t)}function SI(t,e,n){return Bo&21?(Ys(n,e)||(n=RS(),ft.lanes|=n,Wo|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,Pn=!0),t.memoizedState=n)}function QF(t,e){var n=Ue;Ue=n!==0&&4>n?n:4,t(!0);var s=Rg.transition;Rg.transition={};try{t(!1),e()}finally{Ue=n,Rg.transition=s}}function II(){return Ss().memoizedState}function JF(t,e,n){var s=Fi(t);if(n={lane:s,action:n,hasEagerState:!1,eagerState:null,next:null},$I(t))TI(e,n);else if(n=aI(t,e,n,s),n!==null){var r=In();Hs(n,t,s,r),EI(n,e,s)}}function ZF(t,e,n){var s=Fi(t),r={lane:s,action:n,hasEagerState:!1,eagerState:null,next:null};if($I(t))TI(e,r);else{var i=t.alternate;if(t.lanes===0&&(i===null||i.lanes===0)&&(i=e.lastRenderedReducer,i!==null))try{var o=e.lastRenderedState,a=i(o,n);if(r.hasEagerState=!0,r.eagerState=a,Ys(a,o)){var l=e.interleaved;l===null?(r.next=r,Ex(e)):(r.next=l.next,l.next=r),e.interleaved=r;return}}catch{}finally{}n=aI(t,e,r,s),n!==null&&(r=In(),Hs(n,t,s,r),EI(n,e,s))}}function $I(t){var e=t.alternate;return t===ft||e!==null&&e===ft}function TI(t,e){Ac=fp=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function EI(t,e,n){if(n&4194240){var s=e.lanes;s&=t.pendingLanes,n|=s,e.lanes=n,fx(t,n)}}var mp={readContext:Cs,useCallback:ln,useContext:ln,useEffect:ln,useImperativeHandle:ln,useInsertionEffect:ln,useLayoutEffect:ln,useMemo:ln,useReducer:ln,useRef:ln,useState:ln,useDebugValue:ln,useDeferredValue:ln,useTransition:ln,useMutableSource:ln,useSyncExternalStore:ln,useId:ln,unstable_isNewReconciler:!1},eO={readContext:Cs,useCallback:function(t,e){return rr().memoizedState=[t,e===void 0?null:e],t},useContext:Cs,useEffect:Yw,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,jh(4194308,4,bI.bind(null,e,t),n)},useLayoutEffect:function(t,e){return jh(4194308,4,t,e)},useInsertionEffect:function(t,e){return jh(4,2,t,e)},useMemo:function(t,e){var n=rr();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var s=rr();return e=n!==void 0?n(e):e,s.memoizedState=s.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},s.queue=t,t=t.dispatch=JF.bind(null,ft,t),[s.memoizedState,t]},useRef:function(t){var e=rr();return t={current:t},e.memoizedState=t},useState:Xw,useDebugValue:Mx,useDeferredValue:function(t){return rr().memoizedState=t},useTransition:function(){var t=Xw(!1),e=t[0];return t=QF.bind(null,t[1]),rr().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var s=ft,r=rr();if(ct){if(n===void 0)throw Error(oe(407));n=n()}else{if(n=e(),Ht===null)throw Error(oe(349));Bo&30||hI(s,e,n)}r.memoizedState=n;var i={value:n,getSnapshot:e};return r.queue=i,Yw(fI.bind(null,s,i,t),[t]),s.flags|=2048,tu(9,pI.bind(null,s,i,n,e),void 0,null),n},useId:function(){var t=rr(),e=Ht.identifierPrefix;if(ct){var n=Or,s=Fr;n=(s&~(1<<32-Gs(s)-1)).toString(32)+n,e=":"+e+"R"+n,n=Zc++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=YF++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},tO={readContext:Cs,useCallback:kI,useContext:Cs,useEffect:Px,useImperativeHandle:wI,useInsertionEffect:xI,useLayoutEffect:vI,useMemo:CI,useReducer:Ng,useRef:yI,useState:function(){return Ng(eu)},useDebugValue:Mx,useDeferredValue:function(t){var e=Ss();return SI(e,Pt.memoizedState,t)},useTransition:function(){var t=Ng(eu)[0],e=Ss().memoizedState;return[t,e]},useMutableSource:uI,useSyncExternalStore:dI,useId:II,unstable_isNewReconciler:!1},nO={readContext:Cs,useCallback:kI,useContext:Cs,useEffect:Px,useImperativeHandle:wI,useInsertionEffect:xI,useLayoutEffect:vI,useMemo:CI,useReducer:Ag,useRef:yI,useState:function(){return Ag(eu)},useDebugValue:Mx,useDeferredValue:function(t){var e=Ss();return Pt===null?e.memoizedState=t:SI(e,Pt.memoizedState,t)},useTransition:function(){var t=Ag(eu)[0],e=Ss().memoizedState;return[t,e]},useMutableSource:uI,useSyncExternalStore:dI,useId:II,unstable_isNewReconciler:!1};function Ps(t,e){if(t&&t.defaultProps){e=gt({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}function Ly(t,e,n,s){e=t.memoizedState,n=n(s,e),n=n==null?e:gt({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var yf={isMounted:function(t){return(t=t._reactInternals)?ca(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var s=In(),r=Fi(t),i=zr(s,r);i.payload=e,n!=null&&(i.callback=n),e=_i(t,i,r),e!==null&&(Hs(e,t,r,s),Lh(e,t,r))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var s=In(),r=Fi(t),i=zr(s,r);i.tag=1,i.payload=e,n!=null&&(i.callback=n),e=_i(t,i,r),e!==null&&(Hs(e,t,r,s),Lh(e,t,r))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=In(),s=Fi(t),r=zr(n,s);r.tag=2,e!=null&&(r.callback=e),e=_i(t,r,s),e!==null&&(Hs(e,t,s,n),Lh(e,t,s))}};function Qw(t,e,n,s,r,i,o){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(s,i,o):e.prototype&&e.prototype.isPureReactComponent?!Kc(n,s)||!Kc(r,i):!0}function RI(t,e,n){var s=!1,r=Ui,i=e.contextType;return typeof i=="object"&&i!==null?i=Cs(i):(r=jn(e)?zo:xn.current,s=e.contextTypes,i=(s=s!=null)?il(t,r):Ui),e=new e(n,i),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=yf,t.stateNode=e,e._reactInternals=t,s&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=r,t.__reactInternalMemoizedMaskedChildContext=i),e}function Jw(t,e,n,s){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,s),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,s),e.state!==t&&yf.enqueueReplaceState(e,e.state,null)}function zy(t,e,n,s){var r=t.stateNode;r.props=n,r.state=t.memoizedState,r.refs={},Rx(t);var i=e.contextType;typeof i=="object"&&i!==null?r.context=Cs(i):(i=jn(e)?zo:xn.current,r.context=il(t,i)),r.state=t.memoizedState,i=e.getDerivedStateFromProps,typeof i=="function"&&(Ly(t,e,i,n),r.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof r.getSnapshotBeforeUpdate=="function"||typeof r.UNSAFE_componentWillMount!="function"&&typeof r.componentWillMount!="function"||(e=r.state,typeof r.componentWillMount=="function"&&r.componentWillMount(),typeof r.UNSAFE_componentWillMount=="function"&&r.UNSAFE_componentWillMount(),e!==r.state&&yf.enqueueReplaceState(r,r.state,null),hp(t,n,r,s),r.state=t.memoizedState),typeof r.componentDidMount=="function"&&(t.flags|=4194308)}function cl(t,e){try{var n="",s=e;do n+=N3(s),s=s.return;while(s);var r=n}catch(i){r=`
Error generating stack: `+i.message+`
`+i.stack}return{value:t,source:e,stack:r,digest:null}}function _g(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function jy(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var sO=typeof WeakMap=="function"?WeakMap:Map;function NI(t,e,n){n=zr(-1,n),n.tag=3,n.payload={element:null};var s=e.value;return n.callback=function(){yp||(yp=!0,Yy=s),jy(t,e)},n}function AI(t,e,n){n=zr(-1,n),n.tag=3;var s=t.type.getDerivedStateFromError;if(typeof s=="function"){var r=e.value;n.payload=function(){return s(r)},n.callback=function(){jy(t,e)}}var i=t.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(n.callback=function(){jy(t,e),typeof s!="function"&&(Di===null?Di=new Set([this]):Di.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),n}function Zw(t,e,n){var s=t.pingCache;if(s===null){s=t.pingCache=new sO;var r=new Set;s.set(e,r)}else r=s.get(e),r===void 0&&(r=new Set,s.set(e,r));r.has(n)||(r.add(n),t=yO.bind(null,t,e,n),e.then(t,t))}function e2(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function t2(t,e,n,s,r){return t.mode&1?(t.flags|=65536,t.lanes=r,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=zr(-1,1),e.tag=2,_i(n,e,1))),n.lanes|=1),t)}var rO=Zr.ReactCurrentOwner,Pn=!1;function wn(t,e,n,s){e.child=t===null?oI(e,null,n,s):al(e,t.child,n,s)}function n2(t,e,n,s,r){n=n.render;var i=e.ref;return qa(e,r),s=Fx(t,e,n,s,i,r),n=Ox(),t!==null&&!Pn?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~r,Gr(t,e,r)):(ct&&n&&kx(e),e.flags|=1,wn(t,e,s,r),e.child)}function s2(t,e,n,s,r){if(t===null){var i=n.type;return typeof i=="function"&&!Gx(i)&&i.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=i,_I(t,e,i,s,r)):(t=Uh(n.type,null,s,e,e.mode,r),t.ref=e.ref,t.return=e,e.child=t)}if(i=t.child,!(t.lanes&r)){var o=i.memoizedProps;if(n=n.compare,n=n!==null?n:Kc,n(o,s)&&t.ref===e.ref)return Gr(t,e,r)}return e.flags|=1,t=Oi(i,s),t.ref=e.ref,t.return=e,e.child=t}function _I(t,e,n,s,r){if(t!==null){var i=t.memoizedProps;if(Kc(i,s)&&t.ref===e.ref)if(Pn=!1,e.pendingProps=s=i,(t.lanes&r)!==0)t.flags&131072&&(Pn=!0);else return e.lanes=t.lanes,Gr(t,e,r)}return By(t,e,n,s,r)}function DI(t,e,n){var s=e.pendingProps,r=s.children,i=t!==null?t.memoizedState:null;if(s.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ze(Ba,qn),qn|=n;else{if(!(n&1073741824))return t=i!==null?i.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,Ze(Ba,qn),qn|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},s=i!==null?i.baseLanes:n,Ze(Ba,qn),qn|=s}else i!==null?(s=i.baseLanes|n,e.memoizedState=null):s=n,Ze(Ba,qn),qn|=s;return wn(t,e,r,n),e.child}function FI(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function By(t,e,n,s,r){var i=jn(n)?zo:xn.current;return i=il(e,i),qa(e,r),n=Fx(t,e,n,s,i,r),s=Ox(),t!==null&&!Pn?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~r,Gr(t,e,r)):(ct&&s&&kx(e),e.flags|=1,wn(t,e,n,r),e.child)}function r2(t,e,n,s,r){if(jn(n)){var i=!0;ap(e)}else i=!1;if(qa(e,r),e.stateNode===null)Bh(t,e),RI(e,n,s),zy(e,n,s,r),s=!0;else if(t===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var l=o.context,c=n.contextType;typeof c=="object"&&c!==null?c=Cs(c):(c=jn(n)?zo:xn.current,c=il(e,c));var u=n.getDerivedStateFromProps,d=typeof u=="function"||typeof o.getSnapshotBeforeUpdate=="function";d||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==s||l!==c)&&Jw(e,o,s,c),fi=!1;var h=e.memoizedState;o.state=h,hp(e,s,o,r),l=e.memoizedState,a!==s||h!==l||zn.current||fi?(typeof u=="function"&&(Ly(e,n,u,s),l=e.memoizedState),(a=fi||Qw(e,n,a,s,h,l,c))?(d||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=s,e.memoizedState=l),o.props=s,o.state=l,o.context=c,s=a):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),s=!1)}else{o=e.stateNode,lI(t,e),a=e.memoizedProps,c=e.type===e.elementType?a:Ps(e.type,a),o.props=c,d=e.pendingProps,h=o.context,l=n.contextType,typeof l=="object"&&l!==null?l=Cs(l):(l=jn(n)?zo:xn.current,l=il(e,l));var p=n.getDerivedStateFromProps;(u=typeof p=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==d||h!==l)&&Jw(e,o,s,l),fi=!1,h=e.memoizedState,o.state=h,hp(e,s,o,r);var f=e.memoizedState;a!==d||h!==f||zn.current||fi?(typeof p=="function"&&(Ly(e,n,p,s),f=e.memoizedState),(c=fi||Qw(e,n,c,s,h,f,l)||!1)?(u||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(s,f,l),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(s,f,l)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=1024),e.memoizedProps=s,e.memoizedState=f),o.props=s,o.state=f,o.context=l,s=c):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=1024),s=!1)}return Wy(t,e,n,s,i,r)}function Wy(t,e,n,s,r,i){FI(t,e);var o=(e.flags&128)!==0;if(!s&&!o)return r&&Vw(e,n,!1),Gr(t,e,i);s=e.stateNode,rO.current=e;var a=o&&typeof n.getDerivedStateFromError!="function"?null:s.render();return e.flags|=1,t!==null&&o?(e.child=al(e,t.child,null,i),e.child=al(e,null,a,i)):wn(t,e,a,i),e.memoizedState=s.state,r&&Vw(e,n,!0),e.child}function OI(t){var e=t.stateNode;e.pendingContext?Ww(t,e.pendingContext,e.pendingContext!==e.context):e.context&&Ww(t,e.context,!1),Nx(t,e.containerInfo)}function i2(t,e,n,s,r){return ol(),Sx(r),e.flags|=256,wn(t,e,n,s),e.child}var Vy={dehydrated:null,treeContext:null,retryLane:0};function Uy(t){return{baseLanes:t,cachePool:null,transitions:null}}function PI(t,e,n){var s=e.pendingProps,r=pt.current,i=!1,o=(e.flags&128)!==0,a;if((a=o)||(a=t!==null&&t.memoizedState===null?!1:(r&2)!==0),a?(i=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(r|=1),Ze(pt,r&1),t===null)return Py(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=s.children,t=s.fallback,i?(s=e.mode,i=e.child,o={mode:"hidden",children:o},!(s&1)&&i!==null?(i.childLanes=0,i.pendingProps=o):i=bf(o,s,0,null),t=Do(t,s,n,null),i.return=e,t.return=e,i.sibling=t,e.child=i,e.child.memoizedState=Uy(n),e.memoizedState=Vy,t):Lx(e,o));if(r=t.memoizedState,r!==null&&(a=r.dehydrated,a!==null))return iO(t,e,o,s,a,r,n);if(i){i=s.fallback,o=e.mode,r=t.child,a=r.sibling;var l={mode:"hidden",children:s.children};return!(o&1)&&e.child!==r?(s=e.child,s.childLanes=0,s.pendingProps=l,e.deletions=null):(s=Oi(r,l),s.subtreeFlags=r.subtreeFlags&14680064),a!==null?i=Oi(a,i):(i=Do(i,o,n,null),i.flags|=2),i.return=e,s.return=e,s.sibling=i,e.child=s,s=i,i=e.child,o=t.child.memoizedState,o=o===null?Uy(n):{baseLanes:o.baseLanes|n,cachePool:null,transitions:o.transitions},i.memoizedState=o,i.childLanes=t.childLanes&~n,e.memoizedState=Vy,s}return i=t.child,t=i.sibling,s=Oi(i,{mode:"visible",children:s.children}),!(e.mode&1)&&(s.lanes=n),s.return=e,s.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=s,e.memoizedState=null,s}function Lx(t,e){return e=bf({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function ph(t,e,n,s){return s!==null&&Sx(s),al(e,t.child,null,n),t=Lx(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function iO(t,e,n,s,r,i,o){if(n)return e.flags&256?(e.flags&=-257,s=_g(Error(oe(422))),ph(t,e,o,s)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(i=s.fallback,r=e.mode,s=bf({mode:"visible",children:s.children},r,0,null),i=Do(i,r,o,null),i.flags|=2,s.return=e,i.return=e,s.sibling=i,e.child=s,e.mode&1&&al(e,t.child,null,o),e.child.memoizedState=Uy(o),e.memoizedState=Vy,i);if(!(e.mode&1))return ph(t,e,o,null);if(r.data==="$!"){if(s=r.nextSibling&&r.nextSibling.dataset,s)var a=s.dgst;return s=a,i=Error(oe(419)),s=_g(i,s,void 0),ph(t,e,o,s)}if(a=(o&t.childLanes)!==0,Pn||a){if(s=Ht,s!==null){switch(o&-o){case 4:r=2;break;case 16:r=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:r=32;break;case 536870912:r=268435456;break;default:r=0}r=r&(s.suspendedLanes|o)?0:r,r!==0&&r!==i.retryLane&&(i.retryLane=r,Ur(t,r),Hs(s,t,r,-1))}return Ux(),s=_g(Error(oe(421))),ph(t,e,o,s)}return r.data==="$?"?(e.flags|=128,e.child=t.child,e=xO.bind(null,t),r._reactRetry=e,null):(t=i.treeContext,Yn=Ai(r.nextSibling),Jn=e,ct=!0,Ls=null,t!==null&&(ds[hs++]=Fr,ds[hs++]=Or,ds[hs++]=jo,Fr=t.id,Or=t.overflow,jo=e),e=Lx(e,s.children),e.flags|=4096,e)}function o2(t,e,n){t.lanes|=e;var s=t.alternate;s!==null&&(s.lanes|=e),My(t.return,e,n)}function Dg(t,e,n,s,r){var i=t.memoizedState;i===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:s,tail:n,tailMode:r}:(i.isBackwards=e,i.rendering=null,i.renderingStartTime=0,i.last=s,i.tail=n,i.tailMode=r)}function MI(t,e,n){var s=e.pendingProps,r=s.revealOrder,i=s.tail;if(wn(t,e,s.children,n),s=pt.current,s&2)s=s&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&o2(t,n,e);else if(t.tag===19)o2(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}s&=1}if(Ze(pt,s),!(e.mode&1))e.memoizedState=null;else switch(r){case"forwards":for(n=e.child,r=null;n!==null;)t=n.alternate,t!==null&&pp(t)===null&&(r=n),n=n.sibling;n=r,n===null?(r=e.child,e.child=null):(r=n.sibling,n.sibling=null),Dg(e,!1,r,n,i);break;case"backwards":for(n=null,r=e.child,e.child=null;r!==null;){if(t=r.alternate,t!==null&&pp(t)===null){e.child=r;break}t=r.sibling,r.sibling=n,n=r,r=t}Dg(e,!0,n,null,i);break;case"together":Dg(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Bh(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function Gr(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),Wo|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(oe(153));if(e.child!==null){for(t=e.child,n=Oi(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=Oi(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function oO(t,e,n){switch(e.tag){case 3:OI(e),ol();break;case 5:cI(e);break;case 1:jn(e.type)&&ap(e);break;case 4:Nx(e,e.stateNode.containerInfo);break;case 10:var s=e.type._context,r=e.memoizedProps.value;Ze(up,s._currentValue),s._currentValue=r;break;case 13:if(s=e.memoizedState,s!==null)return s.dehydrated!==null?(Ze(pt,pt.current&1),e.flags|=128,null):n&e.child.childLanes?PI(t,e,n):(Ze(pt,pt.current&1),t=Gr(t,e,n),t!==null?t.sibling:null);Ze(pt,pt.current&1);break;case 19:if(s=(n&e.childLanes)!==0,t.flags&128){if(s)return MI(t,e,n);e.flags|=128}if(r=e.memoizedState,r!==null&&(r.rendering=null,r.tail=null,r.lastEffect=null),Ze(pt,pt.current),s)break;return null;case 22:case 23:return e.lanes=0,DI(t,e,n)}return Gr(t,e,n)}var LI,Gy,zI,jI;LI=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};Gy=function(){};zI=function(t,e,n,s){var r=t.memoizedProps;if(r!==s){t=e.stateNode,To(pr.current);var i=null;switch(n){case"input":r=py(t,r),s=py(t,s),i=[];break;case"select":r=gt({},r,{value:void 0}),s=gt({},s,{value:void 0}),i=[];break;case"textarea":r=gy(t,r),s=gy(t,s),i=[];break;default:typeof r.onClick!="function"&&typeof s.onClick=="function"&&(t.onclick=ip)}xy(n,s);var o;n=null;for(c in r)if(!s.hasOwnProperty(c)&&r.hasOwnProperty(c)&&r[c]!=null)if(c==="style"){var a=r[c];for(o in a)a.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else c!=="dangerouslySetInnerHTML"&&c!=="children"&&c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&c!=="autoFocus"&&(jc.hasOwnProperty(c)?i||(i=[]):(i=i||[]).push(c,null));for(c in s){var l=s[c];if(a=r!=null?r[c]:void 0,s.hasOwnProperty(c)&&l!==a&&(l!=null||a!=null))if(c==="style")if(a){for(o in a)!a.hasOwnProperty(o)||l&&l.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in l)l.hasOwnProperty(o)&&a[o]!==l[o]&&(n||(n={}),n[o]=l[o])}else n||(i||(i=[]),i.push(c,n)),n=l;else c==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,a=a?a.__html:void 0,l!=null&&a!==l&&(i=i||[]).push(c,l)):c==="children"?typeof l!="string"&&typeof l!="number"||(i=i||[]).push(c,""+l):c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&(jc.hasOwnProperty(c)?(l!=null&&c==="onScroll"&&rt("scroll",t),i||a===l||(i=[])):(i=i||[]).push(c,l))}n&&(i=i||[]).push("style",n);var c=i;(e.updateQueue=c)&&(e.flags|=4)}};jI=function(t,e,n,s){n!==s&&(e.flags|=4)};function lc(t,e){if(!ct)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var s=null;n!==null;)n.alternate!==null&&(s=n),n=n.sibling;s===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:s.sibling=null}}function cn(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,s=0;if(e)for(var r=t.child;r!==null;)n|=r.lanes|r.childLanes,s|=r.subtreeFlags&14680064,s|=r.flags&14680064,r.return=t,r=r.sibling;else for(r=t.child;r!==null;)n|=r.lanes|r.childLanes,s|=r.subtreeFlags,s|=r.flags,r.return=t,r=r.sibling;return t.subtreeFlags|=s,t.childLanes=n,e}function aO(t,e,n){var s=e.pendingProps;switch(Cx(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return cn(e),null;case 1:return jn(e.type)&&op(),cn(e),null;case 3:return s=e.stateNode,ll(),it(zn),it(xn),_x(),s.pendingContext&&(s.context=s.pendingContext,s.pendingContext=null),(t===null||t.child===null)&&(dh(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Ls!==null&&(Zy(Ls),Ls=null))),Gy(t,e),cn(e),null;case 5:Ax(e);var r=To(Jc.current);if(n=e.type,t!==null&&e.stateNode!=null)zI(t,e,n,s,r),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!s){if(e.stateNode===null)throw Error(oe(166));return cn(e),null}if(t=To(pr.current),dh(e)){s=e.stateNode,n=e.type;var i=e.memoizedProps;switch(s[ur]=e,s[Yc]=i,t=(e.mode&1)!==0,n){case"dialog":rt("cancel",s),rt("close",s);break;case"iframe":case"object":case"embed":rt("load",s);break;case"video":case"audio":for(r=0;r<yc.length;r++)rt(yc[r],s);break;case"source":rt("error",s);break;case"img":case"image":case"link":rt("error",s),rt("load",s);break;case"details":rt("toggle",s);break;case"input":mw(s,i),rt("invalid",s);break;case"select":s._wrapperState={wasMultiple:!!i.multiple},rt("invalid",s);break;case"textarea":yw(s,i),rt("invalid",s)}xy(n,i),r=null;for(var o in i)if(i.hasOwnProperty(o)){var a=i[o];o==="children"?typeof a=="string"?s.textContent!==a&&(i.suppressHydrationWarning!==!0&&uh(s.textContent,a,t),r=["children",a]):typeof a=="number"&&s.textContent!==""+a&&(i.suppressHydrationWarning!==!0&&uh(s.textContent,a,t),r=["children",""+a]):jc.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&rt("scroll",s)}switch(n){case"input":nh(s),gw(s,i,!0);break;case"textarea":nh(s),xw(s);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(s.onclick=ip)}s=r,e.updateQueue=s,s!==null&&(e.flags|=4)}else{o=r.nodeType===9?r:r.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=fS(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=o.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof s.is=="string"?t=o.createElement(n,{is:s.is}):(t=o.createElement(n),n==="select"&&(o=t,s.multiple?o.multiple=!0:s.size&&(o.size=s.size))):t=o.createElementNS(t,n),t[ur]=e,t[Yc]=s,LI(t,e,!1,!1),e.stateNode=t;e:{switch(o=vy(n,s),n){case"dialog":rt("cancel",t),rt("close",t),r=s;break;case"iframe":case"object":case"embed":rt("load",t),r=s;break;case"video":case"audio":for(r=0;r<yc.length;r++)rt(yc[r],t);r=s;break;case"source":rt("error",t),r=s;break;case"img":case"image":case"link":rt("error",t),rt("load",t),r=s;break;case"details":rt("toggle",t),r=s;break;case"input":mw(t,s),r=py(t,s),rt("invalid",t);break;case"option":r=s;break;case"select":t._wrapperState={wasMultiple:!!s.multiple},r=gt({},s,{value:void 0}),rt("invalid",t);break;case"textarea":yw(t,s),r=gy(t,s),rt("invalid",t);break;default:r=s}xy(n,r),a=r;for(i in a)if(a.hasOwnProperty(i)){var l=a[i];i==="style"?yS(t,l):i==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&mS(t,l)):i==="children"?typeof l=="string"?(n!=="textarea"||l!=="")&&Bc(t,l):typeof l=="number"&&Bc(t,""+l):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(jc.hasOwnProperty(i)?l!=null&&i==="onScroll"&&rt("scroll",t):l!=null&&lx(t,i,l,o))}switch(n){case"input":nh(t),gw(t,s,!1);break;case"textarea":nh(t),xw(t);break;case"option":s.value!=null&&t.setAttribute("value",""+Vi(s.value));break;case"select":t.multiple=!!s.multiple,i=s.value,i!=null?Ua(t,!!s.multiple,i,!1):s.defaultValue!=null&&Ua(t,!!s.multiple,s.defaultValue,!0);break;default:typeof r.onClick=="function"&&(t.onclick=ip)}switch(n){case"button":case"input":case"select":case"textarea":s=!!s.autoFocus;break e;case"img":s=!0;break e;default:s=!1}}s&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return cn(e),null;case 6:if(t&&e.stateNode!=null)jI(t,e,t.memoizedProps,s);else{if(typeof s!="string"&&e.stateNode===null)throw Error(oe(166));if(n=To(Jc.current),To(pr.current),dh(e)){if(s=e.stateNode,n=e.memoizedProps,s[ur]=e,(i=s.nodeValue!==n)&&(t=Jn,t!==null))switch(t.tag){case 3:uh(s.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&uh(s.nodeValue,n,(t.mode&1)!==0)}i&&(e.flags|=4)}else s=(n.nodeType===9?n:n.ownerDocument).createTextNode(s),s[ur]=e,e.stateNode=s}return cn(e),null;case 13:if(it(pt),s=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(ct&&Yn!==null&&e.mode&1&&!(e.flags&128))rI(),ol(),e.flags|=98560,i=!1;else if(i=dh(e),s!==null&&s.dehydrated!==null){if(t===null){if(!i)throw Error(oe(318));if(i=e.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(oe(317));i[ur]=e}else ol(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;cn(e),i=!1}else Ls!==null&&(Zy(Ls),Ls=null),i=!0;if(!i)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(s=s!==null,s!==(t!==null&&t.memoizedState!==null)&&s&&(e.child.flags|=8192,e.mode&1&&(t===null||pt.current&1?jt===0&&(jt=3):Ux())),e.updateQueue!==null&&(e.flags|=4),cn(e),null);case 4:return ll(),Gy(t,e),t===null&&qc(e.stateNode.containerInfo),cn(e),null;case 10:return Tx(e.type._context),cn(e),null;case 17:return jn(e.type)&&op(),cn(e),null;case 19:if(it(pt),i=e.memoizedState,i===null)return cn(e),null;if(s=(e.flags&128)!==0,o=i.rendering,o===null)if(s)lc(i,!1);else{if(jt!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(o=pp(t),o!==null){for(e.flags|=128,lc(i,!1),s=o.updateQueue,s!==null&&(e.updateQueue=s,e.flags|=4),e.subtreeFlags=0,s=n,n=e.child;n!==null;)i=n,t=s,i.flags&=14680066,o=i.alternate,o===null?(i.childLanes=0,i.lanes=t,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=o.childLanes,i.lanes=o.lanes,i.child=o.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=o.memoizedProps,i.memoizedState=o.memoizedState,i.updateQueue=o.updateQueue,i.type=o.type,t=o.dependencies,i.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return Ze(pt,pt.current&1|2),e.child}t=t.sibling}i.tail!==null&&St()>ul&&(e.flags|=128,s=!0,lc(i,!1),e.lanes=4194304)}else{if(!s)if(t=pp(o),t!==null){if(e.flags|=128,s=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),lc(i,!0),i.tail===null&&i.tailMode==="hidden"&&!o.alternate&&!ct)return cn(e),null}else 2*St()-i.renderingStartTime>ul&&n!==1073741824&&(e.flags|=128,s=!0,lc(i,!1),e.lanes=4194304);i.isBackwards?(o.sibling=e.child,e.child=o):(n=i.last,n!==null?n.sibling=o:e.child=o,i.last=o)}return i.tail!==null?(e=i.tail,i.rendering=e,i.tail=e.sibling,i.renderingStartTime=St(),e.sibling=null,n=pt.current,Ze(pt,s?n&1|2:n&1),e):(cn(e),null);case 22:case 23:return Vx(),s=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==s&&(e.flags|=8192),s&&e.mode&1?qn&1073741824&&(cn(e),e.subtreeFlags&6&&(e.flags|=8192)):cn(e),null;case 24:return null;case 25:return null}throw Error(oe(156,e.tag))}function lO(t,e){switch(Cx(e),e.tag){case 1:return jn(e.type)&&op(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return ll(),it(zn),it(xn),_x(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return Ax(e),null;case 13:if(it(pt),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(oe(340));ol()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return it(pt),null;case 4:return ll(),null;case 10:return Tx(e.type._context),null;case 22:case 23:return Vx(),null;case 24:return null;default:return null}}var fh=!1,pn=!1,cO=typeof WeakSet=="function"?WeakSet:Set,he=null;function ja(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(s){yt(t,e,s)}else n.current=null}function Hy(t,e,n){try{n()}catch(s){yt(t,e,s)}}var a2=!1;function uO(t,e){if(Ry=np,t=GS(),wx(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var s=n.getSelection&&n.getSelection();if(s&&s.rangeCount!==0){n=s.anchorNode;var r=s.anchorOffset,i=s.focusNode;s=s.focusOffset;try{n.nodeType,i.nodeType}catch{n=null;break e}var o=0,a=-1,l=-1,c=0,u=0,d=t,h=null;t:for(;;){for(var p;d!==n||r!==0&&d.nodeType!==3||(a=o+r),d!==i||s!==0&&d.nodeType!==3||(l=o+s),d.nodeType===3&&(o+=d.nodeValue.length),(p=d.firstChild)!==null;)h=d,d=p;for(;;){if(d===t)break t;if(h===n&&++c===r&&(a=o),h===i&&++u===s&&(l=o),(p=d.nextSibling)!==null)break;d=h,h=d.parentNode}d=p}n=a===-1||l===-1?null:{start:a,end:l}}else n=null}n=n||{start:0,end:0}}else n=null;for(Ny={focusedElem:t,selectionRange:n},np=!1,he=e;he!==null;)if(e=he,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,he=t;else for(;he!==null;){e=he;try{var f=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(f!==null){var g=f.memoizedProps,x=f.memoizedState,y=e.stateNode,v=y.getSnapshotBeforeUpdate(e.elementType===e.type?g:Ps(e.type,g),x);y.__reactInternalSnapshotBeforeUpdate=v}break;case 3:var b=e.stateNode.containerInfo;b.nodeType===1?b.textContent="":b.nodeType===9&&b.documentElement&&b.removeChild(b.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(oe(163))}}catch(w){yt(e,e.return,w)}if(t=e.sibling,t!==null){t.return=e.return,he=t;break}he=e.return}return f=a2,a2=!1,f}function _c(t,e,n){var s=e.updateQueue;if(s=s!==null?s.lastEffect:null,s!==null){var r=s=s.next;do{if((r.tag&t)===t){var i=r.destroy;r.destroy=void 0,i!==void 0&&Hy(e,n,i)}r=r.next}while(r!==s)}}function xf(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var s=n.create;n.destroy=s()}n=n.next}while(n!==e)}}function Ky(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function BI(t){var e=t.alternate;e!==null&&(t.alternate=null,BI(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[ur],delete e[Yc],delete e[Dy],delete e[HF],delete e[KF])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function WI(t){return t.tag===5||t.tag===3||t.tag===4}function l2(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||WI(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function qy(t,e,n){var s=t.tag;if(s===5||s===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=ip));else if(s!==4&&(t=t.child,t!==null))for(qy(t,e,n),t=t.sibling;t!==null;)qy(t,e,n),t=t.sibling}function Xy(t,e,n){var s=t.tag;if(s===5||s===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(s!==4&&(t=t.child,t!==null))for(Xy(t,e,n),t=t.sibling;t!==null;)Xy(t,e,n),t=t.sibling}var Qt=null,Ms=!1;function di(t,e,n){for(n=n.child;n!==null;)VI(t,e,n),n=n.sibling}function VI(t,e,n){if(hr&&typeof hr.onCommitFiberUnmount=="function")try{hr.onCommitFiberUnmount(uf,n)}catch{}switch(n.tag){case 5:pn||ja(n,e);case 6:var s=Qt,r=Ms;Qt=null,di(t,e,n),Qt=s,Ms=r,Qt!==null&&(Ms?(t=Qt,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):Qt.removeChild(n.stateNode));break;case 18:Qt!==null&&(Ms?(t=Qt,n=n.stateNode,t.nodeType===8?$g(t.parentNode,n):t.nodeType===1&&$g(t,n),Gc(t)):$g(Qt,n.stateNode));break;case 4:s=Qt,r=Ms,Qt=n.stateNode.containerInfo,Ms=!0,di(t,e,n),Qt=s,Ms=r;break;case 0:case 11:case 14:case 15:if(!pn&&(s=n.updateQueue,s!==null&&(s=s.lastEffect,s!==null))){r=s=s.next;do{var i=r,o=i.destroy;i=i.tag,o!==void 0&&(i&2||i&4)&&Hy(n,e,o),r=r.next}while(r!==s)}di(t,e,n);break;case 1:if(!pn&&(ja(n,e),s=n.stateNode,typeof s.componentWillUnmount=="function"))try{s.props=n.memoizedProps,s.state=n.memoizedState,s.componentWillUnmount()}catch(a){yt(n,e,a)}di(t,e,n);break;case 21:di(t,e,n);break;case 22:n.mode&1?(pn=(s=pn)||n.memoizedState!==null,di(t,e,n),pn=s):di(t,e,n);break;default:di(t,e,n)}}function c2(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new cO),e.forEach(function(s){var r=vO.bind(null,t,s);n.has(s)||(n.add(s),s.then(r,r))})}}function As(t,e){var n=e.deletions;if(n!==null)for(var s=0;s<n.length;s++){var r=n[s];try{var i=t,o=e,a=o;e:for(;a!==null;){switch(a.tag){case 5:Qt=a.stateNode,Ms=!1;break e;case 3:Qt=a.stateNode.containerInfo,Ms=!0;break e;case 4:Qt=a.stateNode.containerInfo,Ms=!0;break e}a=a.return}if(Qt===null)throw Error(oe(160));VI(i,o,r),Qt=null,Ms=!1;var l=r.alternate;l!==null&&(l.return=null),r.return=null}catch(c){yt(r,e,c)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)UI(e,t),e=e.sibling}function UI(t,e){var n=t.alternate,s=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(As(e,t),sr(t),s&4){try{_c(3,t,t.return),xf(3,t)}catch(g){yt(t,t.return,g)}try{_c(5,t,t.return)}catch(g){yt(t,t.return,g)}}break;case 1:As(e,t),sr(t),s&512&&n!==null&&ja(n,n.return);break;case 5:if(As(e,t),sr(t),s&512&&n!==null&&ja(n,n.return),t.flags&32){var r=t.stateNode;try{Bc(r,"")}catch(g){yt(t,t.return,g)}}if(s&4&&(r=t.stateNode,r!=null)){var i=t.memoizedProps,o=n!==null?n.memoizedProps:i,a=t.type,l=t.updateQueue;if(t.updateQueue=null,l!==null)try{a==="input"&&i.type==="radio"&&i.name!=null&&hS(r,i),vy(a,o);var c=vy(a,i);for(o=0;o<l.length;o+=2){var u=l[o],d=l[o+1];u==="style"?yS(r,d):u==="dangerouslySetInnerHTML"?mS(r,d):u==="children"?Bc(r,d):lx(r,u,d,c)}switch(a){case"input":fy(r,i);break;case"textarea":pS(r,i);break;case"select":var h=r._wrapperState.wasMultiple;r._wrapperState.wasMultiple=!!i.multiple;var p=i.value;p!=null?Ua(r,!!i.multiple,p,!1):h!==!!i.multiple&&(i.defaultValue!=null?Ua(r,!!i.multiple,i.defaultValue,!0):Ua(r,!!i.multiple,i.multiple?[]:"",!1))}r[Yc]=i}catch(g){yt(t,t.return,g)}}break;case 6:if(As(e,t),sr(t),s&4){if(t.stateNode===null)throw Error(oe(162));r=t.stateNode,i=t.memoizedProps;try{r.nodeValue=i}catch(g){yt(t,t.return,g)}}break;case 3:if(As(e,t),sr(t),s&4&&n!==null&&n.memoizedState.isDehydrated)try{Gc(e.containerInfo)}catch(g){yt(t,t.return,g)}break;case 4:As(e,t),sr(t);break;case 13:As(e,t),sr(t),r=t.child,r.flags&8192&&(i=r.memoizedState!==null,r.stateNode.isHidden=i,!i||r.alternate!==null&&r.alternate.memoizedState!==null||(Bx=St())),s&4&&c2(t);break;case 22:if(u=n!==null&&n.memoizedState!==null,t.mode&1?(pn=(c=pn)||u,As(e,t),pn=c):As(e,t),sr(t),s&8192){if(c=t.memoizedState!==null,(t.stateNode.isHidden=c)&&!u&&t.mode&1)for(he=t,u=t.child;u!==null;){for(d=he=u;he!==null;){switch(h=he,p=h.child,h.tag){case 0:case 11:case 14:case 15:_c(4,h,h.return);break;case 1:ja(h,h.return);var f=h.stateNode;if(typeof f.componentWillUnmount=="function"){s=h,n=h.return;try{e=s,f.props=e.memoizedProps,f.state=e.memoizedState,f.componentWillUnmount()}catch(g){yt(s,n,g)}}break;case 5:ja(h,h.return);break;case 22:if(h.memoizedState!==null){d2(d);continue}}p!==null?(p.return=h,he=p):d2(d)}u=u.sibling}e:for(u=null,d=t;;){if(d.tag===5){if(u===null){u=d;try{r=d.stateNode,c?(i=r.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(a=d.stateNode,l=d.memoizedProps.style,o=l!=null&&l.hasOwnProperty("display")?l.display:null,a.style.display=gS("display",o))}catch(g){yt(t,t.return,g)}}}else if(d.tag===6){if(u===null)try{d.stateNode.nodeValue=c?"":d.memoizedProps}catch(g){yt(t,t.return,g)}}else if((d.tag!==22&&d.tag!==23||d.memoizedState===null||d===t)&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===t)break e;for(;d.sibling===null;){if(d.return===null||d.return===t)break e;u===d&&(u=null),d=d.return}u===d&&(u=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:As(e,t),sr(t),s&4&&c2(t);break;case 21:break;default:As(e,t),sr(t)}}function sr(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(WI(n)){var s=n;break e}n=n.return}throw Error(oe(160))}switch(s.tag){case 5:var r=s.stateNode;s.flags&32&&(Bc(r,""),s.flags&=-33);var i=l2(t);Xy(t,i,r);break;case 3:case 4:var o=s.stateNode.containerInfo,a=l2(t);qy(t,a,o);break;default:throw Error(oe(161))}}catch(l){yt(t,t.return,l)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function dO(t,e,n){he=t,GI(t)}function GI(t,e,n){for(var s=(t.mode&1)!==0;he!==null;){var r=he,i=r.child;if(r.tag===22&&s){var o=r.memoizedState!==null||fh;if(!o){var a=r.alternate,l=a!==null&&a.memoizedState!==null||pn;a=fh;var c=pn;if(fh=o,(pn=l)&&!c)for(he=r;he!==null;)o=he,l=o.child,o.tag===22&&o.memoizedState!==null?h2(r):l!==null?(l.return=o,he=l):h2(r);for(;i!==null;)he=i,GI(i),i=i.sibling;he=r,fh=a,pn=c}u2(t)}else r.subtreeFlags&8772&&i!==null?(i.return=r,he=i):u2(t)}}function u2(t){for(;he!==null;){var e=he;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:pn||xf(5,e);break;case 1:var s=e.stateNode;if(e.flags&4&&!pn)if(n===null)s.componentDidMount();else{var r=e.elementType===e.type?n.memoizedProps:Ps(e.type,n.memoizedProps);s.componentDidUpdate(r,n.memoizedState,s.__reactInternalSnapshotBeforeUpdate)}var i=e.updateQueue;i!==null&&qw(e,i,s);break;case 3:var o=e.updateQueue;if(o!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}qw(e,o,n)}break;case 5:var a=e.stateNode;if(n===null&&e.flags&4){n=a;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&n.focus();break;case"img":l.src&&(n.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var c=e.alternate;if(c!==null){var u=c.memoizedState;if(u!==null){var d=u.dehydrated;d!==null&&Gc(d)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(oe(163))}pn||e.flags&512&&Ky(e)}catch(h){yt(e,e.return,h)}}if(e===t){he=null;break}if(n=e.sibling,n!==null){n.return=e.return,he=n;break}he=e.return}}function d2(t){for(;he!==null;){var e=he;if(e===t){he=null;break}var n=e.sibling;if(n!==null){n.return=e.return,he=n;break}he=e.return}}function h2(t){for(;he!==null;){var e=he;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{xf(4,e)}catch(l){yt(e,n,l)}break;case 1:var s=e.stateNode;if(typeof s.componentDidMount=="function"){var r=e.return;try{s.componentDidMount()}catch(l){yt(e,r,l)}}var i=e.return;try{Ky(e)}catch(l){yt(e,i,l)}break;case 5:var o=e.return;try{Ky(e)}catch(l){yt(e,o,l)}}}catch(l){yt(e,e.return,l)}if(e===t){he=null;break}var a=e.sibling;if(a!==null){a.return=e.return,he=a;break}he=e.return}}var hO=Math.ceil,gp=Zr.ReactCurrentDispatcher,zx=Zr.ReactCurrentOwner,ws=Zr.ReactCurrentBatchConfig,Me=0,Ht=null,Rt=null,Jt=0,qn=0,Ba=Ji(0),jt=0,nu=null,Wo=0,vf=0,jx=0,Dc=null,Fn=null,Bx=0,ul=1/0,Nr=null,yp=!1,Yy=null,Di=null,mh=!1,Ci=null,xp=0,Fc=0,Qy=null,Wh=-1,Vh=0;function In(){return Me&6?St():Wh!==-1?Wh:Wh=St()}function Fi(t){return t.mode&1?Me&2&&Jt!==0?Jt&-Jt:XF.transition!==null?(Vh===0&&(Vh=RS()),Vh):(t=Ue,t!==0||(t=window.event,t=t===void 0?16:PS(t.type)),t):1}function Hs(t,e,n,s){if(50<Fc)throw Fc=0,Qy=null,Error(oe(185));wu(t,n,s),(!(Me&2)||t!==Ht)&&(t===Ht&&(!(Me&2)&&(vf|=n),jt===4&&yi(t,Jt)),Bn(t,s),n===1&&Me===0&&!(e.mode&1)&&(ul=St()+500,mf&&Zi()))}function Bn(t,e){var n=t.callbackNode;X3(t,e);var s=tp(t,t===Ht?Jt:0);if(s===0)n!==null&&ww(n),t.callbackNode=null,t.callbackPriority=0;else if(e=s&-s,t.callbackPriority!==e){if(n!=null&&ww(n),e===1)t.tag===0?qF(p2.bind(null,t)):tI(p2.bind(null,t)),UF(function(){!(Me&6)&&Zi()}),n=null;else{switch(NS(s)){case 1:n=px;break;case 4:n=TS;break;case 16:n=ep;break;case 536870912:n=ES;break;default:n=ep}n=ZI(n,HI.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function HI(t,e){if(Wh=-1,Vh=0,Me&6)throw Error(oe(327));var n=t.callbackNode;if(Xa()&&t.callbackNode!==n)return null;var s=tp(t,t===Ht?Jt:0);if(s===0)return null;if(s&30||s&t.expiredLanes||e)e=vp(t,s);else{e=s;var r=Me;Me|=2;var i=qI();(Ht!==t||Jt!==e)&&(Nr=null,ul=St()+500,_o(t,e));do try{mO();break}catch(a){KI(t,a)}while(!0);$x(),gp.current=i,Me=r,Rt!==null?e=0:(Ht=null,Jt=0,e=jt)}if(e!==0){if(e===2&&(r=Sy(t),r!==0&&(s=r,e=Jy(t,r))),e===1)throw n=nu,_o(t,0),yi(t,s),Bn(t,St()),n;if(e===6)yi(t,s);else{if(r=t.current.alternate,!(s&30)&&!pO(r)&&(e=vp(t,s),e===2&&(i=Sy(t),i!==0&&(s=i,e=Jy(t,i))),e===1))throw n=nu,_o(t,0),yi(t,s),Bn(t,St()),n;switch(t.finishedWork=r,t.finishedLanes=s,e){case 0:case 1:throw Error(oe(345));case 2:vo(t,Fn,Nr);break;case 3:if(yi(t,s),(s&130023424)===s&&(e=Bx+500-St(),10<e)){if(tp(t,0)!==0)break;if(r=t.suspendedLanes,(r&s)!==s){In(),t.pingedLanes|=t.suspendedLanes&r;break}t.timeoutHandle=_y(vo.bind(null,t,Fn,Nr),e);break}vo(t,Fn,Nr);break;case 4:if(yi(t,s),(s&4194240)===s)break;for(e=t.eventTimes,r=-1;0<s;){var o=31-Gs(s);i=1<<o,o=e[o],o>r&&(r=o),s&=~i}if(s=r,s=St()-s,s=(120>s?120:480>s?480:1080>s?1080:1920>s?1920:3e3>s?3e3:4320>s?4320:1960*hO(s/1960))-s,10<s){t.timeoutHandle=_y(vo.bind(null,t,Fn,Nr),s);break}vo(t,Fn,Nr);break;case 5:vo(t,Fn,Nr);break;default:throw Error(oe(329))}}}return Bn(t,St()),t.callbackNode===n?HI.bind(null,t):null}function Jy(t,e){var n=Dc;return t.current.memoizedState.isDehydrated&&(_o(t,e).flags|=256),t=vp(t,e),t!==2&&(e=Fn,Fn=n,e!==null&&Zy(e)),t}function Zy(t){Fn===null?Fn=t:Fn.push.apply(Fn,t)}function pO(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var s=0;s<n.length;s++){var r=n[s],i=r.getSnapshot;r=r.value;try{if(!Ys(i(),r))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function yi(t,e){for(e&=~jx,e&=~vf,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-Gs(e),s=1<<n;t[n]=-1,e&=~s}}function p2(t){if(Me&6)throw Error(oe(327));Xa();var e=tp(t,0);if(!(e&1))return Bn(t,St()),null;var n=vp(t,e);if(t.tag!==0&&n===2){var s=Sy(t);s!==0&&(e=s,n=Jy(t,s))}if(n===1)throw n=nu,_o(t,0),yi(t,e),Bn(t,St()),n;if(n===6)throw Error(oe(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,vo(t,Fn,Nr),Bn(t,St()),null}function Wx(t,e){var n=Me;Me|=1;try{return t(e)}finally{Me=n,Me===0&&(ul=St()+500,mf&&Zi())}}function Vo(t){Ci!==null&&Ci.tag===0&&!(Me&6)&&Xa();var e=Me;Me|=1;var n=ws.transition,s=Ue;try{if(ws.transition=null,Ue=1,t)return t()}finally{Ue=s,ws.transition=n,Me=e,!(Me&6)&&Zi()}}function Vx(){qn=Ba.current,it(Ba)}function _o(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,VF(n)),Rt!==null)for(n=Rt.return;n!==null;){var s=n;switch(Cx(s),s.tag){case 1:s=s.type.childContextTypes,s!=null&&op();break;case 3:ll(),it(zn),it(xn),_x();break;case 5:Ax(s);break;case 4:ll();break;case 13:it(pt);break;case 19:it(pt);break;case 10:Tx(s.type._context);break;case 22:case 23:Vx()}n=n.return}if(Ht=t,Rt=t=Oi(t.current,null),Jt=qn=e,jt=0,nu=null,jx=vf=Wo=0,Fn=Dc=null,$o!==null){for(e=0;e<$o.length;e++)if(n=$o[e],s=n.interleaved,s!==null){n.interleaved=null;var r=s.next,i=n.pending;if(i!==null){var o=i.next;i.next=r,s.next=o}n.pending=s}$o=null}return t}function KI(t,e){do{var n=Rt;try{if($x(),zh.current=mp,fp){for(var s=ft.memoizedState;s!==null;){var r=s.queue;r!==null&&(r.pending=null),s=s.next}fp=!1}if(Bo=0,Ut=Pt=ft=null,Ac=!1,Zc=0,zx.current=null,n===null||n.return===null){jt=1,nu=e,Rt=null;break}e:{var i=t,o=n.return,a=n,l=e;if(e=Jt,a.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var c=l,u=a,d=u.tag;if(!(u.mode&1)&&(d===0||d===11||d===15)){var h=u.alternate;h?(u.updateQueue=h.updateQueue,u.memoizedState=h.memoizedState,u.lanes=h.lanes):(u.updateQueue=null,u.memoizedState=null)}var p=e2(o);if(p!==null){p.flags&=-257,t2(p,o,a,i,e),p.mode&1&&Zw(i,c,e),e=p,l=c;var f=e.updateQueue;if(f===null){var g=new Set;g.add(l),e.updateQueue=g}else f.add(l);break e}else{if(!(e&1)){Zw(i,c,e),Ux();break e}l=Error(oe(426))}}else if(ct&&a.mode&1){var x=e2(o);if(x!==null){!(x.flags&65536)&&(x.flags|=256),t2(x,o,a,i,e),Sx(cl(l,a));break e}}i=l=cl(l,a),jt!==4&&(jt=2),Dc===null?Dc=[i]:Dc.push(i),i=o;do{switch(i.tag){case 3:i.flags|=65536,e&=-e,i.lanes|=e;var y=NI(i,l,e);Kw(i,y);break e;case 1:a=l;var v=i.type,b=i.stateNode;if(!(i.flags&128)&&(typeof v.getDerivedStateFromError=="function"||b!==null&&typeof b.componentDidCatch=="function"&&(Di===null||!Di.has(b)))){i.flags|=65536,e&=-e,i.lanes|=e;var w=AI(i,a,e);Kw(i,w);break e}}i=i.return}while(i!==null)}YI(n)}catch(k){e=k,Rt===n&&n!==null&&(Rt=n=n.return);continue}break}while(!0)}function qI(){var t=gp.current;return gp.current=mp,t===null?mp:t}function Ux(){(jt===0||jt===3||jt===2)&&(jt=4),Ht===null||!(Wo&268435455)&&!(vf&268435455)||yi(Ht,Jt)}function vp(t,e){var n=Me;Me|=2;var s=qI();(Ht!==t||Jt!==e)&&(Nr=null,_o(t,e));do try{fO();break}catch(r){KI(t,r)}while(!0);if($x(),Me=n,gp.current=s,Rt!==null)throw Error(oe(261));return Ht=null,Jt=0,jt}function fO(){for(;Rt!==null;)XI(Rt)}function mO(){for(;Rt!==null&&!j3();)XI(Rt)}function XI(t){var e=JI(t.alternate,t,qn);t.memoizedProps=t.pendingProps,e===null?YI(t):Rt=e,zx.current=null}function YI(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=lO(n,e),n!==null){n.flags&=32767,Rt=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{jt=6,Rt=null;return}}else if(n=aO(n,e,qn),n!==null){Rt=n;return}if(e=e.sibling,e!==null){Rt=e;return}Rt=e=t}while(e!==null);jt===0&&(jt=5)}function vo(t,e,n){var s=Ue,r=ws.transition;try{ws.transition=null,Ue=1,gO(t,e,n,s)}finally{ws.transition=r,Ue=s}return null}function gO(t,e,n,s){do Xa();while(Ci!==null);if(Me&6)throw Error(oe(327));n=t.finishedWork;var r=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(oe(177));t.callbackNode=null,t.callbackPriority=0;var i=n.lanes|n.childLanes;if(Y3(t,i),t===Ht&&(Rt=Ht=null,Jt=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||mh||(mh=!0,ZI(ep,function(){return Xa(),null})),i=(n.flags&15990)!==0,n.subtreeFlags&15990||i){i=ws.transition,ws.transition=null;var o=Ue;Ue=1;var a=Me;Me|=4,zx.current=null,uO(t,n),UI(n,t),PF(Ny),np=!!Ry,Ny=Ry=null,t.current=n,dO(n),B3(),Me=a,Ue=o,ws.transition=i}else t.current=n;if(mh&&(mh=!1,Ci=t,xp=r),i=t.pendingLanes,i===0&&(Di=null),U3(n.stateNode),Bn(t,St()),e!==null)for(s=t.onRecoverableError,n=0;n<e.length;n++)r=e[n],s(r.value,{componentStack:r.stack,digest:r.digest});if(yp)throw yp=!1,t=Yy,Yy=null,t;return xp&1&&t.tag!==0&&Xa(),i=t.pendingLanes,i&1?t===Qy?Fc++:(Fc=0,Qy=t):Fc=0,Zi(),null}function Xa(){if(Ci!==null){var t=NS(xp),e=ws.transition,n=Ue;try{if(ws.transition=null,Ue=16>t?16:t,Ci===null)var s=!1;else{if(t=Ci,Ci=null,xp=0,Me&6)throw Error(oe(331));var r=Me;for(Me|=4,he=t.current;he!==null;){var i=he,o=i.child;if(he.flags&16){var a=i.deletions;if(a!==null){for(var l=0;l<a.length;l++){var c=a[l];for(he=c;he!==null;){var u=he;switch(u.tag){case 0:case 11:case 15:_c(8,u,i)}var d=u.child;if(d!==null)d.return=u,he=d;else for(;he!==null;){u=he;var h=u.sibling,p=u.return;if(BI(u),u===c){he=null;break}if(h!==null){h.return=p,he=h;break}he=p}}}var f=i.alternate;if(f!==null){var g=f.child;if(g!==null){f.child=null;do{var x=g.sibling;g.sibling=null,g=x}while(g!==null)}}he=i}}if(i.subtreeFlags&2064&&o!==null)o.return=i,he=o;else e:for(;he!==null;){if(i=he,i.flags&2048)switch(i.tag){case 0:case 11:case 15:_c(9,i,i.return)}var y=i.sibling;if(y!==null){y.return=i.return,he=y;break e}he=i.return}}var v=t.current;for(he=v;he!==null;){o=he;var b=o.child;if(o.subtreeFlags&2064&&b!==null)b.return=o,he=b;else e:for(o=v;he!==null;){if(a=he,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:xf(9,a)}}catch(k){yt(a,a.return,k)}if(a===o){he=null;break e}var w=a.sibling;if(w!==null){w.return=a.return,he=w;break e}he=a.return}}if(Me=r,Zi(),hr&&typeof hr.onPostCommitFiberRoot=="function")try{hr.onPostCommitFiberRoot(uf,t)}catch{}s=!0}return s}finally{Ue=n,ws.transition=e}}return!1}function f2(t,e,n){e=cl(n,e),e=NI(t,e,1),t=_i(t,e,1),e=In(),t!==null&&(wu(t,1,e),Bn(t,e))}function yt(t,e,n){if(t.tag===3)f2(t,t,n);else for(;e!==null;){if(e.tag===3){f2(e,t,n);break}else if(e.tag===1){var s=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof s.componentDidCatch=="function"&&(Di===null||!Di.has(s))){t=cl(n,t),t=AI(e,t,1),e=_i(e,t,1),t=In(),e!==null&&(wu(e,1,t),Bn(e,t));break}}e=e.return}}function yO(t,e,n){var s=t.pingCache;s!==null&&s.delete(e),e=In(),t.pingedLanes|=t.suspendedLanes&n,Ht===t&&(Jt&n)===n&&(jt===4||jt===3&&(Jt&130023424)===Jt&&500>St()-Bx?_o(t,0):jx|=n),Bn(t,e)}function QI(t,e){e===0&&(t.mode&1?(e=ih,ih<<=1,!(ih&130023424)&&(ih=4194304)):e=1);var n=In();t=Ur(t,e),t!==null&&(wu(t,e,n),Bn(t,n))}function xO(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),QI(t,n)}function vO(t,e){var n=0;switch(t.tag){case 13:var s=t.stateNode,r=t.memoizedState;r!==null&&(n=r.retryLane);break;case 19:s=t.stateNode;break;default:throw Error(oe(314))}s!==null&&s.delete(e),QI(t,n)}var JI;JI=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||zn.current)Pn=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return Pn=!1,oO(t,e,n);Pn=!!(t.flags&131072)}else Pn=!1,ct&&e.flags&1048576&&nI(e,cp,e.index);switch(e.lanes=0,e.tag){case 2:var s=e.type;Bh(t,e),t=e.pendingProps;var r=il(e,xn.current);qa(e,n),r=Fx(null,e,s,t,r,n);var i=Ox();return e.flags|=1,typeof r=="object"&&r!==null&&typeof r.render=="function"&&r.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,jn(s)?(i=!0,ap(e)):i=!1,e.memoizedState=r.state!==null&&r.state!==void 0?r.state:null,Rx(e),r.updater=yf,e.stateNode=r,r._reactInternals=e,zy(e,s,t,n),e=Wy(null,e,s,!0,i,n)):(e.tag=0,ct&&i&&kx(e),wn(null,e,r,n),e=e.child),e;case 16:s=e.elementType;e:{switch(Bh(t,e),t=e.pendingProps,r=s._init,s=r(s._payload),e.type=s,r=e.tag=wO(s),t=Ps(s,t),r){case 0:e=By(null,e,s,t,n);break e;case 1:e=r2(null,e,s,t,n);break e;case 11:e=n2(null,e,s,t,n);break e;case 14:e=s2(null,e,s,Ps(s.type,t),n);break e}throw Error(oe(306,s,""))}return e;case 0:return s=e.type,r=e.pendingProps,r=e.elementType===s?r:Ps(s,r),By(t,e,s,r,n);case 1:return s=e.type,r=e.pendingProps,r=e.elementType===s?r:Ps(s,r),r2(t,e,s,r,n);case 3:e:{if(OI(e),t===null)throw Error(oe(387));s=e.pendingProps,i=e.memoizedState,r=i.element,lI(t,e),hp(e,s,null,n);var o=e.memoizedState;if(s=o.element,i.isDehydrated)if(i={element:s,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=i,e.memoizedState=i,e.flags&256){r=cl(Error(oe(423)),e),e=i2(t,e,s,n,r);break e}else if(s!==r){r=cl(Error(oe(424)),e),e=i2(t,e,s,n,r);break e}else for(Yn=Ai(e.stateNode.containerInfo.firstChild),Jn=e,ct=!0,Ls=null,n=oI(e,null,s,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(ol(),s===r){e=Gr(t,e,n);break e}wn(t,e,s,n)}e=e.child}return e;case 5:return cI(e),t===null&&Py(e),s=e.type,r=e.pendingProps,i=t!==null?t.memoizedProps:null,o=r.children,Ay(s,r)?o=null:i!==null&&Ay(s,i)&&(e.flags|=32),FI(t,e),wn(t,e,o,n),e.child;case 6:return t===null&&Py(e),null;case 13:return PI(t,e,n);case 4:return Nx(e,e.stateNode.containerInfo),s=e.pendingProps,t===null?e.child=al(e,null,s,n):wn(t,e,s,n),e.child;case 11:return s=e.type,r=e.pendingProps,r=e.elementType===s?r:Ps(s,r),n2(t,e,s,r,n);case 7:return wn(t,e,e.pendingProps,n),e.child;case 8:return wn(t,e,e.pendingProps.children,n),e.child;case 12:return wn(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(s=e.type._context,r=e.pendingProps,i=e.memoizedProps,o=r.value,Ze(up,s._currentValue),s._currentValue=o,i!==null)if(Ys(i.value,o)){if(i.children===r.children&&!zn.current){e=Gr(t,e,n);break e}}else for(i=e.child,i!==null&&(i.return=e);i!==null;){var a=i.dependencies;if(a!==null){o=i.child;for(var l=a.firstContext;l!==null;){if(l.context===s){if(i.tag===1){l=zr(-1,n&-n),l.tag=2;var c=i.updateQueue;if(c!==null){c=c.shared;var u=c.pending;u===null?l.next=l:(l.next=u.next,u.next=l),c.pending=l}}i.lanes|=n,l=i.alternate,l!==null&&(l.lanes|=n),My(i.return,n,e),a.lanes|=n;break}l=l.next}}else if(i.tag===10)o=i.type===e.type?null:i.child;else if(i.tag===18){if(o=i.return,o===null)throw Error(oe(341));o.lanes|=n,a=o.alternate,a!==null&&(a.lanes|=n),My(o,n,e),o=i.sibling}else o=i.child;if(o!==null)o.return=i;else for(o=i;o!==null;){if(o===e){o=null;break}if(i=o.sibling,i!==null){i.return=o.return,o=i;break}o=o.return}i=o}wn(t,e,r.children,n),e=e.child}return e;case 9:return r=e.type,s=e.pendingProps.children,qa(e,n),r=Cs(r),s=s(r),e.flags|=1,wn(t,e,s,n),e.child;case 14:return s=e.type,r=Ps(s,e.pendingProps),r=Ps(s.type,r),s2(t,e,s,r,n);case 15:return _I(t,e,e.type,e.pendingProps,n);case 17:return s=e.type,r=e.pendingProps,r=e.elementType===s?r:Ps(s,r),Bh(t,e),e.tag=1,jn(s)?(t=!0,ap(e)):t=!1,qa(e,n),RI(e,s,r),zy(e,s,r,n),Wy(null,e,s,!0,t,n);case 19:return MI(t,e,n);case 22:return DI(t,e,n)}throw Error(oe(156,e.tag))};function ZI(t,e){return $S(t,e)}function bO(t,e,n,s){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=s,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ms(t,e,n,s){return new bO(t,e,n,s)}function Gx(t){return t=t.prototype,!(!t||!t.isReactComponent)}function wO(t){if(typeof t=="function")return Gx(t)?1:0;if(t!=null){if(t=t.$$typeof,t===ux)return 11;if(t===dx)return 14}return 2}function Oi(t,e){var n=t.alternate;return n===null?(n=ms(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function Uh(t,e,n,s,r,i){var o=2;if(s=t,typeof t=="function")Gx(t)&&(o=1);else if(typeof t=="string")o=5;else e:switch(t){case Aa:return Do(n.children,r,i,e);case cx:o=8,r|=8;break;case cy:return t=ms(12,n,e,r|2),t.elementType=cy,t.lanes=i,t;case uy:return t=ms(13,n,e,r),t.elementType=uy,t.lanes=i,t;case dy:return t=ms(19,n,e,r),t.elementType=dy,t.lanes=i,t;case cS:return bf(n,r,i,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case aS:o=10;break e;case lS:o=9;break e;case ux:o=11;break e;case dx:o=14;break e;case pi:o=16,s=null;break e}throw Error(oe(130,t==null?t:typeof t,""))}return e=ms(o,n,e,r),e.elementType=t,e.type=s,e.lanes=i,e}function Do(t,e,n,s){return t=ms(7,t,s,e),t.lanes=n,t}function bf(t,e,n,s){return t=ms(22,t,s,e),t.elementType=cS,t.lanes=n,t.stateNode={isHidden:!1},t}function Fg(t,e,n){return t=ms(6,t,null,e),t.lanes=n,t}function Og(t,e,n){return e=ms(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function kO(t,e,n,s,r){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=mg(0),this.expirationTimes=mg(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=mg(0),this.identifierPrefix=s,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function Hx(t,e,n,s,r,i,o,a,l){return t=new kO(t,e,n,a,l),e===1?(e=1,i===!0&&(e|=8)):e=0,i=ms(3,null,null,e),t.current=i,i.stateNode=t,i.memoizedState={element:s,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Rx(i),t}function CO(t,e,n){var s=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Na,key:s==null?null:""+s,children:t,containerInfo:e,implementation:n}}function e$(t){if(!t)return Ui;t=t._reactInternals;e:{if(ca(t)!==t||t.tag!==1)throw Error(oe(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(jn(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(oe(171))}if(t.tag===1){var n=t.type;if(jn(n))return eI(t,n,e)}return e}function t$(t,e,n,s,r,i,o,a,l){return t=Hx(n,s,!0,t,r,i,o,a,l),t.context=e$(null),n=t.current,s=In(),r=Fi(n),i=zr(s,r),i.callback=e??null,_i(n,i,r),t.current.lanes=r,wu(t,r,s),Bn(t,s),t}function wf(t,e,n,s){var r=e.current,i=In(),o=Fi(r);return n=e$(n),e.context===null?e.context=n:e.pendingContext=n,e=zr(i,o),e.payload={element:t},s=s===void 0?null:s,s!==null&&(e.callback=s),t=_i(r,e,o),t!==null&&(Hs(t,r,o,i),Lh(t,r,o)),o}function bp(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function m2(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function Kx(t,e){m2(t,e),(t=t.alternate)&&m2(t,e)}function SO(){return null}var n$=typeof reportError=="function"?reportError:function(t){console.error(t)};function qx(t){this._internalRoot=t}kf.prototype.render=qx.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(oe(409));wf(t,e,null,null)};kf.prototype.unmount=qx.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;Vo(function(){wf(null,t,null,null)}),e[Vr]=null}};function kf(t){this._internalRoot=t}kf.prototype.unstable_scheduleHydration=function(t){if(t){var e=DS();t={blockedOn:null,target:t,priority:e};for(var n=0;n<gi.length&&e!==0&&e<gi[n].priority;n++);gi.splice(n,0,t),n===0&&OS(t)}};function Xx(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function Cf(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function g2(){}function IO(t,e,n,s,r){if(r){if(typeof s=="function"){var i=s;s=function(){var c=bp(o);i.call(c)}}var o=t$(e,s,t,0,null,!1,!1,"",g2);return t._reactRootContainer=o,t[Vr]=o.current,qc(t.nodeType===8?t.parentNode:t),Vo(),o}for(;r=t.lastChild;)t.removeChild(r);if(typeof s=="function"){var a=s;s=function(){var c=bp(l);a.call(c)}}var l=Hx(t,0,!1,null,null,!1,!1,"",g2);return t._reactRootContainer=l,t[Vr]=l.current,qc(t.nodeType===8?t.parentNode:t),Vo(function(){wf(e,l,n,s)}),l}function Sf(t,e,n,s,r){var i=n._reactRootContainer;if(i){var o=i;if(typeof r=="function"){var a=r;r=function(){var l=bp(o);a.call(l)}}wf(e,o,t,r)}else o=IO(n,e,t,r,s);return bp(o)}AS=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=gc(e.pendingLanes);n!==0&&(fx(e,n|1),Bn(e,St()),!(Me&6)&&(ul=St()+500,Zi()))}break;case 13:Vo(function(){var s=Ur(t,1);if(s!==null){var r=In();Hs(s,t,1,r)}}),Kx(t,1)}};mx=function(t){if(t.tag===13){var e=Ur(t,134217728);if(e!==null){var n=In();Hs(e,t,134217728,n)}Kx(t,134217728)}};_S=function(t){if(t.tag===13){var e=Fi(t),n=Ur(t,e);if(n!==null){var s=In();Hs(n,t,e,s)}Kx(t,e)}};DS=function(){return Ue};FS=function(t,e){var n=Ue;try{return Ue=t,e()}finally{Ue=n}};wy=function(t,e,n){switch(e){case"input":if(fy(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var s=n[e];if(s!==t&&s.form===t.form){var r=ff(s);if(!r)throw Error(oe(90));dS(s),fy(s,r)}}}break;case"textarea":pS(t,n);break;case"select":e=n.value,e!=null&&Ua(t,!!n.multiple,e,!1)}};bS=Wx;wS=Vo;var $O={usingClientEntryPoint:!1,Events:[Cu,Oa,ff,xS,vS,Wx]},cc={findFiberByHostInstance:Io,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},TO={bundleType:cc.bundleType,version:cc.version,rendererPackageName:cc.rendererPackageName,rendererConfig:cc.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Zr.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=SS(t),t===null?null:t.stateNode},findFiberByHostInstance:cc.findFiberByHostInstance||SO,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var gh=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!gh.isDisabled&&gh.supportsFiber)try{uf=gh.inject(TO),hr=gh}catch{}}rs.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=$O;rs.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Xx(e))throw Error(oe(200));return CO(t,e,null,n)};rs.createRoot=function(t,e){if(!Xx(t))throw Error(oe(299));var n=!1,s="",r=n$;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(s=e.identifierPrefix),e.onRecoverableError!==void 0&&(r=e.onRecoverableError)),e=Hx(t,1,!1,null,null,n,!1,s,r),t[Vr]=e.current,qc(t.nodeType===8?t.parentNode:t),new qx(e)};rs.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(oe(188)):(t=Object.keys(t).join(","),Error(oe(268,t)));return t=SS(e),t=t===null?null:t.stateNode,t};rs.flushSync=function(t){return Vo(t)};rs.hydrate=function(t,e,n){if(!Cf(e))throw Error(oe(200));return Sf(null,t,e,!0,n)};rs.hydrateRoot=function(t,e,n){if(!Xx(t))throw Error(oe(405));var s=n!=null&&n.hydratedSources||null,r=!1,i="",o=n$;if(n!=null&&(n.unstable_strictMode===!0&&(r=!0),n.identifierPrefix!==void 0&&(i=n.identifierPrefix),n.onRecoverableError!==void 0&&(o=n.onRecoverableError)),e=t$(e,null,t,1,n??null,r,!1,i,o),t[Vr]=e.current,qc(t),s)for(t=0;t<s.length;t++)n=s[t],r=n._getVersion,r=r(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,r]:e.mutableSourceEagerHydrationData.push(n,r);return new kf(e)};rs.render=function(t,e,n){if(!Cf(e))throw Error(oe(200));return Sf(null,t,e,!1,n)};rs.unmountComponentAtNode=function(t){if(!Cf(t))throw Error(oe(40));return t._reactRootContainer?(Vo(function(){Sf(null,null,t,!1,function(){t._reactRootContainer=null,t[Vr]=null})}),!0):!1};rs.unstable_batchedUpdates=Wx;rs.unstable_renderSubtreeIntoContainer=function(t,e,n,s){if(!Cf(n))throw Error(oe(200));if(t==null||t._reactInternals===void 0)throw Error(oe(38));return Sf(t,e,n,!1,s)};rs.version="18.3.1-next-f1338f8080-20240426";function s$(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(s$)}catch(t){console.error(t)}}s$(),sS.exports=rs;var EO=sS.exports,r$,y2=EO;r$=y2.createRoot,y2.hydrateRoot;/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function su(){return su=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(t[s]=n[s])}return t},su.apply(this,arguments)}var Si;(function(t){t.Pop="POP",t.Push="PUSH",t.Replace="REPLACE"})(Si||(Si={}));const x2="popstate";function RO(t){t===void 0&&(t={});function e(s,r){let{pathname:i,search:o,hash:a}=s.location;return e0("",{pathname:i,search:o,hash:a},r.state&&r.state.usr||null,r.state&&r.state.key||"default")}function n(s,r){return typeof r=="string"?r:wp(r)}return AO(e,n,null,t)}function mt(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function i$(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function NO(){return Math.random().toString(36).substr(2,8)}function v2(t,e){return{usr:t.state,key:t.key,idx:e}}function e0(t,e,n,s){return n===void 0&&(n=null),su({pathname:typeof t=="string"?t:t.pathname,search:"",hash:""},typeof e=="string"?_l(e):e,{state:n,key:e&&e.key||s||NO()})}function wp(t){let{pathname:e="/",search:n="",hash:s=""}=t;return n&&n!=="?"&&(e+=n.charAt(0)==="?"?n:"?"+n),s&&s!=="#"&&(e+=s.charAt(0)==="#"?s:"#"+s),e}function _l(t){let e={};if(t){let n=t.indexOf("#");n>=0&&(e.hash=t.substr(n),t=t.substr(0,n));let s=t.indexOf("?");s>=0&&(e.search=t.substr(s),t=t.substr(0,s)),t&&(e.pathname=t)}return e}function AO(t,e,n,s){s===void 0&&(s={});let{window:r=document.defaultView,v5Compat:i=!1}=s,o=r.history,a=Si.Pop,l=null,c=u();c==null&&(c=0,o.replaceState(su({},o.state,{idx:c}),""));function u(){return(o.state||{idx:null}).idx}function d(){a=Si.Pop;let x=u(),y=x==null?null:x-c;c=x,l&&l({action:a,location:g.location,delta:y})}function h(x,y){a=Si.Push;let v=e0(g.location,x,y);c=u()+1;let b=v2(v,c),w=g.createHref(v);try{o.pushState(b,"",w)}catch(k){if(k instanceof DOMException&&k.name==="DataCloneError")throw k;r.location.assign(w)}i&&l&&l({action:a,location:g.location,delta:1})}function p(x,y){a=Si.Replace;let v=e0(g.location,x,y);c=u();let b=v2(v,c),w=g.createHref(v);o.replaceState(b,"",w),i&&l&&l({action:a,location:g.location,delta:0})}function f(x){let y=r.location.origin!=="null"?r.location.origin:r.location.href,v=typeof x=="string"?x:wp(x);return v=v.replace(/ $/,"%20"),mt(y,"No window.location.(origin|href) available to create URL for href: "+v),new URL(v,y)}let g={get action(){return a},get location(){return t(r,o)},listen(x){if(l)throw new Error("A history only accepts one active listener");return r.addEventListener(x2,d),l=x,()=>{r.removeEventListener(x2,d),l=null}},createHref(x){return e(r,x)},createURL:f,encodeLocation(x){let y=f(x);return{pathname:y.pathname,search:y.search,hash:y.hash}},push:h,replace:p,go(x){return o.go(x)}};return g}var b2;(function(t){t.data="data",t.deferred="deferred",t.redirect="redirect",t.error="error"})(b2||(b2={}));function _O(t,e,n){return n===void 0&&(n="/"),DO(t,e,n)}function DO(t,e,n,s){let r=typeof e=="string"?_l(e):e,i=dl(r.pathname||"/",n);if(i==null)return null;let o=o$(t);FO(o);let a=null;for(let l=0;a==null&&l<o.length;++l){let c=GO(i);a=VO(o[l],c)}return a}function o$(t,e,n,s){e===void 0&&(e=[]),n===void 0&&(n=[]),s===void 0&&(s="");let r=(i,o,a)=>{let l={relativePath:a===void 0?i.path||"":a,caseSensitive:i.caseSensitive===!0,childrenIndex:o,route:i};l.relativePath.startsWith("/")&&(mt(l.relativePath.startsWith(s),'Absolute route path "'+l.relativePath+'" nested under path '+('"'+s+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),l.relativePath=l.relativePath.slice(s.length));let c=Pi([s,l.relativePath]),u=n.concat(l);i.children&&i.children.length>0&&(mt(i.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+c+'".')),o$(i.children,e,u,c)),!(i.path==null&&!i.index)&&e.push({path:c,score:BO(c,i.index),routesMeta:u})};return t.forEach((i,o)=>{var a;if(i.path===""||!((a=i.path)!=null&&a.includes("?")))r(i,o);else for(let l of a$(i.path))r(i,o,l)}),e}function a$(t){let e=t.split("/");if(e.length===0)return[];let[n,...s]=e,r=n.endsWith("?"),i=n.replace(/\?$/,"");if(s.length===0)return r?[i,""]:[i];let o=a$(s.join("/")),a=[];return a.push(...o.map(l=>l===""?i:[i,l].join("/"))),r&&a.push(...o),a.map(l=>t.startsWith("/")&&l===""?"/":l)}function FO(t){t.sort((e,n)=>e.score!==n.score?n.score-e.score:WO(e.routesMeta.map(s=>s.childrenIndex),n.routesMeta.map(s=>s.childrenIndex)))}const OO=/^:[\w-]+$/,PO=3,MO=2,LO=1,zO=10,jO=-2,w2=t=>t==="*";function BO(t,e){let n=t.split("/"),s=n.length;return n.some(w2)&&(s+=jO),e&&(s+=MO),n.filter(r=>!w2(r)).reduce((r,i)=>r+(OO.test(i)?PO:i===""?LO:zO),s)}function WO(t,e){return t.length===e.length&&t.slice(0,-1).every((s,r)=>s===e[r])?t[t.length-1]-e[e.length-1]:0}function VO(t,e,n){let{routesMeta:s}=t,r={},i="/",o=[];for(let a=0;a<s.length;++a){let l=s[a],c=a===s.length-1,u=i==="/"?e:e.slice(i.length)||"/",d=t0({path:l.relativePath,caseSensitive:l.caseSensitive,end:c},u),h=l.route;if(!d)return null;Object.assign(r,d.params),o.push({params:r,pathname:Pi([i,d.pathname]),pathnameBase:XO(Pi([i,d.pathnameBase])),route:h}),d.pathnameBase!=="/"&&(i=Pi([i,d.pathnameBase]))}return o}function t0(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[n,s]=UO(t.path,t.caseSensitive,t.end),r=e.match(n);if(!r)return null;let i=r[0],o=i.replace(/(.)\/+$/,"$1"),a=r.slice(1);return{params:s.reduce((c,u,d)=>{let{paramName:h,isOptional:p}=u;if(h==="*"){let g=a[d]||"";o=i.slice(0,i.length-g.length).replace(/(.)\/+$/,"$1")}const f=a[d];return p&&!f?c[h]=void 0:c[h]=(f||"").replace(/%2F/g,"/"),c},{}),pathname:i,pathnameBase:o,pattern:t}}function UO(t,e,n){e===void 0&&(e=!1),n===void 0&&(n=!0),i$(t==="*"||!t.endsWith("*")||t.endsWith("/*"),'Route path "'+t+'" will be treated as if it were '+('"'+t.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+t.replace(/\*$/,"/*")+'".'));let s=[],r="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(o,a,l)=>(s.push({paramName:a,isOptional:l!=null}),l?"/?([^\\/]+)?":"/([^\\/]+)"));return t.endsWith("*")?(s.push({paramName:"*"}),r+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?r+="\\/*$":t!==""&&t!=="/"&&(r+="(?:(?=\\/|$))"),[new RegExp(r,e?void 0:"i"),s]}function GO(t){try{return t.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return i$(!1,'The URL path "'+t+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),t}}function dl(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let n=e.endsWith("/")?e.length-1:e.length,s=t.charAt(n);return s&&s!=="/"?null:t.slice(n)||"/"}function HO(t,e){e===void 0&&(e="/");let{pathname:n,search:s="",hash:r=""}=typeof t=="string"?_l(t):t;return{pathname:n?n.startsWith("/")?n:KO(n,e):e,search:YO(s),hash:QO(r)}}function KO(t,e){let n=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(r=>{r===".."?n.length>1&&n.pop():r!=="."&&n.push(r)}),n.length>1?n.join("/"):"/"}function Pg(t,e,n,s){return"Cannot include a '"+t+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(s)+"].  Please separate it out to the ")+("`to."+n+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function qO(t){return t.filter((e,n)=>n===0||e.route.path&&e.route.path.length>0)}function Yx(t,e){let n=qO(t);return e?n.map((s,r)=>r===n.length-1?s.pathname:s.pathnameBase):n.map(s=>s.pathnameBase)}function Qx(t,e,n,s){s===void 0&&(s=!1);let r;typeof t=="string"?r=_l(t):(r=su({},t),mt(!r.pathname||!r.pathname.includes("?"),Pg("?","pathname","search",r)),mt(!r.pathname||!r.pathname.includes("#"),Pg("#","pathname","hash",r)),mt(!r.search||!r.search.includes("#"),Pg("#","search","hash",r)));let i=t===""||r.pathname==="",o=i?"/":r.pathname,a;if(o==null)a=n;else{let d=e.length-1;if(!s&&o.startsWith("..")){let h=o.split("/");for(;h[0]==="..";)h.shift(),d-=1;r.pathname=h.join("/")}a=d>=0?e[d]:"/"}let l=HO(r,a),c=o&&o!=="/"&&o.endsWith("/"),u=(i||o===".")&&n.endsWith("/");return!l.pathname.endsWith("/")&&(c||u)&&(l.pathname+="/"),l}const Pi=t=>t.join("/").replace(/\/\/+/g,"/"),XO=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),YO=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,QO=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t;function JO(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}const l$=["post","put","patch","delete"];new Set(l$);const ZO=["get",...l$];new Set(ZO);/**
 * React Router v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function ru(){return ru=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(t[s]=n[s])}return t},ru.apply(this,arguments)}const If=W.createContext(null),c$=W.createContext(null),ei=W.createContext(null),$f=W.createContext(null),eo=W.createContext({outlet:null,matches:[],isDataRoute:!1}),u$=W.createContext(null);function eP(t,e){let{relative:n}=e===void 0?{}:e;Dl()||mt(!1);let{basename:s,navigator:r}=W.useContext(ei),{hash:i,pathname:o,search:a}=Tf(t,{relative:n}),l=o;return s!=="/"&&(l=o==="/"?s:Pi([s,o])),r.createHref({pathname:l,search:a,hash:i})}function Dl(){return W.useContext($f)!=null}function ti(){return Dl()||mt(!1),W.useContext($f).location}function d$(t){W.useContext(ei).static||W.useLayoutEffect(t)}function ua(){let{isDataRoute:t}=W.useContext(eo);return t?pP():tP()}function tP(){Dl()||mt(!1);let t=W.useContext(If),{basename:e,future:n,navigator:s}=W.useContext(ei),{matches:r}=W.useContext(eo),{pathname:i}=ti(),o=JSON.stringify(Yx(r,n.v7_relativeSplatPath)),a=W.useRef(!1);return d$(()=>{a.current=!0}),W.useCallback(function(c,u){if(u===void 0&&(u={}),!a.current)return;if(typeof c=="number"){s.go(c);return}let d=Qx(c,JSON.parse(o),i,u.relative==="path");t==null&&e!=="/"&&(d.pathname=d.pathname==="/"?e:Pi([e,d.pathname])),(u.replace?s.replace:s.push)(d,u.state,u)},[e,s,o,i,t])}function Tf(t,e){let{relative:n}=e===void 0?{}:e,{future:s}=W.useContext(ei),{matches:r}=W.useContext(eo),{pathname:i}=ti(),o=JSON.stringify(Yx(r,s.v7_relativeSplatPath));return W.useMemo(()=>Qx(t,JSON.parse(o),i,n==="path"),[t,o,i,n])}function nP(t,e){return sP(t,e)}function sP(t,e,n,s){Dl()||mt(!1);let{navigator:r}=W.useContext(ei),{matches:i}=W.useContext(eo),o=i[i.length-1],a=o?o.params:{};o&&o.pathname;let l=o?o.pathnameBase:"/";o&&o.route;let c=ti(),u;if(e){var d;let x=typeof e=="string"?_l(e):e;l==="/"||(d=x.pathname)!=null&&d.startsWith(l)||mt(!1),u=x}else u=c;let h=u.pathname||"/",p=h;if(l!=="/"){let x=l.replace(/^\//,"").split("/");p="/"+h.replace(/^\//,"").split("/").slice(x.length).join("/")}let f=_O(t,{pathname:p}),g=lP(f&&f.map(x=>Object.assign({},x,{params:Object.assign({},a,x.params),pathname:Pi([l,r.encodeLocation?r.encodeLocation(x.pathname).pathname:x.pathname]),pathnameBase:x.pathnameBase==="/"?l:Pi([l,r.encodeLocation?r.encodeLocation(x.pathnameBase).pathname:x.pathnameBase])})),i,n,s);return e&&g?W.createElement($f.Provider,{value:{location:ru({pathname:"/",search:"",hash:"",state:null,key:"default"},u),navigationType:Si.Pop}},g):g}function rP(){let t=hP(),e=JO(t)?t.status+" "+t.statusText:t instanceof Error?t.message:JSON.stringify(t),n=t instanceof Error?t.stack:null,r={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return W.createElement(W.Fragment,null,W.createElement("h2",null,"Unexpected Application Error!"),W.createElement("h3",{style:{fontStyle:"italic"}},e),n?W.createElement("pre",{style:r},n):null,null)}const iP=W.createElement(rP,null);class oP extends W.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,n){return n.location!==e.location||n.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:n.error,location:n.location,revalidation:e.revalidation||n.revalidation}}componentDidCatch(e,n){console.error("React Router caught the following error during render",e,n)}render(){return this.state.error!==void 0?W.createElement(eo.Provider,{value:this.props.routeContext},W.createElement(u$.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function aP(t){let{routeContext:e,match:n,children:s}=t,r=W.useContext(If);return r&&r.static&&r.staticContext&&(n.route.errorElement||n.route.ErrorBoundary)&&(r.staticContext._deepestRenderedBoundaryId=n.route.id),W.createElement(eo.Provider,{value:e},s)}function lP(t,e,n,s){var r;if(e===void 0&&(e=[]),n===void 0&&(n=null),s===void 0&&(s=null),t==null){var i;if(!n)return null;if(n.errors)t=n.matches;else if((i=s)!=null&&i.v7_partialHydration&&e.length===0&&!n.initialized&&n.matches.length>0)t=n.matches;else return null}let o=t,a=(r=n)==null?void 0:r.errors;if(a!=null){let u=o.findIndex(d=>d.route.id&&(a==null?void 0:a[d.route.id])!==void 0);u>=0||mt(!1),o=o.slice(0,Math.min(o.length,u+1))}let l=!1,c=-1;if(n&&s&&s.v7_partialHydration)for(let u=0;u<o.length;u++){let d=o[u];if((d.route.HydrateFallback||d.route.hydrateFallbackElement)&&(c=u),d.route.id){let{loaderData:h,errors:p}=n,f=d.route.loader&&h[d.route.id]===void 0&&(!p||p[d.route.id]===void 0);if(d.route.lazy||f){l=!0,c>=0?o=o.slice(0,c+1):o=[o[0]];break}}}return o.reduceRight((u,d,h)=>{let p,f=!1,g=null,x=null;n&&(p=a&&d.route.id?a[d.route.id]:void 0,g=d.route.errorElement||iP,l&&(c<0&&h===0?(fP("route-fallback"),f=!0,x=null):c===h&&(f=!0,x=d.route.hydrateFallbackElement||null)));let y=e.concat(o.slice(0,h+1)),v=()=>{let b;return p?b=g:f?b=x:d.route.Component?b=W.createElement(d.route.Component,null):d.route.element?b=d.route.element:b=u,W.createElement(aP,{match:d,routeContext:{outlet:u,matches:y,isDataRoute:n!=null},children:b})};return n&&(d.route.ErrorBoundary||d.route.errorElement||h===0)?W.createElement(oP,{location:n.location,revalidation:n.revalidation,component:g,error:p,children:v(),routeContext:{outlet:null,matches:y,isDataRoute:!0}}):v()},null)}var h$=function(t){return t.UseBlocker="useBlocker",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t}(h$||{}),p$=function(t){return t.UseBlocker="useBlocker",t.UseLoaderData="useLoaderData",t.UseActionData="useActionData",t.UseRouteError="useRouteError",t.UseNavigation="useNavigation",t.UseRouteLoaderData="useRouteLoaderData",t.UseMatches="useMatches",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t.UseRouteId="useRouteId",t}(p$||{});function cP(t){let e=W.useContext(If);return e||mt(!1),e}function uP(t){let e=W.useContext(c$);return e||mt(!1),e}function dP(t){let e=W.useContext(eo);return e||mt(!1),e}function f$(t){let e=dP(),n=e.matches[e.matches.length-1];return n.route.id||mt(!1),n.route.id}function hP(){var t;let e=W.useContext(u$),n=uP(),s=f$();return e!==void 0?e:(t=n.errors)==null?void 0:t[s]}function pP(){let{router:t}=cP(h$.UseNavigateStable),e=f$(p$.UseNavigateStable),n=W.useRef(!1);return d$(()=>{n.current=!0}),W.useCallback(function(r,i){i===void 0&&(i={}),n.current&&(typeof r=="number"?t.navigate(r):t.navigate(r,ru({fromRouteId:e},i)))},[t,e])}const k2={};function fP(t,e,n){k2[t]||(k2[t]=!0)}function mP(t,e){t==null||t.v7_startTransition,t==null||t.v7_relativeSplatPath}function m$(t){let{to:e,replace:n,state:s,relative:r}=t;Dl()||mt(!1);let{future:i,static:o}=W.useContext(ei),{matches:a}=W.useContext(eo),{pathname:l}=ti(),c=ua(),u=Qx(e,Yx(a,i.v7_relativeSplatPath),l,r==="path"),d=JSON.stringify(u);return W.useEffect(()=>c(JSON.parse(d),{replace:n,state:s,relative:r}),[c,d,r,n,s]),null}function un(t){mt(!1)}function gP(t){let{basename:e="/",children:n=null,location:s,navigationType:r=Si.Pop,navigator:i,static:o=!1,future:a}=t;Dl()&&mt(!1);let l=e.replace(/^\/*/,"/"),c=W.useMemo(()=>({basename:l,navigator:i,static:o,future:ru({v7_relativeSplatPath:!1},a)}),[l,a,i,o]);typeof s=="string"&&(s=_l(s));let{pathname:u="/",search:d="",hash:h="",state:p=null,key:f="default"}=s,g=W.useMemo(()=>{let x=dl(u,l);return x==null?null:{location:{pathname:x,search:d,hash:h,state:p,key:f},navigationType:r}},[l,u,d,h,p,f,r]);return g==null?null:W.createElement(ei.Provider,{value:c},W.createElement($f.Provider,{children:n,value:g}))}function yP(t){let{children:e,location:n}=t;return nP(n0(e),n)}new Promise(()=>{});function n0(t,e){e===void 0&&(e=[]);let n=[];return W.Children.forEach(t,(s,r)=>{if(!W.isValidElement(s))return;let i=[...e,r];if(s.type===W.Fragment){n.push.apply(n,n0(s.props.children,i));return}s.type!==un&&mt(!1),!s.props.index||!s.props.children||mt(!1);let o={id:s.props.id||i.join("-"),caseSensitive:s.props.caseSensitive,element:s.props.element,Component:s.props.Component,index:s.props.index,path:s.props.path,loader:s.props.loader,action:s.props.action,errorElement:s.props.errorElement,ErrorBoundary:s.props.ErrorBoundary,hasErrorBoundary:s.props.ErrorBoundary!=null||s.props.errorElement!=null,shouldRevalidate:s.props.shouldRevalidate,handle:s.props.handle,lazy:s.props.lazy};s.props.children&&(o.children=n0(s.props.children,i)),n.push(o)}),n}/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function kp(){return kp=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(t[s]=n[s])}return t},kp.apply(this,arguments)}function g$(t,e){if(t==null)return{};var n={},s=Object.keys(t),r,i;for(i=0;i<s.length;i++)r=s[i],!(e.indexOf(r)>=0)&&(n[r]=t[r]);return n}function xP(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function vP(t,e){return t.button===0&&(!e||e==="_self")&&!xP(t)}const bP=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],wP=["aria-current","caseSensitive","className","end","style","to","viewTransition","children"],kP="6";try{window.__reactRouterVersion=kP}catch{}const CP=W.createContext({isTransitioning:!1}),SP="startTransition",C2=y3[SP];function IP(t){let{basename:e,children:n,future:s,window:r}=t,i=W.useRef();i.current==null&&(i.current=RO({window:r,v5Compat:!0}));let o=i.current,[a,l]=W.useState({action:o.action,location:o.location}),{v7_startTransition:c}=s||{},u=W.useCallback(d=>{c&&C2?C2(()=>l(d)):l(d)},[l,c]);return W.useLayoutEffect(()=>o.listen(u),[o,u]),W.useEffect(()=>mP(s),[s]),W.createElement(gP,{basename:e,children:n,location:a.location,navigationType:a.action,navigator:o,future:s})}const $P=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",TP=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Eo=W.forwardRef(function(e,n){let{onClick:s,relative:r,reloadDocument:i,replace:o,state:a,target:l,to:c,preventScrollReset:u,viewTransition:d}=e,h=g$(e,bP),{basename:p}=W.useContext(ei),f,g=!1;if(typeof c=="string"&&TP.test(c)&&(f=c,$P))try{let b=new URL(window.location.href),w=c.startsWith("//")?new URL(b.protocol+c):new URL(c),k=dl(w.pathname,p);w.origin===b.origin&&k!=null?c=k+w.search+w.hash:g=!0}catch{}let x=eP(c,{relative:r}),y=NP(c,{replace:o,state:a,target:l,preventScrollReset:u,relative:r,viewTransition:d});function v(b){s&&s(b),b.defaultPrevented||y(b)}return W.createElement("a",kp({},h,{href:f||x,onClick:g||i?s:v,ref:n,target:l}))}),EP=W.forwardRef(function(e,n){let{"aria-current":s="page",caseSensitive:r=!1,className:i="",end:o=!1,style:a,to:l,viewTransition:c,children:u}=e,d=g$(e,wP),h=Tf(l,{relative:d.relative}),p=ti(),f=W.useContext(c$),{navigator:g,basename:x}=W.useContext(ei),y=f!=null&&AP(h)&&c===!0,v=g.encodeLocation?g.encodeLocation(h).pathname:h.pathname,b=p.pathname,w=f&&f.navigation&&f.navigation.location?f.navigation.location.pathname:null;r||(b=b.toLowerCase(),w=w?w.toLowerCase():null,v=v.toLowerCase()),w&&x&&(w=dl(w,x)||w);const k=v!=="/"&&v.endsWith("/")?v.length-1:v.length;let S=b===v||!o&&b.startsWith(v)&&b.charAt(k)==="/",I=w!=null&&(w===v||!o&&w.startsWith(v)&&w.charAt(v.length)==="/"),C={isActive:S,isPending:I,isTransitioning:y},$=S?s:void 0,R;typeof i=="function"?R=i(C):R=[i,S?"active":null,I?"pending":null,y?"transitioning":null].filter(Boolean).join(" ");let _=typeof a=="function"?a(C):a;return W.createElement(Eo,kp({},d,{"aria-current":$,className:R,ref:n,style:_,to:l,viewTransition:c}),typeof u=="function"?u(C):u)});var s0;(function(t){t.UseScrollRestoration="useScrollRestoration",t.UseSubmit="useSubmit",t.UseSubmitFetcher="useSubmitFetcher",t.UseFetcher="useFetcher",t.useViewTransitionState="useViewTransitionState"})(s0||(s0={}));var S2;(function(t){t.UseFetcher="useFetcher",t.UseFetchers="useFetchers",t.UseScrollRestoration="useScrollRestoration"})(S2||(S2={}));function RP(t){let e=W.useContext(If);return e||mt(!1),e}function NP(t,e){let{target:n,replace:s,state:r,preventScrollReset:i,relative:o,viewTransition:a}=e===void 0?{}:e,l=ua(),c=ti(),u=Tf(t,{relative:o});return W.useCallback(d=>{if(vP(d,n)){d.preventDefault();let h=s!==void 0?s:wp(c)===wp(u);l(t,{replace:h,state:r,preventScrollReset:i,relative:o,viewTransition:a})}},[c,l,u,s,r,n,t,i,o,a])}function AP(t,e){e===void 0&&(e={});let n=W.useContext(CP);n==null&&mt(!1);let{basename:s}=RP(s0.useViewTransitionState),r=Tf(t,{relative:e.relative});if(!n.isTransitioning)return!1;let i=dl(n.currentLocation.pathname,s)||n.currentLocation.pathname,o=dl(n.nextLocation.pathname,s)||n.nextLocation.pathname;return t0(r.pathname,o)!=null||t0(r.pathname,i)!=null}var _P={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const DP=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),FP=(t,e)=>{const n=W.forwardRef(({color:s="currentColor",size:r=24,strokeWidth:i=2,absoluteStrokeWidth:o,children:a,...l},c)=>W.createElement("svg",{ref:c,..._P,width:r,height:r,stroke:s,strokeWidth:o?Number(i)*24/Number(r):i,className:`lucide lucide-${DP(t)}`,...l},[...e.map(([u,d])=>W.createElement(u,d)),...(Array.isArray(a)?a:[a])||[]]));return n.displayName=`${t}`,n};var we=FP;const Mt=we("Activity",[["path",{d:"M22 12h-4l-3 9L9 3l-3 9H2",key:"d5dnw9"}]]),OP=we("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]),Wn=we("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),yh=we("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]),PP=we("Award",[["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}],["path",{d:"M15.477 12.89 17 22l-5-3-5 3 1.523-9.11",key:"em7aur"}]]),Cp=we("BarChart3",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]),gn=we("Brain",[["path",{d:"M9.5 2A2.5 2.5 0 0 1 12 4.5v15a2.5 2.5 0 0 1-4.96.44 2.5 2.5 0 0 1-2.96-3.08 3 3 0 0 1-.34-5.58 2.5 2.5 0 0 1 1.32-4.24 2.5 2.5 0 0 1 1.98-3A2.5 2.5 0 0 1 9.5 2Z",key:"1mhkh5"}],["path",{d:"M14.5 2A2.5 2.5 0 0 0 12 4.5v15a2.5 2.5 0 0 0 4.96.44 2.5 2.5 0 0 0 2.96-3.08 3 3 0 0 0 .34-5.58 2.5 2.5 0 0 0-1.32-4.24 2.5 2.5 0 0 0-1.98-3A2.5 2.5 0 0 0 14.5 2Z",key:"1d6s00"}]]),y$=we("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]),Zn=we("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["polyline",{points:"22 4 12 14.01 9 11.01",key:"6xbx8j"}]]),Sp=we("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]),Mg=we("Cpu",[["rect",{x:"4",y:"4",width:"16",height:"16",rx:"2",key:"1vbyd7"}],["rect",{x:"9",y:"9",width:"6",height:"6",key:"o3kz5p"}],["path",{d:"M15 2v2",key:"13l42r"}],["path",{d:"M15 20v2",key:"15mkzm"}],["path",{d:"M2 15h2",key:"1gxd5l"}],["path",{d:"M2 9h2",key:"1bbxkp"}],["path",{d:"M20 15h2",key:"19e6y8"}],["path",{d:"M20 9h2",key:"19tzq7"}],["path",{d:"M9 2v2",key:"165o2o"}],["path",{d:"M9 20v2",key:"i2bqo8"}]]),MP=we("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]),x$=we("Droplets",[["path",{d:"M7 16.3c2.2 0 4-1.83 4-4.05 0-1.16-.57-2.26-1.71-3.19S7.29 6.75 7 5.3c-.29 1.45-1.14 2.84-2.29 3.76S3 11.1 3 12.25c0 2.22 1.8 4.05 4 4.05z",key:"1ptgy4"}],["path",{d:"M12.56 6.6A10.97 10.97 0 0 0 14 3.02c.5 2.5 2 4.9 4 6.5s3 3.5 3 5.5a6.98 6.98 0 0 1-11.91 4.97",key:"1sl1rz"}]]),r0=we("EyeOff",[["path",{d:"M9.88 9.88a3 3 0 1 0 4.24 4.24",key:"1jxqfv"}],["path",{d:"M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68",key:"9wicm4"}],["path",{d:"M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61",key:"1jreej"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]),ks=we("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),v$=we("FileText",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["line",{x1:"16",x2:"8",y1:"13",y2:"13",key:"14keom"}],["line",{x1:"16",x2:"8",y1:"17",y2:"17",key:"17nazh"}],["line",{x1:"10",x2:"8",y1:"9",y2:"9",key:"1a5vjj"}]]),Zt=we("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]),LP=we("Home",[["path",{d:"m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"y5dka4"}],["polyline",{points:"9 22 9 12 15 12 15 22",key:"e2us08"}]]),Hr=we("Loader",[["line",{x1:"12",x2:"12",y1:"2",y2:"6",key:"gza1u7"}],["line",{x1:"12",x2:"12",y1:"18",y2:"22",key:"1qhbu9"}],["line",{x1:"4.93",x2:"7.76",y1:"4.93",y2:"7.76",key:"xae44r"}],["line",{x1:"16.24",x2:"19.07",y1:"16.24",y2:"19.07",key:"bxnmvf"}],["line",{x1:"2",x2:"6",y1:"12",y2:"12",key:"89khin"}],["line",{x1:"18",x2:"22",y1:"12",y2:"12",key:"pb8tfm"}],["line",{x1:"4.93",x2:"7.76",y1:"19.07",y2:"16.24",key:"1uxjnu"}],["line",{x1:"16.24",x2:"19.07",y1:"7.76",y2:"4.93",key:"6duxfx"}]]),zP=we("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]),jP=we("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]),BP=we("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]),WP=we("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]),Ws=we("Mic",[["path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z",key:"131961"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]),VP=we("Navigation",[["polygon",{points:"3 11 22 2 13 21 11 13 3 11",key:"1ltx0t"}]]),UP=we("PenSquare",[["path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1qinfi"}],["path",{d:"M18.5 2.5a2.12 2.12 0 0 1 3 3L12 15l-4 1 1-4Z",key:"w2jsv5"}]]),I2=we("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]),b$=we("Play",[["polygon",{points:"5 3 19 12 5 21 5 3",key:"191637"}]]),GP=we("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]),Ef=we("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),HP=we("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]),$2=we("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]),w$=we("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]),KP=we("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),qP=we("Share2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]),Fl=we("Shield",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z",key:"3xmgem"}]]),XP=we("Smartphone",[["rect",{width:"14",height:"20",x:"5",y:"2",rx:"2",ry:"2",key:"1yt0o3"}],["path",{d:"M12 18h.01",key:"mhygvu"}]]),YP=we("Sparkles",[["path",{d:"m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z",key:"17u4zn"}],["path",{d:"M5 3v4",key:"bklmnn"}],["path",{d:"M19 17v4",key:"iiml17"}],["path",{d:"M3 5h4",key:"nem4j1"}],["path",{d:"M17 19h4",key:"lbex7p"}]]),k$=we("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]),QP=we("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]),JP=we("Stethoscope",[["path",{d:"M4.8 2.3A.3.3 0 1 0 5 2H4a2 2 0 0 0-2 2v5a6 6 0 0 0 6 6v0a6 6 0 0 0 6-6V4a2 2 0 0 0-2-2h-1a.2.2 0 1 0 .3.3",key:"1jd90r"}],["path",{d:"M8 15v1a6 6 0 0 0 6 6v0a6 6 0 0 0 6-6v-4",key:"126ukv"}],["circle",{cx:"20",cy:"10",r:"2",key:"ts1r5v"}]]),Jx=we("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]),ZP=we("Thermometer",[["path",{d:"M14 4v10.54a4 4 0 1 1-4 0V4a2 2 0 0 1 4 0Z",key:"17jzev"}]]),e4=we("TrendingDown",[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]]),Zx=we("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]),e1=we("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),t4=we("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]),T2=we("Volume2",[["polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5",key:"16drj5"}],["path",{d:"M15.54 8.46a5 5 0 0 1 0 7.07",key:"ltjumu"}],["path",{d:"M19.07 4.93a10 10 0 0 1 0 14.14",key:"1kegas"}]]),Rf=we("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),hl=we("Zap",[["polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2",key:"45s27k"}]]),n4=()=>{};var E2={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const C$=function(t){const e=[];let n=0;for(let s=0;s<t.length;s++){let r=t.charCodeAt(s);r<128?e[n++]=r:r<2048?(e[n++]=r>>6|192,e[n++]=r&63|128):(r&64512)===55296&&s+1<t.length&&(t.charCodeAt(s+1)&64512)===56320?(r=65536+((r&1023)<<10)+(t.charCodeAt(++s)&1023),e[n++]=r>>18|240,e[n++]=r>>12&63|128,e[n++]=r>>6&63|128,e[n++]=r&63|128):(e[n++]=r>>12|224,e[n++]=r>>6&63|128,e[n++]=r&63|128)}return e},s4=function(t){const e=[];let n=0,s=0;for(;n<t.length;){const r=t[n++];if(r<128)e[s++]=String.fromCharCode(r);else if(r>191&&r<224){const i=t[n++];e[s++]=String.fromCharCode((r&31)<<6|i&63)}else if(r>239&&r<365){const i=t[n++],o=t[n++],a=t[n++],l=((r&7)<<18|(i&63)<<12|(o&63)<<6|a&63)-65536;e[s++]=String.fromCharCode(55296+(l>>10)),e[s++]=String.fromCharCode(56320+(l&1023))}else{const i=t[n++],o=t[n++];e[s++]=String.fromCharCode((r&15)<<12|(i&63)<<6|o&63)}}return e.join("")},S$={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,s=[];for(let r=0;r<t.length;r+=3){const i=t[r],o=r+1<t.length,a=o?t[r+1]:0,l=r+2<t.length,c=l?t[r+2]:0,u=i>>2,d=(i&3)<<4|a>>4;let h=(a&15)<<2|c>>6,p=c&63;l||(p=64,o||(h=64)),s.push(n[u],n[d],n[h],n[p])}return s.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(C$(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):s4(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,s=[];for(let r=0;r<t.length;){const i=n[t.charAt(r++)],a=r<t.length?n[t.charAt(r)]:0;++r;const c=r<t.length?n[t.charAt(r)]:64;++r;const d=r<t.length?n[t.charAt(r)]:64;if(++r,i==null||a==null||c==null||d==null)throw new r4;const h=i<<2|a>>4;if(s.push(h),c!==64){const p=a<<4&240|c>>2;if(s.push(p),d!==64){const f=c<<6&192|d;s.push(f)}}}return s},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class r4 extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const i4=function(t){const e=C$(t);return S$.encodeByteArray(e,!0)},I$=function(t){return i4(t).replace(/\./g,"")},$$=function(t){try{return S$.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function o4(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const a4=()=>o4().__FIREBASE_DEFAULTS__,l4=()=>{if(typeof process>"u"||typeof E2>"u")return;const t=E2.__FIREBASE_DEFAULTS__;if(t)return JSON.parse(t)},c4=()=>{if(typeof document>"u")return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=t&&$$(t[1]);return e&&JSON.parse(e)},t1=()=>{try{return n4()||a4()||l4()||c4()}catch(t){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`);return}},u4=t=>{var e,n;return(n=(e=t1())==null?void 0:e.emulatorHosts)==null?void 0:n[t]},T$=()=>{var t;return(t=t1())==null?void 0:t.config},E$=t=>{var e;return(e=t1())==null?void 0:e[`_${t}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class d4{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}wrapCallback(e){return(n,s)=>{n?this.reject(n):this.resolve(s),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(n):e(n,s))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Nf(t){try{return(t.startsWith("http://")||t.startsWith("https://")?new URL(t).hostname:t).endsWith(".cloudworkstations.dev")}catch{return!1}}async function h4(t){return(await fetch(t,{credentials:"include"})).ok}const Oc={};function p4(){const t={prod:[],emulator:[]};for(const e of Object.keys(Oc))Oc[e]?t.emulator.push(e):t.prod.push(e);return t}function f4(t){let e=document.getElementById(t),n=!1;return e||(e=document.createElement("div"),e.setAttribute("id",t),n=!0),{created:n,element:e}}let R2=!1;function m4(t,e){if(typeof window>"u"||typeof document>"u"||!Nf(window.location.host)||Oc[t]===e||Oc[t]||R2)return;Oc[t]=e;function n(h){return`__firebase__banner__${h}`}const s="__firebase__banner",i=p4().prod.length>0;function o(){const h=document.getElementById(s);h&&h.remove()}function a(h){h.style.display="flex",h.style.background="#7faaf0",h.style.position="fixed",h.style.bottom="5px",h.style.left="5px",h.style.padding=".5em",h.style.borderRadius="5px",h.style.alignItems="center"}function l(h,p){h.setAttribute("width","24"),h.setAttribute("id",p),h.setAttribute("height","24"),h.setAttribute("viewBox","0 0 24 24"),h.setAttribute("fill","none"),h.style.marginLeft="-6px"}function c(){const h=document.createElement("span");return h.style.cursor="pointer",h.style.marginLeft="16px",h.style.fontSize="24px",h.innerHTML=" &times;",h.onclick=()=>{R2=!0,o()},h}function u(h,p){h.setAttribute("id",p),h.innerText="Learn more",h.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",h.setAttribute("target","__blank"),h.style.paddingLeft="5px",h.style.textDecoration="underline"}function d(){const h=f4(s),p=n("text"),f=document.getElementById(p)||document.createElement("span"),g=n("learnmore"),x=document.getElementById(g)||document.createElement("a"),y=n("preprendIcon"),v=document.getElementById(y)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(h.created){const b=h.element;a(b),u(x,g);const w=c();l(v,y),b.append(v,f,x,w),document.body.appendChild(b)}i?(f.innerText="Preview backend disconnected.",v.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(v.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,f.innerText="Preview backend running in this workspace."),f.setAttribute("id",p)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",d):d()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Tn(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function g4(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Tn())}function y4(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function x4(){const t=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof t=="object"&&t.id!==void 0}function v4(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function b4(){const t=Tn();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}function w4(){try{return typeof indexedDB=="object"}catch{return!1}}function k4(){return new Promise((t,e)=>{try{let n=!0;const s="validate-browser-context-for-indexeddb-analytics-module",r=self.indexedDB.open(s);r.onsuccess=()=>{r.result.close(),n||self.indexedDB.deleteDatabase(s),t(!0)},r.onupgradeneeded=()=>{n=!1},r.onerror=()=>{var i;e(((i=r.error)==null?void 0:i.message)||"")}}catch(n){e(n)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const C4="FirebaseError";class to extends Error{constructor(e,n,s){super(n),this.code=e,this.customData=s,this.name=C4,Object.setPrototypeOf(this,to.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Iu.prototype.create)}}class Iu{constructor(e,n,s){this.service=e,this.serviceName=n,this.errors=s}create(e,...n){const s=n[0]||{},r=`${this.service}/${e}`,i=this.errors[e],o=i?S4(i,s):"Error",a=`${this.serviceName}: ${o} (${r}).`;return new to(r,a,s)}}function S4(t,e){return t.replace(I4,(n,s)=>{const r=e[s];return r!=null?String(r):`<${s}?>`})}const I4=/\{\$([^}]+)}/g;function $4(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function pl(t,e){if(t===e)return!0;const n=Object.keys(t),s=Object.keys(e);for(const r of n){if(!s.includes(r))return!1;const i=t[r],o=e[r];if(N2(i)&&N2(o)){if(!pl(i,o))return!1}else if(i!==o)return!1}for(const r of s)if(!n.includes(r))return!1;return!0}function N2(t){return t!==null&&typeof t=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $u(t){const e=[];for(const[n,s]of Object.entries(t))Array.isArray(s)?s.forEach(r=>{e.push(encodeURIComponent(n)+"="+encodeURIComponent(r))}):e.push(encodeURIComponent(n)+"="+encodeURIComponent(s));return e.length?"&"+e.join("&"):""}function xc(t){const e={};return t.replace(/^\?/,"").split("&").forEach(s=>{if(s){const[r,i]=s.split("=");e[decodeURIComponent(r)]=decodeURIComponent(i)}}),e}function vc(t){const e=t.indexOf("?");if(!e)return"";const n=t.indexOf("#",e);return t.substring(e,n>0?n:void 0)}function T4(t,e){const n=new E4(t,e);return n.subscribe.bind(n)}class E4{constructor(e,n){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=n,this.task.then(()=>{e(this)}).catch(s=>{this.error(s)})}next(e){this.forEachObserver(n=>{n.next(e)})}error(e){this.forEachObserver(n=>{n.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,n,s){let r;if(e===void 0&&n===void 0&&s===void 0)throw new Error("Missing Observer.");R4(e,["next","error","complete"])?r=e:r={next:e,error:n,complete:s},r.next===void 0&&(r.next=Lg),r.error===void 0&&(r.error=Lg),r.complete===void 0&&(r.complete=Lg);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch{}}),this.observers.push(r),i}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let n=0;n<this.observers.length;n++)this.sendOne(n,e)}sendOne(e,n){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{n(this.observers[e])}catch(s){typeof console<"u"&&console.error&&console.error(s)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function R4(t,e){if(typeof t!="object"||t===null)return!1;for(const n of e)if(n in t&&typeof t[n]=="function")return!0;return!1}function Lg(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $r(t){return t&&t._delegate?t._delegate:t}class fl{constructor(e,n,s){this.name=e,this.instanceFactory=n,this.type=s,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bo="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class N4{constructor(e,n){this.name=e,this.container=n,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const n=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(n)){const s=new d4;if(this.instancesDeferred.set(n,s),this.isInitialized(n)||this.shouldAutoInitialize())try{const r=this.getOrInitializeService({instanceIdentifier:n});r&&s.resolve(r)}catch{}}return this.instancesDeferred.get(n).promise}getImmediate(e){const n=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),s=(e==null?void 0:e.optional)??!1;if(this.isInitialized(n)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:n})}catch(r){if(s)return null;throw r}else{if(s)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(_4(e))try{this.getOrInitializeService({instanceIdentifier:bo})}catch{}for(const[n,s]of this.instancesDeferred.entries()){const r=this.normalizeInstanceIdentifier(n);try{const i=this.getOrInitializeService({instanceIdentifier:r});s.resolve(i)}catch{}}}}clearInstance(e=bo){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(n=>"INTERNAL"in n).map(n=>n.INTERNAL.delete()),...e.filter(n=>"_delete"in n).map(n=>n._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=bo){return this.instances.has(e)}getOptions(e=bo){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:n={}}=e,s=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(s))throw Error(`${this.name}(${s}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:s,options:n});for(const[i,o]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(i);s===a&&o.resolve(r)}return r}onInit(e,n){const s=this.normalizeInstanceIdentifier(n),r=this.onInitCallbacks.get(s)??new Set;r.add(e),this.onInitCallbacks.set(s,r);const i=this.instances.get(s);return i&&e(i,s),()=>{r.delete(e)}}invokeOnInitCallbacks(e,n){const s=this.onInitCallbacks.get(n);if(s)for(const r of s)try{r(e,n)}catch{}}getOrInitializeService({instanceIdentifier:e,options:n={}}){let s=this.instances.get(e);if(!s&&this.component&&(s=this.component.instanceFactory(this.container,{instanceIdentifier:A4(e),options:n}),this.instances.set(e,s),this.instancesOptions.set(e,n),this.invokeOnInitCallbacks(s,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,s)}catch{}return s||null}normalizeInstanceIdentifier(e=bo){return this.component?this.component.multipleInstances?e:bo:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function A4(t){return t===bo?void 0:t}function _4(t){return t.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class D4{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const n=this.getProvider(e.name);if(n.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);n.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const n=new N4(e,this);return this.providers.set(e,n),n}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Xe;(function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"})(Xe||(Xe={}));const F4={debug:Xe.DEBUG,verbose:Xe.VERBOSE,info:Xe.INFO,warn:Xe.WARN,error:Xe.ERROR,silent:Xe.SILENT},O4=Xe.INFO,P4={[Xe.DEBUG]:"log",[Xe.VERBOSE]:"log",[Xe.INFO]:"info",[Xe.WARN]:"warn",[Xe.ERROR]:"error"},M4=(t,e,...n)=>{if(e<t.logLevel)return;const s=new Date().toISOString(),r=P4[e];if(r)console[r](`[${s}]  ${t.name}:`,...n);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};let R$=class{constructor(e){this.name=e,this._logLevel=O4,this._logHandler=M4,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Xe))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?F4[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Xe.DEBUG,...e),this._logHandler(this,Xe.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Xe.VERBOSE,...e),this._logHandler(this,Xe.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Xe.INFO,...e),this._logHandler(this,Xe.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Xe.WARN,...e),this._logHandler(this,Xe.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Xe.ERROR,...e),this._logHandler(this,Xe.ERROR,...e)}};const L4=(t,e)=>e.some(n=>t instanceof n);let A2,_2;function z4(){return A2||(A2=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function j4(){return _2||(_2=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const N$=new WeakMap,i0=new WeakMap,A$=new WeakMap,zg=new WeakMap,n1=new WeakMap;function B4(t){const e=new Promise((n,s)=>{const r=()=>{t.removeEventListener("success",i),t.removeEventListener("error",o)},i=()=>{n(Mi(t.result)),r()},o=()=>{s(t.error),r()};t.addEventListener("success",i),t.addEventListener("error",o)});return e.then(n=>{n instanceof IDBCursor&&N$.set(n,t)}).catch(()=>{}),n1.set(e,t),e}function W4(t){if(i0.has(t))return;const e=new Promise((n,s)=>{const r=()=>{t.removeEventListener("complete",i),t.removeEventListener("error",o),t.removeEventListener("abort",o)},i=()=>{n(),r()},o=()=>{s(t.error||new DOMException("AbortError","AbortError")),r()};t.addEventListener("complete",i),t.addEventListener("error",o),t.addEventListener("abort",o)});i0.set(t,e)}let o0={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return i0.get(t);if(e==="objectStoreNames")return t.objectStoreNames||A$.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return Mi(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function V4(t){o0=t(o0)}function U4(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...n){const s=t.call(jg(this),e,...n);return A$.set(s,e.sort?e.sort():[e]),Mi(s)}:j4().includes(t)?function(...e){return t.apply(jg(this),e),Mi(N$.get(this))}:function(...e){return Mi(t.apply(jg(this),e))}}function G4(t){return typeof t=="function"?U4(t):(t instanceof IDBTransaction&&W4(t),L4(t,z4())?new Proxy(t,o0):t)}function Mi(t){if(t instanceof IDBRequest)return B4(t);if(zg.has(t))return zg.get(t);const e=G4(t);return e!==t&&(zg.set(t,e),n1.set(e,t)),e}const jg=t=>n1.get(t);function H4(t,e,{blocked:n,upgrade:s,blocking:r,terminated:i}={}){const o=indexedDB.open(t,e),a=Mi(o);return s&&o.addEventListener("upgradeneeded",l=>{s(Mi(o.result),l.oldVersion,l.newVersion,Mi(o.transaction),l)}),n&&o.addEventListener("blocked",l=>n(l.oldVersion,l.newVersion,l)),a.then(l=>{i&&l.addEventListener("close",()=>i()),r&&l.addEventListener("versionchange",c=>r(c.oldVersion,c.newVersion,c))}).catch(()=>{}),a}const K4=["get","getKey","getAll","getAllKeys","count"],q4=["put","add","delete","clear"],Bg=new Map;function D2(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(Bg.get(e))return Bg.get(e);const n=e.replace(/FromIndex$/,""),s=e!==n,r=q4.includes(n);if(!(n in(s?IDBIndex:IDBObjectStore).prototype)||!(r||K4.includes(n)))return;const i=async function(o,...a){const l=this.transaction(o,r?"readwrite":"readonly");let c=l.store;return s&&(c=c.index(a.shift())),(await Promise.all([c[n](...a),r&&l.done]))[0]};return Bg.set(e,i),i}V4(t=>({...t,get:(e,n,s)=>D2(e,n)||t.get(e,n,s),has:(e,n)=>!!D2(e,n)||t.has(e,n)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class X4{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(n=>{if(Y4(n)){const s=n.getImmediate();return`${s.library}/${s.version}`}else return null}).filter(n=>n).join(" ")}}function Y4(t){const e=t.getComponent();return(e==null?void 0:e.type)==="VERSION"}const a0="@firebase/app",F2="0.14.7";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Kr=new R$("@firebase/app"),Q4="@firebase/app-compat",J4="@firebase/analytics-compat",Z4="@firebase/analytics",eM="@firebase/app-check-compat",tM="@firebase/app-check",nM="@firebase/auth",sM="@firebase/auth-compat",rM="@firebase/database",iM="@firebase/data-connect",oM="@firebase/database-compat",aM="@firebase/functions",lM="@firebase/functions-compat",cM="@firebase/installations",uM="@firebase/installations-compat",dM="@firebase/messaging",hM="@firebase/messaging-compat",pM="@firebase/performance",fM="@firebase/performance-compat",mM="@firebase/remote-config",gM="@firebase/remote-config-compat",yM="@firebase/storage",xM="@firebase/storage-compat",vM="@firebase/firestore",bM="@firebase/ai",wM="@firebase/firestore-compat",kM="firebase",CM="12.8.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const l0="[DEFAULT]",SM={[a0]:"fire-core",[Q4]:"fire-core-compat",[Z4]:"fire-analytics",[J4]:"fire-analytics-compat",[tM]:"fire-app-check",[eM]:"fire-app-check-compat",[nM]:"fire-auth",[sM]:"fire-auth-compat",[rM]:"fire-rtdb",[iM]:"fire-data-connect",[oM]:"fire-rtdb-compat",[aM]:"fire-fn",[lM]:"fire-fn-compat",[cM]:"fire-iid",[uM]:"fire-iid-compat",[dM]:"fire-fcm",[hM]:"fire-fcm-compat",[pM]:"fire-perf",[fM]:"fire-perf-compat",[mM]:"fire-rc",[gM]:"fire-rc-compat",[yM]:"fire-gcs",[xM]:"fire-gcs-compat",[vM]:"fire-fst",[wM]:"fire-fst-compat",[bM]:"fire-vertex","fire-js":"fire-js",[kM]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ip=new Map,IM=new Map,c0=new Map;function O2(t,e){try{t.container.addComponent(e)}catch(n){Kr.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function iu(t){const e=t.name;if(c0.has(e))return Kr.debug(`There were multiple attempts to register component ${e}.`),!1;c0.set(e,t);for(const n of Ip.values())O2(n,t);for(const n of IM.values())O2(n,t);return!0}function _$(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}function Bs(t){return t==null?!1:t.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $M={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Li=new Iu("app","Firebase",$M);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TM{constructor(e,n,s){this._isDeleted=!1,this._options={...e},this._config={...n},this._name=n.name,this._automaticDataCollectionEnabled=n.automaticDataCollectionEnabled,this._container=s,this.container.addComponent(new fl("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Li.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Tu=CM;function D$(t,e={}){let n=t;typeof e!="object"&&(e={name:e});const s={name:l0,automaticDataCollectionEnabled:!0,...e},r=s.name;if(typeof r!="string"||!r)throw Li.create("bad-app-name",{appName:String(r)});if(n||(n=T$()),!n)throw Li.create("no-options");const i=Ip.get(r);if(i){if(pl(n,i.options)&&pl(s,i.config))return i;throw Li.create("duplicate-app",{appName:r})}const o=new D4(r);for(const l of c0.values())o.addComponent(l);const a=new TM(n,s,o);return Ip.set(r,a),a}function EM(t=l0){const e=Ip.get(t);if(!e&&t===l0&&T$())return D$();if(!e)throw Li.create("no-app",{appName:t});return e}function Ya(t,e,n){let s=SM[t]??t;n&&(s+=`-${n}`);const r=s.match(/\s|\//),i=e.match(/\s|\//);if(r||i){const o=[`Unable to register library "${s}" with version "${e}":`];r&&o.push(`library name "${s}" contains illegal characters (whitespace or "/")`),r&&i&&o.push("and"),i&&o.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Kr.warn(o.join(" "));return}iu(new fl(`${s}-version`,()=>({library:s,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const RM="firebase-heartbeat-database",NM=1,ou="firebase-heartbeat-store";let Wg=null;function F$(){return Wg||(Wg=H4(RM,NM,{upgrade:(t,e)=>{switch(e){case 0:try{t.createObjectStore(ou)}catch(n){console.warn(n)}}}}).catch(t=>{throw Li.create("idb-open",{originalErrorMessage:t.message})})),Wg}async function AM(t){try{const n=(await F$()).transaction(ou),s=await n.objectStore(ou).get(O$(t));return await n.done,s}catch(e){if(e instanceof to)Kr.warn(e.message);else{const n=Li.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});Kr.warn(n.message)}}}async function P2(t,e){try{const s=(await F$()).transaction(ou,"readwrite");await s.objectStore(ou).put(e,O$(t)),await s.done}catch(n){if(n instanceof to)Kr.warn(n.message);else{const s=Li.create("idb-set",{originalErrorMessage:n==null?void 0:n.message});Kr.warn(s.message)}}}function O$(t){return`${t.name}!${t.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _M=1024,DM=30;class FM{constructor(e){this.container=e,this._heartbeatsCache=null;const n=this.container.getProvider("app").getImmediate();this._storage=new PM(n),this._heartbeatsCachePromise=this._storage.read().then(s=>(this._heartbeatsCache=s,s))}async triggerHeartbeat(){var e,n;try{const r=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=M2();if(((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((n=this._heartbeatsCache)==null?void 0:n.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(o=>o.date===i))return;if(this._heartbeatsCache.heartbeats.push({date:i,agent:r}),this._heartbeatsCache.heartbeats.length>DM){const o=MM(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(o,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(s){Kr.warn(s)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const n=M2(),{heartbeatsToSend:s,unsentEntries:r}=OM(this._heartbeatsCache.heartbeats),i=I$(JSON.stringify({version:2,heartbeats:s}));return this._heartbeatsCache.lastSentHeartbeatDate=n,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(n){return Kr.warn(n),""}}}function M2(){return new Date().toISOString().substring(0,10)}function OM(t,e=_M){const n=[];let s=t.slice();for(const r of t){const i=n.find(o=>o.agent===r.agent);if(i){if(i.dates.push(r.date),L2(n)>e){i.dates.pop();break}}else if(n.push({agent:r.agent,dates:[r.date]}),L2(n)>e){n.pop();break}s=s.slice(1)}return{heartbeatsToSend:n,unsentEntries:s}}class PM{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return w4()?k4().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const n=await AM(this.app);return n!=null&&n.heartbeats?n:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const s=await this.read();return P2(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??s.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const s=await this.read();return P2(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??s.lastSentHeartbeatDate,heartbeats:[...s.heartbeats,...e.heartbeats]})}else return}}function L2(t){return I$(JSON.stringify({version:2,heartbeats:t})).length}function MM(t){if(t.length===0)return-1;let e=0,n=t[0].date;for(let s=1;s<t.length;s++)t[s].date<n&&(n=t[s].date,e=s);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function LM(t){iu(new fl("platform-logger",e=>new X4(e),"PRIVATE")),iu(new fl("heartbeat",e=>new FM(e),"PRIVATE")),Ya(a0,F2,t),Ya(a0,F2,"esm2020"),Ya("fire-js","")}LM("");function P$(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const zM=P$,M$=new Iu("auth","Firebase",P$());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $p=new R$("@firebase/auth");function jM(t,...e){$p.logLevel<=Xe.WARN&&$p.warn(`Auth (${Tu}): ${t}`,...e)}function Gh(t,...e){$p.logLevel<=Xe.ERROR&&$p.error(`Auth (${Tu}): ${t}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qs(t,...e){throw s1(t,...e)}function fr(t,...e){return s1(t,...e)}function L$(t,e,n){const s={...zM(),[e]:n};return new Iu("auth","Firebase",s).create(e,{appName:t.name})}function jr(t){return L$(t,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function s1(t,...e){if(typeof t!="string"){const n=e[0],s=[...e.slice(1)];return s[0]&&(s[0].appName=t.name),t._errorFactory.create(n,...s)}return M$.create(t,...e)}function ke(t,e,...n){if(!t)throw s1(e,...n)}function Pr(t){const e="INTERNAL ASSERTION FAILED: "+t;throw Gh(e),new Error(e)}function qr(t,e){t||Pr(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function u0(){var t;return typeof self<"u"&&((t=self.location)==null?void 0:t.href)||""}function BM(){return z2()==="http:"||z2()==="https:"}function z2(){var t;return typeof self<"u"&&((t=self.location)==null?void 0:t.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function WM(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(BM()||x4()||"connection"in navigator)?navigator.onLine:!0}function VM(){if(typeof navigator>"u")return null;const t=navigator;return t.languages&&t.languages[0]||t.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Eu{constructor(e,n){this.shortDelay=e,this.longDelay=n,qr(n>e,"Short delay should be less than long delay!"),this.isMobile=g4()||v4()}get(){return WM()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function r1(t,e){qr(t.emulator,"Emulator should always be set here");const{url:n}=t.emulator;return e?`${n}${e.startsWith("/")?e.slice(1):e}`:n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class z${static initialize(e,n,s){this.fetchImpl=e,n&&(this.headersImpl=n),s&&(this.responseImpl=s)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Pr("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Pr("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Pr("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const UM={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const GM=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],HM=new Eu(3e4,6e4);function no(t,e){return t.tenantId&&!e.tenantId?{...e,tenantId:t.tenantId}:e}async function ni(t,e,n,s,r={}){return j$(t,r,async()=>{let i={},o={};s&&(e==="GET"?o=s:i={body:JSON.stringify(s)});const a=$u({key:t.config.apiKey,...o}).slice(1),l=await t._getAdditionalHeaders();l["Content-Type"]="application/json",t.languageCode&&(l["X-Firebase-Locale"]=t.languageCode);const c={method:e,headers:l,...i};return y4()||(c.referrerPolicy="no-referrer"),t.emulatorConfig&&Nf(t.emulatorConfig.host)&&(c.credentials="include"),z$.fetch()(await B$(t,t.config.apiHost,n,a),c)})}async function j$(t,e,n){t._canInitEmulator=!1;const s={...UM,...e};try{const r=new qM(t),i=await Promise.race([n(),r.promise]);r.clearNetworkTimeout();const o=await i.json();if("needConfirmation"in o)throw xh(t,"account-exists-with-different-credential",o);if(i.ok&&!("errorMessage"in o))return o;{const a=i.ok?o.errorMessage:o.error.message,[l,c]=a.split(" : ");if(l==="FEDERATED_USER_ID_ALREADY_LINKED")throw xh(t,"credential-already-in-use",o);if(l==="EMAIL_EXISTS")throw xh(t,"email-already-in-use",o);if(l==="USER_DISABLED")throw xh(t,"user-disabled",o);const u=s[l]||l.toLowerCase().replace(/[_\s]+/g,"-");if(c)throw L$(t,u,c);Qs(t,u)}}catch(r){if(r instanceof to)throw r;Qs(t,"network-request-failed",{message:String(r)})}}async function Ru(t,e,n,s,r={}){const i=await ni(t,e,n,s,r);return"mfaPendingCredential"in i&&Qs(t,"multi-factor-auth-required",{_serverResponse:i}),i}async function B$(t,e,n,s){const r=`${e}${n}?${s}`,i=t,o=i.config.emulator?r1(t.config,r):`${t.config.apiScheme}://${r}`;return GM.includes(n)&&(await i._persistenceManagerAvailable,i._getPersistenceType()==="COOKIE")?i._getPersistence()._getFinalTarget(o).toString():o}function KM(t){switch(t){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class qM{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((n,s)=>{this.timer=setTimeout(()=>s(fr(this.auth,"network-request-failed")),HM.get())})}}function xh(t,e,n){const s={appName:t.name};n.email&&(s.email=n.email),n.phoneNumber&&(s.phoneNumber=n.phoneNumber);const r=fr(t,e,s);return r.customData._tokenResponse=n,r}function j2(t){return t!==void 0&&t.enterprise!==void 0}class XM{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const n of this.recaptchaEnforcementState)if(n.provider&&n.provider===e)return KM(n.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function YM(t,e){return ni(t,"GET","/v2/recaptchaConfig",no(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function QM(t,e){return ni(t,"POST","/v1/accounts:delete",e)}async function Tp(t,e){return ni(t,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pc(t){if(t)try{const e=new Date(Number(t));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function JM(t,e=!1){const n=$r(t),s=await n.getIdToken(e),r=i1(s);ke(r&&r.exp&&r.auth_time&&r.iat,n.auth,"internal-error");const i=typeof r.firebase=="object"?r.firebase:void 0,o=i==null?void 0:i.sign_in_provider;return{claims:r,token:s,authTime:Pc(Vg(r.auth_time)),issuedAtTime:Pc(Vg(r.iat)),expirationTime:Pc(Vg(r.exp)),signInProvider:o||null,signInSecondFactor:(i==null?void 0:i.sign_in_second_factor)||null}}function Vg(t){return Number(t)*1e3}function i1(t){const[e,n,s]=t.split(".");if(e===void 0||n===void 0||s===void 0)return Gh("JWT malformed, contained fewer than 3 sections"),null;try{const r=$$(n);return r?JSON.parse(r):(Gh("Failed to decode base64 JWT payload"),null)}catch(r){return Gh("Caught error parsing JWT payload as JSON",r==null?void 0:r.toString()),null}}function B2(t){const e=i1(t);return ke(e,"internal-error"),ke(typeof e.exp<"u","internal-error"),ke(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ml(t,e,n=!1){if(n)return e;try{return await e}catch(s){throw s instanceof to&&ZM(s)&&t.auth.currentUser===t&&await t.auth.signOut(),s}}function ZM({code:t}){return t==="auth/user-disabled"||t==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eL{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const n=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),n}else{this.errorBackoff=3e4;const s=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,s)}}schedule(e=!1){if(!this.isRunning)return;const n=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},n)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class d0{constructor(e,n){this.createdAt=e,this.lastLoginAt=n,this._initializeTime()}_initializeTime(){this.lastSignInTime=Pc(this.lastLoginAt),this.creationTime=Pc(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ep(t){var d;const e=t.auth,n=await t.getIdToken(),s=await ml(t,Tp(e,{idToken:n}));ke(s==null?void 0:s.users.length,e,"internal-error");const r=s.users[0];t._notifyReloadListener(r);const i=(d=r.providerUserInfo)!=null&&d.length?W$(r.providerUserInfo):[],o=nL(t.providerData,i),a=t.isAnonymous,l=!(t.email&&r.passwordHash)&&!(o!=null&&o.length),c=a?l:!1,u={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:o,metadata:new d0(r.createdAt,r.lastLoginAt),isAnonymous:c};Object.assign(t,u)}async function tL(t){const e=$r(t);await Ep(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function nL(t,e){return[...t.filter(s=>!e.some(r=>r.providerId===s.providerId)),...e]}function W$(t){return t.map(({providerId:e,...n})=>({providerId:e,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function sL(t,e){const n=await j$(t,{},async()=>{const s=$u({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:r,apiKey:i}=t.config,o=await B$(t,r,"/v1/token",`key=${i}`),a=await t._getAdditionalHeaders();a["Content-Type"]="application/x-www-form-urlencoded";const l={method:"POST",headers:a,body:s};return t.emulatorConfig&&Nf(t.emulatorConfig.host)&&(l.credentials="include"),z$.fetch()(o,l)});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}async function rL(t,e){return ni(t,"POST","/v2/accounts:revokeToken",no(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qa{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){ke(e.idToken,"internal-error"),ke(typeof e.idToken<"u","internal-error"),ke(typeof e.refreshToken<"u","internal-error");const n="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):B2(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,n)}updateFromIdToken(e){ke(e.length!==0,"internal-error");const n=B2(e);this.updateTokensAndExpiration(e,null,n)}async getToken(e,n=!1){return!n&&this.accessToken&&!this.isExpired?this.accessToken:(ke(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,n){const{accessToken:s,refreshToken:r,expiresIn:i}=await sL(e,n);this.updateTokensAndExpiration(s,r,Number(i))}updateTokensAndExpiration(e,n,s){this.refreshToken=n||null,this.accessToken=e||null,this.expirationTime=Date.now()+s*1e3}static fromJSON(e,n){const{refreshToken:s,accessToken:r,expirationTime:i}=n,o=new Qa;return s&&(ke(typeof s=="string","internal-error",{appName:e}),o.refreshToken=s),r&&(ke(typeof r=="string","internal-error",{appName:e}),o.accessToken=r),i&&(ke(typeof i=="number","internal-error",{appName:e}),o.expirationTime=i),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Qa,this.toJSON())}_performRefresh(){return Pr("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hi(t,e){ke(typeof t=="string"||typeof t>"u","internal-error",{appName:e})}class Vs{constructor({uid:e,auth:n,stsTokenManager:s,...r}){this.providerId="firebase",this.proactiveRefresh=new eL(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=n,this.stsTokenManager=s,this.accessToken=s.accessToken,this.displayName=r.displayName||null,this.email=r.email||null,this.emailVerified=r.emailVerified||!1,this.phoneNumber=r.phoneNumber||null,this.photoURL=r.photoURL||null,this.isAnonymous=r.isAnonymous||!1,this.tenantId=r.tenantId||null,this.providerData=r.providerData?[...r.providerData]:[],this.metadata=new d0(r.createdAt||void 0,r.lastLoginAt||void 0)}async getIdToken(e){const n=await ml(this,this.stsTokenManager.getToken(this.auth,e));return ke(n,this.auth,"internal-error"),this.accessToken!==n&&(this.accessToken=n,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),n}getIdTokenResult(e){return JM(this,e)}reload(){return tL(this)}_assign(e){this!==e&&(ke(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(n=>({...n})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const n=new Vs({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return n.metadata._copy(this.metadata),n}_onReload(e){ke(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,n=!1){let s=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),s=!0),n&&await Ep(this),await this.auth._persistUserIfCurrent(this),s&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Bs(this.auth.app))return Promise.reject(jr(this.auth));const e=await this.getIdToken();return await ml(this,QM(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,n){const s=n.displayName??void 0,r=n.email??void 0,i=n.phoneNumber??void 0,o=n.photoURL??void 0,a=n.tenantId??void 0,l=n._redirectEventId??void 0,c=n.createdAt??void 0,u=n.lastLoginAt??void 0,{uid:d,emailVerified:h,isAnonymous:p,providerData:f,stsTokenManager:g}=n;ke(d&&g,e,"internal-error");const x=Qa.fromJSON(this.name,g);ke(typeof d=="string",e,"internal-error"),hi(s,e.name),hi(r,e.name),ke(typeof h=="boolean",e,"internal-error"),ke(typeof p=="boolean",e,"internal-error"),hi(i,e.name),hi(o,e.name),hi(a,e.name),hi(l,e.name),hi(c,e.name),hi(u,e.name);const y=new Vs({uid:d,auth:e,email:r,emailVerified:h,displayName:s,isAnonymous:p,photoURL:o,phoneNumber:i,tenantId:a,stsTokenManager:x,createdAt:c,lastLoginAt:u});return f&&Array.isArray(f)&&(y.providerData=f.map(v=>({...v}))),l&&(y._redirectEventId=l),y}static async _fromIdTokenResponse(e,n,s=!1){const r=new Qa;r.updateFromServerResponse(n);const i=new Vs({uid:n.localId,auth:e,stsTokenManager:r,isAnonymous:s});return await Ep(i),i}static async _fromGetAccountInfoResponse(e,n,s){const r=n.users[0];ke(r.localId!==void 0,"internal-error");const i=r.providerUserInfo!==void 0?W$(r.providerUserInfo):[],o=!(r.email&&r.passwordHash)&&!(i!=null&&i.length),a=new Qa;a.updateFromIdToken(s);const l=new Vs({uid:r.localId,auth:e,stsTokenManager:a,isAnonymous:o}),c={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:i,metadata:new d0(r.createdAt,r.lastLoginAt),isAnonymous:!(r.email&&r.passwordHash)&&!(i!=null&&i.length)};return Object.assign(l,c),l}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const W2=new Map;function Mr(t){qr(t instanceof Function,"Expected a class definition");let e=W2.get(t);return e?(qr(e instanceof t,"Instance stored in cache mismatched with class"),e):(e=new t,W2.set(t,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class V${constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,n){this.storage[e]=n}async _get(e){const n=this.storage[e];return n===void 0?null:n}async _remove(e){delete this.storage[e]}_addListener(e,n){}_removeListener(e,n){}}V$.type="NONE";const V2=V$;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Hh(t,e,n){return`firebase:${t}:${e}:${n}`}class Ja{constructor(e,n,s){this.persistence=e,this.auth=n,this.userKey=s;const{config:r,name:i}=this.auth;this.fullUserKey=Hh(this.userKey,r.apiKey,i),this.fullPersistenceKey=Hh("persistence",r.apiKey,i),this.boundEventHandler=n._onStorageEvent.bind(n),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const n=await Tp(this.auth,{idToken:e}).catch(()=>{});return n?Vs._fromGetAccountInfoResponse(this.auth,n,e):null}return Vs._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const n=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,n)return this.setCurrentUser(n)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,n,s="authUser"){if(!n.length)return new Ja(Mr(V2),e,s);const r=(await Promise.all(n.map(async c=>{if(await c._isAvailable())return c}))).filter(c=>c);let i=r[0]||Mr(V2);const o=Hh(s,e.config.apiKey,e.name);let a=null;for(const c of n)try{const u=await c._get(o);if(u){let d;if(typeof u=="string"){const h=await Tp(e,{idToken:u}).catch(()=>{});if(!h)break;d=await Vs._fromGetAccountInfoResponse(e,h,u)}else d=Vs._fromJSON(e,u);c!==i&&(a=d),i=c;break}}catch{}const l=r.filter(c=>c._shouldAllowMigration);return!i._shouldAllowMigration||!l.length?new Ja(i,e,s):(i=l[0],a&&await i._set(o,a.toJSON()),await Promise.all(n.map(async c=>{if(c!==i)try{await c._remove(o)}catch{}})),new Ja(i,e,s))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function U2(t){const e=t.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(K$(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(U$(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(X$(e))return"Blackberry";if(Y$(e))return"Webos";if(G$(e))return"Safari";if((e.includes("chrome/")||H$(e))&&!e.includes("edge/"))return"Chrome";if(q$(e))return"Android";{const n=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,s=t.match(n);if((s==null?void 0:s.length)===2)return s[1]}return"Other"}function U$(t=Tn()){return/firefox\//i.test(t)}function G$(t=Tn()){const e=t.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function H$(t=Tn()){return/crios\//i.test(t)}function K$(t=Tn()){return/iemobile/i.test(t)}function q$(t=Tn()){return/android/i.test(t)}function X$(t=Tn()){return/blackberry/i.test(t)}function Y$(t=Tn()){return/webos/i.test(t)}function o1(t=Tn()){return/iphone|ipad|ipod/i.test(t)||/macintosh/i.test(t)&&/mobile/i.test(t)}function iL(t=Tn()){var e;return o1(t)&&!!((e=window.navigator)!=null&&e.standalone)}function oL(){return b4()&&document.documentMode===10}function Q$(t=Tn()){return o1(t)||q$(t)||Y$(t)||X$(t)||/windows phone/i.test(t)||K$(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function J$(t,e=[]){let n;switch(t){case"Browser":n=U2(Tn());break;case"Worker":n=`${U2(Tn())}-${t}`;break;default:n=t}const s=e.length?e.join(","):"FirebaseCore-web";return`${n}/JsCore/${Tu}/${s}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aL{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,n){const s=i=>new Promise((o,a)=>{try{const l=e(i);o(l)}catch(l){a(l)}});s.onAbort=n,this.queue.push(s);const r=this.queue.length-1;return()=>{this.queue[r]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const n=[];try{for(const s of this.queue)await s(e),s.onAbort&&n.push(s.onAbort)}catch(s){n.reverse();for(const r of n)try{r()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:s==null?void 0:s.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function lL(t,e={}){return ni(t,"GET","/v2/passwordPolicy",no(t,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cL=6;class uL{constructor(e){var s;const n=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=n.minPasswordLength??cL,n.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=n.maxPasswordLength),n.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=n.containsLowercaseCharacter),n.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=n.containsUppercaseCharacter),n.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=n.containsNumericCharacter),n.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=n.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=((s=e.allowedNonAlphanumericCharacters)==null?void 0:s.join(""))??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const n={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,n),this.validatePasswordCharacterOptions(e,n),n.isValid&&(n.isValid=n.meetsMinPasswordLength??!0),n.isValid&&(n.isValid=n.meetsMaxPasswordLength??!0),n.isValid&&(n.isValid=n.containsLowercaseLetter??!0),n.isValid&&(n.isValid=n.containsUppercaseLetter??!0),n.isValid&&(n.isValid=n.containsNumericCharacter??!0),n.isValid&&(n.isValid=n.containsNonAlphanumericCharacter??!0),n}validatePasswordLengthOptions(e,n){const s=this.customStrengthOptions.minPasswordLength,r=this.customStrengthOptions.maxPasswordLength;s&&(n.meetsMinPasswordLength=e.length>=s),r&&(n.meetsMaxPasswordLength=e.length<=r)}validatePasswordCharacterOptions(e,n){this.updatePasswordCharacterOptionsStatuses(n,!1,!1,!1,!1);let s;for(let r=0;r<e.length;r++)s=e.charAt(r),this.updatePasswordCharacterOptionsStatuses(n,s>="a"&&s<="z",s>="A"&&s<="Z",s>="0"&&s<="9",this.allowedNonAlphanumericCharacters.includes(s))}updatePasswordCharacterOptionsStatuses(e,n,s,r,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=n)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=s)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=r)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dL{constructor(e,n,s,r){this.app=e,this.heartbeatServiceProvider=n,this.appCheckServiceProvider=s,this.config=r,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new G2(this),this.idTokenSubscription=new G2(this),this.beforeStateQueue=new aL(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=M$,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=r.sdkClientVersion,this._persistenceManagerAvailable=new Promise(i=>this._resolvePersistenceManagerAvailable=i)}_initializeWithPersistence(e,n){return n&&(this._popupRedirectResolver=Mr(n)),this._initializationPromise=this.queue(async()=>{var s,r,i;if(!this._deleted&&(this.persistenceManager=await Ja.create(this,e),(s=this._resolvePersistenceManagerAvailable)==null||s.call(this),!this._deleted)){if((r=this._popupRedirectResolver)!=null&&r._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(n),this.lastNotifiedUid=((i=this.currentUser)==null?void 0:i.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const n=await Tp(this,{idToken:e}),s=await Vs._fromGetAccountInfoResponse(this,n,e);await this.directlySetCurrentUser(s)}catch(n){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",n),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var i;if(Bs(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(a=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(a,a))}):this.directlySetCurrentUser(null)}const n=await this.assertedPersistence.getCurrentUser();let s=n,r=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=(i=this.redirectUser)==null?void 0:i._redirectEventId,a=s==null?void 0:s._redirectEventId,l=await this.tryRedirectSignIn(e);(!o||o===a)&&(l!=null&&l.user)&&(s=l.user,r=!0)}if(!s)return this.directlySetCurrentUser(null);if(!s._redirectEventId){if(r)try{await this.beforeStateQueue.runMiddleware(s)}catch(o){s=n,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return s?this.reloadAndSetCurrentUserOrClear(s):this.directlySetCurrentUser(null)}return ke(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===s._redirectEventId?this.directlySetCurrentUser(s):this.reloadAndSetCurrentUserOrClear(s)}async tryRedirectSignIn(e){let n=null;try{n=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return n}async reloadAndSetCurrentUserOrClear(e){try{await Ep(e)}catch(n){if((n==null?void 0:n.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=VM()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(Bs(this.app))return Promise.reject(jr(this));const n=e?$r(e):null;return n&&ke(n.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(n&&n._clone(this))}async _updateCurrentUser(e,n=!1){if(!this._deleted)return e&&ke(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),n||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return Bs(this.app)?Promise.reject(jr(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return Bs(this.app)?Promise.reject(jr(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Mr(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const n=this._getPasswordPolicyInternal();return n.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):n.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await lL(this),n=new uL(e);this.tenantId===null?this._projectPasswordPolicy=n:this._tenantPasswordPolicies[this.tenantId]=n}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new Iu("auth","Firebase",e())}onAuthStateChanged(e,n,s){return this.registerStateListener(this.authStateSubscription,e,n,s)}beforeAuthStateChanged(e,n){return this.beforeStateQueue.pushCallback(e,n)}onIdTokenChanged(e,n,s){return this.registerStateListener(this.idTokenSubscription,e,n,s)}authStateReady(){return new Promise((e,n)=>{if(this.currentUser)e();else{const s=this.onAuthStateChanged(()=>{s(),e()},n)}})}async revokeAccessToken(e){if(this.currentUser){const n=await this.currentUser.getIdToken(),s={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:n};this.tenantId!=null&&(s.tenantId=this.tenantId),await rL(this,s)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)==null?void 0:e.toJSON()}}async _setRedirectUser(e,n){const s=await this.getOrInitRedirectPersistenceManager(n);return e===null?s.removeCurrentUser():s.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const n=e&&Mr(e)||this._popupRedirectResolver;ke(n,this,"argument-error"),this.redirectPersistenceManager=await Ja.create(this,[Mr(n._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var n,s;return this._isInitialized&&await this.queue(async()=>{}),((n=this._currentUser)==null?void 0:n._redirectEventId)===e?this._currentUser:((s=this.redirectUser)==null?void 0:s._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var n;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=((n=this.currentUser)==null?void 0:n.uid)??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,n,s,r){if(this._deleted)return()=>{};const i=typeof n=="function"?n:n.next.bind(n);let o=!1;const a=this._isInitialized?Promise.resolve():this._initializationPromise;if(ke(a,this,"internal-error"),a.then(()=>{o||i(this.currentUser)}),typeof n=="function"){const l=e.addObserver(n,s,r);return()=>{o=!0,l()}}else{const l=e.addObserver(n);return()=>{o=!0,l()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return ke(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=J$(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var r;const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const n=await((r=this.heartbeatServiceProvider.getImmediate({optional:!0}))==null?void 0:r.getHeartbeatsHeader());n&&(e["X-Firebase-Client"]=n);const s=await this._getAppCheckToken();return s&&(e["X-Firebase-AppCheck"]=s),e}async _getAppCheckToken(){var n;if(Bs(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await((n=this.appCheckServiceProvider.getImmediate({optional:!0}))==null?void 0:n.getToken());return e!=null&&e.error&&jM(`Error while retrieving App Check token: ${e.error}`),e==null?void 0:e.token}}function da(t){return $r(t)}class G2{constructor(e){this.auth=e,this.observer=null,this.addObserver=T4(n=>this.observer=n)}get next(){return ke(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Af={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function hL(t){Af=t}function Z$(t){return Af.loadJS(t)}function pL(){return Af.recaptchaEnterpriseScript}function fL(){return Af.gapiScript}function mL(t){return`__${t}${Math.floor(Math.random()*1e6)}`}class gL{constructor(){this.enterprise=new yL}ready(e){e()}execute(e,n){return Promise.resolve("token")}render(e,n){return""}}class yL{ready(e){e()}execute(e,n){return Promise.resolve("token")}render(e,n){return""}}const xL="recaptcha-enterprise",eT="NO_RECAPTCHA";class vL{constructor(e){this.type=xL,this.auth=da(e)}async verify(e="verify",n=!1){async function s(i){if(!n){if(i.tenantId==null&&i._agentRecaptchaConfig!=null)return i._agentRecaptchaConfig.siteKey;if(i.tenantId!=null&&i._tenantRecaptchaConfigs[i.tenantId]!==void 0)return i._tenantRecaptchaConfigs[i.tenantId].siteKey}return new Promise(async(o,a)=>{YM(i,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(l=>{if(l.recaptchaKey===void 0)a(new Error("recaptcha Enterprise site key undefined"));else{const c=new XM(l);return i.tenantId==null?i._agentRecaptchaConfig=c:i._tenantRecaptchaConfigs[i.tenantId]=c,o(c.siteKey)}}).catch(l=>{a(l)})})}function r(i,o,a){const l=window.grecaptcha;j2(l)?l.enterprise.ready(()=>{l.enterprise.execute(i,{action:e}).then(c=>{o(c)}).catch(()=>{o(eT)})}):a(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new gL().execute("siteKey",{action:"verify"}):new Promise((i,o)=>{s(this.auth).then(a=>{if(!n&&j2(window.grecaptcha))r(a,i,o);else{if(typeof window>"u"){o(new Error("RecaptchaVerifier is only supported in browser"));return}let l=pL();l.length!==0&&(l+=a),Z$(l).then(()=>{r(a,i,o)}).catch(c=>{o(c)})}}).catch(a=>{o(a)})})}}async function H2(t,e,n,s=!1,r=!1){const i=new vL(t);let o;if(r)o=eT;else try{o=await i.verify(n)}catch{o=await i.verify(n,!0)}const a={...e};if(n==="mfaSmsEnrollment"||n==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in a){const l=a.phoneEnrollmentInfo.phoneNumber,c=a.phoneEnrollmentInfo.recaptchaToken;Object.assign(a,{phoneEnrollmentInfo:{phoneNumber:l,recaptchaToken:c,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in a){const l=a.phoneSignInInfo.recaptchaToken;Object.assign(a,{phoneSignInInfo:{recaptchaToken:l,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return a}return s?Object.assign(a,{captchaResp:o}):Object.assign(a,{captchaResponse:o}),Object.assign(a,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(a,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),a}async function h0(t,e,n,s,r){var i;if((i=t._getRecaptchaConfig())!=null&&i.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const o=await H2(t,e,n,n==="getOobCode");return s(t,o)}else return s(t,e).catch(async o=>{if(o.code==="auth/missing-recaptcha-token"){console.log(`${n} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const a=await H2(t,e,n,n==="getOobCode");return s(t,a)}else return Promise.reject(o)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bL(t,e){const n=_$(t,"auth");if(n.isInitialized()){const r=n.getImmediate(),i=n.getOptions();if(pl(i,e??{}))return r;Qs(r,"already-initialized")}return n.initialize({options:e})}function wL(t,e){const n=(e==null?void 0:e.persistence)||[],s=(Array.isArray(n)?n:[n]).map(Mr);e!=null&&e.errorMap&&t._updateErrorMap(e.errorMap),t._initializeWithPersistence(s,e==null?void 0:e.popupRedirectResolver)}function kL(t,e,n){const s=da(t);ke(/^https?:\/\//.test(e),s,"invalid-emulator-scheme");const r=!1,i=tT(e),{host:o,port:a}=CL(e),l=a===null?"":`:${a}`,c={url:`${i}//${o}${l}/`},u=Object.freeze({host:o,port:a,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:r})});if(!s._canInitEmulator){ke(s.config.emulator&&s.emulatorConfig,s,"emulator-config-failed"),ke(pl(c,s.config.emulator)&&pl(u,s.emulatorConfig),s,"emulator-config-failed");return}s.config.emulator=c,s.emulatorConfig=u,s.settings.appVerificationDisabledForTesting=!0,Nf(o)?(h4(`${i}//${o}${l}`),m4("Auth",!0)):SL()}function tT(t){const e=t.indexOf(":");return e<0?"":t.substr(0,e+1)}function CL(t){const e=tT(t),n=/(\/\/)?([^?#/]+)/.exec(t.substr(e.length));if(!n)return{host:"",port:null};const s=n[2].split("@").pop()||"",r=/^(\[[^\]]+\])(:|$)/.exec(s);if(r){const i=r[1];return{host:i,port:K2(s.substr(i.length+1))}}else{const[i,o]=s.split(":");return{host:i,port:K2(o)}}}function K2(t){if(!t)return null;const e=Number(t);return isNaN(e)?null:e}function SL(){function t(){const e=document.createElement("p"),n=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",n.position="fixed",n.width="100%",n.backgroundColor="#ffffff",n.border=".1em solid #000000",n.color="#b50000",n.bottom="0px",n.left="0px",n.margin="0px",n.zIndex="10000",n.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",t):t())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class a1{constructor(e,n){this.providerId=e,this.signInMethod=n}toJSON(){return Pr("not implemented")}_getIdTokenResponse(e){return Pr("not implemented")}_linkToIdToken(e,n){return Pr("not implemented")}_getReauthenticationResolver(e){return Pr("not implemented")}}async function IL(t,e){return ni(t,"POST","/v1/accounts:signUp",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function $L(t,e){return Ru(t,"POST","/v1/accounts:signInWithPassword",no(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function TL(t,e){return Ru(t,"POST","/v1/accounts:signInWithEmailLink",no(t,e))}async function EL(t,e){return Ru(t,"POST","/v1/accounts:signInWithEmailLink",no(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class au extends a1{constructor(e,n,s,r=null){super("password",s),this._email=e,this._password=n,this._tenantId=r}static _fromEmailAndPassword(e,n){return new au(e,n,"password")}static _fromEmailAndCode(e,n,s=null){return new au(e,n,"emailLink",s)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e;if(n!=null&&n.email&&(n!=null&&n.password)){if(n.signInMethod==="password")return this._fromEmailAndPassword(n.email,n.password);if(n.signInMethod==="emailLink")return this._fromEmailAndCode(n.email,n.password,n.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const n={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return h0(e,n,"signInWithPassword",$L);case"emailLink":return TL(e,{email:this._email,oobCode:this._password});default:Qs(e,"internal-error")}}async _linkToIdToken(e,n){switch(this.signInMethod){case"password":const s={idToken:n,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return h0(e,s,"signUpPassword",IL);case"emailLink":return EL(e,{idToken:n,email:this._email,oobCode:this._password});default:Qs(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Za(t,e){return Ru(t,"POST","/v1/accounts:signInWithIdp",no(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const RL="http://localhost";class Uo extends a1{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const n=new Uo(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(n.idToken=e.idToken),e.accessToken&&(n.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(n.nonce=e.nonce),e.pendingToken&&(n.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(n.accessToken=e.oauthToken,n.secret=e.oauthTokenSecret):Qs("argument-error"),n}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e,{providerId:s,signInMethod:r,...i}=n;if(!s||!r)return null;const o=new Uo(s,r);return o.idToken=i.idToken||void 0,o.accessToken=i.accessToken||void 0,o.secret=i.secret,o.nonce=i.nonce,o.pendingToken=i.pendingToken||null,o}_getIdTokenResponse(e){const n=this.buildRequest();return Za(e,n)}_linkToIdToken(e,n){const s=this.buildRequest();return s.idToken=n,Za(e,s)}_getReauthenticationResolver(e){const n=this.buildRequest();return n.autoCreate=!1,Za(e,n)}buildRequest(){const e={requestUri:RL,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const n={};this.idToken&&(n.id_token=this.idToken),this.accessToken&&(n.access_token=this.accessToken),this.secret&&(n.oauth_token_secret=this.secret),n.providerId=this.providerId,this.nonce&&!this.pendingToken&&(n.nonce=this.nonce),e.postBody=$u(n)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function NL(t){switch(t){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function AL(t){const e=xc(vc(t)).link,n=e?xc(vc(e)).deep_link_id:null,s=xc(vc(t)).deep_link_id;return(s?xc(vc(s)).link:null)||s||n||e||t}class l1{constructor(e){const n=xc(vc(e)),s=n.apiKey??null,r=n.oobCode??null,i=NL(n.mode??null);ke(s&&r&&i,"argument-error"),this.apiKey=s,this.operation=i,this.code=r,this.continueUrl=n.continueUrl??null,this.languageCode=n.lang??null,this.tenantId=n.tenantId??null}static parseLink(e){const n=AL(e);try{return new l1(n)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ol{constructor(){this.providerId=Ol.PROVIDER_ID}static credential(e,n){return au._fromEmailAndPassword(e,n)}static credentialWithLink(e,n){const s=l1.parseLink(n);return ke(s,"argument-error"),au._fromEmailAndCode(e,s.code,s.tenantId)}}Ol.PROVIDER_ID="password";Ol.EMAIL_PASSWORD_SIGN_IN_METHOD="password";Ol.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nT{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nu extends nT{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xi extends Nu{constructor(){super("facebook.com")}static credential(e){return Uo._fromParams({providerId:xi.PROVIDER_ID,signInMethod:xi.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return xi.credentialFromTaggedObject(e)}static credentialFromError(e){return xi.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return xi.credential(e.oauthAccessToken)}catch{return null}}}xi.FACEBOOK_SIGN_IN_METHOD="facebook.com";xi.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vi extends Nu{constructor(){super("google.com"),this.addScope("profile")}static credential(e,n){return Uo._fromParams({providerId:vi.PROVIDER_ID,signInMethod:vi.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:n})}static credentialFromResult(e){return vi.credentialFromTaggedObject(e)}static credentialFromError(e){return vi.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:n,oauthAccessToken:s}=e;if(!n&&!s)return null;try{return vi.credential(n,s)}catch{return null}}}vi.GOOGLE_SIGN_IN_METHOD="google.com";vi.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bi extends Nu{constructor(){super("github.com")}static credential(e){return Uo._fromParams({providerId:bi.PROVIDER_ID,signInMethod:bi.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return bi.credentialFromTaggedObject(e)}static credentialFromError(e){return bi.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return bi.credential(e.oauthAccessToken)}catch{return null}}}bi.GITHUB_SIGN_IN_METHOD="github.com";bi.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wi extends Nu{constructor(){super("twitter.com")}static credential(e,n){return Uo._fromParams({providerId:wi.PROVIDER_ID,signInMethod:wi.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:n})}static credentialFromResult(e){return wi.credentialFromTaggedObject(e)}static credentialFromError(e){return wi.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:n,oauthTokenSecret:s}=e;if(!n||!s)return null;try{return wi.credential(n,s)}catch{return null}}}wi.TWITTER_SIGN_IN_METHOD="twitter.com";wi.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _L(t,e){return Ru(t,"POST","/v1/accounts:signUp",no(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Go{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,n,s,r=!1){const i=await Vs._fromIdTokenResponse(e,s,r),o=q2(s);return new Go({user:i,providerId:o,_tokenResponse:s,operationType:n})}static async _forOperation(e,n,s){await e._updateTokensIfNecessary(s,!0);const r=q2(s);return new Go({user:e,providerId:r,_tokenResponse:s,operationType:n})}}function q2(t){return t.providerId?t.providerId:"phoneNumber"in t?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rp extends to{constructor(e,n,s,r){super(n.code,n.message),this.operationType=s,this.user=r,Object.setPrototypeOf(this,Rp.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:n.customData._serverResponse,operationType:s}}static _fromErrorAndOperation(e,n,s,r){return new Rp(e,n,s,r)}}function sT(t,e,n,s){return(e==="reauthenticate"?n._getReauthenticationResolver(t):n._getIdTokenResponse(t)).catch(i=>{throw i.code==="auth/multi-factor-auth-required"?Rp._fromErrorAndOperation(t,i,e,s):i})}async function DL(t,e,n=!1){const s=await ml(t,e._linkToIdToken(t.auth,await t.getIdToken()),n);return Go._forOperation(t,"link",s)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function FL(t,e,n=!1){const{auth:s}=t;if(Bs(s.app))return Promise.reject(jr(s));const r="reauthenticate";try{const i=await ml(t,sT(s,r,e,t),n);ke(i.idToken,s,"internal-error");const o=i1(i.idToken);ke(o,s,"internal-error");const{sub:a}=o;return ke(t.uid===a,s,"user-mismatch"),Go._forOperation(t,r,i)}catch(i){throw(i==null?void 0:i.code)==="auth/user-not-found"&&Qs(s,"user-mismatch"),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function rT(t,e,n=!1){if(Bs(t.app))return Promise.reject(jr(t));const s="signIn",r=await sT(t,s,e),i=await Go._fromIdTokenResponse(t,s,r);return n||await t._updateCurrentUser(i.user),i}async function OL(t,e){return rT(da(t),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function iT(t){const e=da(t);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function PL(t,e,n){if(Bs(t.app))return Promise.reject(jr(t));const s=da(t),o=await h0(s,{returnSecureToken:!0,email:e,password:n,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",_L).catch(l=>{throw l.code==="auth/password-does-not-meet-requirements"&&iT(t),l}),a=await Go._fromIdTokenResponse(s,"signIn",o);return await s._updateCurrentUser(a.user),a}function ML(t,e,n){return Bs(t.app)?Promise.reject(jr(t)):OL($r(t),Ol.credential(e,n)).catch(async s=>{throw s.code==="auth/password-does-not-meet-requirements"&&iT(t),s})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function LL(t,e){return ni(t,"POST","/v1/accounts:update",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function zL(t,{displayName:e,photoURL:n}){if(e===void 0&&n===void 0)return;const s=$r(t),i={idToken:await s.getIdToken(),displayName:e,photoUrl:n,returnSecureToken:!0},o=await ml(s,LL(s.auth,i));s.displayName=o.displayName||null,s.photoURL=o.photoUrl||null;const a=s.providerData.find(({providerId:l})=>l==="password");a&&(a.displayName=s.displayName,a.photoURL=s.photoURL),await s._updateTokensIfNecessary(o)}function jL(t,e,n,s){return $r(t).onIdTokenChanged(e,n,s)}function BL(t,e,n){return $r(t).beforeAuthStateChanged(e,n)}function WL(t,e,n,s){return $r(t).onAuthStateChanged(e,n,s)}function VL(t){return $r(t).signOut()}const Np="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oT{constructor(e,n){this.storageRetriever=e,this.type=n}_isAvailable(){try{return this.storage?(this.storage.setItem(Np,"1"),this.storage.removeItem(Np),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,n){return this.storage.setItem(e,JSON.stringify(n)),Promise.resolve()}_get(e){const n=this.storage.getItem(e);return Promise.resolve(n?JSON.parse(n):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const UL=1e3,GL=10;class aT extends oT{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,n)=>this.onStorageEvent(e,n),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=Q$(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const n of Object.keys(this.listeners)){const s=this.storage.getItem(n),r=this.localCache[n];s!==r&&e(n,r,s)}}onStorageEvent(e,n=!1){if(!e.key){this.forAllChangedKeys((o,a,l)=>{this.notifyListeners(o,l)});return}const s=e.key;n?this.detachListener():this.stopPolling();const r=()=>{const o=this.storage.getItem(s);!n&&this.localCache[s]===o||this.notifyListeners(s,o)},i=this.storage.getItem(s);oL()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(r,GL):r()}notifyListeners(e,n){this.localCache[e]=n;const s=this.listeners[e];if(s)for(const r of Array.from(s))r(n&&JSON.parse(n))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,n,s)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:n,newValue:s}),!0)})},UL)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,n){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,n){await super._set(e,n),this.localCache[e]=JSON.stringify(n)}async _get(e){const n=await super._get(e);return this.localCache[e]=JSON.stringify(n),n}async _remove(e){await super._remove(e),delete this.localCache[e]}}aT.type="LOCAL";const HL=aT;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lT extends oT{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,n){}_removeListener(e,n){}}lT.type="SESSION";const cT=lT;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function KL(t){return Promise.all(t.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(n){return{fulfilled:!1,reason:n}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _f{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const n=this.receivers.find(r=>r.isListeningto(e));if(n)return n;const s=new _f(e);return this.receivers.push(s),s}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const n=e,{eventId:s,eventType:r,data:i}=n.data,o=this.handlersMap[r];if(!(o!=null&&o.size))return;n.ports[0].postMessage({status:"ack",eventId:s,eventType:r});const a=Array.from(o).map(async c=>c(n.origin,i)),l=await KL(a);n.ports[0].postMessage({status:"done",eventId:s,eventType:r,response:l})}_subscribe(e,n){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(n)}_unsubscribe(e,n){this.handlersMap[e]&&n&&this.handlersMap[e].delete(n),(!n||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}_f.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function c1(t="",e=10){let n="";for(let s=0;s<e;s++)n+=Math.floor(Math.random()*10);return t+n}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qL{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,n,s=50){const r=typeof MessageChannel<"u"?new MessageChannel:null;if(!r)throw new Error("connection_unavailable");let i,o;return new Promise((a,l)=>{const c=c1("",20);r.port1.start();const u=setTimeout(()=>{l(new Error("unsupported_event"))},s);o={messageChannel:r,onMessage(d){const h=d;if(h.data.eventId===c)switch(h.data.status){case"ack":clearTimeout(u),i=setTimeout(()=>{l(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),a(h.data.response);break;default:clearTimeout(u),clearTimeout(i),l(new Error("invalid_response"));break}}},this.handlers.add(o),r.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:c,data:n},[r.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mr(){return window}function XL(t){mr().location.href=t}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uT(){return typeof mr().WorkerGlobalScope<"u"&&typeof mr().importScripts=="function"}async function YL(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function QL(){var t;return((t=navigator==null?void 0:navigator.serviceWorker)==null?void 0:t.controller)||null}function JL(){return uT()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dT="firebaseLocalStorageDb",ZL=1,Ap="firebaseLocalStorage",hT="fbase_key";class Au{constructor(e){this.request=e}toPromise(){return new Promise((e,n)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{n(this.request.error)})})}}function Df(t,e){return t.transaction([Ap],e?"readwrite":"readonly").objectStore(Ap)}function ez(){const t=indexedDB.deleteDatabase(dT);return new Au(t).toPromise()}function p0(){const t=indexedDB.open(dT,ZL);return new Promise((e,n)=>{t.addEventListener("error",()=>{n(t.error)}),t.addEventListener("upgradeneeded",()=>{const s=t.result;try{s.createObjectStore(Ap,{keyPath:hT})}catch(r){n(r)}}),t.addEventListener("success",async()=>{const s=t.result;s.objectStoreNames.contains(Ap)?e(s):(s.close(),await ez(),e(await p0()))})})}async function X2(t,e,n){const s=Df(t,!0).put({[hT]:e,value:n});return new Au(s).toPromise()}async function tz(t,e){const n=Df(t,!1).get(e),s=await new Au(n).toPromise();return s===void 0?null:s.value}function Y2(t,e){const n=Df(t,!0).delete(e);return new Au(n).toPromise()}const nz=800,sz=3;class pT{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await p0(),this.db)}async _withRetries(e){let n=0;for(;;)try{const s=await this._openDb();return await e(s)}catch(s){if(n++>sz)throw s;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return uT()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=_f._getInstance(JL()),this.receiver._subscribe("keyChanged",async(e,n)=>({keyProcessed:(await this._poll()).includes(n.key)})),this.receiver._subscribe("ping",async(e,n)=>["keyChanged"])}async initializeSender(){var n,s;if(this.activeServiceWorker=await YL(),!this.activeServiceWorker)return;this.sender=new qL(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&(n=e[0])!=null&&n.fulfilled&&(s=e[0])!=null&&s.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||QL()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await p0();return await X2(e,Np,"1"),await Y2(e,Np),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,n){return this._withPendingWrite(async()=>(await this._withRetries(s=>X2(s,e,n)),this.localCache[e]=n,this.notifyServiceWorker(e)))}async _get(e){const n=await this._withRetries(s=>tz(s,e));return this.localCache[e]=n,n}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(n=>Y2(n,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(r=>{const i=Df(r,!1).getAll();return new Au(i).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const n=[],s=new Set;if(e.length!==0)for(const{fbase_key:r,value:i}of e)s.add(r),JSON.stringify(this.localCache[r])!==JSON.stringify(i)&&(this.notifyListeners(r,i),n.push(r));for(const r of Object.keys(this.localCache))this.localCache[r]&&!s.has(r)&&(this.notifyListeners(r,null),n.push(r));return n}notifyListeners(e,n){this.localCache[e]=n;const s=this.listeners[e];if(s)for(const r of Array.from(s))r(n)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),nz)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,n){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}pT.type="LOCAL";const rz=pT;new Eu(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function iz(t,e){return e?Mr(e):(ke(t._popupRedirectResolver,t,"argument-error"),t._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class u1 extends a1{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Za(e,this._buildIdpRequest())}_linkToIdToken(e,n){return Za(e,this._buildIdpRequest(n))}_getReauthenticationResolver(e){return Za(e,this._buildIdpRequest())}_buildIdpRequest(e){const n={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(n.idToken=e),n}}function oz(t){return rT(t.auth,new u1(t),t.bypassAuthState)}function az(t){const{auth:e,user:n}=t;return ke(n,e,"internal-error"),FL(n,new u1(t),t.bypassAuthState)}async function lz(t){const{auth:e,user:n}=t;return ke(n,e,"internal-error"),DL(n,new u1(t),t.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fT{constructor(e,n,s,r,i=!1){this.auth=e,this.resolver=s,this.user=r,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(n)?n:[n]}execute(){return new Promise(async(e,n)=>{this.pendingPromise={resolve:e,reject:n};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(s){this.reject(s)}})}async onAuthEvent(e){const{urlResponse:n,sessionId:s,postBody:r,tenantId:i,error:o,type:a}=e;if(o){this.reject(o);return}const l={auth:this.auth,requestUri:n,sessionId:s,tenantId:i||void 0,postBody:r||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(l))}catch(c){this.reject(c)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return oz;case"linkViaPopup":case"linkViaRedirect":return lz;case"reauthViaPopup":case"reauthViaRedirect":return az;default:Qs(this.auth,"internal-error")}}resolve(e){qr(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){qr(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cz=new Eu(2e3,1e4);class Wa extends fT{constructor(e,n,s,r,i){super(e,n,r,i),this.provider=s,this.authWindow=null,this.pollId=null,Wa.currentPopupAction&&Wa.currentPopupAction.cancel(),Wa.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return ke(e,this.auth,"internal-error"),e}async onExecution(){qr(this.filter.length===1,"Popup operations only handle one event");const e=c1();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(n=>{this.reject(n)}),this.resolver._isIframeWebStorageSupported(this.auth,n=>{n||this.reject(fr(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)==null?void 0:e.associatedEvent)||null}cancel(){this.reject(fr(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Wa.currentPopupAction=null}pollUserCancellation(){const e=()=>{var n,s;if((s=(n=this.authWindow)==null?void 0:n.window)!=null&&s.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(fr(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,cz.get())};e()}}Wa.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uz="pendingRedirect",Kh=new Map;class dz extends fT{constructor(e,n,s=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],n,void 0,s),this.eventId=null}async execute(){let e=Kh.get(this.auth._key());if(!e){try{const s=await hz(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(s)}catch(n){e=()=>Promise.reject(n)}Kh.set(this.auth._key(),e)}return this.bypassAuthState||Kh.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const n=await this.auth._redirectUserForId(e.eventId);if(n)return this.user=n,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function hz(t,e){const n=mz(e),s=fz(t);if(!await s._isAvailable())return!1;const r=await s._get(n)==="true";return await s._remove(n),r}function pz(t,e){Kh.set(t._key(),e)}function fz(t){return Mr(t._redirectPersistence)}function mz(t){return Hh(uz,t.config.apiKey,t.name)}async function gz(t,e,n=!1){if(Bs(t.app))return Promise.reject(jr(t));const s=da(t),r=iz(s,e),o=await new dz(s,r,n).execute();return o&&!n&&(delete o.user._redirectEventId,await s._persistUserIfCurrent(o.user),await s._setRedirectUser(null,e)),o}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yz=10*60*1e3;class xz{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let n=!1;return this.consumers.forEach(s=>{this.isEventForConsumer(e,s)&&(n=!0,this.sendToConsumer(e,s),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!vz(e)||(this.hasHandledPotentialRedirect=!0,n||(this.queuedRedirectEvent=e,n=!0)),n}sendToConsumer(e,n){var s;if(e.error&&!mT(e)){const r=((s=e.error.code)==null?void 0:s.split("auth/")[1])||"internal-error";n.onError(fr(this.auth,r))}else n.onAuthEvent(e)}isEventForConsumer(e,n){const s=n.eventId===null||!!e.eventId&&e.eventId===n.eventId;return n.filter.includes(e.type)&&s}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=yz&&this.cachedEventUids.clear(),this.cachedEventUids.has(Q2(e))}saveEventToCache(e){this.cachedEventUids.add(Q2(e)),this.lastProcessedEventTime=Date.now()}}function Q2(t){return[t.type,t.eventId,t.sessionId,t.tenantId].filter(e=>e).join("-")}function mT({type:t,error:e}){return t==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function vz(t){switch(t.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return mT(t);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function bz(t,e={}){return ni(t,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wz=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,kz=/^https?/;async function Cz(t){if(t.config.emulator)return;const{authorizedDomains:e}=await bz(t);for(const n of e)try{if(Sz(n))return}catch{}Qs(t,"unauthorized-domain")}function Sz(t){const e=u0(),{protocol:n,hostname:s}=new URL(e);if(t.startsWith("chrome-extension://")){const o=new URL(t);return o.hostname===""&&s===""?n==="chrome-extension:"&&t.replace("chrome-extension://","")===e.replace("chrome-extension://",""):n==="chrome-extension:"&&o.hostname===s}if(!kz.test(n))return!1;if(wz.test(t))return s===t;const r=t.replace(/\./g,"\\.");return new RegExp("^(.+\\."+r+"|"+r+")$","i").test(s)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Iz=new Eu(3e4,6e4);function J2(){const t=mr().___jsl;if(t!=null&&t.H){for(const e of Object.keys(t.H))if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=[...t.H[e].L],t.CP)for(let n=0;n<t.CP.length;n++)t.CP[n]=null}}function $z(t){return new Promise((e,n)=>{var r,i,o;function s(){J2(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{J2(),n(fr(t,"network-request-failed"))},timeout:Iz.get()})}if((i=(r=mr().gapi)==null?void 0:r.iframes)!=null&&i.Iframe)e(gapi.iframes.getContext());else if((o=mr().gapi)!=null&&o.load)s();else{const a=mL("iframefcb");return mr()[a]=()=>{gapi.load?s():n(fr(t,"network-request-failed"))},Z$(`${fL()}?onload=${a}`).catch(l=>n(l))}}).catch(e=>{throw qh=null,e})}let qh=null;function Tz(t){return qh=qh||$z(t),qh}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ez=new Eu(5e3,15e3),Rz="__/auth/iframe",Nz="emulator/auth/iframe",Az={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},_z=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function Dz(t){const e=t.config;ke(e.authDomain,t,"auth-domain-config-required");const n=e.emulator?r1(e,Nz):`https://${t.config.authDomain}/${Rz}`,s={apiKey:e.apiKey,appName:t.name,v:Tu},r=_z.get(t.config.apiHost);r&&(s.eid=r);const i=t._getFrameworks();return i.length&&(s.fw=i.join(",")),`${n}?${$u(s).slice(1)}`}async function Fz(t){const e=await Tz(t),n=mr().gapi;return ke(n,t,"internal-error"),e.open({where:document.body,url:Dz(t),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:Az,dontclear:!0},s=>new Promise(async(r,i)=>{await s.restyle({setHideOnLeave:!1});const o=fr(t,"network-request-failed"),a=mr().setTimeout(()=>{i(o)},Ez.get());function l(){mr().clearTimeout(a),r(s)}s.ping(l).then(l,()=>{i(o)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Oz={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},Pz=500,Mz=600,Lz="_blank",zz="http://localhost";class Z2{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function jz(t,e,n,s=Pz,r=Mz){const i=Math.max((window.screen.availHeight-r)/2,0).toString(),o=Math.max((window.screen.availWidth-s)/2,0).toString();let a="";const l={...Oz,width:s.toString(),height:r.toString(),top:i,left:o},c=Tn().toLowerCase();n&&(a=H$(c)?Lz:n),U$(c)&&(e=e||zz,l.scrollbars="yes");const u=Object.entries(l).reduce((h,[p,f])=>`${h}${p}=${f},`,"");if(iL(c)&&a!=="_self")return Bz(e||"",a),new Z2(null);const d=window.open(e||"",a,u);ke(d,t,"popup-blocked");try{d.focus()}catch{}return new Z2(d)}function Bz(t,e){const n=document.createElement("a");n.href=t,n.target=e;const s=document.createEvent("MouseEvent");s.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(s)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wz="__/auth/handler",Vz="emulator/auth/handler",Uz=encodeURIComponent("fac");async function ek(t,e,n,s,r,i){ke(t.config.authDomain,t,"auth-domain-config-required"),ke(t.config.apiKey,t,"invalid-api-key");const o={apiKey:t.config.apiKey,appName:t.name,authType:n,redirectUrl:s,v:Tu,eventId:r};if(e instanceof nT){e.setDefaultLanguage(t.languageCode),o.providerId=e.providerId||"",$4(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[u,d]of Object.entries({}))o[u]=d}if(e instanceof Nu){const u=e.getScopes().filter(d=>d!=="");u.length>0&&(o.scopes=u.join(","))}t.tenantId&&(o.tid=t.tenantId);const a=o;for(const u of Object.keys(a))a[u]===void 0&&delete a[u];const l=await t._getAppCheckToken(),c=l?`#${Uz}=${encodeURIComponent(l)}`:"";return`${Gz(t)}?${$u(a).slice(1)}${c}`}function Gz({config:t}){return t.emulator?r1(t,Vz):`https://${t.authDomain}/${Wz}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ug="webStorageSupport";class Hz{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=cT,this._completeRedirectFn=gz,this._overrideRedirectResult=pz}async _openPopup(e,n,s,r){var o;qr((o=this.eventManagers[e._key()])==null?void 0:o.manager,"_initialize() not called before _openPopup()");const i=await ek(e,n,s,u0(),r);return jz(e,i,c1())}async _openRedirect(e,n,s,r){await this._originValidation(e);const i=await ek(e,n,s,u0(),r);return XL(i),new Promise(()=>{})}_initialize(e){const n=e._key();if(this.eventManagers[n]){const{manager:r,promise:i}=this.eventManagers[n];return r?Promise.resolve(r):(qr(i,"If manager is not set, promise should be"),i)}const s=this.initAndGetManager(e);return this.eventManagers[n]={promise:s},s.catch(()=>{delete this.eventManagers[n]}),s}async initAndGetManager(e){const n=await Fz(e),s=new xz(e);return n.register("authEvent",r=>(ke(r==null?void 0:r.authEvent,e,"invalid-auth-event"),{status:s.onEvent(r.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:s},this.iframes[e._key()]=n,s}_isIframeWebStorageSupported(e,n){this.iframes[e._key()].send(Ug,{type:Ug},r=>{var o;const i=(o=r==null?void 0:r[0])==null?void 0:o[Ug];i!==void 0&&n(!!i),Qs(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const n=e._key();return this.originValidationPromises[n]||(this.originValidationPromises[n]=Cz(e)),this.originValidationPromises[n]}get _shouldInitProactively(){return Q$()||G$()||o1()}}const Kz=Hz;var tk="@firebase/auth",nk="1.12.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qz{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)==null?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const n=this.auth.onIdTokenChanged(s=>{e((s==null?void 0:s.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,n),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const n=this.internalListeners.get(e);n&&(this.internalListeners.delete(e),n(),this.updateProactiveRefresh())}assertAuthConfigured(){ke(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xz(t){switch(t){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function Yz(t){iu(new fl("auth",(e,{options:n})=>{const s=e.getProvider("app").getImmediate(),r=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:o,authDomain:a}=s.options;ke(o&&!o.includes(":"),"invalid-api-key",{appName:s.name});const l={apiKey:o,authDomain:a,clientPlatform:t,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:J$(t)},c=new dL(s,r,i,l);return wL(c,n),c},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,n,s)=>{e.getProvider("auth-internal").initialize()})),iu(new fl("auth-internal",e=>{const n=da(e.getProvider("auth").getImmediate());return(s=>new qz(s))(n)},"PRIVATE").setInstantiationMode("EXPLICIT")),Ya(tk,nk,Xz(t)),Ya(tk,nk,"esm2020")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qz=5*60,Jz=E$("authIdTokenMaxAge")||Qz;let sk=null;const Zz=t=>async e=>{const n=e&&await e.getIdTokenResult(),s=n&&(new Date().getTime()-Date.parse(n.issuedAtTime))/1e3;if(s&&s>Jz)return;const r=n==null?void 0:n.token;sk!==r&&(sk=r,await fetch(t,{method:r?"POST":"DELETE",headers:r?{Authorization:`Bearer ${r}`}:{}}))};function ej(t=EM()){const e=_$(t,"auth");if(e.isInitialized())return e.getImmediate();const n=bL(t,{popupRedirectResolver:Kz,persistence:[rz,HL,cT]}),s=E$("authTokenSyncURL");if(s&&typeof isSecureContext=="boolean"&&isSecureContext){const i=new URL(s,location.origin);if(location.origin===i.origin){const o=Zz(i.toString());BL(n,o,()=>o(n.currentUser)),jL(n,a=>o(a))}}const r=u4("auth");return r&&kL(n,`http://${r}`),n}function tj(){var t;return((t=document.getElementsByTagName("head"))==null?void 0:t[0])??document}hL({loadJS(t){return new Promise((e,n)=>{const s=document.createElement("script");s.setAttribute("src",t),s.onload=e,s.onerror=r=>{const i=fr("internal-error");i.customData=r,n(i)},s.type="text/javascript",s.charset="UTF-8",tj().appendChild(s)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});Yz("Browser");var nj="firebase",sj="12.8.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Ya(nj,sj,"app");const rj={apiKey:"AIzaSyCcEBPPiufYWBUhGcmi_i7C-HStbeAUg7Q",authDomain:"arogya-ai-pwa-v1.firebaseapp.com",projectId:"arogya-ai-pwa-v1",storageBucket:"arogya-ai-pwa-v1.firebasestorage.app",messagingSenderId:"39775890411",appId:"1:39775890411:web:7bf58175b68751f5d787ae"},ij=D$(rj),vh=ej(ij),gT=W.createContext(null);function oj({children:t}){const[e,n]=W.useState(null),[s,r]=W.useState(!0);W.useEffect(()=>{const u=WL(vh,d=>{n(d?{id:d.uid,email:d.email,name:d.displayName||d.email.split("@")[0],photoURL:d.photoURL,emailVerified:d.emailVerified}:null),r(!1)});return()=>u()},[]);const i=async(u,d)=>{try{return(await ML(vh,u,d)).user}catch(h){throw console.error("Login Error:",h),new Error(l(h.code))}},o=async(u,d,h)=>{try{const p=await PL(vh,d,h);return await zL(p.user,{displayName:u}),n({id:p.user.uid,email:p.user.email,name:u,photoURL:p.user.photoURL,emailVerified:p.user.emailVerified}),p.user}catch(p){throw console.error("Register Error:",p),new Error(l(p.code))}},a=async()=>{try{await VL(vh)}catch(u){console.error("Logout Error:",u)}},l=u=>{switch(u){case"auth/user-not-found":return"No user found with this email";case"auth/wrong-password":return"Incorrect password";case"auth/email-already-in-use":return"Email already in use";case"auth/weak-password":return"Password is too weak";case"auth/invalid-email":return"Invalid email address";default:return"Authentication failed. Please try again."}},c={user:e,isAuthenticated:!!e,isLoading:s,login:i,register:o,logout:a};return m.jsx(gT.Provider,{value:c,children:!s&&t})}function _u(){const t=W.useContext(gT);if(!t)throw new Error("useAuth must be used within an AuthProvider");return t}function aj(){var c,u;const[t,e]=W.useState(!1),n=ti(),s=ua(),{user:r,logout:i}=_u(),o=()=>{i(),s("/")},a=[{section:"Main",items:[{name:"Dashboard",path:"/dashboard",icon:LP,description:"Overview & insights"},{name:"Disease Prediction",path:"/disease-prediction",icon:gn,description:"AI-powered health assessment"}]},{section:"Screening Modules",items:[{name:"Vital Signs (rPPG)",path:"/vital-signs-analysis",icon:Zt,description:"Heart rate, respiration, SpO2"},{name:"Eye Screening",path:"/eye-screening",icon:ks,description:"Anemia, jaundice detection"},{name:"Voice Analysis",path:"/voice-analysis",icon:Ws,description:"Respiratory & vocal health"},{name:"Symptom Checker",path:"/symptom-checker",icon:JP,description:"Multi-symptom assessment"}]},{section:"Analytics & Emergency",items:[{name:"Health Analytics",path:"/health-analytics",icon:Cp,description:"Trends & data insights"},{name:"Journal",path:"/journal",icon:v$,description:"Timeline of scans & results"},{name:"Health Profile",path:"/health-profile",icon:e1,description:"Personal health information"},{name:"Emergency Protocol",path:"/emergency-protocol",icon:Fl,description:"Quick emergency response"}]},{section:"Settings",items:[{name:"Privacy",path:"/settings/privacy",icon:KP,description:"Consent & privacy controls"}]},{section:"Legacy",items:[{name:"Legacy Vital Signs",path:"/vital-signs",icon:Mt,description:"Original vital signs module"}]}],l=d=>d==="/"?n.pathname==="/":n.pathname.startsWith(d);return m.jsxs(m.Fragment,{children:[m.jsx("button",{onClick:()=>e(!t),className:"lg:hidden fixed top-4 left-4 z-50 bg-blue-600 text-white p-2 rounded-lg shadow-lg",style:{position:"fixed",top:16,left:16,zIndex:1e3,backgroundColor:"#2563eb",color:"white",padding:8,borderRadius:8,border:"none",cursor:"pointer",boxShadow:"0 4px 12px rgba(0,0,0,0.15)"},children:t?m.jsx(Rf,{size:20}):m.jsx(WP,{size:20})}),m.jsxs("nav",{style:{position:"fixed",top:0,left:t?0:"-320px",width:320,height:"100vh",backgroundColor:"var(--white)",borderRight:"1px solid var(--primary-green-200)",boxShadow:"4px 0 20px rgba(16, 185, 129, 0.1)",transition:"left var(--transition-normal)",zIndex:999,overflowY:"auto"},className:`lg:left-0 ${t?"shadow-xl":""}`,children:[m.jsxs("div",{style:{padding:"24px 20px",borderBottom:"1px solid var(--primary-green-100)",background:"var(--gradient-primary)",color:"white",position:"relative",overflow:"hidden"},children:[m.jsx("div",{style:{position:"absolute",top:0,right:0,width:100,height:100,background:"rgba(255, 255, 255, 0.1)",borderRadius:"50%",transform:"translate(30px, -30px)"}}),m.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:8,position:"relative",zIndex:1},children:[m.jsx(Mt,{size:28,style:{color:"white",marginRight:12}}),m.jsx("h1",{style:{fontSize:20,fontWeight:"bold",color:"white",margin:0},children:"Arogya AI"})]}),m.jsx("p",{style:{fontSize:12,color:"rgba(255, 255, 255, 0.9)",margin:0,position:"relative",zIndex:1},children:"Advanced Biometric Health Screening"})]}),m.jsx("div",{style:{padding:"16px 0"},children:a.map((d,h)=>m.jsxs("div",{style:{marginBottom:24},children:[m.jsx("div",{style:{padding:"8px 20px",fontSize:12,fontWeight:600,color:"var(--primary-green-600)",textTransform:"uppercase",letterSpacing:"0.05em"},children:d.section}),d.items.map(p=>{const f=p.icon,g=l(p.path);return m.jsx(EP,{to:p.path,onClick:()=>e(!1),style:{display:"block",padding:"12px 20px",textDecoration:"none",color:g?"var(--primary-green-700)":"var(--gray-600)",backgroundColor:g?"var(--primary-green-50)":"transparent",borderRight:g?"3px solid var(--primary-green)":"3px solid transparent",transition:"var(--transition-fast)",borderRadius:"0 var(--radius-md) var(--radius-md) 0",margin:"2px 0"},onMouseEnter:x=>{g||(x.target.style.backgroundColor="var(--primary-green-50)",x.target.style.transform="translateX(4px)")},onMouseLeave:x=>{g||(x.target.style.backgroundColor="transparent",x.target.style.transform="translateX(0)")},children:m.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[m.jsx(f,{size:18,style:{marginRight:12,color:g?"var(--primary-green)":"var(--gray-400)"}}),m.jsxs("div",{children:[m.jsx("div",{style:{fontSize:14,fontWeight:g?600:500,marginBottom:2},children:p.name}),m.jsx("div",{style:{fontSize:11,color:"var(--gray-400)",lineHeight:"1.3"},children:p.description})]})]})},p.path)})]},d.section))}),m.jsxs("div",{style:{position:"absolute",bottom:0,left:0,right:0,padding:"16px 20px",borderTop:"1px solid var(--primary-green-100)",background:"linear-gradient(135deg, var(--primary-green-50) 0%, var(--white) 100%)"},children:[r&&m.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:12},children:[m.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[m.jsx("div",{style:{width:36,height:36,background:"var(--gradient-primary)",borderRadius:10,display:"flex",alignItems:"center",justifyContent:"center",color:"white",fontWeight:600,fontSize:14},children:((u=(c=r.name)==null?void 0:c.charAt(0))==null?void 0:u.toUpperCase())||"U"}),m.jsxs("div",{children:[m.jsx("div",{style:{fontSize:13,fontWeight:600,color:"var(--gray-700)"},children:r.name||"User"}),m.jsx("div",{style:{fontSize:11,color:"var(--gray-400)"},children:r.email})]})]}),m.jsx("button",{onClick:o,style:{background:"transparent",border:"none",padding:8,borderRadius:8,cursor:"pointer",color:"var(--gray-500)",transition:"all 0.2s ease"},title:"Sign out",children:m.jsx(jP,{size:18})})]}),m.jsxs("div",{style:{fontSize:11,color:"var(--gray-400)",textAlign:"center"},children:[m.jsx("div",{style:{fontWeight:500,color:"var(--primary-green-600)"},children:"Arogya AI v0.4.0"}),m.jsx("div",{children:"For screening purposes only"})]})]})]}),t&&m.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",zIndex:998},onClick:()=>e(!1),className:"lg:hidden"})]})}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lj=1e-7,cj=1e-4;class yT{constructor(e,n){this.backend=e,this.dataMover=n,this.data=new WeakMap,this.dataIdsCount=0}get(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)}set(e,n){this.dataIdsCount++,this.data.set(e,n)}has(e){return this.data.has(e)}delete(e){return this.dataIdsCount--,this.data.delete(e)}numDataIds(){return this.dataIdsCount}}class d1{refCount(e){return Dn("refCount")}incRef(e){return Dn("incRef")}timerAvailable(){return!0}time(e){return Dn("time")}read(e){return Dn("read")}readSync(e){return Dn("readSync")}readToGPU(e,n){return Dn("readToGPU")}numDataIds(){return Dn("numDataIds")}disposeData(e,n){return Dn("disposeData")}write(e,n,s){return Dn("write")}move(e,n,s,r,i){return Dn("move")}createTensorFromGPUData(e,n,s){return Dn("createTensorFromGPUData")}memory(){return Dn("memory")}floatPrecision(){return Dn("floatPrecision")}epsilon(){return this.floatPrecision()===32?lj:cj}dispose(){return Dn("dispose")}}function Dn(t){throw new Error(`'${t}' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen`)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uj(t){let e=t.length,n=0;for(;e>0;)n=Math.random()*e|0,e--,Ta(t,e,n)}function Ho(t,e,n){return Math.max(t,Math.min(e,n))}function h1(t){return t%2===0?t:t+1}function Ta(t,e,n){const s=t[e];t[e]=t[n],t[n]=s}function dj(t){let e=0;for(let n=0;n<t.length;n++)e+=t[n];return e}function T(t,e){if(!t)throw new Error(typeof e=="string"?e:e())}function p1(t,e,n=""){T(je(t,e),()=>n+` Shapes ${t} and ${e} must match`)}function f1(t){T(t!=null,()=>"The input to the tensor constructor must be a non-null value.")}function J(t){if(t.length===0)return 1;let e=t[0];for(let n=1;n<t.length;n++)e*=t[n];return e}function je(t,e){if(t===e)return!0;if(t==null||e==null||t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function gl(t){return t%1===0}function f0(t){const e=Math.ceil(Math.sqrt(t));return[e,Math.ceil(t/e)]}function el(t,e){return e<=t.length?t:t+" ".repeat(e-t.length)}function rk(t,e=r=>0,n,s){return new Promise((r,i)=>{let o=0;const a=()=>{if(t()){r();return}o++;const l=e(o);if(n!=null&&o>=n){i();return}s!=null?s(a,l):setTimeout(a,l)};a()})}function xT(t,e){let n=1,s=-1;for(let i=0;i<t.length;++i)if(t[i]>=0)n*=t[i];else if(t[i]===-1){if(s!==-1)throw Error(`Shapes can only have 1 implicit size. Found -1 at dim ${s} and dim ${i}`);s=i}else if(t[i]<0)throw Error(`Shapes can not be < 0. Found ${t[i]} at dim ${i}`);if(s===-1){if(e>0&&e!==n)throw Error(`Size(${e}) must match the product of shape ${t}`);return t}if(n===0)throw Error(`Cannot infer the missing size in [${t}] when there are 0 elements`);if(e%n!==0)throw Error(`The implicit shape can't be a fractional number. Got ${e} / ${n}`);const r=t.slice();return r[s]=e/n,r}function Te(t,e){const n=e.length;return t=t==null?e.map((s,r)=>r):[].concat(t),T(t.every(s=>s>=-n&&s<n),()=>`All values in axis param must be in range [-${n}, ${n}) but got axis ${t}`),T(t.every(s=>gl(s)),()=>`All values in axis param must be integers but got axis ${t}`),t.map(s=>s<0?n+s:s)}function so(t,e){const n=[],s=[],r=e!=null&&Array.isArray(e)&&e.length===0,i=e==null||r?null:Te(e,t).sort();let o=0;for(let a=0;a<t.length;++a){if(i!=null){if(i[o]===a&&t[a]!==1)throw new Error(`Can't squeeze axis ${a} since its dim '${t[a]}' is not 1`);(i[o]==null||i[o]>a)&&t[a]===1&&(n.push(t[a]),s.push(a)),i[o]<=a&&o++}t[a]!==1&&(n.push(t[a]),s.push(a))}return{newShape:n,keptDims:s}}function tn(t,e){return xt(t,e)}function xt(t,e){let n=null;if(t==null||t==="float32")n=new Float32Array(e);else if(t==="int32")n=new Int32Array(e);else if(t==="bool")n=new Uint8Array(e);else if(t==="string")n=new Array(e);else throw new Error(`Unknown data type ${t}`);return n}function hj(t,e){for(let n=0;n<t.length;n++){const s=t[n];if(isNaN(s)||!isFinite(s))throw Error(`A tensor of type ${e} being uploaded contains ${s}.`)}}function pj(t){return t==="bool"||t==="complex64"||t==="float32"||t==="int32"||t==="string"}function vT(t,e){return!(e==="complex64"||e==="float32"&&t!=="complex64"||e==="int32"&&t!=="float32"&&t!=="complex64"||e==="bool"&&t==="bool")}function _p(t){if(t==="float32"||t==="int32")return 4;if(t==="complex64")return 8;if(t==="bool")return 1;throw new Error(`Unknown dtype ${t}`)}function fj(t){if(t==null)return 0;let e=0;return t.forEach(n=>e+=n.length),e}function Du(t){return typeof t=="string"||t instanceof String}function mj(t){return typeof t=="boolean"}function m0(t){return typeof t=="number"}function Pl(t){return Array.isArray(t)?Pl(t[0]):t instanceof Float32Array?"float32":t instanceof Int32Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray?"int32":m0(t)?"float32":Du(t)?"string":mj(t)?"bool":"float32"}function g0(t){return!!(t&&t.constructor&&t.call&&t.apply)}function y0(t,e){for(let n=e;n<t;++n)if(t%n===0)return n;return t}function me(t){const e=t.length;if(e<2)return[];const n=new Array(e-1);n[e-2]=t[e-1];for(let s=e-3;s>=0;--s)n[s]=n[s+1]*t[s+1];return n}function bT(t,e,n,s=!1){const r=new Array;if(e.length===1){const i=e[0]*(s?2:1);for(let o=0;o<i;o++)r[o]=n[t+o]}else{const i=e[0],o=e.slice(1),a=o.reduce((l,c)=>l*c)*(s?2:1);for(let l=0;l<i;l++)r[l]=bT(t+l*a,o,n,s)}return r}function Ks(t,e,n=!1){if(t.length===0)return e[0];const s=t.reduce((r,i)=>r*i)*(n?2:1);if(s===0)return[];if(s!==e.length)throw new Error(`[${t}] does not match the input size ${e.length}${n?" for a complex tensor":""}.`);return bT(0,t,e,n)}function gj(t,e){if(Array.isArray(t))return t;if(e==="float32")return t instanceof Float32Array?t:new Float32Array(t);if(e==="int32")return t instanceof Int32Array?t:new Int32Array(t);if(e==="bool"||e==="string")return Uint8Array.from(new Int32Array(t));throw new Error(`Unknown dtype ${e}`)}function m1(t,e){const n=nn(t,e);for(let s=0;s<n.length;s++)n[s]=1;return n}function nn(t,e){if(e==null||e==="float32"||e==="complex64")return new Float32Array(t);if(e==="int32")return new Int32Array(t);if(e==="bool")return new Uint8Array(t);throw new Error(`Unknown data type ${e}`)}function wT(t,e){const n=t.reduce((s,r)=>s*r,1);if(e==null||e==="float32")return Ks(t,new Float32Array(n));if(e==="int32")return Ks(t,new Int32Array(n));if(e==="bool")return Ks(t,new Uint8Array(n));throw new Error(`Unknown data type ${e}`)}function si(t){t.forEach(e=>{T(Number.isInteger(e)&&e>=0,()=>`Tensor must have a shape comprised of positive integers but got shape [${t}].`)})}function gr(t,e,n){if(e===0)return 0;if(e===1)return t[0];let s=t[t.length-1];for(let r=0;r<t.length-1;++r)s+=n[r]*t[r];return s}function Ml(t,e,n){if(e===0)return[];if(e===1)return[t];const s=new Array(e);for(let r=0;r<s.length-1;++r)s[r]=Math.floor(t/n[r]),t-=s[r]*n[r];return s[s.length-1]=t,s}function g1(t){return t&&t.then&&typeof t.then=="function"}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ik="tfjsflags";class yj{constructor(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=xj,this.populateURLFlags()}setPlatform(e,n){this.platform!=null&&(q().getBool("IS_TEST")||q().getBool("PROD")||console.warn(`Platform ${this.platformName} has already been set. Overwriting the platform with ${e}.`)),this.platformName=e,this.platform=n}registerFlag(e,n,s){if(this.flagRegistry[e]={evaluationFn:n,setHook:s},this.urlFlags[e]!=null){const r=this.urlFlags[e];q().getBool("IS_TEST")||q().getBool("PROD")||console.warn(`Setting feature override from URL ${e}: ${r}.`),this.set(e,r)}}async getAsync(e){return e in this.flags?this.flags[e]:(this.flags[e]=await this.evaluateFlag(e),this.flags[e])}get(e){if(e in this.flags)return this.flags[e];const n=this.evaluateFlag(e);if(g1(n))throw new Error(`Flag ${e} cannot be synchronously evaluated. Please use getAsync() instead.`);return this.flags[e]=n,this.flags[e]}getNumber(e){return this.get(e)}getBool(e){return this.get(e)}getString(e){return this.get(e)}getFlags(){return this.flags}get features(){return this.flags}set(e,n){if(this.flagRegistry[e]==null)throw new Error(`Cannot set flag ${e} as it has not been registered.`);this.flags[e]=n,this.flagRegistry[e].setHook!=null&&this.flagRegistry[e].setHook(n)}evaluateFlag(e){if(this.flagRegistry[e]==null)throw new Error(`Cannot evaluate flag '${e}': no evaluation function found.`);return this.flagRegistry[e].evaluationFn()}setFlags(e){this.flags=Object.assign({},e)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if(typeof this.global>"u"||typeof this.global.location>"u"||typeof this.global.location.search>"u")return;const e=this.getQueryParams(this.global.location.search);ik in e&&e[ik].split(",").forEach(s=>{const[r,i]=s.split(":");this.urlFlags[r]=bj(r,i)})}}function xj(t){const e={};return t.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(n,...s)=>(vj(e,s[0],s[1]),s.join("="))),e}function vj(t,e,n){t[decodeURIComponent(e)]=decodeURIComponent(n||"")}function bj(t,e){const n=e.toLowerCase();return n==="true"||n==="false"?n==="true":`${+n}`===n?+n:e}function q(){return kT}let kT=null;function wj(t){kT=t}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let Gg;function CT(){if(Gg==null){let t;if(typeof window<"u")t=window;else if(typeof global<"u")t=global;else if(typeof process<"u")t=process;else if(typeof self<"u")t=self;else throw new Error("Could not find a global object");Gg=t}return Gg}function kj(){const t=CT();return t._tfGlobals==null&&(t._tfGlobals=new Map),t._tfGlobals}function y1(t,e){const n=kj();if(n.has(t))return n.get(t);{const s=e();return n.set(t,s),n.get(t)}}const Ff="Abs",Fu="Acos",Ou="Acosh",Ll="Add",x1="AddN",v1="All",b1="Any",Of="ArgMax",Pf="ArgMin",Pu="Asin",Mu="Asinh",Lu="Atan",zu="Atanh",ju="Atan2",Mf="AvgPool",w1="AvgPoolGrad",Lf="AvgPool3D",k1="AvgPool3DGrad",zf="BatchMatMul",jf="BatchToSpaceND",C1="Bincount",S1="BitwiseAnd",Cj="BroadcastTo",ST="BroadcastArgs",Bu="Cast",Wu="Ceil",Vu="ClipByValue",I1="Complex",Bf="ComplexAbs",Wf="Concat",Vf="Conv2D",$1="Conv2DBackpropFilter",Uf="Conv2DBackpropInput",Gf="Conv3D",T1="Conv3DBackpropFilterV2",E1="Conv3DBackpropInputV2",Uu="Cos",Gu="Cosh",R1="Cumprod",Hf="Cumsum",N1="CropAndResize",A1="DenseBincount",_1="DepthToSpace",Kf="DepthwiseConv2dNative",D1="DepthwiseConv2dNativeBackpropFilter",F1="DepthwiseConv2dNativeBackpropInput",IT="Diag",qf="Dilation2D",x0="Dilation2DBackpropInput",v0="Dilation2DBackpropFilter",Sj="Draw",Hu="RealDiv",O1="Einsum",Ku="Elu",P1="EluGrad",qu="Erf",Xf="Equal",Xu="Exp",Yf="ExpandDims",Yu="Expm1",M1="FFT",L1="Fill",z1="FlipLeftRight",Qu="Floor",Ju="FloorDiv",Qf="FusedBatchNorm",Jf="GatherV2",$T="GatherNd",Zf="Greater",Zu="GreaterEqual",ed="Identity",j1="IFFT",B1="Imag",td="IsFinite",nd="IsInf",sd="IsNan",em="LeakyRelu",tm="Less",nm="LessEqual",TT="LinSpace",rd="Log",id="Log1p",sm="LogicalAnd",rm="LogicalNot",im="LogicalOr",Ij="LogSoftmax",om="LRN",W1="LRNGrad",am="Max",od="Maximum",lm="MaxPool",V1="MaxPoolGrad",cm="MaxPool3D",U1="MaxPool3DGrad",ET="MaxPoolWithArgmax",um="Mean",dm="Min",ad="Minimum",hm="MirrorPad",ld="Mod",RT="Multinomial",cd="Multiply",pm="Neg",fm="NotEqual",G1="NonMaxSuppressionV3",H1="NonMaxSuppressionV4",K1="NonMaxSuppressionV5",mm="OnesLike",gm="OneHot",ym="Pack",xm="PadV2",ud="Pow",vm="Prelu",bm="Prod",NT="RaggedGather",AT="RaggedRange",_T="RaggedTensorToTensor",q1="Range",X1="Real",dd="Reciprocal",hd="Relu",wm="Reshape",km="ResizeNearestNeighbor",Y1="ResizeNearestNeighborGrad",Cm="ResizeBilinear",Q1="ResizeBilinearGrad",pd="Relu6",Sm="Reverse",fd="Round",md="Rsqrt",DT="ScatterNd",FT="TensorScatterUpdate",OT="SearchSorted",Im="Select",gd="Selu",$m="Slice",yd="Sin",xd="Sinh",vd="Sign",bd="Sigmoid",wd="Softplus",kd="Sqrt",Tm="Sum",Em="SpaceToBatchND",Rm="SplitV",Nm="Softmax",PT="SparseFillEmptyRows",MT="SparseReshape",LT="SparseSegmentMean",zT="SparseSegmentSum",jT="SparseToDense",Cd="SquaredDifference",J1="Square",Z1="StaticRegexReplace",ev="StridedSlice",BT="StringNGrams",WT="StringSplit",VT="StringToHashBucketFast",Sd="Sub",Id="Tan",$d="Tanh",Td="Tile",tv="TopK",nv="Transform",tl="Transpose",sv="Unique",Am="Unpack",_m="UnsortedSegmentSum",Dm="ZerosLike",Ed="Step",b0="FromPixels",rv="RotateWithOffset",Dp="_FusedMatMul",Fp="FusedConv2D",UT="FusedDepthwiseConv2D";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xn(...t){q().getBool("IS_TEST")||q().getBool("PROD")||console.warn(...t)}function $j(...t){q().getBool("IS_TEST")||q().getBool("PROD")||console.log(...t)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Op=y1("kernelRegistry",()=>new Map),w0=y1("gradRegistry",()=>new Map);function k0(t,e){const n=HT(t,e);return Op.get(n)}function ok(t){return w0.get(t)}function ak(t){const e=Op.entries(),n=[];for(;;){const{done:s,value:r}=e.next();if(s)break;const[i,o]=r,[a]=i.split("_");a===t&&n.push(o)}return n}function GT(t){const{kernelName:e,backendName:n}=t,s=HT(e,n);Op.has(s)&&Xn(`The kernel '${e}' for backend '${n}' is already registered`),Op.set(s,t)}function Tj(t){const{kernelName:e}=t;w0.has(e)&&q().getBool("DEBUG")&&Xn(`Overriding the gradient for '${e}'`),w0.set(e,t)}function HT(t,e){return`${e}_${t}`}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KT(t){return t instanceof Float32Array||t instanceof Int32Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray}var qT=tt,gs=null;try{gs=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function tt(t,e,n){this.low=t|0,this.high=e|0,this.unsigned=!!n}tt.prototype.__isLong__;Object.defineProperty(tt.prototype,"__isLong__",{value:!0});function Hn(t){return(t&&t.__isLong__)===!0}tt.isLong=Hn;var lk={},ck={};function ha(t,e){var n,s,r;return e?(t>>>=0,(r=0<=t&&t<256)&&(s=ck[t],s)?s:(n=nt(t,(t|0)<0?-1:0,!0),r&&(ck[t]=n),n)):(t|=0,(r=-128<=t&&t<128)&&(s=lk[t],s)?s:(n=nt(t,t<0?-1:0,!1),r&&(lk[t]=n),n))}tt.fromInt=ha;function ys(t,e){if(isNaN(t))return e?Ro:xs;if(e){if(t<0)return Ro;if(t>=XT)return JT}else{if(t<=-dk)return Mn;if(t+1>=dk)return QT}return t<0?ys(-t,e).neg():nt(t%yl|0,t/yl|0,e)}tt.fromNumber=ys;function nt(t,e,n){return new tt(t,e,n)}tt.fromBits=nt;var Pp=Math.pow;function iv(t,e,n){if(t.length===0)throw Error("empty string");if(t==="NaN"||t==="Infinity"||t==="+Infinity"||t==="-Infinity")return xs;if(typeof e=="number"?(n=e,e=!1):e=!!e,n=n||10,n<2||36<n)throw RangeError("radix");var s;if((s=t.indexOf("-"))>0)throw Error("interior hyphen");if(s===0)return iv(t.substring(1),e,n).neg();for(var r=ys(Pp(n,8)),i=xs,o=0;o<t.length;o+=8){var a=Math.min(8,t.length-o),l=parseInt(t.substring(o,o+a),n);if(a<8){var c=ys(Pp(n,a));i=i.mul(c).add(ys(l))}else i=i.mul(r),i=i.add(ys(l))}return i.unsigned=e,i}tt.fromString=iv;function tr(t,e){return typeof t=="number"?ys(t,e):typeof t=="string"?iv(t,e):nt(t.low,t.high,typeof e=="boolean"?e:t.unsigned)}tt.fromValue=tr;var uk=65536,Ej=1<<24,yl=uk*uk,XT=yl*yl,dk=XT/2,hk=ha(Ej),xs=ha(0);tt.ZERO=xs;var Ro=ha(0,!0);tt.UZERO=Ro;var Va=ha(1);tt.ONE=Va;var YT=ha(1,!0);tt.UONE=YT;var C0=ha(-1);tt.NEG_ONE=C0;var QT=nt(-1,2147483647,!1);tt.MAX_VALUE=QT;var JT=nt(-1,-1,!0);tt.MAX_UNSIGNED_VALUE=JT;var Mn=nt(0,-2147483648,!1);tt.MIN_VALUE=Mn;var ce=tt.prototype;ce.toInt=function(){return this.unsigned?this.low>>>0:this.low};ce.toNumber=function(){return this.unsigned?(this.high>>>0)*yl+(this.low>>>0):this.high*yl+(this.low>>>0)};ce.toString=function(e){if(e=e||10,e<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(Mn)){var n=ys(e),s=this.div(n),r=s.mul(n).sub(this);return s.toString(e)+r.toInt().toString(e)}else return"-"+this.neg().toString(e);for(var i=ys(Pp(e,6),this.unsigned),o=this,a="";;){var l=o.div(i),c=o.sub(l.mul(i)).toInt()>>>0,u=c.toString(e);if(o=l,o.isZero())return u+a;for(;u.length<6;)u="0"+u;a=""+u+a}};ce.getHighBits=function(){return this.high};ce.getHighBitsUnsigned=function(){return this.high>>>0};ce.getLowBits=function(){return this.low};ce.getLowBitsUnsigned=function(){return this.low>>>0};ce.getNumBitsAbs=function(){if(this.isNegative())return this.eq(Mn)?64:this.neg().getNumBitsAbs();for(var e=this.high!=0?this.high:this.low,n=31;n>0&&!(e&1<<n);n--);return this.high!=0?n+33:n+1};ce.isZero=function(){return this.high===0&&this.low===0};ce.eqz=ce.isZero;ce.isNegative=function(){return!this.unsigned&&this.high<0};ce.isPositive=function(){return this.unsigned||this.high>=0};ce.isOdd=function(){return(this.low&1)===1};ce.isEven=function(){return(this.low&1)===0};ce.equals=function(e){return Hn(e)||(e=tr(e)),this.unsigned!==e.unsigned&&this.high>>>31===1&&e.high>>>31===1?!1:this.high===e.high&&this.low===e.low};ce.eq=ce.equals;ce.notEquals=function(e){return!this.eq(e)};ce.neq=ce.notEquals;ce.ne=ce.notEquals;ce.lessThan=function(e){return this.comp(e)<0};ce.lt=ce.lessThan;ce.lessThanOrEqual=function(e){return this.comp(e)<=0};ce.lte=ce.lessThanOrEqual;ce.le=ce.lessThanOrEqual;ce.greaterThan=function(e){return this.comp(e)>0};ce.gt=ce.greaterThan;ce.greaterThanOrEqual=function(e){return this.comp(e)>=0};ce.gte=ce.greaterThanOrEqual;ce.ge=ce.greaterThanOrEqual;ce.compare=function(e){if(Hn(e)||(e=tr(e)),this.eq(e))return 0;var n=this.isNegative(),s=e.isNegative();return n&&!s?-1:!n&&s?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1};ce.comp=ce.compare;ce.negate=function(){return!this.unsigned&&this.eq(Mn)?Mn:this.not().add(Va)};ce.neg=ce.negate;ce.add=function(e){Hn(e)||(e=tr(e));var n=this.high>>>16,s=this.high&65535,r=this.low>>>16,i=this.low&65535,o=e.high>>>16,a=e.high&65535,l=e.low>>>16,c=e.low&65535,u=0,d=0,h=0,p=0;return p+=i+c,h+=p>>>16,p&=65535,h+=r+l,d+=h>>>16,h&=65535,d+=s+a,u+=d>>>16,d&=65535,u+=n+o,u&=65535,nt(h<<16|p,u<<16|d,this.unsigned)};ce.subtract=function(e){return Hn(e)||(e=tr(e)),this.add(e.neg())};ce.sub=ce.subtract;ce.multiply=function(e){if(this.isZero())return xs;if(Hn(e)||(e=tr(e)),gs){var n=gs.mul(this.low,this.high,e.low,e.high);return nt(n,gs.get_high(),this.unsigned)}if(e.isZero())return xs;if(this.eq(Mn))return e.isOdd()?Mn:xs;if(e.eq(Mn))return this.isOdd()?Mn:xs;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(hk)&&e.lt(hk))return ys(this.toNumber()*e.toNumber(),this.unsigned);var s=this.high>>>16,r=this.high&65535,i=this.low>>>16,o=this.low&65535,a=e.high>>>16,l=e.high&65535,c=e.low>>>16,u=e.low&65535,d=0,h=0,p=0,f=0;return f+=o*u,p+=f>>>16,f&=65535,p+=i*u,h+=p>>>16,p&=65535,p+=o*c,h+=p>>>16,p&=65535,h+=r*u,d+=h>>>16,h&=65535,h+=i*c,d+=h>>>16,h&=65535,h+=o*l,d+=h>>>16,h&=65535,d+=s*u+r*c+i*l+o*a,d&=65535,nt(p<<16|f,d<<16|h,this.unsigned)};ce.mul=ce.multiply;ce.divide=function(e){if(Hn(e)||(e=tr(e)),e.isZero())throw Error("division by zero");if(gs){if(!this.unsigned&&this.high===-2147483648&&e.low===-1&&e.high===-1)return this;var n=(this.unsigned?gs.div_u:gs.div_s)(this.low,this.high,e.low,e.high);return nt(n,gs.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?Ro:xs;var s,r,i;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return Ro;if(e.gt(this.shru(1)))return YT;i=Ro}else{if(this.eq(Mn)){if(e.eq(Va)||e.eq(C0))return Mn;if(e.eq(Mn))return Va;var o=this.shr(1);return s=o.div(e).shl(1),s.eq(xs)?e.isNegative()?Va:C0:(r=this.sub(e.mul(s)),i=s.add(r.div(e)),i)}else if(e.eq(Mn))return this.unsigned?Ro:xs;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();i=xs}for(r=this;r.gte(e);){s=Math.max(1,Math.floor(r.toNumber()/e.toNumber()));for(var a=Math.ceil(Math.log(s)/Math.LN2),l=a<=48?1:Pp(2,a-48),c=ys(s),u=c.mul(e);u.isNegative()||u.gt(r);)s-=l,c=ys(s,this.unsigned),u=c.mul(e);c.isZero()&&(c=Va),i=i.add(c),r=r.sub(u)}return i};ce.div=ce.divide;ce.modulo=function(e){if(Hn(e)||(e=tr(e)),gs){var n=(this.unsigned?gs.rem_u:gs.rem_s)(this.low,this.high,e.low,e.high);return nt(n,gs.get_high(),this.unsigned)}return this.sub(this.div(e).mul(e))};ce.mod=ce.modulo;ce.rem=ce.modulo;ce.not=function(){return nt(~this.low,~this.high,this.unsigned)};ce.and=function(e){return Hn(e)||(e=tr(e)),nt(this.low&e.low,this.high&e.high,this.unsigned)};ce.or=function(e){return Hn(e)||(e=tr(e)),nt(this.low|e.low,this.high|e.high,this.unsigned)};ce.xor=function(e){return Hn(e)||(e=tr(e)),nt(this.low^e.low,this.high^e.high,this.unsigned)};ce.shiftLeft=function(e){return Hn(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?nt(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):nt(0,this.low<<e-32,this.unsigned)};ce.shl=ce.shiftLeft;ce.shiftRight=function(e){return Hn(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?nt(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):nt(this.high>>e-32,this.high>=0?0:-1,this.unsigned)};ce.shr=ce.shiftRight;ce.shiftRightUnsigned=function(e){if(Hn(e)&&(e=e.toInt()),e&=63,e===0)return this;var n=this.high;if(e<32){var s=this.low;return nt(s>>>e|n<<32-e,n>>>e,this.unsigned)}else return e===32?nt(n,0,this.unsigned):nt(n>>>e-32,0,this.unsigned)};ce.shru=ce.shiftRightUnsigned;ce.shr_u=ce.shiftRightUnsigned;ce.toSigned=function(){return this.unsigned?nt(this.low,this.high,!1):this};ce.toUnsigned=function(){return this.unsigned?this:nt(this.low,this.high,!0)};ce.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()};ce.toBytesLE=function(){var e=this.high,n=this.low;return[n&255,n>>>8&255,n>>>16&255,n>>>24,e&255,e>>>8&255,e>>>16&255,e>>>24]};ce.toBytesBE=function(){var e=this.high,n=this.low;return[e>>>24,e>>>16&255,e>>>8&255,e&255,n>>>24,n>>>16&255,n>>>8&255,n&255]};tt.fromBytes=function(e,n,s){return s?tt.fromBytesLE(e,n):tt.fromBytesBE(e,n)};tt.fromBytesLE=function(e,n){return new tt(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,n)};tt.fromBytesBE=function(e,n){return new tt(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],n)};const ZT=UC(qT),Rj=VC({__proto__:null,default:ZT},[qT]);/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ko=ZT||Rj;function Fm(t){return ko.fromString(t,!0,16)}const eE=Fm("c3a5c85c97cb3127"),wo=Fm("b492b66fbe98f273"),fn=Fm("9ae16a3b2f90404f");function S0(t){return t.xor(t.shru(47))}function tE(t,e,n){const s=t.slice(e,e+n);return ko.fromBytes(Array.from(s),!0,!0)}function Ye(t,e){return tE(t,e,8)}function pk(t,e){return tE(t,e,4)}function Lt(t,e){return e===0?t:t.shru(e).or(t.shl(64-e))}function zi(t,e,n=Fm("9ddfea08eb382d69")){let s=t.xor(e).mul(n);s=s.xor(s.shru(47));let r=e.xor(s).mul(n);return r=r.xor(r.shru(47)),r=r.mul(n),r}function Nj(t,e,n,s,r,i){r=r.add(t),i=Lt(i.add(r).add(s),21);const o=r;return r=r.add(e),r=r.add(n),i=i.add(Lt(r,44)),[r.add(s),i.add(o)]}function bh(t,e,n,s){return Nj(Ye(t,e),Ye(t,e+8),Ye(t,e+16),Ye(t,e+24),n,s)}function Aj(t,e=t.length){if(e>=8){const n=fn.add(e*2),s=Ye(t,0).add(fn),r=Ye(t,e-8),i=Lt(r,37).mul(n).add(s),o=Lt(s,25).add(r).mul(n);return zi(i,o,n)}if(e>=4){const n=fn.add(e*2),s=pk(t,0);return zi(s.shl(3).add(e),pk(t,e-4),n)}if(e>0){const n=t[0],s=t[e>>1],r=t[e-1],i=n+(s<<8),o=e+(r<<2);return S0(fn.mul(i).xor(eE.mul(o))).mul(fn)}return fn}function _j(t,e=t.length){const n=fn.add(e*2),s=Ye(t,0).mul(wo),r=Ye(t,8),i=Ye(t,e-8).mul(n),o=Ye(t,e-16).mul(fn);return zi(Lt(s.add(r),43).add(Lt(i,30)).add(o),s.add(Lt(r.add(fn),18)).add(i),n)}function Dj(t,e=t.length){const n=fn.add(e*2),s=Ye(t,0).mul(fn),r=Ye(t,8),i=Ye(t,e-8).mul(n),o=Ye(t,e-16).mul(fn),a=Lt(s.add(r),43).add(Lt(i,30)).add(o),l=zi(a,s.add(Lt(r.add(fn),18)).add(i),n),c=Ye(t,16).mul(n),u=Ye(t,24),d=a.add(Ye(t,e-32)).mul(n),h=l.add(Ye(t,e-24)).mul(n);return zi(Lt(c.add(u),43).add(Lt(d,30)).add(h),c.add(Lt(u.add(s),18)).add(d),n)}function Fj(t,e=t.length){const n=ko.fromNumber(81,!0);if(e<=32)return e<=16?Aj(t,e):_j(t,e);if(e<=64)return Dj(t,e);let s=n,r=n.mul(wo).add(113),i=S0(r.mul(fn).add(113)).mul(fn),o=[ko.UZERO,ko.UZERO],a=[ko.UZERO,ko.UZERO];s=s.mul(fn).add(Ye(t,0));let l=0;const c=(e-1>>6)*64,u=c+(e-1&63)-63;do s=Lt(s.add(r).add(o[0]).add(Ye(t,l+8)),37).mul(wo),r=Lt(r.add(o[1]).add(Ye(t,l+48)),42).mul(wo),s=s.xor(a[1]),r=r.add(o[0]).add(Ye(t,l+40)),i=Lt(i.add(a[0]),33).mul(wo),o=bh(t,l,o[1].mul(wo),s.add(a[0])),a=bh(t,l+32,i.add(a[1]),r.add(Ye(t,l+16))),[i,s]=[s,i],l+=64;while(l!==c);const d=wo.add(i.and(255).shl(1));return l=u,a[0]=a[0].add(e-1&63),o[0]=o[0].add(a[0]),a[0]=a[0].add(o[0]),s=Lt(s.add(r).add(o[0]).add(Ye(t,l+8)),37).mul(d),r=Lt(r.add(o[1]).add(Ye(t,l+48)),42).mul(d),s=s.xor(a[1].mul(9)),r=r.add(o[0].mul(9).add(Ye(t,l+40))),i=Lt(i.add(a[0]),33).mul(d),o=bh(t,l,o[1].mul(d),s.add(a[0])),a=bh(t,l+32,i.add(a[1]),r.add(Ye(t,l+16))),[i,s]=[s,i],zi(zi(o[0],a[0],d).add(S0(r).mul(eE)).add(i),zi(o[1],a[1],d).add(s),d)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ro(t,e){return e==="string"?ji(t):pa([t],e)}function Oj(t,e){return t instanceof Float32Array&&e==="float32"||t instanceof Int32Array&&e==="int32"||t instanceof Uint8Array&&e==="bool"}function pa(t,e){if(e==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(t)&&(t=Ko(t)),q().getBool("DEBUG")&&hj(t,e),Oj(t,e))return t;if(e==null||e==="float32"||e==="complex64")return new Float32Array(t);if(e==="int32")return new Int32Array(t);if(e==="bool"){const n=new Uint8Array(t.length);for(let s=0;s<n.length;++s)Math.round(t[s])!==0&&(n[s]=1);return n}else throw new Error(`Unknown data type ${e}`)}function kn(){return q().platform.now()}function ji(t,e="utf-8"){return e=e||"utf-8",q().platform.encode(t,e)}function Gi(t,e="utf-8"){return e=e||"utf-8",q().platform.decode(t,e)}function Is(t){return q().platform.isTypedArray!=null?q().platform.isTypedArray(t):KT(t)}function Ko(t,e=[],n=!1){if(e==null&&(e=[]),typeof t=="boolean"||typeof t=="number"||typeof t=="string"||g1(t)||t==null||Is(t)&&n)e.push(t);else if(Array.isArray(t)||Is(t))for(let s=0;s<t.length;++s)Ko(t[s],e,n);else{let s=-1;for(const r of Object.keys(t))/^([1-9]+[0-9]*|0)$/.test(r)&&(s=Math.max(s,Number(r)));for(let r=0;r<=s;r++)Ko(t[r],e,n)}return e}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Pj{constructor(e,n){this.backendTimer=e,this.logger=n,n==null&&(this.logger=new Lj)}profileKernel(e,n,s){let r;const i=()=>{r=s()};let o;const a=kn();if(this.backendTimer.timerAvailable())o=this.backendTimer.time(i);else{i();for(const c of r)c.dataSync();o=Promise.resolve({kernelMs:kn()-a})}if(q().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(let c=0;c<r.length;c++){const u=r[c];u.data().then(d=>{Mj(d,u.dtype,e)})}return{kernelName:e,outputs:r,inputs:n,timeMs:o.then(c=>c.kernelMs),extraInfo:o.then(c=>c.getExtraProfileInfo!=null?c.getExtraProfileInfo():"")}}logKernelProfile(e){const{kernelName:n,outputs:s,timeMs:r,inputs:i,extraInfo:o}=e;s.forEach(a=>{Promise.all([a.data(),r,o]).then(l=>{this.logger.logKernelProfile(n,a,l[0],l[1],i,l[2])})})}}function Mj(t,e,n){if(e!=="float32")return!1;for(let s=0;s<t.length;s++){const r=t[s];if(isNaN(r)||!isFinite(r))return console.warn(`Found ${r} in the result of '${n}'`),!0}return!1}class Lj{logKernelProfile(e,n,s,r,i,o){const a=typeof r=="number"?el(`${r}ms`,9):r.error,l=el(e,25),c=n.rank,u=n.size,d=el(n.shape.toString(),14);let h="";for(const p in i){const f=i[p];if(f!=null){const g=f.shape||n.shape,x=g.length;h+=`${p}: ${x}D ${x>0?g:""} `}}console.log(`%c${l}	%c${a}	%c${c}D ${d}	%c${u}	%c${h}	%c${o}`,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zj(t,e,n){const s={},r={};for(let l=0;l<e.length;l++)s[e[l].id]=!0;for(let l=0;l<t.length;l++){const c=t[l],u=c.inputs;for(const d in u){const h=u[d];let p=!1;for(let f=0;f<e.length;f++)if(s[h.id]){c.outputs.forEach(g=>s[g.id]=!0),p=!0,r[c.id]=!0;break}if(p)break}}const i={};i[n.id]=!0;const o={};for(let l=t.length-1;l>=0;l--){const c=t[l],u=c.inputs;for(let d=0;d<c.outputs.length;d++)if(i[c.outputs[d].id]){for(const h in u)i[u[h].id]=!0,o[c.id]=!0;break}}const a=[];for(let l=0;l<t.length;l++){const c=t[l];if(r[c.id]&&o[c.id]){const u={};for(const h in c.inputs){const p=c.inputs[h];s[p.id]&&(u[h]=p)}const d=Object.assign({},c);d.inputs=u,d.outputs=c.outputs,a.push(d)}}return a}function jj(t,e,n,s){for(let r=e.length-1;r>=0;r--){const i=e[r],o=[];if(i.outputs.forEach(l=>{const c=t[l.id];c!=null?o.push(c):o.push(null)}),i.gradient==null)throw new Error(`Cannot compute gradient: gradient function not found for ${i.kernelName}.`);const a=i.gradient(o);for(const l in i.inputs){if(!(l in a))throw new Error(`Cannot backprop through input ${l}. Available gradients found: ${Object.keys(a)}.`);const c=n(()=>a[l]());if(c.dtype!=="float32")throw new Error(`Error in gradient for op ${i.kernelName}. The gradient of input ${l} must have 'float32' dtype, but has '${c.dtype}'`);const u=i.inputs[l];if(!je(c.shape,u.shape))throw new Error(`Error in gradient for op ${i.kernelName}. The gradient of input '${l}' has shape '${c.shape}', which does not match the shape of the input '${u.shape}'`);if(t[u.id]==null)t[u.id]=c;else{const d=t[u.id];t[u.id]=s(d,c),d.dispose()}}}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fk=20,uc=3,Hg=7;function Bj(t,e,n,s){const r=me(e),i=Wj(t,e,n,r),o=e.length,a=Xh(t,e,n,r,i),l=["Tensor"];return s&&(l.push(`  dtype: ${n}`),l.push(`  rank: ${o}`),l.push(`  shape: [${e}]`),l.push("  values:")),l.push(a.map(c=>"    "+c).join(`
`)),l.join(`
`)}function Wj(t,e,n,s){const r=J(e),i=s[s.length-1],o=new Array(i).fill(0),a=e.length,l=n==="complex64"?wc(t):t;if(a>1)for(let c=0;c<r/i;c++){const u=c*i;for(let d=0;d<i;d++)o[d]=Math.max(o[d],bc(l[u+d],0,n).length)}return o}function bc(t,e,n){let s;return Array.isArray(t)?s=`${parseFloat(t[0].toFixed(Hg))} + ${parseFloat(t[1].toFixed(Hg))}j`:Du(t)?s=`'${t}'`:n==="bool"?s=nE(t):s=parseFloat(t.toFixed(Hg)).toString(),el(s,e)}function nE(t){return t===0?"false":"true"}function Xh(t,e,n,s,r,i=!0){const o=n==="complex64"?2:1,a=e[0],l=e.length;if(l===0){if(n==="complex64"){const g=wc(t);return[bc(g[0],0,n)]}return n==="bool"?[nE(t[0])]:[t[0].toString()]}if(l===1){if(a>fk){const x=uc*o;let y=Array.from(t.slice(0,x)),v=Array.from(t.slice((a-uc)*o,a*o));return n==="complex64"&&(y=wc(y),v=wc(v)),["["+y.map((b,w)=>bc(b,r[w],n)).join(", ")+", ..., "+v.map((b,w)=>bc(b,r[a-uc+w],n)).join(", ")+"]"]}return["["+(n==="complex64"?wc(t):Array.from(t)).map((x,y)=>bc(x,r[y],n)).join(", ")+"]"]}const c=e.slice(1),u=s.slice(1),d=s[0]*o,h=[];if(a>fk){for(let g=0;g<uc;g++){const x=g*d,y=x+d;h.push(...Xh(t.slice(x,y),c,n,u,r,!1))}h.push("...");for(let g=a-uc;g<a;g++){const x=g*d,y=x+d;h.push(...Xh(t.slice(x,y),c,n,u,r,g===a-1))}}else for(let g=0;g<a;g++){const x=g*d,y=x+d;h.push(...Xh(t.slice(x,y),c,n,u,r,g===a-1))}const p=l===2?",":"";h[0]="["+(a>0?h[0]+p:"");for(let g=1;g<h.length-1;g++)h[g]=" "+h[g]+p;let f=`,
`;for(let g=2;g<l;g++)f+=`
`;return h[h.length-1]=" "+h[h.length-1]+"]"+(i?"":f),h}function wc(t){const e=[];for(let n=0;n<t.length;n+=2)e.push([t[n],t[n+1]]);return e}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Kt{constructor(e,n,s){if(this.dtype=n,this.shape=e.slice(),this.size=J(e),s!=null){const r=s.length;T(r===this.size,()=>`Length of values '${r}' does not match the size inferred by the shape '${this.size}'.`)}if(n==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=s||xt(n,this.size),this.strides=me(e)}set(e,...n){n.length===0&&(n=[0]),T(n.length===this.rank,()=>`The number of provided coordinates (${n.length}) must match the rank (${this.rank})`);const s=this.locToIndex(n);this.values[s]=e}get(...e){e.length===0&&(e=[0]);let n=0;for(const r of e){if(r<0||r>=this.shape[n]){const i=`Requested out of range element at ${e}.   Buffer shape=${this.shape}`;throw new Error(i)}n++}let s=e[e.length-1];for(let r=0;r<e.length-1;++r)s+=this.strides[r]*e[r];return this.values[s]}locToIndex(e){if(this.rank===0)return 0;if(this.rank===1)return e[0];let n=e[e.length-1];for(let s=0;s<e.length-1;++s)n+=this.strides[s]*e[s];return n}indexToLoc(e){if(this.rank===0)return[];if(this.rank===1)return[e];const n=new Array(this.shape.length);for(let s=0;s<n.length-1;++s)n[s]=Math.floor(e/this.strides[s]),e-=n[s]*this.strides[s];return n[n.length-1]=e,n}get rank(){return this.shape.length}toTensor(){return zs().makeTensor(this.values,this.shape,this.dtype)}}let zs=null,Ea=null;function Vj(t){zs=t}function Uj(t){Ea=t}class Et{constructor(e,n,s,r){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=n||"float32",this.size=J(e),this.strides=me(e),this.dataId=s,this.id=r,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}async buffer(){const e=await this.data();return Ea.buffer(this.shape,this.dtype,e)}bufferSync(){return Ea.buffer(this.shape,this.dtype,this.dataSync())}async array(){const e=await this.data();return Ks(this.shape,e,this.dtype==="complex64")}arraySync(){return Ks(this.shape,this.dataSync(),this.dtype==="complex64")}async data(){this.throwIfDisposed();const e=zs().read(this.dataId);if(this.dtype==="string"){const n=await e;try{return n.map(s=>Gi(s))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return e}dataToGPU(e){return this.throwIfDisposed(),zs().readToGPU(this.dataId,e)}dataSync(){this.throwIfDisposed();const e=zs().readSync(this.dataId);if(this.dtype==="string")try{return e.map(n=>Gi(n))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e}async bytes(){this.throwIfDisposed();const e=await zs().read(this.dataId);return this.dtype==="string"?e:new Uint8Array(e.buffer)}dispose(){this.isDisposed||(this.kerasMask&&this.kerasMask.dispose(),zs().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(e=!1){return Ea.print(this,e)}clone(){return this.throwIfDisposed(),Ea.clone(this)}toString(e=!1){const n=this.dataSync();return Bj(n,this.shape,this.dtype,e)}cast(e){return this.throwIfDisposed(),Ea.cast(this,e)}variable(e=!0,n,s){return this.throwIfDisposed(),zs().makeVariable(this,e,n,s)}}Object.defineProperty(Et,Symbol.hasInstance,{value:t=>!!t&&t.data!=null&&t.dataSync!=null&&t.throwIfDisposed!=null});function Y(){return y1("Tensor",()=>Et)}Y();class Mp extends Et{constructor(e,n,s,r){super(e.shape,e.dtype,e.dataId,r),this.trainable=n,this.name=s}assign(e){if(e.dtype!==this.dtype)throw new Error(`dtype of the new value (${e.dtype}) and previous value (${this.dtype}) must match`);if(!je(e.shape,this.shape))throw new Error(`shape of the new value (${e.shape}) and previous value (${this.shape}) must match`);zs().disposeTensor(this),this.dataId=e.dataId,zs().incRef(this,null)}dispose(){zs().disposeVariable(this),this.isDisposedInternal=!0}}Object.defineProperty(Mp,Symbol.hasInstance,{value:t=>t instanceof Et&&t.assign!=null&&t.assign instanceof Function});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var mk;(function(t){t.R0="R0",t.R1="R1",t.R2="R2",t.R3="R3",t.R4="R4",t.R5="R5",t.R6="R6"})(mk||(mk={}));var I0;(function(t){t.float32="float32",t.int32="int32",t.bool="int32",t.complex64="complex64"})(I0||(I0={}));var $0;(function(t){t.float32="float32",t.int32="int32",t.bool="bool",t.complex64="complex64"})($0||($0={}));var T0;(function(t){t.float32="float32",t.int32="float32",t.bool="float32",t.complex64="complex64"})(T0||(T0={}));var E0;(function(t){t.float32="complex64",t.int32="complex64",t.bool="complex64",t.complex64="complex64"})(E0||(E0={}));const Gj={float32:T0,int32:I0,bool:$0,complex64:E0};function Vn(t,e){if(t==="string"||e==="string"){if(t==="string"&&e==="string")return"string";throw new Error(`Can not upcast ${t} with ${e}`)}return Gj[t][e]}function ov(t){return Vn(t,"int32")}function sE(t){return t!=null&&typeof t=="object"&&"texture"in t&&t.texture instanceof WebGLTexture}function rE(t){return typeof GPUBuffer<"u"&&t!=null&&typeof t=="object"&&"buffer"in t&&t.buffer instanceof GPUBuffer}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bt(t,e){if(t.dtype===e.dtype)return[t,e];const n=Vn(t.dtype,e.dtype);return[t.cast(n),e.cast(n)]}function iE(t){const e=[];return oE(t,e,new Set),e}function oE(t,e,n){if(t==null)return;if(t instanceof Et){e.push(t);return}if(!Hj(t))return;const s=t;for(const r in s){const i=s[r];n.has(i)||(n.add(i),oE(i,e,n))}}function Hj(t){return Array.isArray(t)||typeof t=="object"}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kg(t){return t.kernelName!=null}class gk{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(e=>e.name)))}}}dispose(){for(const e in this.registeredVariables)this.registeredVariables[e].dispose()}}class xl{constructor(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new gk}async ready(){if(this.pendingBackendInit!=null)return this.pendingBackendInit.then(()=>{});if(this.backendInstance!=null)return;const e=this.getSortedBackends();for(let n=0;n<e.length;n++){const s=e[n];if(await this.initializeBackend(s).success){await this.setBackend(s);return}}throw new Error("Could not initialize any backends, all backend initializations failed.")}get backend(){if(this.pendingBackendInit!=null)throw new Error(`Backend '${this.backendName}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);if(this.backendInstance==null){const{name:e,asyncInit:n}=this.initializeBackendsAndReturnBest();if(n)throw new Error(`The highest priority backend '${e}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);this.setBackend(e)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(e){if(!(e in this.registry))if(e in this.registryFactory){const{asyncInit:n}=this.initializeBackend(e);if(n)return null}else return null;return this.registry[e]}findBackendFactory(e){return e in this.registryFactory?this.registryFactory[e].factory:null}registerBackend(e,n,s=1){return e in this.registryFactory?(Xn(`${e} backend was already registered. Reusing existing backend factory.`),!1):(this.registryFactory[e]={factory:n,priority:s},!0)}async setBackend(e){if(this.registryFactory[e]==null)throw new Error(`Backend name '${e}' not found in registry`);if(this.backendName=e,this.registry[e]==null){this.backendInstance=null;const{success:n,asyncInit:s}=this.initializeBackend(e);if(!(s?await n:n))return!1}return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new Pj(this.backendInstance),!0}setupRegisteredKernels(){ak(this.backendName).forEach(n=>{n.setupFunc!=null&&n.setupFunc(this.backendInstance)})}disposeRegisteredKernels(e){ak(e).forEach(s=>{s.disposeFunc!=null&&s.disposeFunc(this.registry[e])})}initializeBackend(e){const n=this.registryFactory[e];if(n==null)throw new Error(`Cannot initialize backend ${e}, no registration found.`);try{const s=n.factory();if(s&&!(s instanceof d1)&&typeof s.then=="function"){const r=++this.pendingBackendInitId,i=s.then(o=>r<this.pendingBackendInitId?!1:(this.registry[e]=o,this.pendingBackendInit=null,!0)).catch(o=>(r<this.pendingBackendInitId||(this.pendingBackendInit=null,Xn(`Initialization of backend ${e} failed`),Xn(o.stack||o.message)),!1));return this.pendingBackendInit=i,{success:i,asyncInit:!0}}else return this.registry[e]=s,{success:!0,asyncInit:!1}}catch(s){return Xn(`Initialization of backend ${e} failed`),Xn(s.stack||s.message),{success:!1,asyncInit:!1}}}removeBackend(e){if(!(e in this.registryFactory))throw new Error(`${e} backend not found in registry`);this.backendName===e&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((e,n)=>this.registryFactory[n].priority-this.registryFactory[e].priority)}initializeBackendsAndReturnBest(){const e=this.getSortedBackends();for(let n=0;n<e.length;n++){const s=e[n],{success:r,asyncInit:i}=this.initializeBackend(s);if(i||r)return{name:s,asyncInit:i}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(e,n){const s=this.state.tensorInfo.get(n),r=s.backend,i=this.readSync(n),o=r.refCount(n);r.disposeData(n,!0),s.backend=e,e.move(n,i,s.shape,s.dtype,o),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(e,n){let s=null;if(n==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");n=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof n!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");s=e}let r;return this.scopedRun(()=>this.startScope(s),()=>this.endScope(r),()=>(r=n(),r instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),r))}scopedRun(e,n,s){e();try{const r=s();return n(),r}catch(r){throw n(),r}}nextTensorId(){return xl.nextTensorId++}nextVariableId(){return xl.nextVariableId++}clone(e){const n=z.runKernel(ed,{x:e}),s={x:e},r=o=>({x:()=>{const a="float32",l={x:o},c={dtype:a};return z.runKernel(Bu,l,c)}}),i=[];return this.addTapeNode(this.state.activeScope.name,s,[n],r,i,{}),n}runKernel(e,n,s){if(this.backendName==null&&this.backend,!(k0(e,this.backendName)!=null))throw new Error(`Kernel '${e}' not registered for backend '${this.backendName}'`);return this.runKernelFunc({kernelName:e,inputs:n,attrs:s})}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(e,n,s){const r=this.backend.numDataIds();let i=0;s.forEach(l=>{i+=l.dtype==="complex64"?3:1});const o=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],a=r-n-i-o;if(a>0)throw new Error(`Backend '${this.backendName}' has an internal memory leak (${a} data ids) after running '${e}'`)}runKernelFunc(e){let n,s=[];const r=this.isTapeOn(),i=this.state.numBytes,o=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);let a;this.backendName==null&&this.backend;let l;const c=Kg(e)?e.kernelName:this.state.activeScope!=null?this.state.activeScope.name:"";if(Kg(e)){const{kernelName:f,inputs:g,attrs:x}=e;this.backendName==null&&this.backend;const y=k0(f,this.backendName);T(y!=null,()=>`Cannot find registered kernel '${f}' for backend '${this.backendName}'`),a=()=>{const v=this.backend.numDataIds();l=y.kernelFunc({inputs:g,attrs:x,backend:this.backend});const b=Array.isArray(l)?l:[l];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(f,v,b);const w=b.map(k=>k.rank!=null?k:this.makeTensorFromTensorInfo(k));if(r){const k=this.getTensorsForGradient(f,g,w);s=this.saveTensorsForBackwardMode(k)}return w}}else{const{forwardFunc:f}=e,g=x=>{r&&(s=x.map(y=>this.keep(this.clone(y))))};a=()=>{const x=this.backend.numDataIds();l=this.tidy(()=>f(this.backend,g));const y=Array.isArray(l)?l:[l];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(c,x,y),y}}const{inputs:u,attrs:d}=e,h=Kg(e)?null:e.backwardsFunc;let p;return this.scopedRun(()=>this.state.kernelDepth++,()=>this.state.kernelDepth--,()=>{!this.ENV.getBool("DEBUG")&&!this.state.profiling?n=a():(p=this.profiler.profileKernel(c,u,()=>a()),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(p),n=p.outputs)}),r&&this.addTapeNode(c,u,n,h,s,d),this.state.profiling&&this.state.activeProfile.kernels.push({name:c,bytesAdded:this.state.numBytes-i,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-o,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(u).map(f=>u[f]!=null?u[f].shape:null),outputShapes:n.map(f=>f.shape),kernelTimeMs:p.timeMs,extraInfo:p.extraInfo}),Array.isArray(l)?n:n[0]}saveTensorsForBackwardMode(e){return e.map(s=>this.keep(this.clone(s)))}getTensorsForGradient(e,n,s){const r=ok(e);if(r!=null){const i=r.inputsToSave||[],o=r.outputsToSave||[];let a;r.saveAllInputs?(T(Array.isArray(n),()=>"saveAllInputs is true, expected inputs to be an array."),a=Object.keys(n).map(c=>n[c])):a=i.map(c=>n[c]);const l=s.filter((c,u)=>o[u]);return a.concat(l)}return[]}makeTensor(e,n,s,r){if(e==null)throw new Error("Values passed to engine.makeTensor() are null");s=s||"float32",r=r||this.backend;let i=e;s==="string"&&Du(e[0])&&(i=e.map(l=>ji(l)));const o=r.write(i,n,s),a=new Et(n,s,o,this.nextTensorId());if(this.trackTensor(a,r),s==="string"){const l=this.state.tensorInfo.get(o),c=fj(i);this.state.numBytes+=c-l.bytes,l.bytes=c}return a}makeTensorFromDataId(e,n,s,r){s=s||"float32";const i={dataId:e,shape:n,dtype:s};return this.makeTensorFromTensorInfo(i,r)}makeTensorFromTensorInfo(e,n){const{dataId:s,shape:r,dtype:i}=e,o=new Et(r,i,s,this.nextTensorId());return this.trackTensor(o,n),o}makeVariable(e,n=!0,s,r){s=s||this.nextVariableId().toString(),r!=null&&r!==e.dtype&&(e=e.cast(r));const i=new Mp(e,n,s,this.nextTensorId());if(this.state.registeredVariables[i.name]!=null)throw new Error(`Variable with name ${i.name} was already registered`);return this.state.registeredVariables[i.name]=i,this.incRef(i,this.backend),i}trackTensor(e,n){this.state.numTensors++,e.dtype==="string"&&this.state.numStringTensors++;let s=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(s=e.size*_p(e.dtype)),this.state.numBytes+=s,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:n||this.backend,dtype:e.dtype,shape:e.shape,bytes:s})),e instanceof Mp||this.track(e)}incRef(e,n){this.trackTensor(e,n),this.backend.incRef(e.dataId)}removeDataId(e,n){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===n&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)}disposeTensor(e){if(!this.state.tensorInfo.has(e.dataId))return;const n=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,e.dtype==="string"&&(this.state.numStringTensors--,this.state.numBytes-=n.bytes),e.dtype!=="complex64"&&e.dtype!=="string"){const s=e.size*_p(e.dtype);this.state.numBytes-=s}n.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,n.backend)}disposeVariables(){for(const e in this.state.registeredVariables){const n=this.state.registeredVariables[e];this.disposeVariable(n)}}disposeVariable(e){this.disposeTensor(e),this.state.registeredVariables[e.name]!=null&&delete this.state.registeredVariables[e.name]}memory(){const e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e}async profile(e){this.state.profiling=!0;const n=this.state.numBytes,s=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=await e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map(r=>r.totalBytesSnapshot)),this.state.activeProfile.newBytes=this.state.numBytes-n,this.state.activeProfile.newTensors=this.state.numTensors-s;for(const r of this.state.activeProfile.kernels)r.kernelTimeMs=await r.kernelTimeMs,r.extraInfo=await r.extraInfo;return this.state.activeProfile}isTapeOn(){return this.state.gradientDepth>0&&this.state.kernelDepth===0}addTapeNode(e,n,s,r,i,o){const a={id:this.state.nextTapeNodeId++,kernelName:e,inputs:n,outputs:s,saved:i},l=ok(e);l!=null&&(r=l.gradFunc),r!=null&&(a.gradient=c=>(c=c.map((u,d)=>{if(u==null){const h=s[d],p=nn(h.size,h.dtype);return this.makeTensor(p,h.shape,h.dtype)}return u}),r(c.length>1?c:c[0],i,o))),this.state.activeTape.push(a)}keep(e){return e.kept=!0,e}startTape(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(e){const n={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(n.name=e),this.state.scopeStack.push(n),this.state.activeScope=n}endScope(e){const n=iE(e),s=new Set(n.map(i=>i.id));for(let i=0;i<this.state.activeScope.track.length;i++){const o=this.state.activeScope.track[i];!o.kept&&!s.has(o.id)&&o.dispose()}const r=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],n.forEach(i=>{!i.kept&&i.scopeId===r.id&&this.track(i)})}gradients(e,n,s,r=!1){if(T(n.length>0,()=>"gradients() received an empty list of xs."),s!=null&&s.dtype!=="float32")throw new Error(`dy must have 'float32' dtype, but has '${s.dtype}'`);const i=this.scopedRun(()=>this.startTape(),()=>this.endTape(),()=>this.tidy("forward",e));T(i instanceof Et,()=>"The result y returned by f() must be a tensor.");const o=zj(this.state.activeTape,n,i);if(!r&&o.length===0&&n.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",()=>{const a={};a[i.id]=s??Kj(i.shape),jj(a,o,c=>this.tidy(c),qj);const l=n.map(c=>a[c.id]);return this.state.gradientDepth===0&&(this.state.activeTape.forEach(c=>{for(const u of c.saved)u.dispose()}),this.state.activeTape=null),{value:i,grads:l}})}customGrad(e){return T(g0(e),()=>"The f passed in customGrad(f) must be a function."),(...n)=>{T(n.every(a=>a instanceof Et),()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors");let s;const r={};n.forEach((a,l)=>{r[l]=a});const i=(a,l)=>(s=e(...n,l),T(s.value instanceof Et,()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"),T(g0(s.gradFunc),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."),s.value),o=(a,l)=>{const c=s.gradFunc(a,l),u=Array.isArray(c)?c:[c];T(u.length===n.length,()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."),T(u.every(h=>h instanceof Et),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors.");const d={};return u.forEach((h,p)=>{d[p]=()=>h}),d};return this.runKernelFunc({forwardFunc:i,backwardsFunc:o,inputs:r})}}readSync(e){return this.state.tensorInfo.get(e).backend.readSync(e)}read(e){return this.state.tensorInfo.get(e).backend.read(e)}readToGPU(e,n){return this.state.tensorInfo.get(e).backend.readToGPU(e,n)}async time(e){const n=kn(),s=await this.backend.time(e);return s.wallMs=kn()-n,s}track(e){return this.state.activeScope!=null&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new gk;for(const e in this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}xl.nextTensorId=0;xl.nextVariableId=0;function Kj(t){const e=m1(J(t),"float32");return z.makeTensor(e,t,"float32")}function aE(){const t=CT();if(t._tfengine==null){const e=new yj(t);t._tfengine=new xl(e)}return wj(t._tfengine.ENV),Vj(()=>t._tfengine),t._tfengine}const z=aE();function qj(t,e){const n={a:t,b:e};return z.runKernel(Ll,n)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xj(){return typeof navigator<"u"&&navigator!=null}function lE(t){if(t||Xj()){if(t||(t=navigator),t.product==="ReactNative")return!0;const e=t.userAgent||t.vendor||(typeof window<"u"?window.opera:"");if(!e){const n=t;return n.userAgentData&&n.userAgentData.mobile}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}return!1}function cE(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const En=q();En.registerFlag("DEBUG",()=>!1,t=>{t&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")});En.registerFlag("IS_BROWSER",()=>cE());En.registerFlag("IS_NODE",()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u");En.registerFlag("IS_CHROME",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor));En.registerFlag("IS_SAFARI",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Safari/.test(navigator.userAgent)&&/Apple/.test(navigator.vendor));En.registerFlag("PROD",()=>!1);En.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",()=>En.getBool("DEBUG"));En.registerFlag("DEPRECATION_WARNINGS_ENABLED",()=>!0);En.registerFlag("IS_TEST",()=>!1);En.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",()=>En.getBool("DEBUG"));En.registerFlag("WRAP_TO_IMAGEBITMAP",()=>!1);En.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",()=>!1);En.registerFlag("USE_SETTIMEOUTCUSTOM",()=>!1);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rd(t,e){let n=t;if(Is(t))return e==="string"?[]:[t.length];if(sE(t)){const r=t.channels||"RGBA";return[t.height,t.width*r.length]}else if(rE(t))return[t.buffer.size/(e==null?4:_p(e))];if(!Array.isArray(t))return[];const s=[];for(;Array.isArray(n)||Is(n)&&e!=="string";)s.push(n.length),n=n[0];return Array.isArray(t)&&q().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&uE(t,s,[]),s}function uE(t,e,n){if(n=n||[],!Array.isArray(t)&&!Is(t)){T(e.length===0,()=>`Element arr[${n.join("][")}] is a primitive, but should be an array/TypedArray of ${e[0]} elements`);return}T(e.length>0,()=>`Element arr[${n.join("][")}] should be a primitive, but is an array of ${t.length} elements`),T(t.length===e[0],()=>`Element arr[${n.join("][")}] should have ${e[0]} elements, but has ${t.length} elements`);const s=e.slice(1);for(let r=0;r<t.length;++r)uE(t[r],s,n.concat(r))}function yk(t,e,n,s){if(t!=="string_or_numeric"){if(t==null)throw new Error("Expected dtype cannot be null.");if(t!=="numeric"&&t!==e||t==="numeric"&&e==="string")throw new Error(`Argument '${n}' passed to '${s}' must be ${t} tensor, but got ${e} tensor`)}}function N(t,e,n,s="numeric"){if(t instanceof Y())return yk(s,t.dtype,e,n),t;let r=Pl(t);if(r!=="string"&&["bool","int32","float32"].indexOf(s)>=0&&(r=s),yk(s,r,e,n),t==null||!Is(t)&&!Array.isArray(t)&&typeof t!="number"&&typeof t!="boolean"&&typeof t!="string"){const l=t==null?"null":t.constructor.name;throw new Error(`Argument '${e}' passed to '${n}' must be a Tensor or TensorLike, but got '${l}'`)}const i=Rd(t,r);!Is(t)&&!Array.isArray(t)&&(t=[t]);const a=r!=="string"?pa(t,r):Ko(t,[],!0);return z.makeTensor(a,i,r)}function dE(t,e,n,s="numeric"){if(!Array.isArray(t))throw new Error(`Argument ${e} passed to ${n} must be a \`Tensor[]\` or \`TensorLike[]\``);return t.map((i,o)=>N(i,`${e}[${o}]`,n,s))}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yj="__op";function G(t){const e=Object.keys(t);if(e.length!==1)throw new Error(`Please provide an object with a single key (operation name) mapping to a function. Got an object with ${e.length} keys.`);let n=e[0];const s=t[n];n.endsWith("_")&&(n=n.substring(0,n.length-1)),n=n+Yj;const r=(...i)=>{z.startScope(n);try{const o=s(...i);return g1(o)&&console.error("Cannot return a Promise inside of tidy."),z.endScope(o),o}catch(o){throw z.endScope(null),o}};return Object.defineProperty(r,"name",{value:n,configurable:!0}),r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qj(t,e){const n=N(t,"real","complex"),s=N(e,"imag","complex");p1(n.shape,s.shape,`real and imag shapes, ${n.shape} and ${s.shape}, must match in call to tf.complex().`);const r={real:n,imag:s};return z.runKernel(I1,r)}const vl=G({complex_:Qj});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nd(t,e,n,s){if(s==null)s=Pl(t);else if(s==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(rE(t)||sE(t)){if(s!=="float32"&&s!=="int32")throw new Error(`Creating tensor from GPU data only supports 'float32'|'int32' dtype, while the dtype is ${s}.`);return z.backend.createTensorFromGPUData(t,e||n,s)}if(!Is(t)&&!Array.isArray(t)&&typeof t!="number"&&typeof t!="boolean"&&typeof t!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(e!=null){si(e);const r=J(e),i=J(n);T(r===i,()=>`Based on the provided shape, [${e}], the tensor should have ${r} values but has ${i}`);for(let o=0;o<n.length;++o){const a=n[o],l=o===n.length-1?a!==J(e.slice(o)):!0;T(n[o]===e[o]||!l,()=>`Error creating a new Tensor. Inferred shape (${n}) does not match the provided shape (${e}). `)}}return!Is(t)&&!Array.isArray(t)&&(t=[t]),e=e||n,t=s!=="string"?pa(t,s):Ko(t,[],!0),z.makeTensor(t,e,s)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hE(t,e,n){const s=Rd(t,n);return Nd(t,e,s,n)}class zl{static join(e){return new zl(e).slice()}constructor(e){if(this.shards=[],this.previousShardIndex=0,e==null||(e instanceof Array||(e=[e]),e=e.map(s=>Is(s)?s.buffer:s),e.length===0))return;this.bufferUniformSize=e[0].byteLength;let n=0;for(let s=0;s<e.length;s++){const r=e[s];s!==e.length-1&&r.byteLength!==this.bufferUniformSize&&(this.bufferUniformSize=void 0);const i=n+r.byteLength;this.shards.push({buffer:r,start:n,end:i}),n=i}this.shards.length===0&&(this.byteLength=0),this.byteLength=this.shards[this.shards.length-1].end}slice(e=0,n=this.byteLength){if(this.shards.length===0)return new ArrayBuffer(0);if(e=isNaN(Number(e))?0:e,n=isNaN(Number(n))?0:n,e=Math.max(0,e),n=Math.min(this.byteLength,n),n<=e)return new ArrayBuffer(0);const s=this.findShardForByte(e);if(s===-1)throw new Error(`Could not find start shard for byte ${e}`);const r=n-e,i=new ArrayBuffer(r),o=new Uint8Array(i);let a=0;for(let l=s;l<this.shards.length;l++){const c=this.shards[l],d=e+a-c.start,h=a,f=Math.min(n,c.end)-c.start,g=new Uint8Array(c.buffer,d,f-d);if(o.set(g,h),a+=g.length,n<c.end)break}return i}findShardForByte(e){if(this.shards.length===0||e<0||e>=this.byteLength)return-1;if(this.bufferUniformSize!=null)return this.previousShardIndex=Math.floor(e/this.bufferUniformSize),this.previousShardIndex;function n(r){return e<r.start?-1:e>=r.end?1:0}if(n(this.shards[this.previousShardIndex])===0)return this.previousShardIndex;const s=Jj(this.shards,n);return s===-1?-1:(this.previousShardIndex=s,this.previousShardIndex)}}function Jj(t,e){let n=0,s=t.length;for(;n<=s;){const r=Math.floor((s-n)/2)+n,i=e(t[r]);if(i===0)return r;i<0?s=r:n=r+1}return-1}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ir(){return z}function xk(){return z.memory()}function K(t,e){return z.tidy(t,e)}function Re(t){iE(t).forEach(n=>n.dispose())}function yr(t){return z.keep(t)}function Zj(t){return z.setBackend(t)}function eB(){return z.ready()}function pE(t,e,n=1){return z.registerBackend(t,e,n)}function tB(){return z.backend}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vk=4;async function bk(t,e){const n=[],s=[],r=Array.isArray(t)?t.map(o=>o.name):Object.keys(t);for(let o=0;o<r.length;++o){const a=r[o],l=Array.isArray(t)?t[o].tensor:t[a];if(l.dtype!=="float32"&&l.dtype!=="int32"&&l.dtype!=="bool"&&l.dtype!=="string"&&l.dtype!=="complex64")throw new Error(`Unsupported dtype in weight '${a}': ${l.dtype}`);const c={name:a,shape:l.shape,dtype:l.dtype};if(l.dtype==="string"){const u=new Promise(async d=>{const h=await l.bytes(),p=h.reduce((x,y)=>x+y.length,0)+vk*h.length,f=new Uint8Array(p);let g=0;for(let x=0;x<h.length;x++){const y=h[x],v=new Uint8Array(new Uint32Array([y.length]).buffer);f.set(v,g),g+=vk,f.set(y,g),g+=y.length}d(f)});s.push(u)}else s.push(l.data());e!=null&&(c.group=e),n.push(c)}const i=await Promise.all(s);return{data:nB(i),specs:n}}function nB(t){if(t===null)throw new Error(`Invalid input value: ${JSON.stringify(t)}`);let e=0;const n=[];t.forEach(i=>{if(e+=i.byteLength,n.push(i.byteLength===i.buffer.byteLength?i:new i.constructor(i)),!(i instanceof Float32Array||i instanceof Int32Array||i instanceof Uint8Array))throw new Error(`Unsupported TypedArray subtype: ${i.constructor.name}`)});const s=new Uint8Array(e);let r=0;return n.forEach(i=>{s.set(new Uint8Array(i.buffer),r),r+=i.byteLength}),s.buffer}const av=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function wk(t){return av?Buffer.byteLength(t,"utf8"):new Blob([t]).size}function sB(t){if(av)return Buffer.from(t).toString("base64");const e=new Uint8Array(t);let n="";for(let s=0,r=e.length;s<r;s++)n+=String.fromCharCode(e[s]);return btoa(n)}function rB(t){if(av){const s=Buffer.from(t,"base64");return s.buffer.slice(s.byteOffset,s.byteOffset+s.byteLength)}const e=atob(t),n=new Uint8Array(e.length);for(let s=0;s<e.length;++s)n.set([e.charCodeAt(s)],s);return n.buffer}function iB(t){return zl.join(t)}function fE(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:t.modelTopology==null?0:wk(JSON.stringify(t.modelTopology)),weightSpecsBytes:t.weightSpecs==null?0:wk(JSON.stringify(t.weightSpecs)),weightDataBytes:t.weightData==null?0:new zl(t.weightData).byteLength}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class dn{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return dn.instance==null&&(dn.instance=new dn),dn.instance}static registerSaveRouter(e){dn.getInstance().saveRouters.push(e)}static registerLoadRouter(e){dn.getInstance().loadRouters.push(e)}static getSaveHandlers(e){return dn.getHandlers(e,"save")}static getLoadHandlers(e,n){return dn.getHandlers(e,"load",n)}static getHandlers(e,n,s){const r=[];return(n==="load"?dn.getInstance().loadRouters:dn.getInstance().saveRouters).forEach(o=>{const a=o(e,s);a!==null&&r.push(a)}),r}}const oB=t=>dn.getSaveHandlers(t);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const R0="tensorflowjs",N0=1,No="models_store",Ii="model_info_store";function mE(){if(!q().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");const t=typeof window>"u"?self:window,e=t.indexedDB||t.mozIndexedDB||t.webkitIndexedDB||t.msIndexedDB||t.shimIndexedDB;if(e==null)throw new Error("The current browser does not appear to support IndexedDB.");return e}function A0(t){const e=t.result;e.createObjectStore(No,{keyPath:"modelPath"}),e.createObjectStore(Ii,{keyPath:"modelPath"})}class qo{constructor(e){if(this.indexedDB=mE(),e==null||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,e)}async load(){return this.databaseAction(this.modelPath)}databaseAction(e,n){return new Promise((s,r)=>{const i=this.indexedDB.open(R0,N0);i.onupgradeneeded=()=>A0(i),i.onsuccess=()=>{const o=i.result;if(n==null){const a=o.transaction(No,"readonly"),c=a.objectStore(No).get(this.modelPath);c.onsuccess=()=>{if(c.result==null)return o.close(),r(new Error(`Cannot find model with path '${this.modelPath}' in IndexedDB.`));s(c.result.modelArtifacts)},c.onerror=u=>(o.close(),r(c.error)),a.oncomplete=()=>o.close()}else{n.weightData=zl.join(n.weightData);const a=fE(n),l=o.transaction(Ii,"readwrite");let c=l.objectStore(Ii),u;try{u=c.put({modelPath:this.modelPath,modelArtifactsInfo:a})}catch(h){return r(h)}let d;u.onsuccess=()=>{d=o.transaction(No,"readwrite");const h=d.objectStore(No);let p;try{p=h.put({modelPath:this.modelPath,modelArtifacts:n,modelArtifactsInfo:a})}catch(f){return r(f)}p.onsuccess=()=>s({modelArtifactsInfo:a}),p.onerror=f=>{c=l.objectStore(Ii);const g=c.delete(this.modelPath);g.onsuccess=()=>(o.close(),r(p.error)),g.onerror=x=>(o.close(),r(p.error))}},u.onerror=h=>(o.close(),r(u.error)),l.oncomplete=()=>{d==null?o.close():d.oncomplete=()=>o.close()}}},i.onerror=o=>r(i.error)})}}qo.URL_SCHEME="indexeddb://";const gE=t=>q().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(qo.URL_SCHEME)?aB(t.slice(qo.URL_SCHEME.length)):null;dn.registerSaveRouter(gE);dn.registerLoadRouter(gE);function aB(t){return new qo(t)}function lB(t){return t.startsWith(qo.URL_SCHEME)?t.slice(qo.URL_SCHEME.length):t}class cB{constructor(){this.indexedDB=mE()}async listModels(){return new Promise((e,n)=>{const s=this.indexedDB.open(R0,N0);s.onupgradeneeded=()=>A0(s),s.onsuccess=()=>{const r=s.result,i=r.transaction(Ii,"readonly"),a=i.objectStore(Ii).getAll();a.onsuccess=()=>{const l={};for(const c of a.result)l[c.modelPath]=c.modelArtifactsInfo;e(l)},a.onerror=l=>(r.close(),n(a.error)),i.oncomplete=()=>r.close()},s.onerror=r=>n(s.error)})}async removeModel(e){return e=lB(e),new Promise((n,s)=>{const r=this.indexedDB.open(R0,N0);r.onupgradeneeded=()=>A0(r),r.onsuccess=()=>{const i=r.result,o=i.transaction(Ii,"readwrite"),a=o.objectStore(Ii),l=a.get(e);let c;l.onsuccess=()=>{if(l.result==null)return i.close(),s(new Error(`Cannot find model with path '${e}' in IndexedDB.`));{const u=a.delete(e),d=()=>{c=i.transaction(No,"readwrite");const p=c.objectStore(No).delete(e);p.onsuccess=()=>n(l.result.modelArtifactsInfo),p.onerror=f=>s(l.error)};u.onsuccess=d,u.onerror=h=>(d(),i.close(),s(l.error))}},l.onerror=u=>(i.close(),s(l.error)),o.oncomplete=()=>{c==null?i.close():c.oncomplete=()=>i.close()}},r.onerror=i=>s(r.error)})}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Dr="/",Ra="tensorflowjs_models",yE="info",uB="model_topology",dB="weight_specs",hB="weight_data",pB="model_metadata";function xE(t){return{info:[Ra,t,yE].join(Dr),topology:[Ra,t,uB].join(Dr),weightSpecs:[Ra,t,dB].join(Dr),weightData:[Ra,t,hB].join(Dr),modelMetadata:[Ra,t,pB].join(Dr)}}function vE(t){for(const e of Object.values(t))window.localStorage.removeItem(e)}function fB(t){const e=t.split(Dr);if(e.length<3)throw new Error(`Invalid key format: ${t}`);return e.slice(1,e.length-1).join(Dr)}function mB(t){return t.startsWith(Xo.URL_SCHEME)?t.slice(Xo.URL_SCHEME.length):t}class Xo{constructor(e){if(!q().getBool("IS_BROWSER")||typeof window>"u"||typeof window.localStorage>"u")throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,e==null||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=xE(this.modelPath)}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{const n=JSON.stringify(e.modelTopology),s=JSON.stringify(e.weightSpecs),r=fE(e),i=zl.join(e.weightData);try{this.LS.setItem(this.keys.info,JSON.stringify(r)),this.LS.setItem(this.keys.topology,n),this.LS.setItem(this.keys.weightSpecs,s),this.LS.setItem(this.keys.weightData,sB(i));const o={format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,signature:e.signature!=null?e.signature:void 0,userDefinedMetadata:e.userDefinedMetadata!=null?e.userDefinedMetadata:void 0,modelInitializer:e.modelInitializer!=null?e.modelInitializer:void 0,initializerSignature:e.initializerSignature!=null?e.initializerSignature:void 0,trainingConfig:e.trainingConfig!=null?e.trainingConfig:void 0};return this.LS.setItem(this.keys.modelMetadata,JSON.stringify(o)),{modelArtifactsInfo:r}}catch{throw vE(this.keys),new Error(`Failed to save model '${this.modelPath}' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=${r.modelTopologyBytes}, weightSpecsBytes=${r.weightSpecsBytes}, weightDataBytes=${r.weightDataBytes}.`)}}}async load(){const e=JSON.parse(this.LS.getItem(this.keys.info));if(e==null)throw new Error(`In local storage, there is no model with name '${this.modelPath}'`);if(e.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");const n={},s=JSON.parse(this.LS.getItem(this.keys.topology));if(s==null)throw new Error(`In local storage, the topology of model '${this.modelPath}' is missing.`);n.modelTopology=s;const r=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(r==null)throw new Error(`In local storage, the weight specs of model '${this.modelPath}' are missing.`);n.weightSpecs=r;const i=this.LS.getItem(this.keys.modelMetadata);if(i!=null){const a=JSON.parse(i);n.format=a.format,n.generatedBy=a.generatedBy,n.convertedBy=a.convertedBy,a.signature!=null&&(n.signature=a.signature),a.userDefinedMetadata!=null&&(n.userDefinedMetadata=a.userDefinedMetadata),a.modelInitializer!=null&&(n.modelInitializer=a.modelInitializer),a.initializerSignature!=null&&(n.initializerSignature=a.initializerSignature),a.trainingConfig!=null&&(n.trainingConfig=a.trainingConfig)}const o=this.LS.getItem(this.keys.weightData);if(o==null)throw new Error(`In local storage, the binary weight values of model '${this.modelPath}' are missing.`);return n.weightData=rB(o),n}}Xo.URL_SCHEME="localstorage://";const bE=t=>q().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(Xo.URL_SCHEME)?gB(t.slice(Xo.URL_SCHEME.length)):null;dn.registerSaveRouter(bE);dn.registerLoadRouter(bE);function gB(t){return new Xo(t)}class yB{constructor(){T(q().getBool("IS_BROWSER"),()=>"Current environment is not a web browser"),T(typeof window>"u"||typeof window.localStorage<"u",()=>"Current browser does not appear to support localStorage"),this.LS=window.localStorage}async listModels(){const e={},n=Ra+Dr,s=Dr+yE;for(let r=0;r<this.LS.length;++r){const i=this.LS.key(r);if(i.startsWith(n)&&i.endsWith(s)){const o=fB(i);e[o]=JSON.parse(this.LS.getItem(i))}}return e}async removeModel(e){e=mB(e);const n=xE(e);if(this.LS.getItem(n.info)==null)throw new Error(`Cannot find model at path '${e}'`);const s=JSON.parse(this.LS.getItem(n.info));return vE(n),s}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kk="://";class or{constructor(){this.managers={}}static getInstance(){return or.instance==null&&(or.instance=new or),or.instance}static registerManager(e,n){T(e!=null,()=>"scheme must not be undefined or null."),e.endsWith(kk)&&(e=e.slice(0,e.indexOf(kk))),T(e.length>0,()=>"scheme must not be an empty string.");const s=or.getInstance();T(s.managers[e]==null,()=>`A model store manager is already registered for scheme '${e}'.`),s.managers[e]=n}static getManager(e){const n=or.getInstance().managers[e];if(n==null)throw new Error(`Cannot find model manager for scheme '${e}'`);return n}static getSchemes(){return Object.keys(or.getInstance().managers)}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class xB{constructor(){this.messageName="setTimeoutCustom",this.functionRefs=[],this.handledMessageCount=0,this.hasEventListener=!1}fetch(e,n){return fetch(e,n)}now(){return performance.now()}encode(e,n){if(n!=="utf-8"&&n!=="utf8")throw new Error(`Browser's encoder only supports utf-8, but got ${n}`);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)}decode(e,n){return new TextDecoder(n).decode(e)}setTimeoutCustom(e,n){if(typeof window>"u"||!q().getBool("USE_SETTIMEOUTCUSTOM")){setTimeout(e,n);return}this.functionRefs.push(e),setTimeout(()=>{window.postMessage({name:this.messageName,index:this.functionRefs.length-1},"*")},n),this.hasEventListener||(this.hasEventListener=!0,window.addEventListener("message",s=>{if(s.source===window&&s.data.name===this.messageName){s.stopPropagation();const r=this.functionRefs[s.data.index];r(),this.handledMessageCount++,this.handledMessageCount===this.functionRefs.length&&(this.functionRefs=[],this.handledMessageCount=0)}},!0))}isTypedArray(e){return KT(e)}}if(q().get("IS_BROWSER")){q().setPlatform("browser",new xB);try{or.registerManager(Xo.URL_SCHEME,new yB)}catch{}try{or.registerManager(qo.URL_SCHEME,new cB)}catch{}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vB={importFetch:()=>require("node-fetch")};let qg;class bB{constructor(){this.util=require("util"),this.textEncoder=new this.util.TextEncoder}fetch(e,n){return q().global.fetch!=null?q().global.fetch(e,n):(qg==null&&(qg=vB.importFetch()),qg(e,n))}now(){const e=process.hrtime();return e[0]*1e3+e[1]/1e6}encode(e,n){if(n!=="utf-8"&&n!=="utf8")throw new Error(`Node built-in encoder only supports utf-8, but got ${n}`);return this.textEncoder.encode(e)}decode(e,n){return e.length===0?"":new this.util.TextDecoder(n).decode(e)}isTypedArray(e){return this.util.types.isFloat32Array(e)||this.util.types.isInt32Array(e)||this.util.types.isUint8Array(e)||this.util.types.isUint8ClampedArray(e)}}q().get("IS_NODE")&&!q().get("IS_BROWSER")&&q().setPlatform("node",new bB);/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $e(t,e="float32",n){return e=e||"float32",si(t),new Kt(t,e,n)}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wB(t,e){const n=N(t,"x","cast");if(!pj(e))throw new Error(`Failed to cast to unknown dtype ${e}`);if(e==="string"&&n.dtype!=="string"||e!=="string"&&n.dtype==="string")throw new Error("Only strings can be casted to strings");const s={x:n},r={dtype:e};return z.runKernel(Bu,s,r)}const de=G({cast_:wB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kB(t){const n={x:N(t,"x","clone","string_or_numeric")};return z.runKernel(ed,n)}const Fo=G({clone_:kB});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CB(t,e=!1){console.log(t.toString(e))}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */aE();const SB={buffer:$e,cast:de,clone:Fo,print:CB};Uj(SB);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IB(t,e){let n=N(t,"a","add"),s=N(e,"b","add");[n,s]=bt(n,s);const r={a:n,b:s};return z.runKernel(Ll,r)}const re=G({add_:IB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $B(t,e){let n=N(t,"a","floorDiv"),s=N(e,"b","floorDiv");[n,s]=bt(n,s);const r={a:n,b:s};return z.runKernel(Ju,r)}const wE=G({floorDiv_:$B});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TB(t,e){let n=N(t,"a","div"),s=N(e,"b","div");if([n,s]=bt(n,s),n.dtype==="int32"&&s.dtype==="int32")return wE(n,s);const r={a:n,b:s},i={};return z.runKernel(Hu,r,i)}const ye=G({div_:TB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EB(t,e){let n=N(t,"a","mul"),s=N(e,"b","mul");[n,s]=bt(n,s);const r={a:n,b:s};return z.runKernel(cd,r)}const L=G({mul_:EB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RB(t){const e=N(t,"x","abs");if(e.dtype==="complex64"){const n={x:e};return z.runKernel(Bf,n)}else{const n={x:e};return z.runKernel(Ff,n)}}const hn=G({abs_:RB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NB(t){const n={x:N(t,"x","acos")};return z.runKernel(Fu,n)}const AB=G({acos_:NB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _B(t){const n={x:N(t,"x","acosh")};return z.runKernel(Ou,n)}const DB=G({acosh_:_B});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FB(t,e=null,n=!1){const r={x:N(t,"x","all","bool")},i={axis:e,keepDims:n};return z.runKernel(v1,r,i)}const kE=G({all_:FB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OB(t,e=null,n=!1){const r={x:N(t,"x","any","bool")},i={axis:e,keepDims:n};return z.runKernel(b1,r,i)}const _0=G({any_:OB});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PB(t,e=0){const s={x:N(t,"x","argMax")},r={axis:e};return z.runKernel(Of,s,r)}const lu=G({argMax_:PB});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MB(t,e=0){const s={x:N(t,"x","argMin")},r={axis:e};return z.runKernel(Pf,s,r)}const LB=G({argMin_:MB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zB(t){const n={x:N(t,"x","asin")};return z.runKernel(Pu,n)}const jB=G({asin_:zB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BB(t){const n={x:N(t,"x","asinh")};return z.runKernel(Mu,n)}const WB=G({asinh_:BB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VB(t){const n={x:N(t,"x","atan")};return z.runKernel(Lu,n)}const UB=G({atan_:VB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GB(t,e){let n=N(t,"a","atan2"),s=N(e,"b","atan2");[n,s]=bt(n,s);const r={a:n,b:s};return z.runKernel(ju,r)}const HB=G({atan2_:GB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KB(t){const n={x:N(t,"x","atanh")};return z.runKernel(zu,n)}const qB=G({atanh_:KB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ad(t,e,n,s,r="NHWC",i){const o=t[3],a=[...e,o],l=ii(r);return qt(t,a,n,i,s,null,null,l)}function Ts(t,e,n,s,r,i,o="channelsLast"){const[a,l]=cu(e);let c;if(o==="channelsLast")c=[a,l,t[3],t[3]];else if(o==="channelsFirst")c=[a,l,t[1],t[1]];else throw new Error(`Unknown dataFormat ${o}`);return qt(t,c,n,s,r,i,!1,o)}function ri(t,e,n,s,r,i,o="NDHWC"){const[a,l,c]=D0(e);let u,d;if(o==="NDHWC")d="channelsLast",u=[a,l,c,t[4],t[4]];else if(o==="NCDHW")d="channelsFirst",u=[a,l,c,t[1],t[1]];else throw new Error(`Unknown dataFormat ${o}`);return io(t,u,n,s,r,!1,d,i)}function qt(t,e,n,s,r,i,o=!1,a="channelsLast"){let[l,c,u,d]=[-1,-1,-1,-1];if(a==="channelsLast")[l,c,u,d]=t;else if(a==="channelsFirst")[l,d,c,u]=t;else throw new Error(`Unknown dataFormat ${a}`);const[h,p,,f]=e,[g,x]=cu(n),[y,v]=cu(s),b=nl(h,y),w=nl(p,v),{padInfo:k,outHeight:S,outWidth:I}=QB(r,c,u,g,x,b,w,i,a),C=o?f*d:f;let $;return a==="channelsFirst"?$=[l,C,S,I]:a==="channelsLast"&&($=[l,S,I,C]),{batchSize:l,dataFormat:a,inHeight:c,inWidth:u,inChannels:d,outHeight:S,outWidth:I,outChannels:C,padInfo:k,strideHeight:g,strideWidth:x,filterHeight:h,filterWidth:p,effectiveFilterHeight:b,effectiveFilterWidth:w,dilationHeight:y,dilationWidth:v,inShape:t,outShape:$,filterShape:e}}function io(t,e,n,s,r,i=!1,o="channelsLast",a){let[l,c,u,d,h]=[-1,-1,-1,-1,-1];if(o==="channelsLast")[l,c,u,d,h]=t;else if(o==="channelsFirst")[l,h,c,u,d]=t;else throw new Error(`Unknown dataFormat ${o}`);const[p,f,g,,x]=e,[y,v,b]=D0(n),[w,k,S]=D0(s),I=nl(p,w),C=nl(f,k),$=nl(g,S),{padInfo:R,outDepth:_,outHeight:M,outWidth:B}=JB(r,c,u,d,y,v,b,I,C,$,a),A=i?x*h:x;let F;return o==="channelsFirst"?F=[l,A,_,M,B]:o==="channelsLast"&&(F=[l,_,M,B,A]),{batchSize:l,dataFormat:o,inDepth:c,inHeight:u,inWidth:d,inChannels:h,outDepth:_,outHeight:M,outWidth:B,outChannels:A,padInfo:R,strideDepth:y,strideHeight:v,strideWidth:b,filterDepth:p,filterHeight:f,filterWidth:g,effectiveFilterDepth:I,effectiveFilterHeight:C,effectiveFilterWidth:$,dilationDepth:w,dilationHeight:k,dilationWidth:S,inShape:t,outShape:F,filterShape:e}}function XB(t,e,n,s,r){s==null&&(s=lv(t,e,n));const i=t[0],o=t[1],a=uu((i-e+2*s)/n+1,r),l=uu((o-e+2*s)/n+1,r);return[a,l]}function YB(t,e,n,s,r,i){r==null&&(r=lv(t,e[0],s[0]));const o=[0,0,0,n];for(let a=0;a<3;a++)t[a]+2*r>=e[a]&&(o[a]=uu((t[a]-e[a]+2*r)/s[a]+1,i));return o}function lv(t,e,n,s=1){const r=nl(e,s);return Math.floor((t[0]*(n-1)-n+r)/2)}function cu(t){return typeof t=="number"?[t,t,t]:t.length===2?[t[0],t[1],1]:t}function D0(t){return typeof t=="number"?[t,t,t]:t}function nl(t,e){return e<=1?t:t+(t-1)*(e-1)}function QB(t,e,n,s,r,i,o,a,l){let c,u,d;if(typeof t=="number"){c={top:t,bottom:t,left:t,right:t,type:t===0?"VALID":"NUMBER"};const p=XB([e,n],i,s,t,a);u=p[0],d=p[1]}else if(t==="same"){u=Math.ceil(e/s),d=Math.ceil(n/r);const h=Math.max(0,(u-1)*s+i-e),p=Math.max(0,(d-1)*r+o-n),f=Math.floor(h/2),g=h-f,x=Math.floor(p/2),y=p-x;c={top:f,bottom:g,left:x,right:y,type:"SAME"}}else if(t==="valid")c={top:0,bottom:0,left:0,right:0,type:"VALID"},u=Math.ceil((e-i+1)/s),d=Math.ceil((n-o+1)/r);else if(typeof t=="object"){const h=l==="channelsLast"?t[1][0]:t[2][0],p=l==="channelsLast"?t[1][1]:t[2][1],f=l==="channelsLast"?t[2][0]:t[3][0],g=l==="channelsLast"?t[2][1]:t[3][1];c={top:h,bottom:p,left:f,right:g,type:h===0&&p===0&&f===0&&g===0?"VALID":"EXPLICIT"},u=uu((e-i+h+p)/s+1,a),d=uu((n-o+f+g)/r+1,a)}else throw Error(`Unknown padding parameter: ${t}`);return{padInfo:c,outHeight:u,outWidth:d}}function JB(t,e,n,s,r,i,o,a,l,c,u){let d,h,p,f;if(t==="valid"&&(t=0),typeof t=="number"){d={top:t,bottom:t,left:t,right:t,front:t,back:t,type:t===0?"VALID":"NUMBER"};const x=YB([e,n,s,1],[a,l,c],1,[r,i,o],t,u);h=x[0],p=x[1],f=x[2]}else if(t==="same"){h=Math.ceil(e/r),p=Math.ceil(n/i),f=Math.ceil(s/o);const g=(h-1)*r+a-e,x=(p-1)*i+l-n,y=(f-1)*o+c-s,v=Math.floor(g/2),b=g-v,w=Math.floor(x/2),k=x-w,S=Math.floor(y/2),I=y-S;d={top:w,bottom:k,left:S,right:I,front:v,back:b,type:"SAME"}}else throw Error(`Unknown padding parameter: ${t}`);return{padInfo:d,outDepth:h,outHeight:p,outWidth:f}}function uu(t,e){if(!e)return Math.trunc(t);switch(e){case"round":return Math.round(t);case"ceil":return Math.ceil(t);case"floor":return Math.floor(t);default:throw new Error(`Unknown roundingMode ${e}`)}}function Yo(t){const[e,n,s]=cu(t);return e===1&&n===1&&s===1}function rn(t,e){return Yo(t)||Yo(e)}function Qo(t){return cu(t).every(e=>e>0)}function ii(t){if(t==="NHWC")return"channelsLast";if(t==="NCHW")return"channelsFirst";throw new Error(`Unknown dataFormat ${t}`)}function _n(t,e,n){if(n!=null){if(typeof e=="string")throw Error(`Error in ${t}: pad must be an integer when using dimRoundingMode ${n} but got pad ${e}.`);if(typeof e=="number")T(gl(e),()=>`Error in ${t}: pad must be an integer when using dimRoundingMode ${n} but got pad ${e}.`);else if(typeof e=="object")e.forEach(s=>{s.forEach(r=>{T(gl(r),()=>`Error in ${t}: pad must be an integer when using dimRoundingMode ${n} but got pad ${r}.`)})});else throw Error(`Error in ${t}: Unknown padding parameter: ${e}`)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZB(t,e){const s={x:N(t,"x","reshape","string_or_numeric")},r={shape:e};return z.runKernel(wm,s,r)}const U=G({reshape_:ZB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function e6(t,e,n,s,r){const i=N(t,"x","avgPool","float32"),o=1;T(rn(n,o),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${n} and dilations '${o}'`);let a=i,l=!1;i.rank===3&&(l=!0,a=U(i,[1,i.shape[0],i.shape[1],i.shape[2]])),T(a.rank===4,()=>`Error in avgPool: x must be rank 4 but got rank ${a.rank}.`),_n("avgPool",s,r);const c={x:a},u={filterSize:e,strides:n,pad:s,dimRoundingMode:r};let d=z.runKernel(Mf,c,u);return d=de(d,i.dtype),l?U(d,[d.shape[1],d.shape[2],d.shape[3]]):d}const cv=G({avgPool_:e6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function t6(t,e,n,s,r,i="NDHWC"){const o=N(t,"x","avgPool3d","float32");let a=o,l=!1;o.rank===4&&(l=!0,a=U(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),T(a.rank===5,()=>`Error in avgPool3d: x must be rank 5 but got rank ${a.rank}.`),T(i==="NDHWC",()=>`Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of ${i}`),T(typeof n=="number"&&n>0||Array.isArray(n)&&n[0]>0&&n[1]>0&&n[2]>0,()=>`Error in avgPool3d: Stride must be > 0, but got '${n}'`),_n("avgPool3d",s,r);const c={x:a},u={filterSize:e,strides:n,pad:s,dimRoundingMode:r,dataFormat:i};let d=z.runKernel(Lf,c,u);return d=de(d,a.dtype),l?U(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}const n6=G({avgPool3d_:t6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function s6(t,e=0){T(t.length>=1,()=>"Pass at least one tensor to concat");const n=dE(t,"tensors","concat","string_or_numeric");if(n[0].dtype==="complex64"&&n.forEach(i=>{if(i.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype ${i.dtype}. `)}),n.length===1)return Fo(n[0]);const s=n,r={axis:e};return z.runKernel(Wf,s,r)}const $n=G({concat_:s6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function r6(t,e,n=!1,s=!1){let r=N(t,"a","matMul"),i=N(e,"b","matMul");[r,i]=bt(r,i);const o={a:r,b:i},a={transposeA:n,transposeB:s};return z.runKernel(zf,o,a)}const Le=G({matMul_:r6});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function i6(t){const n={x:N(t,"x","sigmoid","float32")};return z.runKernel(bd,n)}const jl=G({sigmoid_:i6});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function o6(t,e,n){const s=N(t,"x","slice","string_or_numeric");if(s.rank===0)throw new Error("Slicing scalar is not possible");const r={x:s},i={begin:e,size:n};return z.runKernel($m,r,i)}const Qe=G({slice_:o6});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function a6(t){const n={x:N(t,"x","tanh","float32")};return z.runKernel($d,n)}const Om=G({tanh_:a6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function l6(t,e,n){const s=N(t,"x","batchToSpaceND"),r=e.reduce((a,l)=>a*l);T(s.rank>=1+e.length,()=>`input rank is ${s.rank} but should be > than blockShape.length ${e.length}`),T(n.length===e.length,()=>`crops.length is ${n.length} but should be equal to blockShape.length  ${e.length}`),T(s.shape[0]%r===0,()=>`input tensor batch is ${s.shape[0]} but is not divisible by the product of the elements of blockShape ${e.join(" * ")} === ${r}`);const i={x:s},o={blockShape:e,crops:n};return z.runKernel(jf,i,o)}const uv=G({batchToSpaceND_:l6});function c6(t){let e;return t.rank===0||t.rank===1?e=U(t,[1,1,1,t.size]):t.rank===2?e=U(t,[1,1,t.shape[0],t.shape[1]]):t.rank===3?e=U(t,[1,t.shape[0],t.shape[1],t.shape[2]]):e=t,e}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function u6(t,e,n,s,r,i){i==null&&(i=.001);const o=N(t,"x","batchNorm"),a=N(e,"mean","batchNorm"),l=N(n,"variance","batchNorm");let c;r!=null&&(c=N(r,"scale","batchNorm"));let u;s!=null&&(u=N(s,"offset","batchNorm")),T(a.rank===l.rank,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),T(u==null||a.rank===u.rank,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),T(c==null||a.rank===c.rank,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");const h={x:c6(o),scale:c,offset:u,mean:a,variance:l},p={varianceEpsilon:i},f=z.runKernel(Qf,h,p);return U(f,o.shape)}const Pm=G({batchNorm_:u6});function d6(t,e,n,s,r,i){const o=N(t,"x","batchNorm"),a=N(e,"mean","batchNorm"),l=N(n,"variance","batchNorm");let c;r!=null&&(c=N(r,"scale","batchNorm"));let u;return s!=null&&(u=N(s,"offset","batchNorm")),T(o.rank===2,()=>`Error in batchNorm2D: x must be rank 2 but got rank ${o.rank}.`),T(a.rank===2||a.rank===1,()=>`Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank ${a.rank}.`),T(l.rank===2||l.rank===1,()=>`Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank ${l.rank}.`),c!=null&&T(c.rank===2||c.rank===1,()=>`Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank ${c.rank}.`),u!=null&&T(u.rank===2||u.rank===1,()=>`Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank ${u.rank}.`),Pm(o,a,l,u,c,i)}const h6=G({batchNorm2d_:d6});function p6(t,e,n,s,r,i){const o=N(t,"x","batchNorm"),a=N(e,"mean","batchNorm"),l=N(n,"variance","batchNorm");let c;r!=null&&(c=N(r,"scale","batchNorm"));let u;return s!=null&&(u=N(s,"offset","batchNorm")),T(o.rank===3,()=>`Error in batchNorm3D: x must be rank 3 but got rank ${o.rank}.`),T(a.rank===3||a.rank===1,()=>`Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank ${a.rank}.`),T(l.rank===3||l.rank===1,()=>`Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank ${l.rank}.`),c!=null&&T(c.rank===3||c.rank===1,()=>`Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank ${c.rank}.`),u!=null&&T(u.rank===3||u.rank===1,()=>`Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank ${u.rank}.`),Pm(o,a,l,u,c,i)}const f6=G({batchNorm3d_:p6});function m6(t,e,n,s,r,i){const o=N(t,"x","batchNorm"),a=N(e,"mean","batchNorm"),l=N(n,"variance","batchNorm");let c;r!=null&&(c=N(r,"scale","batchNorm"));let u;return s!=null&&(u=N(s,"offset","batchNorm")),T(o.rank===4,()=>`Error in batchNorm4D: x must be rank 4 but got rank ${o.rank}.`),T(a.rank===4||a.rank===1,()=>`Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank ${a.rank}.`),T(l.rank===4||l.rank===1,()=>`Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank ${l.rank}.`),c!=null&&T(c.rank===4||c.rank===1,()=>`Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank ${c.rank}.`),u!=null&&T(u.rank===4||u.rank===1,()=>`Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank ${u.rank}.`),Pm(o,a,l,u,c,i)}const g6=G({batchNorm4d_:m6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function y6(t,e,n){const s=N(t,"x","bincount"),r=N(e,"weights","bincount");T(s.dtype==="int32",()=>`Error in bincount: input dtype must be int32, but got ${s.dtype}`),T(n>=0,()=>`size must be non-negative, but got ${n}.`),T(r.size===s.size||r.size===0,()=>`Error in bincount: weights must have the same size as input or0-length, but got input shape: ${s.shape}, weights shape: ${r.shape}.`);const i={x:s,weights:r},o={size:n};return z.runKernel(C1,i,o)}const x6=G({bincount_:y6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function v6(t,e){let n=N(t,"broadcastTo","x");const s=n.shape;if(si(e),e.length<n.rank)throw new Error(`broadcastTo(): shape.length=${e.length} < input.rank=${n.rank}.`);if(e.length>n.rank){const c=n.shape.slice();for(;c.length<e.length;)c.unshift(1);n=U(n,c)}const r=n.shape,i=Array.from(e);for(let c=e.length-1;c>=0;c--)if(r[c]===e[c])i[c]=1;else if(n.shape[c]!==1)throw new Error(`broadcastTo(): [${s}] cannot be broadcast to [${e}].`);if(i.map((c,u)=>c>1?u:-1).filter(c=>c>=0).length===0)return Fo(n);const a={x:n},l={reps:i};return z.runKernel(Td,a,l)}const Mc=G({broadcastTo_:v6});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function b6(t){const n={x:N(t,"x","ceil","float32")};return z.runKernel(Wu,n)}const w6=G({ceil_:b6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mm(t,e,n){si(t),n=n||Pl(e);const s={shape:t,value:e,dtype:n};return z.runKernel(L1,{},s)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function k6(t,e,n){const s=N(t,"x","clipByValue");if(T(e<=n,()=>`Error in clip: min (${e}) must be less than or equal to max (${n}).`),e===n)return Mm(s.shape,e,s.dtype);const r={x:s},i={clipValueMin:e,clipValueMax:n};return z.runKernel(Vu,r,i)}const ss=G({clipByValue_:k6});function C6(t){return $n(t,0)}const S6=G({concat1d_:C6});function I6(t,e){return $n(t,e)}const $6=G({concat2d_:I6});function T6(t,e){return $n(t,e)}const E6=G({concat3d_:T6});function R6(t,e){return $n(t,e)}const N6=G({concat4d_:R6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function A6(t,e,n,s,r="NHWC",i=[1,1],o){const a=N(t,"x","conv2d","float32"),l=N(e,"filter","conv2d","float32");let c=a,u=!1;a.rank===3&&(u=!0,c=U(a,[1,a.shape[0],a.shape[1],a.shape[2]])),T(c.rank===4,()=>`Error in conv2d: input must be rank 4, but got rank ${c.rank}.`),T(l.rank===4,()=>`Error in conv2d: filter must be rank 4, but got rank ${l.rank}.`),_n("conv2d",s,o);const d=r==="NHWC"?c.shape[3]:c.shape[1];T(d===l.shape[2],()=>`Error in conv2d: depth of input (${d}) must match input depth for filter ${l.shape[2]}.`),T(rn(n,i),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${n} and dilations '${i}'`),T(Qo(i),()=>"Error in conv2D: Dilated rates should be larger than 0."),T(Qo(n),()=>"Error in conv2D: Strides should be larger than 0.");const h={x:c,filter:l},p={strides:n,pad:s,dataFormat:r,dilations:i,dimRoundingMode:o},f=z.runKernel(Vf,h,p);return u?U(f,[f.shape[1],f.shape[2],f.shape[3]]):f}const Jo=G({conv2d_:A6});function _6(t,e,n,s,r="NWC",i=1,o){const a=N(t,"x","conv1d"),l=N(e,"filter","conv1d");let c=a,u=!1;a.rank===2&&(u=!0,c=U(a,[1,a.shape[0],a.shape[1]])),T(c.rank===3,()=>`Error in conv1d: input must be rank 3, but got rank ${c.rank}.`),T(l.rank===3,()=>`Error in conv1d: filter must be rank 3, but got rank ${l.rank}.`),_n("conv1d",s,o),T(c.shape[2]===l.shape[1],()=>`Error in conv1d: depth of input (${c.shape[2]}) must match input depth for filter ${l.shape[1]}.`),T(rn(n,i),()=>`Error in conv1D: Either stride or dilation must be 1. Got stride ${n} and dilation '${i}'`),T(Qo(i),()=>"Error in conv1D: Dilated rates should be larger than 0."),T(Qo(n),()=>"Error in conv1D: Stride should be larger than 0."),T(r==="NWC",()=>`Error in conv1d: got dataFormat of ${r} but only NWC is currently supported.`);const d=U(l,[1,l.shape[0],l.shape[1],l.shape[2]]),h=U(c,[c.shape[0],1,c.shape[1],c.shape[2]]),x=Jo(h,d,[1,n],s,"NHWC",[1,i],o);return u?U(x,[x.shape[2],x.shape[3]]):U(x,[x.shape[0],x.shape[2],x.shape[3]])}const CE=G({conv1d_:_6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function D6(t,e,n,s,r,i="NHWC",o){T(t.length===e.rank,()=>`Length of inShape (${t.length}) and rank of dy (${e.rank}) must match`);let a=t,l=e,c=!1;e.rank===3&&(c=!0,l=U(e,[1,e.shape[0],e.shape[1],e.shape[2]]),a=[1,t[0],t[1],t[2]]),T(a.length===4,()=>`Error in conv2dDerInput: inShape must be length 4, but got length ${a.length}.`),T(l.rank===4,()=>`Error in conv2dDerInput: dy must be rank 4, but got rank ${l.rank}`),T(n.rank===4,()=>`Error in conv2dDerInput: filter must be rank 4, but got rank ${n.rank}`);const u=i==="NHWC"?a[3]:a[1],d=i==="NHWC"?l.shape[3]:l.shape[1];T(u===n.shape[2],()=>`Error in conv2dDerInput: depth of input (${u}) must match input depth for filter ${n.shape[2]}.`),T(d===n.shape[3],()=>`Error in conv2dDerInput: depth of output (${d}) must match output depth for filter ${n.shape[3]}.`),_n("conv2dDerInput",r,o);const h={dy:l,filter:n},p={strides:s,pad:r,dataFormat:i,dimRoundingMode:o,inputShape:a},f=z.runKernel(Uf,h,p);return c?U(f,[f.shape[1],f.shape[2],f.shape[3]]):f}const dv=G({conv2DBackpropInput_:D6});function F6(t,e,n,s,r,i){const o=N(t,"x","conv2dTranspose"),a=N(e,"filter","conv2dTranspose");return dv(n,o,a,s,r,"NHWC",i)}const SE=G({conv2dTranspose_:F6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function O6(t,e,n,s,r="NDHWC",i=[1,1,1]){const o=N(t,"x","conv3d"),a=N(e,"filter","conv3d");let l=o,c=!1;o.rank===4&&(c=!0,l=U(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),T(l.rank===5,()=>`Error in conv3d: input must be rank 5, but got rank ${l.rank}.`),T(a.rank===5,()=>`Error in conv3d: filter must be rank 5, but got rank ${a.rank}.`),T(l.shape[4]===a.shape[3],()=>`Error in conv3d: depth of input (${l.shape[4]}) must match input depth for filter ${a.shape[3]}.`),T(rn(n,i),()=>`Error in conv3D: Either strides or dilations must be 1. Got strides ${n} and dilations '${i}'`),T(r==="NDHWC",()=>`Error in conv3d: got dataFormat of ${r} but only NDHWC is currently supported.`),T(Qo(i),()=>"Error in conv3D: Dilated rates should be larger than 0."),T(Qo(n),()=>"Error in conv3D: Strides should be larger than 0.");const u={x:l,filter:a},d={strides:n,pad:s,dataFormat:r,dilations:i},h=z.runKernel(Gf,u,d);return c?U(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}const P6=G({conv3d_:O6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function M6(t,e,n,s,r){T(t.length===e.rank,()=>`Length of inShape (${t.length}) and rank of dy (${e.rank}) must match`);let i=t,o=e,a=!1;e.rank===4&&(a=!0,o=U(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]),i=[1,t[0],t[1],t[2],t[3]]);const l=i[4],c=o.shape[4];T(i.length===5,()=>`Error in conv3dDerInput: inShape must be length 5, but got length ${i.length}.`),T(o.rank===5,()=>`Error in conv3dDerInput: dy must be rank 5, but got rank ${o.rank}`),T(n.rank===5,()=>`Error in conv3dDerInput: filter must be rank 5, but got rank ${n.rank}`),T(l===n.shape[3],()=>`Error in conv3dDerInput: depth of input (${l}) must match input depth for filter ${n.shape[3]}.`),T(c===n.shape[4],()=>`Error in conv3dDerInput: depth of output (${c}) must match output depth for filter ${n.shape[4]}.`);const u={dy:o,filter:n},d={pad:r,strides:s,inputShape:i},h=z.runKernel(E1,u,d);return a?U(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}const IE=G({conv3DBackpropInput_:M6});function L6(t,e,n,s,r){const i=N(t,"x","conv3dTranspose"),o=N(e,"filter","conv3dTranspose");return IE(n,i,o,s,r)}const z6=G({conv3dTranspose_:L6});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function j6(t){const n={x:N(t,"x","cos","float32")};return z.runKernel(Uu,n)}const hv=G({cos_:j6});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function B6(t){const n={x:N(t,"x","cosh","float32")};return z.runKernel(Gu,n)}const $E=G({cosh_:B6});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function W6(t,e=0,n=!1,s=!1){const i={x:N(t,"x","cumprod")},o={axis:e,exclusive:n,reverse:s};return z.runKernel(R1,i,o)}const F0=G({cumprod_:W6});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function V6(t,e=0,n=!1,s=!1){const i={x:N(t,"x","cumsum")},o={axis:e,exclusive:n,reverse:s};return z.runKernel(Hf,i,o)}const TE=G({cumsum_:V6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function U6(t,e,n,s=!1){const r=N(t,"x","denseBincount"),i=N(e,"weights","denseBincount");T(r.dtype==="int32",()=>`Error in denseBincount: input dtype must be int32, but got ${r.dtype}`),T(r.rank<=2,()=>`Error in denseBincount: input must be at most rank 2, but got rank ${r.rank}.`),T(n>=0,()=>`size must be non-negative, but got ${n}.`),T(i.size===r.size||i.size===0,()=>`Error in denseBincount: weights must have the same shape as x or 0-length, but got x shape: ${r.shape}, weights shape: ${i.shape}.`);const o={x:r,weights:i},a={size:n,binaryOutput:s};return z.runKernel(A1,o,a)}const Ck=G({denseBincount_:U6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function G6(t,e,n="NHWC"){const s=N(t,"x","depthToSpace","float32"),r=n==="NHWC"?s.shape[1]:s.shape[2],i=n==="NHWC"?s.shape[2]:s.shape[3],o=n==="NHWC"?s.shape[3]:s.shape[1];T(e>1,()=>`blockSize should be > 1 for depthToSpace, but was: ${e}`),T(r*e>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${r} and ${e}  for depthToSpace with input shape
    ${s.shape}`),T(i*e>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${i} and ${e} for depthToSpace with input shape
        ${s.shape}`),T(o%(e*e)===0,()=>`Dimension size must be evenly divisible by ${e*e} but is ${o} for depthToSpace with input shape ${s.shape}`);const a={x:s},l={blockSize:e,dataFormat:n};return z.runKernel(_1,a,l)}const H6=G({depthToSpace_:G6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function K6(t,e,n,s,r="NHWC",i=[1,1],o){const a=N(t,"x","depthwiseConv2d","float32"),l=N(e,"filter","depthwiseConv2d","float32");let c=a,u=!1;a.rank===3&&(u=!0,c=U(a,[1,a.shape[0],a.shape[1],a.shape[2]])),T(c.rank===4,()=>`Error in depthwiseConv2d: input must be rank 4, but got rank ${c.rank}.`),T(l.rank===4,()=>`Error in depthwiseConv2d: filter must be rank 4, but got rank ${l.rank}.`);const d=r==="NHWC"?c.shape[3]:c.shape[1];T(d===l.shape[2],()=>`Error in depthwiseConv2d: number of input channels (${d}) must match the inChannels dimension in filter ${l.shape[2]}.`),_n("depthwiseConv2d",s,o);const h={x:c,filter:l},p={strides:n,pad:s,dataFormat:r,dilations:i,dimRoundingMode:o},f=z.runKernel(Kf,h,p);return u?U(f,[f.shape[1],f.shape[2],f.shape[3]]):f}const pv=G({depthwiseConv2d_:K6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function q6(t,e,n,s,r=[1,1],i="NHWC"){const o=N(t,"x","dilation2d"),a=N(e,"filter","dilation2d");T(o.rank===3||o.rank===4,()=>`Error in dilation2d: input must be rank 3 or 4, but got rank ${o.rank}.`),T(a.rank===3,()=>`Error in dilation2d: filter must be rank 3, but got rank ${a.rank}.`),T(i==="NHWC",()=>`Error in dilation2d: Only NHWC is currently supported, but got dataFormat of ${i}`);let l=o,c=!1;o.rank===3&&(l=U(o,[1,o.shape[0],o.shape[1],o.shape[2]]),c=!0),T(l.shape[3]===a.shape[2],()=>`Error in dilation2d:  input and filter must have the same depth: ${l.shape[3]} vs ${a.shape[2]}`);const u={x:l,filter:a},d={strides:n,pad:s,dilations:r},h=z.runKernel(qf,u,d);return c?U(h,[h.shape[1],h.shape[2],h.shape[3]]):h}const X6=G({dilation2d_:q6});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bl(t,e){const n=t.length,s=[];for(let r=0;r<n;r++){const i=n-1-r,o=t[i]||1;(e[e.length-1-r]||1)>1&&o===1&&s.unshift(i)}return s}function Ft(t,e){const n=[];for(let s=0;s<e.length;s++){const r=t[t.length-s-1],i=e.length-s-1,o=e[i];(r==null||r===1&&o>1)&&n.unshift(i)}return n}function Se(t,e){const n=Math.max(t.length,e.length),s=new Array(n);for(let r=0;r<n;r++){let i=t[t.length-r-1];i==null&&(i=1);let o=e[e.length-r-1];if(o==null&&(o=1),i===1)s[n-r-1]=o;else if(o===1)s[n-r-1]=i;else if(i!==o){const a=`Operands could not be broadcast together with shapes ${t} and ${e}.`;throw Error(a)}else s[n-r-1]=i}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Y6(t,e){let n=N(t,"a","equal","string_or_numeric"),s=N(e,"b","equal","string_or_numeric");[n,s]=bt(n,s),Se(n.shape,s.shape);const r={a:n,b:s};return z.runKernel(Xf,r)}const wr=G({equal_:Y6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Q6(t,e,n){const s=N(e,"a","where"),r=N(n,"b","where"),i=N(t,"condition","where","bool"),o=Se(Se(i.shape,s.shape),r.shape),a=Mc(i,o),l=Mc(s,o),c=Mc(r,o),u={condition:a,t:l,e:c};return z.runKernel(Im,u)}const yn=G({where_:Q6});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function J6(t){const n={x:N(t,"x","zerosLike")};return z.runKernel(Dm,n)}const Fe=G({zerosLike_:J6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Z6(t,e){let n=N(t,"a","div"),s=N(e,"b","div");[n,s]=bt(n,s);const r=ye(n,s),i=Fe(r),o=wr(s,i);return yn(o,i,r)}const eW=G({divNoNan_:Z6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tW(t,e){const n=N(t,"t1","dot"),s=N(e,"t2","dot");T((n.rank===1||n.rank===2)&&(s.rank===1||s.rank===2),()=>`Error in dot: inputs must all be rank 1 or 2, but got ranks ${n.rank} and ${s.rank}.`);const r=n.rank===1?n.size:n.shape[1],i=s.rank===1?s.size:s.shape[0];if(T(r===i,()=>`Error in dot: inner dimensions of inputs must match, but got ${r} and ${i}.`),n.rank===1&&s.rank===1){const o=U(n,[1,-1]),a=U(s,[-1,1]),l=Le(o,a);return U(l,[])}else if(n.rank===1&&s.rank===2){const o=U(n,[1,-1]),a=U(s,[s.shape[0],s.shape[1]]),l=Le(o,a);return U(l,[l.size])}else if(n.rank===2&&s.rank===1){const o=U(s,[-1,1]),a=Le(n,o);return U(a,[a.size])}else{const o=U(s,[s.shape[0],s.shape[1]]);return Le(n,o)}}const nW=G({dot_:tW});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sW(t,...e){const n=e.map((r,i)=>N(r,`tensors${i}`,"einsum")),s={equation:t};return z.runKernel(O1,n,s)}const dc=G({einsum_:sW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rW(t){const n={x:N(t,"x","elu","float32")};return z.runKernel(Ku,n)}const Lm=G({elu_:rW});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iW(t){let e=N(t,"x","erf");T(e.dtype==="int32"||e.dtype==="float32",()=>"Input dtype must be `int32` or `float32`."),e.dtype==="int32"&&(e=de(e,"float32"));const n={x:e};return z.runKernel(qu,n)}const EE=G({erf_:iW});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fv(t,e){for(let n=0;n<t.length;++n)if(t[t.length-n-1]!==e-1-n)return!1;return!0}function RE(t,e,n){const s=t.length+e.length,r=[];let i=0,o=0;for(let a=0;a<s;a++)n.indexOf(a)===-1?r.push(t[i++]):r.push(e[o++]);return r}function Wt(t,e){const n=[],s=t.length;for(let i=0;i<s;i++)e.indexOf(i)===-1&&n.push(t[i]);const r=e.map(i=>t[i]);return[n,r]}function Tt(t,e){const n=e.map(s=>1);return RE(t,n,e)}function Xt(t,e,n){T(fv(e,n),()=>`${t} supports only inner-most axes for now. Got axes ${e} and rank-${n} input.`)}function dt(t,e){if(fv(t,e))return null;const n=[];for(let s=0;s<e;++s)t.indexOf(s)===-1&&n.push(s);return t.forEach(s=>n.push(s)),n}function oo(t){return t.map((e,n)=>[n,e]).sort((e,n)=>e[1]-n[1]).map(e=>e[0])}function wt(t,e){const n=[];for(let s=e-t;s<e;++s)n.push(s);return n}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oW(t,e=null,n=!1){const r={x:N(t,"x","max")},i={reductionIndices:e,keepDims:n};return z.runKernel(am,r,i)}const qs=G({max_:oW});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aW(t,e=null,n=!1){const r={x:N(t,"x","min")},i={axis:e,keepDims:n};return z.runKernel(dm,r,i)}const Lp=G({min_:aW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lW(t,e){let n=N(t,"base","pow"),s=N(e,"exp","pow");[n,s]=bt(n,s);const r={a:n,b:s};return z.runKernel(ud,r)}const Zo=G({pow_:lW});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ze(t,e){if((Is(t)&&e!=="string"||Array.isArray(t))&&e!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(e==="string"&&Is(t)&&!(t instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return Nd(t,[],[],e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cW(t){const n={x:N(t,"x","sqrt","float32")};return z.runKernel(kd,n)}const sn=G({sqrt_:cW});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uW(t){const e=N(t,"x","square"),n={};return z.runKernel("Square",{x:e},n)}const et=G({square_:uW});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dW(t,e=null,n=!1){let s=N(t,"x","sum");s.dtype==="bool"&&(s=de(s,"int32"));const r={x:s},i={axis:e,keepDims:n};return z.runKernel(Tm,r,i)}const ge=G({sum_:dW});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hW(t,e="euclidean",n=null,s=!1){t=N(t,"x","norm");const r=NE(t,e,n);let i=r.shape;if(s){const o=Te(n,t.shape);i=Tt(r.shape,o)}return U(r,i)}function NE(t,e,n=null){if(t.rank===0)return hn(t);if(t.rank!==1&&n===null)return NE(U(t,[-1]),e,n);if(t.rank===1||typeof n=="number"||Array.isArray(n)&&n.length===1){if(e===1)return ge(hn(t),n);if(e===1/0)return qs(hn(t),n);if(e===-1/0)return Lp(hn(t),n);if(e==="euclidean"||e===2)return sn(ge(Zo(hn(t),ze(2,"int32")),n));throw new Error(`Error in norm: invalid ord value: ${e}`)}if(Array.isArray(n)&&n.length===2){if(e===1)return qs(ge(hn(t),n[0]),n[1]-1);if(e===1/0)return qs(ge(hn(t),n[1]),n[0]);if(e===-1/0)return Lp(ge(hn(t),n[1]),n[0]);if(e==="fro"||e==="euclidean")return sn(ge(et(t),n));throw new Error(`Error in norm: invalid ord value: ${e}`)}throw new Error(`Error in norm: invalid axis: ${n}`)}const zm=G({norm_:hW});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pW(t,e=null,n=!1){return zm(t,"euclidean",e,n)}const fW=G({euclideanNorm_:pW});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mW(t){const n={x:N(t,"x","exp")};return z.runKernel(Xu,n)}const kr=G({exp_:mW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gW(t,e=0){const n=N(t,"x","expandDims","string_or_numeric");T(e<=n.rank,()=>"Axis must be <= rank of the tensor");const s={input:n},r={dim:e};return z.runKernel(Yf,s,r)}const Cn=G({expandDims_:gW});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yW(t){const n={x:N(t,"x","expm1")};return z.runKernel(Yu,n)}const xW=G({expm1_:yW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vW(t,e){const n=N(t,"x","tile","string_or_numeric");T(n.rank===e.length,()=>`Error in transpose: rank of input ${n.rank} must match length of reps ${e}.`);const s={x:n},r={reps:e};return z.runKernel(Td,s,r)}const Us=G({tile_:vW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bW(t,e,n,s="float32"){e==null&&(e=t);const r=$e([t,e],s),i=t<=e?t:e;for(let a=0;a<i;++a)r.set(1,a,a);const o=U(r.toTensor(),[t,e]);if(n==null)return o;if(n.length===1)return Us(Cn(o,0),[n[0],1,1]);if(n.length===2)return Us(Cn(Cn(o,0),0),[n[0],n[1],1,1]);if(n.length===3)return Us(Cn(Cn(Cn(o,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error(`eye() currently supports only 1D and 2D batchShapes, but received ${n.length}D.`)}const AE=G({eye_:bW});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wW(t){const n={x:N(t,"x","floor","float32")};return z.runKernel(Qu,n)}const jm=G({floor_:wW});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kW(t,e,n=0,s=0){const r=N(t,"x","gather"),i=N(e,"indices","gather","int32"),o={x:r,indices:i},a={axis:n,batchDims:s};return z.runKernel(Jf,o,a)}const mv=G({gather_:kW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CW(t,e){let n=N(t,"a","greater","string_or_numeric"),s=N(e,"b","greater","string_or_numeric");[n,s]=bt(n,s),Se(n.shape,s.shape);const r={a:n,b:s};return z.runKernel(Zf,r)}const os=G({greater_:CW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SW(t,e){let n=N(t,"a","greaterEqual","string_or_numeric"),s=N(e,"b","greaterEqual","string_or_numeric");[n,s]=bt(n,s),Se(n.shape,s.shape);const r={a:n,b:s};return z.runKernel(Zu,r)}const fa=G({greaterEqual_:SW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IW(t){const n={input:N(t,"input","imag")};return z.runKernel(B1,n)}const gv=G({imag_:IW});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $W(t){const n={x:N(t,"x","isFinite")};return z.runKernel(td,n)}const TW=G({isFinite_:$W});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EW(t){const n={x:N(t,"x","isInf")};return z.runKernel(nd,n)}const RW=G({isInf_:EW});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NW(t){const n={x:N(t,"x","isNaN")};return z.runKernel(sd,n)}const AW=G({isNaN_:NW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _W(t,e=.2){const s={x:N(t,"x","leakyRelu")},r={alpha:e};return z.runKernel(em,s,r)}const yv=G({leakyRelu_:_W});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DW(t,e){let n=N(t,"a","less","string_or_numeric"),s=N(e,"b","less","string_or_numeric");[n,s]=bt(n,s),Se(n.shape,s.shape);const r={a:n,b:s};return z.runKernel(tm,r)}const zp=G({less_:DW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FW(t,e){let n=N(t,"a","lessEqual","string_or_numeric"),s=N(e,"b","lessEqual","string_or_numeric");[n,s]=bt(n,s),Se(n.shape,s.shape);const r={a:n,b:s};return z.runKernel(nm,r)}const Bl=G({lessEqual_:FW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OW(t,e=5,n=1,s=1,r=.5){const i=N(t,"x","localResponseNormalization");T(i.rank===4||i.rank===3,()=>`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank ${i.rank}.`),T(gl(e),()=>`Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ${e}.`);let o=i,a=!1;i.rank===3&&(a=!0,o=U(i,[1,i.shape[0],i.shape[1],i.shape[2]]));const l={x:o},c={depthRadius:e,bias:n,alpha:s,beta:r},u=z.runKernel(om,l,c);return a?U(u,[u.shape[1],u.shape[2],u.shape[3]]):u}const PW=G({localResponseNormalization_:OW});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MW(t){const n={x:N(t,"x","log","float32")};return z.runKernel(rd,n)}const Cr=G({log_:MW});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LW(t){const n={x:N(t,"x","log1p")};return z.runKernel(id,n)}const _E=G({log1p_:LW});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zW(t,e){T(g0(t),()=>"The f passed in variableGrads(f) must be a function"),T(e==null||Array.isArray(e)&&e.every(c=>c instanceof Mp),()=>"The varList passed in variableGrads(f, varList) must be an array of variables");const n=e!=null;if(!n){e=[];for(const c in z.registeredVariables)e.push(z.registeredVariables[c])}const s=n?e.filter(c=>!c.trainable):null,r=e.length;e=e.filter(c=>c.trainable),T(e.length>0,()=>`variableGrads() expects at least one of the input variables to be trainable, but none of the ${r} variables is trainable.`);const i=!0,{value:o,grads:a}=z.gradients(t,e,null,i);T(a.some(c=>c!=null),()=>"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."),T(o.rank===0,()=>`The f passed in variableGrads(f) must return a scalar, but it returned a rank-${o.rank} tensor`);const l={};return e.forEach((c,u)=>{a[u]!=null&&(l[c.name]=a[u])}),s!=null&&s.forEach(c=>l[c.name]=null),{value:o,grads:l}}function wl(t){return z.customGrad(t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jW(t){const n={x:N(t,"x","neg")};return z.runKernel(pm,n)}const vt=G({neg_:jW});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BW(t){const n={x:N(t,"x","softplus")};return z.runKernel(wd,n)}const _d=G({softplus_:BW});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WW(t){const e=N(t,"x","logSigmoid");return wl(s=>({value:vt(_d(vt(s))),gradFunc:o=>L(o,jl(vt(s)))}))(e)}const VW=G({logSigmoid_:WW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UW(t,e){let n=N(t,"a","sub"),s=N(e,"b","sub");[n,s]=bt(n,s);const r={a:n,b:s};return z.runKernel(Sd,r)}const ve=G({sub_:UW});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GW(t,e=-1){const n=N(t,"logits","logSoftmax");if(e===-1&&(e=n.rank-1),e!==n.rank-1)throw Error(`Log Softmax along a non-last dimension is not yet supported. Logits was rank ${n.rank} and axis was ${e}`);return wl((r,i)=>{const a=qs(r,e,!0),l=ve(r,a),c=ve(de(l,"float32"),Cr(ge(kr(l),e,!0)));return i([c]),{value:c,gradFunc:(d,h)=>{const[p]=h,f=!0,g=kr(p);return ve(d,L(ge(d,e,f),g))}}})(n)}const DE=G({logSoftmax_:GW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HW(t,e=null,n=!1){const s=N(t,"x","logSumExp"),r=Te(e,s.shape),i=qs(s,r,!0),o=ve(s,i),a=kr(o),l=ge(a,r),c=Cr(l),u=re(U(i,c.shape),c);if(n){const d=Tt(u.shape,r);return U(u,d)}return u}const FE=G({logSumExp_:HW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KW(t,e){const n=N(t,"a","logicalAnd","bool"),s=N(e,"b","logicalAnd","bool");Se(n.shape,s.shape);const r={a:n,b:s};return z.runKernel(sm,r)}const Xr=G({logicalAnd_:KW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qW(t){const n={x:N(t,"x","logicalNot","bool")};return z.runKernel(rm,n)}const xv=G({logicalNot_:qW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XW(t,e){const n=N(t,"a","logicalOr","bool"),s=N(e,"b","logicalOr","bool");Se(n.shape,s.shape);const r={a:n,b:s};return z.runKernel(im,r)}const OE=G({logicalOr_:XW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YW(t,e){const n=N(t,"a","logicalXor","bool"),s=N(e,"b","logicalXor","bool");return Se(n.shape,s.shape),Xr(OE(t,e),xv(Xr(t,e)))}const QW=G({logicalXor_:YW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JW(t,e,n,s,r){const i=N(t,"x","maxPool"),o=1;let a=i,l=!1;i.rank===3&&(l=!0,a=U(i,[1,i.shape[0],i.shape[1],i.shape[2]])),T(a.rank===4,()=>`Error in maxPool: input must be rank 4 but got rank ${a.rank}.`),T(rn(n,o),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${n} and dilations '${o}'`),_n("maxPool",s,r);const c={x:a},u={filterSize:e,strides:n,pad:s,dimRoundingMode:r},d=z.runKernel(lm,c,u);return l?U(d,[d.shape[1],d.shape[2],d.shape[3]]):d}const vv=G({maxPool_:JW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZW(t,e=[1,1,1],n,s,r,i="NDHWC"){const o=N(t,"x","maxPool3d");let a=o,l=!1;o.rank===4&&(l=!0,a=U(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),T(a.rank===5,()=>`Error in maxPool3d: x must be rank 5 but got rank ${a.rank}.`),T(i==="NDHWC",()=>`Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of ${i}`),_n("maxPool3d",s,r);const c={x:a},u={filterSize:e,strides:n,pad:s,dimRoundingMode:r,dataFormat:i},d=z.runKernel(cm,c,u);return l?U(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}const e5=G({maxPool3d_:ZW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function t5(t,e){let n=N(t,"a","maximum"),s=N(e,"b","maximum");[n,s]=bt(n,s),n.dtype==="bool"&&(n=de(n,"int32"),s=de(s,"int32")),Se(n.shape,s.shape);const r={a:n,b:s};return z.runKernel(od,r)}const ao=G({maximum_:t5});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function n5(t,e=null,n=!1){const r={x:N(t,"x","mean")},i={axis:e,keepDims:n};return z.runKernel(um,r,i)}const It=G({mean_:n5});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zt(t,e="float32"){if(si(t),e==="complex64"){const s=zt(t,"float32"),r=zt(t,"float32");return vl(s,r)}const n=nn(J(t),e);return z.makeTensor(n,t,e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lo(t,e="float32"){if(si(t),e==="complex64"){const s=lo(t,"float32"),r=zt(t,"float32");return vl(s,r)}const n=m1(J(t),e);return z.makeTensor(n,t,e)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function s5(t,e){let n=N(t,"a","minimum"),s=N(e,"b","minimum");[n,s]=bt(n,s),n.dtype==="bool"&&(n=de(n,"int32"),s=de(s,"int32")),Se(n.shape,s.shape);const r={a:n,b:s};return z.runKernel(ad,r)}const du=G({minimum_:s5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function r5(t,e,n){T(n==="reflect"||n==="symmetric",()=>`Invalid mode. Mode must be either reflect or symmetric. Got ${n}.`);const s=N(t,"x","mirrorPad");if(s.rank===0)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");T(e.length===s.rank,()=>`Padding doesn't match input. Must be ${s.rank}. Got ${e.length}.`);const r=n==="reflect"?1:0;for(let a=0;a<s.rank;a++)T(e[a].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),T(e[a][0]>=0&&e[a][0]<=s.shape[a]-r&&e[a][1]>=0&&e[a][1]<=s.shape[a]-r,()=>`Padding in dimension ${a} cannot be greater than or equal to ${s.shape[a]-r} or less than 0 for input of shape ${s.shape}`);const i={paddings:e,mode:n},o={x:s};return z.runKernel(hm,o,i)}const i5=G({mirrorPad_:r5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function o5(t,e){let n=N(t,"a","mod"),s=N(e,"b","mod");[n,s]=bt(n,s);const r={a:n,b:s};return z.runKernel(ld,r)}const a5=G({mod_:o5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function l5(t,e=null,n=!1){t=N(t,"x","moments");const s=Te(e,t.shape),r=It(t,s,n);let i=r.shape;n||(i=Tt(r.shape,s));const o=et(ve(de(t,"float32"),U(r,i))),a=It(o,s,n);return{mean:r,variance:a}}const bv=G({moments_:l5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function c5(t,e){let n=N(t,"a","notEqual","string_or_numeric"),s=N(e,"b","notEqual","string_or_numeric");[n,s]=bt(n,s),Se(n.shape,s.shape);const r={a:n,b:s};return z.runKernel(fm,r)}const jp=G({notEqual_:c5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function u5(t,e,n=1,s=0,r="int32"){if(e<2)throw new Error(`Error in oneHot: depth must be >=2, but it is ${e}`);const o={indices:N(t,"indices","oneHot","int32")},a={dtype:r,depth:e,onValue:n,offValue:s};return z.runKernel(gm,o,a)}const PE=G({oneHot_:u5});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function d5(t){const n={x:N(t,"x","onesLike")};return z.runKernel(mm,n)}const $s=G({onesLike_:d5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function h5(t,e,n=0){const s=N(t,"x","pad");if(s.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");const r={paddings:e,constantValue:n},i={x:s};return z.runKernel(xm,i,r)}const wv=G({pad_:h5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function p5(t,e,n){const s=N(t,"x","spaceToBatchND");T(s.rank>=1+e.length,()=>`input rank ${s.rank} should be > than [blockShape] ${e.length}`),T(n.length===e.length,()=>`paddings.shape[0] ${n.length} must be equal to [blockShape] ${e.length}`),T(s.shape.reduce((o,a,l)=>l>0&&l<=e.length?o&&(a+n[l-1][0]+n[l-1][1])%e[l-1]===0:o,!0),()=>`input spatial dimensions ${s.shape.slice(1)} with paddings ${n.toString()} must be divisible by blockShapes ${e.toString()}`);const r={x:s},i={blockShape:e,paddings:n};return z.runKernel(Em,r,i)}const kv=G({spaceToBatchND_:p5});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function f5(t,e,n,s,r,i,o){r==null&&(r=[1,1]),i==null&&(i=1),s===0&&(s="valid");const a=N(t,"x","maxPool");let l=a,c=!1;a.rank===3&&(c=!0,l=U(a,[1,a.shape[0],a.shape[1],a.shape[2]])),T(rn(i,r),()=>`Error in pool: Either strides or dilations must be 1. Got strides ${i} and dilations '${r}'`);const u=Ts(l.shape,e,i,r,s),d=[u.dilationHeight,u.dilationWidth];let h;s==="same"?h=g5([u.filterHeight,u.filterWidth],d):h=[[0,0],[0,0]];const p=d[0]===1&&d[1]===1,[f,g]=m5([u.inHeight,u.inWidth],d,h),x=p?s:"valid",y=p?l:kv(l,d,f),b=(n==="avg"?()=>cv(y,e,i,x,o):()=>vv(y,e,i,x,o))(),w=p?b:uv(b,d,g);return c?U(w,[w.shape[1],w.shape[2],w.shape[3]]):w}function m5(t,e,n){const s=n.map(u=>u[0]),r=n.map(u=>u[1]),i=t.concat(s,r),o=e.map((u,d)=>(u-i[d]%u)%u),a=r.map((u,d)=>u+o[d]),l=e.map((u,d)=>[s[d],a[d]]),c=e.map((u,d)=>[0,o[d]]);return[l,c]}function g5(t,e){const s=t.map((o,a)=>o+(o-1)*(e[a]-1)).map(o=>o-1),r=s.map(o=>Math.floor(o/2)),i=s.map((o,a)=>o-r[a]);return s.map((o,a)=>[r[a],i[a]])}const y5=G({pool_:f5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function x5(t,e){const n=N(t,"x","prelu"),s=N(e,"alpha","prelu"),r={x:n,alpha:s};return z.runKernel(vm,r)}const Cv=G({prelu_:x5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function v5(t,e=null,n=!1){let s=N(t,"x","prod");s.dtype==="bool"&&(s=de(s,"int32"));const r={x:s},i={axis:e,keepDims:n};return z.runKernel(bm,r,i)}const b5=G({prod_:v5});var Sv={exports:{}};Sv.exports;(function(t){(function(e,n,s){function r(l){var c=this,u=a();c.next=function(){var d=2091639*c.s0+c.c*23283064365386963e-26;return c.s0=c.s1,c.s1=c.s2,c.s2=d-(c.c=d|0)},c.c=1,c.s0=u(" "),c.s1=u(" "),c.s2=u(" "),c.s0-=u(l),c.s0<0&&(c.s0+=1),c.s1-=u(l),c.s1<0&&(c.s1+=1),c.s2-=u(l),c.s2<0&&(c.s2+=1),u=null}function i(l,c){return c.c=l.c,c.s0=l.s0,c.s1=l.s1,c.s2=l.s2,c}function o(l,c){var u=new r(l),d=c&&c.state,h=u.next;return h.int32=function(){return u.next()*4294967296|0},h.double=function(){return h()+(h()*2097152|0)*11102230246251565e-32},h.quick=h,d&&(typeof d=="object"&&i(d,u),h.state=function(){return i(u,{})}),h}function a(){var l=4022871197,c=function(u){u=String(u);for(var d=0;d<u.length;d++){l+=u.charCodeAt(d);var h=.02519603282416938*l;l=h>>>0,h-=l,h*=l,l=h>>>0,h-=l,l+=h*4294967296}return(l>>>0)*23283064365386963e-26};return c}n&&n.exports?n.exports=o:this.alea=o})(aa,t)})(Sv);var w5=Sv.exports,Iv={exports:{}};Iv.exports;(function(t){(function(e,n,s){function r(a){var l=this,c="";l.x=0,l.y=0,l.z=0,l.w=0,l.next=function(){var d=l.x^l.x<<11;return l.x=l.y,l.y=l.z,l.z=l.w,l.w^=l.w>>>19^d^d>>>8},a===(a|0)?l.x=a:c+=a;for(var u=0;u<c.length+64;u++)l.x^=c.charCodeAt(u)|0,l.next()}function i(a,l){return l.x=a.x,l.y=a.y,l.z=a.z,l.w=a.w,l}function o(a,l){var c=new r(a),u=l&&l.state,d=function(){return(c.next()>>>0)/4294967296};return d.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,f=(h+p)/(1<<21);while(f===0);return f},d.int32=c.next,d.quick=d,u&&(typeof u=="object"&&i(u,c),d.state=function(){return i(c,{})}),d}n&&n.exports?n.exports=o:this.xor128=o})(aa,t)})(Iv);var k5=Iv.exports,$v={exports:{}};$v.exports;(function(t){(function(e,n,s){function r(a){var l=this,c="";l.next=function(){var d=l.x^l.x>>>2;return l.x=l.y,l.y=l.z,l.z=l.w,l.w=l.v,(l.d=l.d+362437|0)+(l.v=l.v^l.v<<4^(d^d<<1))|0},l.x=0,l.y=0,l.z=0,l.w=0,l.v=0,a===(a|0)?l.x=a:c+=a;for(var u=0;u<c.length+64;u++)l.x^=c.charCodeAt(u)|0,u==c.length&&(l.d=l.x<<10^l.x>>>4),l.next()}function i(a,l){return l.x=a.x,l.y=a.y,l.z=a.z,l.w=a.w,l.v=a.v,l.d=a.d,l}function o(a,l){var c=new r(a),u=l&&l.state,d=function(){return(c.next()>>>0)/4294967296};return d.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,f=(h+p)/(1<<21);while(f===0);return f},d.int32=c.next,d.quick=d,u&&(typeof u=="object"&&i(u,c),d.state=function(){return i(c,{})}),d}n&&n.exports?n.exports=o:this.xorwow=o})(aa,t)})($v);var C5=$v.exports,Tv={exports:{}};Tv.exports;(function(t){(function(e,n,s){function r(a){var l=this;l.next=function(){var u=l.x,d=l.i,h,p;return h=u[d],h^=h>>>7,p=h^h<<24,h=u[d+1&7],p^=h^h>>>10,h=u[d+3&7],p^=h^h>>>3,h=u[d+4&7],p^=h^h<<7,h=u[d+7&7],h=h^h<<13,p^=h^h<<9,u[d]=p,l.i=d+1&7,p};function c(u,d){var h,p=[];if(d===(d|0))p[0]=d;else for(d=""+d,h=0;h<d.length;++h)p[h&7]=p[h&7]<<15^d.charCodeAt(h)+p[h+1&7]<<13;for(;p.length<8;)p.push(0);for(h=0;h<8&&p[h]===0;++h);for(h==8?p[7]=-1:p[h],u.x=p,u.i=0,h=256;h>0;--h)u.next()}c(l,a)}function i(a,l){return l.x=a.x.slice(),l.i=a.i,l}function o(a,l){a==null&&(a=+new Date);var c=new r(a),u=l&&l.state,d=function(){return(c.next()>>>0)/4294967296};return d.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,f=(h+p)/(1<<21);while(f===0);return f},d.int32=c.next,d.quick=d,u&&(u.x&&i(u,c),d.state=function(){return i(c,{})}),d}n&&n.exports?n.exports=o:this.xorshift7=o})(aa,t)})(Tv);var S5=Tv.exports,Ev={exports:{}};Ev.exports;(function(t){(function(e,n,s){function r(a){var l=this;l.next=function(){var u=l.w,d=l.X,h=l.i,p,f;return l.w=u=u+1640531527|0,f=d[h+34&127],p=d[h=h+1&127],f^=f<<13,p^=p<<17,f^=f>>>15,p^=p>>>12,f=d[h]=f^p,l.i=h,f+(u^u>>>16)|0};function c(u,d){var h,p,f,g,x,y=[],v=128;for(d===(d|0)?(p=d,d=null):(d=d+"\0",p=0,v=Math.max(v,d.length)),f=0,g=-32;g<v;++g)d&&(p^=d.charCodeAt((g+32)%d.length)),g===0&&(x=p),p^=p<<10,p^=p>>>15,p^=p<<4,p^=p>>>13,g>=0&&(x=x+1640531527|0,h=y[g&127]^=p+x,f=h==0?f+1:0);for(f>=128&&(y[(d&&d.length||0)&127]=-1),f=127,g=4*128;g>0;--g)p=y[f+34&127],h=y[f=f+1&127],p^=p<<13,h^=h<<17,p^=p>>>15,h^=h>>>12,y[f]=p^h;u.w=x,u.X=y,u.i=f}c(l,a)}function i(a,l){return l.i=a.i,l.w=a.w,l.X=a.X.slice(),l}function o(a,l){a==null&&(a=+new Date);var c=new r(a),u=l&&l.state,d=function(){return(c.next()>>>0)/4294967296};return d.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,f=(h+p)/(1<<21);while(f===0);return f},d.int32=c.next,d.quick=d,u&&(u.X&&i(u,c),d.state=function(){return i(c,{})}),d}n&&n.exports?n.exports=o:this.xor4096=o})(aa,t)})(Ev);var I5=Ev.exports,Rv={exports:{}};Rv.exports;(function(t){(function(e,n,s){function r(a){var l=this,c="";l.next=function(){var d=l.b,h=l.c,p=l.d,f=l.a;return d=d<<25^d>>>7^h,h=h-p|0,p=p<<24^p>>>8^f,f=f-d|0,l.b=d=d<<20^d>>>12^h,l.c=h=h-p|0,l.d=p<<16^h>>>16^f,l.a=f-d|0},l.a=0,l.b=0,l.c=-1640531527,l.d=1367130551,a===Math.floor(a)?(l.a=a/4294967296|0,l.b=a|0):c+=a;for(var u=0;u<c.length+20;u++)l.b^=c.charCodeAt(u)|0,l.next()}function i(a,l){return l.a=a.a,l.b=a.b,l.c=a.c,l.d=a.d,l}function o(a,l){var c=new r(a),u=l&&l.state,d=function(){return(c.next()>>>0)/4294967296};return d.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,f=(h+p)/(1<<21);while(f===0);return f},d.int32=c.next,d.quick=d,u&&(typeof u=="object"&&i(u,c),d.state=function(){return i(c,{})}),d}n&&n.exports?n.exports=o:this.tychei=o})(aa,t)})(Rv);var $5=Rv.exports,ME={exports:{}};const T5={},E5=Object.freeze(Object.defineProperty({__proto__:null,default:T5},Symbol.toStringTag,{value:"Module"})),R5=t3(E5);(function(t){(function(e,n,s){var r=256,i=6,o=52,a="random",l=s.pow(r,i),c=s.pow(2,o),u=c*2,d=r-1,h;function p(w,k,S){var I=[];k=k==!0?{entropy:!0}:k||{};var C=y(x(k.entropy?[w,b(n)]:w??v(),3),I),$=new f(I),R=function(){for(var _=$.g(i),M=l,B=0;_<c;)_=(_+B)*r,M*=r,B=$.g(1);for(;_>=u;)_/=2,M/=2,B>>>=1;return(_+B)/M};return R.int32=function(){return $.g(4)|0},R.quick=function(){return $.g(4)/4294967296},R.double=R,y(b($.S),n),(k.pass||S||function(_,M,B,A){return A&&(A.S&&g(A,$),_.state=function(){return g($,{})}),B?(s[a]=_,M):_})(R,C,"global"in k?k.global:this==s,k.state)}function f(w){var k,S=w.length,I=this,C=0,$=I.i=I.j=0,R=I.S=[];for(S||(w=[S++]);C<r;)R[C]=C++;for(C=0;C<r;C++)R[C]=R[$=d&$+w[C%S]+(k=R[C])],R[$]=k;(I.g=function(_){for(var M,B=0,A=I.i,F=I.j,P=I.S;_--;)M=P[A=d&A+1],B=B*r+P[d&(P[A]=P[F=d&F+M])+(P[F]=M)];return I.i=A,I.j=F,B})(r)}function g(w,k){return k.i=w.i,k.j=w.j,k.S=w.S.slice(),k}function x(w,k){var S=[],I=typeof w,C;if(k&&I=="object")for(C in w)try{S.push(x(w[C],k-1))}catch{}return S.length?S:I=="string"?w:w+"\0"}function y(w,k){for(var S=w+"",I,C=0;C<S.length;)k[d&C]=d&(I^=k[d&C]*19)+S.charCodeAt(C++);return b(k)}function v(){try{var w;return h&&(w=h.randomBytes)?w=w(r):(w=new Uint8Array(r),(e.crypto||e.msCrypto).getRandomValues(w)),b(w)}catch{var k=e.navigator,S=k&&k.plugins;return[+new Date,e,S,e.screen,b(n)]}}function b(w){return String.fromCharCode.apply(0,w)}if(y(s.random(),n),t.exports){t.exports=p;try{h=R5}catch{}}else s["seed"+a]=p})(typeof self<"u"?self:aa,[],Math)})(ME);var N5=ME.exports,A5=w5,_5=k5,D5=C5,F5=S5,O5=I5,P5=$5,ma=N5;ma.alea=A5;ma.xor128=_5;ma.xorwow=D5;ma.xorshift7=F5;ma.xor4096=O5;ma.tychei=P5;var Nv=ma;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class LE{constructor(e,n,s,r,i){this.mean=e,this.stdDev=n,this.dtype=s,this.nextVal=NaN,this.truncated=r,this.truncated&&(this.upper=this.mean+this.stdDev*2,this.lower=this.mean-this.stdDev*2);const o=i||Math.random();this.random=Nv.alea(o.toString())}nextValue(){if(!isNaN(this.nextVal)){const r=this.nextVal;return this.nextVal=NaN,r}let e,n,s=!1;for(;!s;){let r,i,o;do r=2*this.random()-1,i=2*this.random()-1,o=r*r+i*i;while(o>=1||o===0);const a=Math.sqrt(-2*Math.log(o)/o);e=this.mean+this.stdDev*r*a,n=this.mean+this.stdDev*i*a,(!this.truncated||this.isValidTruncated(e))&&(s=!0)}return(!this.truncated||this.isValidTruncated(n))&&(this.nextVal=this.convertValue(n)),this.convertValue(e)}convertValue(e){return this.dtype==null||this.dtype==="float32"?e:Math.round(e)}isValidTruncated(e){return e<=this.upper&&e>=this.lower}}class M5{constructor(e=0,n=1,s,r){if(this.canReturnFloat=()=>this.dtype==null||this.dtype==="float32",this.min=e,this.range=n-e,this.dtype=s,r==null&&(r=Math.random()),typeof r=="number"&&(r=r.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error(`The difference between ${e} - ${n} <= 1 and dtype is not float`);this.random=Nv.alea(r)}convertValue(e){return this.canReturnFloat()?e:Math.round(e)}nextValue(){return this.convertValue(this.min+this.range*this.random())}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function L5(t,e=0,n=1,s,r){if(si(t),s!=null&&s==="bool")throw new Error(`Unsupported data type ${s}`);const i=new LE(e,n,s,!1,r),o=$e(t,s);for(let a=0;a<o.values.length;a++)o.values[a]=i.nextValue();return o.toTensor()}const z5=G({randomNormal_:L5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function j5(t,e=0,n=1,s="float32",r){si(t);const i=$e(t,s),o=new M5(e,n,null,r);for(let a=0;a<i.values.length;a++)i.values[a]=o.nextValue();return i.toTensor()}const Dd=G({randomUniform_:j5});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hu(t,e,n=1,s="float32"){if(n===0)throw new Error("Cannot have a step of zero");const r={start:t,stop:e,step:n,dtype:s};return z.runKernel(q1,{},r)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function B5(t){const n={input:N(t,"input","real")};return z.runKernel(X1,n)}const Bp=G({real_:B5});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function W5(t){const n={x:N(t,"x","reciprocal")};return z.runKernel(dd,n)}const V5=G({reciprocal_:W5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function U5(t){const n={x:N(t,"x","relu")};return z.runKernel(hd,n)}const ga=G({relu_:U5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function G5(t){const n={x:N(t,"x","relu6")};return z.runKernel(pd,n)}const zE=G({relu6_:G5});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function H5(t,e){const s={x:N(t,"x","reverse")},r={dims:e};return z.runKernel(Sm,s,r)}const ea=G({reverse_:H5});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function K5(t){const n={x:N(t,"x","round")};return z.runKernel(fd,n)}const jE=G({round_:K5});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function q5(t){const n={x:N(t,"x","rsqrt","float32")};return z.runKernel(md,n)}const BE=G({rsqrt_:q5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function X5(t){const n={x:N(t,"x","selu")};return z.runKernel(gd,n)}const WE=G({selu_:X5});function Y5(t,e,n,s,r,i=[1,1],o="NHWC"){const a=N(t,"x","separableConv2d"),l=N(e,"depthwiseFilter","separableConv2d"),c=N(n,"pointwiseFilter","separableConv2d");let u=a,d=!1;if(a.rank===3&&(d=!0,u=U(a,[1,a.shape[0],a.shape[1],a.shape[2]])),o==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");T(u.rank===4,()=>`Error in separableConv2d: input must be rank 4, but got rank ${u.rank}.`),T(l.rank===4,()=>`Error in separableConv2d: depthwise filter must be rank 4, but got rank ${l.rank}.`),T(c.rank===4,()=>`Error in separableConv2d: pointwise filter must be rank 4, but got rank ${l.rank}.`),T(c.shape[0]===1,()=>`Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got ${c.shape[0]}.`),T(c.shape[1]===1,()=>`Error in separableConv2d: the second dimension of pointwise filter must be 1, but got ${c.shape[1]}.`);const h=l.shape[2],p=l.shape[3];T(c.shape[2]===h*p,()=>`Error in separableConv2d: the third dimension of pointwise filter must be ${h*p}, but got ${c.shape[2]}.`);const f=pv(u,l,s,r,o,i),x=Jo(f,c,1,"valid",o);return d?U(x,[x.shape[1],x.shape[2],x.shape[3]]):x}const VE=G({separableConv2d_:Y5});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Q5(t){const n={x:N(t,"x","sign")};return z.runKernel(vd,n)}const J5=G({sign_:Q5});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Z5(t){const n={x:N(t,"x","sin","float32")};return z.runKernel(yd,n)}const UE=G({sin_:Z5});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eV(t){const n={x:N(t,"x","sinh")};return z.runKernel(xd,n)}const GE=G({sinh_:eV});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tV(t,e,n){const s=N(t,"x","slice1d");return T(s.rank===1,()=>`slice1d expects a rank-1 tensor, but got a rank-${s.rank} tensor`),Qe(s,[e],[n])}const Av=G({slice1d_:tV});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nV(t,e,n){const s=N(t,"x","slice2d");return T(s.rank===2,()=>`slice2d expects a rank-2 tensor, but got a rank-${s.rank} tensor`),Qe(s,e,n)}const HE=G({slice2d_:nV});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sV(t,e,n){const s=N(t,"x","slice3d");return T(s.rank===3,()=>`slice3d expects a rank-3 tensor, but got a rank-${s.rank} tensor`),Qe(s,e,n)}const _v=G({slice3d_:sV});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rV(t,e,n){const s=N(t,"x","slice4d");return T(s.rank===4,()=>`slice4d expects a rank-4 tensor, but got a rank-${s.rank} tensor`),Qe(s,e,n)}const Wp=G({slice4d_:rV});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iV(t,e=-1){const n=N(t,"logits","softmax","float32");if(e===-1&&(e=n.rank-1),e!==n.rank-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${n.rank} and dim was ${e}`);const s={logits:n},r={dim:e};return z.runKernel(Nm,s,r)}const Dv=G({softmax_:iV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oV(t){T(t.dtype==="complex64",()=>`The dtype for tf.spectral.fft() must be complex64 but got ${t.dtype}.`);const e={input:t};return z.runKernel(M1,e)}const KE=G({fft_:oV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aV(t){T(t.dtype==="complex64",()=>`The dtype for tf.spectral.ifft() must be complex64 but got ${t.dtype}.`);const e={input:t};return z.runKernel(j1,e)}const O0=G({ifft_:aV});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lV(t){const e=t.shape[t.shape.length-1],n=t.size/e;let s;if(e<=2){const r=U(t,[n,e]);s=O0(r)}else{const r=[n,2*(e-1)],i=U(Bp(t),[n,e]),o=U(gv(t),[n,e]),a=ea(Qe(i,[0,1],[n,e-2]),1),l=L(ea(Qe(o,[0,1],[n,e-2]),1),ze(-1)),c=$n([i,a],1),u=$n([o,l],1),d=U(vl(c,u),[r[0],r[1]]);s=O0(d)}if(s=Bp(s),t.rank===3&&t.shape[0]!==0){const r=s,i=t.shape[0];s=U(s,[i,s.shape[0]/i,s.shape[1]]),r.dispose()}return s}const cV=G({irfft_:lV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uV(t,e,n=0){const r={x:N(t,"x","split")},i={numOrSizeSplits:e,axis:n};return z.runKernel(Rm,r,i)}const es=G({split_:uV});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dV(t,e){T(t.dtype==="float32",()=>`The dtype for rfft() must be real value but got ${t.dtype}`);let n=t.shape[t.shape.length-1];const s=t.size/n;let r;if(e!=null&&e<n){const f=t.shape.map(x=>0),g=t.shape.map(x=>x);g[t.shape.length-1]=e,r=Qe(t,f,g),n=e}else if(e!=null&&e>n){const f=t.shape.map(g=>g);f[t.shape.length-1]=e-n,r=$n([t,zt(f)],t.shape.length-1),n=e}else r=t;const i=Fe(r),o=U(vl(r,i),[s,n]),a=KE(o),l=Math.floor(n/2)+1,c=Bp(a),u=gv(a),d=es(c,[l,n-l],c.shape.length-1),h=es(u,[l,n-l],u.shape.length-1),p=r.shape.slice();return p[r.shape.length-1]=l,U(vl(d[0],h[0]),p)}const hV=G({rfft_:dV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pV(t,e){let n=N(t,"a","squaredDifference"),s=N(e,"b","squaredDifference");[n,s]=bt(n,s),Se(n.shape,s.shape);const r={a:n,b:s},i={};return z.runKernel(Cd,r,i)}const fV=G({squaredDifference_:pV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mV(t,e){const n=N(t,"x","squeeze","string_or_numeric");return U(n,so(n.shape,e).newShape)}const Fd=G({squeeze_:mV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gV(t,e=0){const n=dE(t,"tensors","stack","string_or_numeric");T(n.length>=1,()=>"Pass at least one tensor to tf.stack"),n.length>0&&T(e<=n[0].rank,()=>"Axis must be <= rank of the tensor");const s=n,r={axis:e};return z.runKernel(ym,s,r)}const Yr=G({stack_:gV});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yV(t,e=0){const s={x:N(t,"x","step")},r={alpha:e};return z.runKernel(Ed,s,r)}const Od=G({step_:yV});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xV(t,e,n,s,r=0,i=0,o=0,a=0,l=0){const u={x:N(t,"x","stridedSlice","string_or_numeric")},d={begin:e,end:n,strides:s,beginMask:r,endMask:i,ellipsisMask:o,newAxisMask:a,shrinkAxisMask:l};return z.runKernel(ev,u,d)}const vV=G({stridedSlice_:xV});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bV(t){const n={x:N(t,"x","tan","float32")};return z.runKernel(Id,n)}const wV=G({tan_:bV});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ln(t,e){f1(t);const n=Rd(t,e);if(n.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return Nd(t,null,n,e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Oo(t,e,n){if(f1(t),e!=null&&e.length!==2)throw new Error("tensor2d() requires shape to have two numbers");const s=Rd(t,n);if(s.length!==2&&s.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(s.length===1&&e==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return Nd(t,e,s,n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fv(t,e,n){if(f1(t),e!=null&&e.length!==3)throw new Error("tensor3d() requires shape to have three numbers");const s=Rd(t,n);if(s.length!==3&&s.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(s.length===1&&e==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return Nd(t,e,s,n)}function qE(t,e,n){const s=e.rank>1?e.shape[e.rank-1]:1,r=e.rank>1?e.rank-1:1,i=`Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: ${n.shape}, indices.shape: ${e.shape}, shape: ${t}, sliceDim: ${s}, and batchDim: ${r}.`;if(n.rank<r)throw new Error(i+` update.rank < ${r}. `);if(t.length<s+(n.rank-r))throw new Error(i+` Output shape length < ${s+(n.rank-r)}`);if(n.rank!==r+t.length-s)throw new Error(i+` update.rank != ${r+t.length-s}`);for(let o=0;o<r;++o)if(n.shape[o]!==e.shape[o])throw new Error(i+` updates.shape[${o}] (${n.shape[o]}) != indices.shape[${o}] (${e.shape[o]}).`);for(let o=0;o<n.rank-r;++o)if(n.shape[o+r]!==t[o+s])throw new Error(i+` updates.shape[${o+r}] (${n.shape[o+r]}) != shape[${o+r}] (${t[o+r]})`)}function kV(t,e,n){if(e.rank<1)throw new Error(`tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ${e.rank}.`);if(t.rank<1)throw new Error(`tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ${t.rank}.`);if(e.dtype!=="int32")throw new Error(`The dtype of 'indices' should be int32, but got dtype: ${e.dtype}`);if(n.length<1)throw new Error(`Output rank must be greater or equal to 1, but got shape: ${n}`);if(n.length===0){if(e.size===0)throw new Error(`Indices specified for empty output. indices shape: ${e.shape}`);if(t.size===0)throw new Error(`Updates specified for empty output. updates shape: ${t.shape}`)}qE(n,e,t)}function ya(t,e,n){const s=e.shape.length,r=s>1?e.shape[s-1]:1,i=n.length;let o=1;for(let d=r;d<i;++d)o*=n[d];const a=r<1?1:r,l=J(e.shape)/a,c=[...me(n.slice(0,r)),1],u=J(n);return{sliceRank:r,numUpdates:l,sliceSize:o,strides:c,outputSize:u}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CV(t,e=1,n=!0){const s=N(t,"x","topk");if(s.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");const r=s.shape[s.shape.length-1];if(e<0)throw new Error(`'k' passed to topk() must be >= 0 but got ${e}`);if(e>r)throw new Error(`'k' passed to topk() must be <= the last dimension (${r}) but got ${e}`);const i={x:s},o={k:e,sorted:n},[a,l]=z.runKernel(tv,i,o);return{values:a,indices:l}}const SV=G({topk_:CV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IV(t,e=0,n=1,s,r){if(si(t),s!=null&&s==="bool")throw new Error("Unsupported data type $ { dtype }");const i=new LE(e,n,s,!0,r),o=$e(t,s);for(let a=0;a<o.values.length;a++)o.values[a]=i.nextValue();return o.toTensor()}const XE=G({truncatedNormal_:IV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $V(t,e=0){const n=N(t,"x","unique","string_or_numeric");T(n.rank>0,()=>"The input tensor must be at least 1D");const s={x:n},r={axis:e},[i,o]=z.runKernel(sv,s,r);return{values:i,indices:o}}const TV=G({unique_:$V});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EV(t,e,n){const s=N(t,"x","unsortedSegmentSum"),r=N(e,"segmentIds","unsortedSegmentSum","int32");T(gl(n),()=>"numSegments must be of dtype int");const i={x:s,segmentIds:r},o={numSegments:n};return z.runKernel(_m,i,o)}const YE=G({unsortedSegmentSum_:EV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RV(t,e=0){const n=N(t,"x","unstack","string_or_numeric");T(e>=-n.shape.length&&e<n.shape.length,()=>`Axis = ${e} is not in [-${n.shape.length}, ${n.shape.length})`);const s={value:n},r={axis:e};return z.runKernel(Am,s,r)}const ta=G({unstack_:RV});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NV(t,e=!0,n,s){return z.makeVariable(t,e,n,s)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QE(t,e){const n=[];for(let i=0;i<e.length;i++)e[i]&&n.push(i);const s=$e(t,"int32"),r=$e([n.length,t.length],"int32");for(let i=0;i<n.length;i++){const o=s.indexToLoc(n[i]),a=i*t.length;r.values.set(o,a)}return r.toTensor()}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AV(t,e,n){const s=N(t,"x","transpose");if(e==null&&(e=s.shape.map((o,a)=>a).reverse()),T(s.rank===e.length,()=>`Error in transpose: rank of input ${s.rank} must match length of perm ${e}.`),e.forEach(o=>{T(o>=0&&o<s.rank,()=>`All entries in 'perm' must be between 0 and ${s.rank-1} but got ${e}`)}),s.rank<=1)return s.clone();const r={x:s},i={perm:e};return s.dtype==="complex64"?K(()=>{let o=Bp(s),a=gv(s);return o=z.runKernel(tl,{x:o},i),a=z.runKernel(tl,{x:a},i),n&&(a=vt(a)),vl(o,a)}):z.runKernel(tl,r,i)}const De=G({transpose_:AV});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _V(t,e){if(e==null)return t.shape.slice();if(je(t.shape,e))return e;if(t.shape.length===e.length){const n=[];for(let s=0;s<t.shape.length;s++)e[s]==null&&t.shape[s]!=null?n.push(t.shape[s]):n.push(e[s]);return n}return e}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DV(t,e,n,s){const r=N(t,"x","dropout");if(T(r.dtype==="float32",()=>`x has to be a floating point tensor since it's going to be scaled, but got a ${r.dtype} tensor instead.`),T(e>=0&&e<1,()=>`rate must be a float in the range [0, 1), but got ${e}.`),e===0)return t instanceof Et?r.clone():r;const i=_V(r,n),o=1-e,a=ye(jm(re(Dd(i,0,1,"float32",s),o)),o);return L(r,a)}const FV=G({dropout_:DV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OV(t,e,n,s,r,i="NHWC",o){let a=t;t.rank===3&&(a=U(t,[1,t.shape[0],t.shape[1],t.shape[2]]));let l=e;l.rank===3&&(l=U(e,[1,e.shape[0],e.shape[1],e.shape[2]])),T(a.rank===4,()=>`Error in conv2dDerFilter: input must be rank 4, but got shape ${a.shape}.`),T(l.rank===4,()=>`Error in conv2dDerFilter: dy must be rank 4, but got shape ${l.shape}.`),T(n.length===4,()=>`Error in conv2dDerFilter: filterShape must be length 4, but got ${n}.`);const c=i==="NHWC"?a.shape[3]:a.shape[1],u=i==="NHWC"?l.shape[3]:l.shape[1];T(c===n[2],()=>`Error in conv2dDerFilter: depth of input ${c}) must match input depth in filter (${n[2]}.`),T(u===n[3],()=>`Error in conv2dDerFilter: depth of dy (${u}) must match output depth for filter (${n[3]}).`),_n("conv2dDerFilter",r,o);const d={x:a,dy:l},h={strides:s,pad:r,dataFormat:i,dimRoundingMode:o,filterShape:n};return z.runKernel($1,d,h)}const Ov=G({conv2DBackpropFilter_:OV});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pv(t,e,n){if(n==null||n==="linear")return t;if(n==="relu")return L(t,Od(e));throw new Error(`Cannot compute gradient for fused activation ${n}.`)}function Mv(t,e){let n=e;const s=Ft(t.shape,e.shape);return s.length>0&&(n=ge(n,s)),U(n,t.shape)}function Lv(t,e,n,s){if(e==="linear")return t;if(e==="relu")return ga(t);if(e==="elu")return Lm(t);if(e==="relu6")return zE(t);if(e==="prelu")return Cv(t,n);if(e==="leakyrelu")return yv(t,s);if(e==="sigmoid")return jl(t);throw new Error(`Unknown fused activation ${e}.`)}const zv=(t,e)=>!(t>0)||e==="linear";/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PV({x:t,filter:e,strides:n,pad:s,dataFormat:r="NHWC",dilations:i=[1,1],dimRoundingMode:o,bias:a,activation:l="linear",preluActivationWeights:c,leakyreluAlpha:u}){if(l=l||"linear",zv(z.state.gradientDepth,l)===!1){T(r==="NHWC",()=>`Error in fused conv2d: got dataFormat of ${r} but only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear.`);let S=Jo(t,e,n,s,r,i,o);return a!=null&&(S=re(S,a)),Lv(S,l,c,u)}const d=N(t,"x","conv2d","float32"),h=N(e,"filter","conv2d","float32");let p=d,f=!1;d.rank===3&&(f=!0,p=U(d,[1,d.shape[0],d.shape[1],d.shape[2]])),T(p.rank===4,()=>`Error in fused conv2d: input must be rank 4, but got rank ${p.rank}.`),T(h.rank===4,()=>`Error in fused conv2d: filter must be rank 4, but got rank ${h.rank}.`),_n("fused conv2d",s,o);const g=r==="NHWC"?p.shape[3]:p.shape[1];T(h.shape[2]===g,()=>`Error in conv2d: depth of input (${g}) must match input depth for filter ${h.shape[2]}.`),T(rn(n,i),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${n} and dilations '${i}'`);const x=qt(p.shape,h.shape,n,i,s,o);let y;a!=null&&(y=N(a,"bias","fused conv2d"),[y]=bt(y,d),r==="NHWC"?Se(x.outShape,y.shape):(T(y.shape.length<=1,()=>`Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of rank-${y.shape.length}.`),T(y.shape.length===0||y.shape[0]===x.outChannels||y.shape[0]===1,()=>`Error in fused conv2d: bias shape (${y.shape}) is not compatible with the number of output channels (${x.outChannels})`)));let v;if(c!=null){const S=c.shape;if(T(S.length<=1||S.length===3,()=>`Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of rank-${S.length}.`),S.length===1)T(S[0]===1||S[0]===x.outChannels,()=>`Error in fused conv2d: PReLU activation weights (${S}) is not compatible with the number of output channels (${x.outChannels}).`);else if(S.length===3)try{Se(S,x.outShape)}catch{const C=`Error in fused conv2d: PReLU activation weights (${S}) is not compatible with the output shape of the conv2d (${x.outShape}).`;throw Error(C)}v=N(c,"prelu weights","fused conv2d")}const b=(S,I)=>{T(r==="NHWC",()=>`Error in gradient of fused conv2D: got dataFormat of ${r} but only NHWC is currently supported.`);const[C,$,R,_]=I,M=Pv(S,R,l);T(Yo(i),()=>`Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${i}'`);const B=dv($.shape,M,C,n,s),A=Ov($,M,C.shape,n,s),F=[B,A];if(_!=null){const P=Mv(_,M);F.push(P)}return F},w={x:p,filter:h,bias:y,preluActivationWeights:v},k={strides:n,pad:s,dataFormat:r,dilations:i,dimRoundingMode:o,activation:l,leakyreluAlpha:u};return a==null?wl((I,C,$)=>{let R=z.runKernel(Fp,w,k);return $([C,I,R]),f&&(R=U(R,[R.shape[1],R.shape[2],R.shape[3]])),{value:R,gradFunc:b}})(p,h):wl((I,C,$,R)=>{let _=z.runKernel(Fp,w,k);return R([C,I,_,$]),f&&(_=U(_,[_.shape[1],_.shape[2],_.shape[3]])),{value:_,gradFunc:b}})(p,h,y)}const MV=G({fusedConv2d_:PV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LV(t,e,n,s,r,i=[1,1],o){let a=t;t.rank===3&&(a=U(t,[1,t.shape[0],t.shape[1],t.shape[2]]));let l=e;l.rank===3&&(l=U(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const c={x:a,dy:l},u={strides:s,pad:r,dimRoundingMode:o,dilations:i,filterShape:n};return z.runKernel(D1,c,u)}const zV=G({depthwiseConv2dNativeBackpropFilter_:LV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jV(t,e,n,s,r,i=[1,1],o){let a=e,l=!1;e.rank===3&&(l=!0,a=U(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const c={dy:a,filter:n},u={strides:s,pad:r,dimRoundingMode:o,dilations:i,inputShape:t},d=z.runKernel(F1,c,u);return l?U(d,[d.shape[1],d.shape[2],d.shape[3]]):d}const BV=G({depthwiseConv2dNativeBackpropInput_:jV});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WV({a:t,b:e,transposeA:n=!1,transposeB:s=!1,bias:r,activation:i="linear",preluActivationWeights:o,leakyreluAlpha:a=.2}){if(zv(z.state.gradientDepth,i)===!1){let _=Le(t,e,n,s);return r!=null&&(_=re(_,r)),Lv(_,i,o,a)}let l=N(t,"a","fused matMul"),c=N(e,"b","fused matMul");[l,c]=bt(l,c);const u=n?l.shape[l.rank-2]:l.shape[l.rank-1],d=s?c.shape[c.rank-1]:c.shape[c.rank-2],h=n?l.shape[l.rank-1]:l.shape[l.rank-2],p=s?c.shape[c.rank-2]:c.shape[c.rank-1],f=l.shape.slice(0,-2),g=c.shape.slice(0,-2),x=J(f),y=J(g);T(u===d,()=>`Error in fused matMul: inner shapes (${u}) and (${d}) of Tensors with shapes ${l.shape} and ${c.shape} and transposeA=${n} and transposeB=${s} must match.`);const b=Se(l.shape.slice(0,-2),c.shape.slice(0,-2)).concat([h,p]),w=n?U(l,[x,u,h]):U(l,[x,h,u]),k=s?U(c,[y,p,d]):U(c,[y,d,p]);let S;r!=null&&(S=N(r,"bias","fused matMul"),[S]=bt(S,l),Se(b,S.shape));let I;o!=null&&(I=N(o,"prelu weights","fused matMul"));const C=(_,M)=>{const[B,A,F,P]=M,H=Pv(U(_,F.shape),F,i);let E,D;if(!n&&!s?(E=Le(H,A,!1,!0),D=Le(B,H,!0,!1)):!n&&s?(E=Le(H,A,!1,!1),D=Le(H,B,!0,!1)):n&&!s?(E=Le(A,H,!1,!0),D=Le(B,H,!1,!1)):(E=Le(A,H,!0,!0),D=Le(H,B,!0,!0)),r!=null){const V=Mv(P,H);return[E,D,V]}else return[E,D]},$={a:w,b:k,bias:S,preluActivationWeights:I},R={transposeA:n,transposeB:s,activation:i,leakyreluAlpha:a};return r==null?wl((M,B,A)=>{const F=z.runKernel(Dp,$,R);return A([M,B,F]),{value:U(F,b),gradFunc:C}})(w,k):wl((M,B,A,F)=>{const P=z.runKernel(Dp,$,R);return F([M,B,P,A]),{value:U(P,b),gradFunc:C}})(w,k,S)}const Sk=G({fusedMatMul_:WV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VV(t,e,n,s,r="bilinear",i=0){const o=N(t,"image","cropAndResize"),a=N(e,"boxes","cropAndResize","float32"),l=N(n,"boxInd","cropAndResize","int32"),c=a.shape[0];T(o.rank===4,()=>`Error in cropAndResize: image must be rank 4,but got rank ${o.rank}.`),T(a.rank===2&&a.shape[1]===4,()=>`Error in cropAndResize: boxes must be have size [${c},4] but had shape ${a.shape}.`),T(l.rank===1&&l.shape[0]===c,()=>`Error in cropAndResize: boxInd must be have size [${c}] but had shape ${a.shape}.`),T(s.length===2,()=>`Error in cropAndResize: cropSize must be of length 2, but got length ${s.length}.`),T(s[0]>=1&&s[1]>=1,()=>`cropSize must be atleast [1,1], but was ${s}`),T(r==="bilinear"||r==="nearest",()=>`method must be bilinear or nearest, but was ${r}`);const u={image:o,boxes:a,boxInd:l},d={method:r,extrapolationValue:i,cropSize:s};return z.runKernel(N1,u,d)}const UV=G({cropAndResize_:VV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GV(t){const e=N(t,"image","flipLeftRight","float32");T(e.rank===4,()=>`Error in flipLeftRight: image must be rank 4,but got rank ${e.rank}.`);const n={image:e};return z.runKernel(z1,n,{})}const HV=G({flipLeftRight_:GV});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KV(t){const e=N(t,"image","grayscaleToRGB"),n=e.rank-1,s=e.shape[n];T(e.rank>=2,()=>`Error in grayscaleToRGB: images must be at least rank 2, but got rank ${e.rank}.`),T(s===1,()=>`Error in grayscaleToRGB: last dimension of a grayscale image should be size 1, but got size ${s}.`);const r=new Array(e.rank);return r.fill(1,0,n),r[n]=3,Us(e,r)}const qV=G({grayscaleToRGB_:KV});/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XV(t){const e=N(t,"image","RGBToGrayscale"),n=e.rank-1,s=e.shape[n];T(e.rank>=2,()=>`Error in RGBToGrayscale: images must be at least rank 2, but got rank ${e.rank}.`),T(s===3,()=>`Error in RGBToGrayscale: last dimension of an RGB image should be size 3, but got size ${s}.`);const r=e.dtype,i=de(e,"float32"),o=Ln([.2989,.587,.114]);let a;switch(e.rank){case 2:a=dc("ij,j->i",i,o);break;case 3:a=dc("ijk,k->ij",i,o);break;case 4:a=dc("ijkl,l->ijk",i,o);break;case 5:a=dc("ijklm,m->ijkl",i,o);break;case 6:a=dc("ijklmn,n->ijklm",i,o);break;default:throw new Error("Not a valid tensor rank.")}return a=Cn(a,-1),de(a,r)}const YV=G({rgbToGrayscale_:XV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QV(t,e,n=0,s=.5){const r=N(t,"image","rotateWithOffset","float32");T(r.rank===4,()=>`Error in rotateWithOffset: image must be rank 4,but got rank ${r.rank}.`);const i={image:r},o={radians:e,fillValue:n,center:s};return z.runKernel(rv,i,o)}const JV=G({rotateWithOffset_:QV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wl(t,e,n,s,r,i){s==null&&(s=.5),r==null&&(r=Number.NEGATIVE_INFINITY),i==null&&(i=0);const o=t.shape[0];return n=Math.min(n,o),T(0<=s&&s<=1,()=>`iouThreshold must be in [0, 1], but was '${s}'`),T(t.rank===2,()=>`boxes must be a 2D tensor, but was of rank '${t.rank}'`),T(t.shape[1]===4,()=>`boxes must have 4 columns, but 2nd dimension was ${t.shape[1]}`),T(e.rank===1,()=>"scores must be a 1D tensor"),T(e.shape[0]===o,()=>`scores has incompatible shape with boxes. Expected ${o}, but was ${e.shape[0]}`),T(0<=i&&i<=1,()=>`softNmsSigma must be in [0, 1], but was '${i}'`),{maxOutputSize:n,iouThreshold:s,scoreThreshold:r,softNmsSigma:i}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZV(t,e,n,s=.5,r=Number.NEGATIVE_INFINITY){const i=N(t,"boxes","nonMaxSuppression","float32"),o=N(e,"scores","nonMaxSuppression","float32"),a=Wl(i,o,n,s,r);n=a.maxOutputSize,s=a.iouThreshold,r=a.scoreThreshold;const l={maxOutputSize:n,iouThreshold:s,scoreThreshold:r};return z.runKernel(G1,{boxes:i,scores:o},l)}const eU=G({nonMaxSuppression_:ZV});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tU(t,e,n){const s=nU(t,e,n),r=s<0?-(s+1):s;t.splice(r,0,e)}function nU(t,e,n){return rU(t,e,n||sU)}function sU(t,e){return t>e?1:t<e?-1:0}function rU(t,e,n){let s=0,r=t.length,i=0,o=!1;for(;s<r;){i=s+(r-s>>>1);const a=n(e,t[i]);a>0?s=i+1:(r=i,o=!a)}return o?s:-s-1}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jv(t,e,n,s,r){return Vv(t,e,n,s,r,0)}function Bv(t,e,n,s,r,i){return Vv(t,e,n,s,r,0,!1,i,!0)}function Wv(t,e,n,s,r,i){return Vv(t,e,n,s,r,i,!0)}function Vv(t,e,n,s,r,i,o=!1,a=!1,l=!1){const c=[];for(let x=0;x<e.length;x++)e[x]>r&&c.push({score:e[x],boxIndex:x,suppressBeginIndex:0});c.sort(Ik);const u=i>0?-.5/i:0,d=[],h=[];for(;d.length<n&&c.length>0;){const x=c.pop(),{score:y,boxIndex:v,suppressBeginIndex:b}=x;if(y<r)break;let w=!1;for(let k=d.length-1;k>=b;--k){const S=iU(t,v,d[k]);if(S>=s){w=!0;break}if(x.score=x.score*oU(s,u,S),x.score<=r)break}x.suppressBeginIndex=d.length,w||(x.score===y?(d.push(v),h.push(x.score)):x.score>r&&tU(c,x,Ik))}const p=d.length,f=n-p;a&&f>0&&(d.push(...new Array(f).fill(0)),h.push(...new Array(f).fill(0)));const g={selectedIndices:d};return o&&(g.selectedScores=h),l&&(g.validOutputs=p),g}function iU(t,e,n){const s=t.subarray(e*4,e*4+4),r=t.subarray(n*4,n*4+4),i=Math.min(s[0],s[2]),o=Math.min(s[1],s[3]),a=Math.max(s[0],s[2]),l=Math.max(s[1],s[3]),c=Math.min(r[0],r[2]),u=Math.min(r[1],r[3]),d=Math.max(r[0],r[2]),h=Math.max(r[1],r[3]),p=(a-i)*(l-o),f=(d-c)*(h-u);if(p<=0||f<=0)return 0;const g=Math.max(i,c),x=Math.max(o,u),y=Math.min(a,d),v=Math.min(l,h),b=Math.max(y-g,0)*Math.max(v-x,0);return b/(p+f-b)}function oU(t,e,n){const s=Math.exp(e*n*n);return n<=t?s:0}function Ik(t,e){return t.score-e.score||t.score===e.score&&e.boxIndex-t.boxIndex}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function aU(t,e,n,s=.5,r=Number.NEGATIVE_INFINITY){const i=N(t,"boxes","nonMaxSuppressionAsync"),o=N(e,"scores","nonMaxSuppressionAsync"),a=Wl(i,o,n,s,r);n=a.maxOutputSize,s=a.iouThreshold,r=a.scoreThreshold;const l=await Promise.all([i.data(),o.data()]),c=l[0],u=l[1],{selectedIndices:d}=jv(c,u,n,s,r);return i!==t&&i.dispose(),o!==e&&o.dispose(),Ln(d,"int32")}const lU=aU;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cU(t,e,n,s=.5,r=Number.NEGATIVE_INFINITY,i=0){const o=N(t,"boxes","nonMaxSuppression"),a=N(e,"scores","nonMaxSuppression"),l=Wl(o,a,n,s,r,i);n=l.maxOutputSize,s=l.iouThreshold,r=l.scoreThreshold,i=l.softNmsSigma;const c={boxes:o,scores:a},u={maxOutputSize:n,iouThreshold:s,scoreThreshold:r,softNmsSigma:i},d=z.runKernel(K1,c,u);return{selectedIndices:d[0],selectedScores:d[1]}}const uU=G({nonMaxSuppressionWithScore_:cU});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function dU(t,e,n,s=.5,r=Number.NEGATIVE_INFINITY,i=0){const o=N(t,"boxes","nonMaxSuppressionAsync"),a=N(e,"scores","nonMaxSuppressionAsync"),l=Wl(o,a,n,s,r,i);n=l.maxOutputSize,s=l.iouThreshold,r=l.scoreThreshold,i=l.softNmsSigma;const c=await Promise.all([o.data(),a.data()]),u=c[0],d=c[1],{selectedIndices:h,selectedScores:p}=Wv(u,d,n,s,r,i);return o!==t&&o.dispose(),a!==e&&a.dispose(),{selectedIndices:Ln(h,"int32"),selectedScores:Ln(p)}}const hU=dU;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pU(t,e,n,s=.5,r=Number.NEGATIVE_INFINITY,i=!1){const o=N(t,"boxes","nonMaxSuppression"),a=N(e,"scores","nonMaxSuppression"),l=Wl(o,a,n,s,r,null),c=l.maxOutputSize,u=l.iouThreshold,d=l.scoreThreshold,h={boxes:o,scores:a},p={maxOutputSize:c,iouThreshold:u,scoreThreshold:d,padToMaxOutputSize:i},f=z.runKernel(H1,h,p);return{selectedIndices:f[0],validOutputs:f[1]}}const fU=G({nonMaxSuppressionPadded_:pU});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function mU(t,e,n,s=.5,r=Number.NEGATIVE_INFINITY,i=!1){const o=N(t,"boxes","nonMaxSuppressionAsync"),a=N(e,"scores","nonMaxSuppressionAsync"),l=Wl(o,a,n,s,r,null),c=l.maxOutputSize,u=l.iouThreshold,d=l.scoreThreshold,[h,p]=await Promise.all([o.data(),a.data()]),{selectedIndices:f,validOutputs:g}=Bv(h,p,c,u,d,i);return o!==t&&o.dispose(),a!==e&&a.dispose(),{selectedIndices:Ln(f,"int32"),validOutputs:ze(g,"int32")}}const gU=mU;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yU(t,e,n=!1,s=!1){const r=N(t,"images","resizeBilinear");T(r.rank===3||r.rank===4,()=>`Error in resizeBilinear: x must be rank 3 or 4, but got rank ${r.rank}.`),T(e.length===2,()=>`Error in resizeBilinear: new shape must 2D, but got shape ${e}.`),T(s===!1||n===!1,()=>"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false.");let i=r,o=!1;r.rank===3&&(o=!0,i=U(r,[1,r.shape[0],r.shape[1],r.shape[2]]));const a={images:i},l={alignCorners:n,halfPixelCenters:s,size:e},c=z.runKernel(Cm,a,l);return o?U(c,[c.shape[1],c.shape[2],c.shape[3]]):c}const JE=G({resizeBilinear_:yU});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xU(t,e,n=!1,s=!1){const r=N(t,"images","resizeNearestNeighbor");T(r.rank===3||r.rank===4,()=>`Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ${r.rank}.`),T(e.length===2,()=>`Error in resizeNearestNeighbor: new shape must 2D, but got shape ${e}.`),T(r.dtype==="float32"||r.dtype==="int32",()=>"`images` must have `int32` or `float32` as dtype"),T(s===!1||n===!1,()=>"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false.");let i=r,o=!1;r.rank===3&&(o=!0,i=U(r,[1,r.shape[0],r.shape[1],r.shape[2]]));const a={images:i},l={alignCorners:n,halfPixelCenters:s,size:e},c=z.runKernel(km,a,l);return o?U(c,[c.shape[1],c.shape[2],c.shape[3]]):c}const ZE=G({resizeNearestNeighbor_:xU});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vU(t,e="binary",n=!1,s=.5){const r=N(t,"image","threshold"),i=.2989,o=.587,a=.114,l=r.shape[0]*r.shape[1];let c=L(Ln([s]),255),u,d,h,p;if(T(r.rank===3,()=>`Error in threshold: image must be rank 3,but got rank ${r.rank}.`),T(r.shape[2]===3||r.shape[2]===1,()=>`Error in threshold: image color channel must be equal to 3 or 1but got ${r.shape[2]}.`),T(r.dtype==="int32"||r.dtype==="float32",()=>`Error in dtype: image dtype must be int32 or float32,but got dtype ${r.dtype}.`),T(e==="otsu"||e==="binary",()=>`Method must be binary or otsu, but was ${e}`),r.shape[2]===3){[u,d,h]=es(r,[1,1,1],-1);const x=L(u,i),y=L(d,o),v=L(h,a);p=re(re(x,y),v)}else p=t;if(e==="otsu"){const x=x6(de(jE(p),"int32"),hE([]),256);c=bU(x,l)}const f=n?Bl(p,c):os(p,c);return de(L(f,255),"int32")}function bU(t,e){let n=Ln([-1]),s=Ln([0]),r=Ln([0]),i,o,a,l,c,u;for(let d=0;d<t.size-1;d++){i=Qe(t,0,d+1),o=Qe(t,d+1),c=ye(ge(i),e),u=ye(ge(o),e);const h=ge(L(i,hu(0,i.size)));a=ye(h,ge(i));const p=Mm(o.shape,i.size),f=re(hu(0,o.size),p),g=L(o,f);l=ye(ge(g),ge(o));const x=ve(a,l),y=ve(a,l),v=L(c,u);r=L(L(v,x),y);const b=os(r,s);s=yn(b,r,s),n=yn(b,Ln([d]),n)}return n}const wU=G({threshold_:vU});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kU(t,e,n="nearest",s="constant",r=0,i){const o=N(t,"image","transform","float32"),a=N(e,"transforms","transform","float32");T(o.rank===4,()=>`Error in transform: image must be rank 4,but got rank ${o.rank}.`),T(a.rank===2&&(a.shape[0]===o.shape[0]||a.shape[0]===1)&&a.shape[1]===8,()=>"Error in transform: Input transform should be batch x 8 or 1 x 8"),T(i==null||i.length===2,()=>`Error in transform: outputShape must be [height, width] or null, but got ${i}.`);const l={image:o,transforms:a},c={interpolation:n,fillMode:s,fillValue:r,outputShape:i};return z.runKernel(nv,l,c)}const CU=G({transform_:kU});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SU(t,e,n){const s=N(t,"a","bandPart");T(s.rank>=2,()=>`bandPart(): Rank must be at least 2, got ${s.rank}.`);const r=s.shape,[i,o]=s.shape.slice(-2);let a,l;typeof e=="number"?(T(e%1===0,()=>`bandPart(): numLower must be an integer, got ${e}.`),T(e<=i,()=>`bandPart(): numLower (${e}) must not be greater than the number of rows (${i}).`),a=N(e<0?i:e,"numLower","bandPart")):(T(e.dtype==="int32",()=>"bandPart(): numLower's dtype must be an int32."),a=yn(zp(e,0),i,du(e,i))),typeof n=="number"?(T(n%1===0,()=>`bandPart(): numUpper must be an integer, got ${n}.`),T(n<=o,()=>`bandPart(): numUpper (${n}) must not be greater than the number of columns (${o}).`),l=N(n<0?o:n,"numUpper","bandPart")):(T(n.dtype==="int32",()=>"bandPart(): numUpper's dtype must be an int32."),l=yn(zp(n,0),o,du(n,o)));const c=U(hu(0,i,1,"int32"),[-1,1]),u=hu(0,o,1,"int32"),d=ve(c,u),h=Xr(Bl(d,a),fa(d,vt(l))),p=zt([i,o],s.dtype);return U(Yr(ta(U(s,[-1,i,o])).map(f=>yn(h,f,p))),r)}const IU=G({bandPart_:SU});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $U(t){let e;if(Array.isArray(t)){e=!1,T(t!=null&&t.length>0,()=>"Gram-Schmidt process: input must not be null, undefined, or empty");const r=t[0].shape[0];for(let i=1;i<t.length;++i)T(t[i].shape[0]===r,()=>`Gram-Schmidt: Non-unique lengths found in the input vectors: (${t[i].shape[0]} vs. ${r})`)}else e=!0,t=es(t,t.shape[0],0).map(r=>Fd(r,[0]));T(t.length<=t[0].shape[0],()=>`Gram-Schmidt: Number of vectors (${t.length}) exceeds number of dimensions (${t[0].shape[0]}).`);const n=[],s=t;for(let r=0;r<t.length;++r)n.push(z.tidy(()=>{let i=s[r];if(r>0)for(let o=0;o<r;++o){const a=L(ge(L(n[o],i)),n[o]);i=ve(i,a)}return ye(i,zm(i,"euclidean"))}));return e?Yr(n,0):n}const TU=G({gramSchmidt_:$U});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EU(t,e=!1){if(T(t.rank>=2,()=>`qr() requires input tensor to have a rank >= 2, but got rank ${t.rank}`),t.rank===2)return $k(t,e);{const n=t.shape.slice(0,t.shape.length-2).reduce((l,c)=>l*c),s=ta(U(t,[n,t.shape[t.shape.length-2],t.shape[t.shape.length-1]]),0),r=[],i=[];s.forEach(l=>{const[c,u]=$k(l,e);r.push(c),i.push(u)});const o=U(Yr(r,0),t.shape),a=U(Yr(i,0),t.shape);return[o,a]}}function $k(t,e=!1){return z.tidy(()=>{T(t.shape.length===2,()=>`qr2d() requires a 2D Tensor, but got a ${t.shape.length}D Tensor.`);const n=t.shape[0],s=t.shape[1];let r=AE(n),i=Fo(t);const o=Oo([[1]],[1,1]);let a=Fo(o);const l=n>=s?s:n;for(let c=0;c<l;++c){const u=i,d=a,h=r;[a,i,r]=z.tidy(()=>{const p=Qe(i,[c,c],[n-c,1]),f=zm(p),g=Qe(i,[c,c],[1,1]),x=yn(os(g,0),Oo([[-1]]),Oo([[1]])),y=ve(g,L(x,f)),v=ye(p,y);v.shape[0]===1?a=Fo(o):a=$n([o,Qe(v,[1,0],[v.shape[0]-1,v.shape[1]])],0);const b=vt(ye(Le(x,y),f)),w=Qe(i,[c,0],[n-c,s]),k=L(b,a),S=De(a);if(c===0)i=ve(w,Le(k,Le(S,w)));else{const $=ve(w,Le(k,Le(S,w)));i=$n([Qe(i,[0,0],[c,s]),$],0)}const I=De(k),C=Qe(r,[0,c],[n,r.shape[1]-c]);if(c===0)r=ve(C,Le(Le(C,a),I));else{const $=ve(C,Le(Le(C,a),I));r=$n([Qe(r,[0,0],[n,c]),$],1)}return[a,i,r]}),Re([u,d,h])}return!e&&n>s&&(r=Qe(r,[0,0],[n,s]),i=Qe(i,[0,0],[s,s])),[r,i]})}const RU=G({qr_:EU});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lr={flipLeftRight:HV,grayscaleToRGB:qV,resizeNearestNeighbor:ZE,resizeBilinear:JE,rgbToGrayscale:YV,rotateWithOffset:JV,cropAndResize:UV,nonMaxSuppression:eU,nonMaxSuppressionAsync:lU,nonMaxSuppressionWithScore:uU,nonMaxSuppressionWithScoreAsync:hU,nonMaxSuppressionPadded:fU,nonMaxSuppressionPaddedAsync:gU,threshold:wU,transform:CU},NU={bandPart:IU,gramSchmidt:TU,qr:RU};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AU=new Map,_U=new Map;class Vl{getClassName(){return this.constructor.className}static fromConfig(e,n){return new e(n)}}class fs{constructor(){this.classNameMap={}}static getMap(){return fs.instance==null&&(fs.instance=new fs),fs.instance}static register(e){fs.getMap().classNameMap[e.className]=[e,e.fromConfig]}}function te(t,e,n){T(t.className!=null,()=>"Class being registered does not have the static className property defined."),T(typeof t.className=="string",()=>"className is required to be a string, but got type "+typeof t.className),T(t.className.length>0,()=>"Class being registered has an empty-string as its className, which is disallowed."),typeof e>"u"&&(e="Custom"),typeof n>"u"&&(n=t.className);const s=n,r=e+">"+s;return fs.register(t),AU.set(r,t),_U.set(t,r),t}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class co extends Vl{minimize(e,n=!1,s){const{value:r,grads:i}=this.computeGradients(e,s);if(s!=null){const o=s.map(a=>({name:a.name,tensor:i[a.name]}));this.applyGradients(o)}else this.applyGradients(i);return Re(i),n?r:(r.dispose(),null)}get iterations(){return this.iterations_==null&&(this.iterations_=0),this.iterations_}incrementIterations(){this.iterations_=this.iterations+1}computeGradients(e,n){return zW(e,n)}dispose(){this.iterations_!=null&&Re(this.iterations_)}async saveIterations(){return this.iterations_==null&&(this.iterations_=0),{name:"iter",tensor:ze(this.iterations_,"int32")}}async getWeights(){throw new Error("getWeights() is not implemented for this optimizer yet.")}async setWeights(e){throw new Error(`setWeights() is not implemented for this optimizer class ${this.getClassName()}`)}async extractIterations(e){return this.iterations_=(await e[0].tensor.data())[0],e.slice(1)}}Object.defineProperty(co,Symbol.hasInstance,{value:t=>t.minimize!=null&&t.computeGradients!=null&&t.applyGradients!=null});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class eR extends co{static get className(){return"Adadelta"}constructor(e,n,s=null){super(),this.learningRate=e,this.rho=n,this.epsilon=s,this.accumulatedGrads=[],this.accumulatedUpdates=[],s==null&&(this.epsilon=z.backend.epsilon())}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const i=z.registeredVariables[s],o=!1;this.accumulatedGrads[r]==null&&(this.accumulatedGrads[r]={originalName:`${s}/accum_grad`,variable:K(()=>Fe(i).variable(o))}),this.accumulatedUpdates[r]==null&&(this.accumulatedUpdates[r]={originalName:`${s}/accum_var`,variable:K(()=>Fe(i).variable(o))});const a=Array.isArray(e)?e[r].tensor:e[s];if(a==null)return;const l=this.accumulatedGrads[r].variable,c=this.accumulatedUpdates[r].variable;K(()=>{const u=re(L(l,this.rho),L(et(a),1-this.rho)),d=L(ye(sn(re(c,this.epsilon)),sn(re(l,this.epsilon))),a),h=re(L(c,this.rho),L(et(d),1-this.rho));l.assign(u),c.assign(h);const p=re(L(d,-this.learningRate),i);i.assign(p)})}),this.incrementIterations()}dispose(){this.accumulatedUpdates!=null&&(Re(this.accumulatedGrads.map(e=>e.variable)),Re(this.accumulatedUpdates.map(e=>e.variable)))}async getWeights(){const e=[...this.accumulatedGrads,...this.accumulatedUpdates];return[await this.saveIterations()].concat(e.map(n=>({name:n.originalName,tensor:n.variable})))}async setWeights(e){e=await this.extractIterations(e);const n=e.length/2,s=!1;this.accumulatedGrads=e.slice(0,n).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.accumulatedUpdates=e.slice(n,n*2).map(r=>({originalName:r.name,variable:r.tensor.variable(s)}))}getConfig(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}static fromConfig(e,n){return new e(n.learningRate,n.rho,n.epsilon)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class tR extends co{static get className(){return"Adagrad"}constructor(e,n=.1){super(),this.learningRate=e,this.initialAccumulatorValue=n,this.accumulatedGrads=[]}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const i=z.registeredVariables[s];this.accumulatedGrads[r]==null&&(this.accumulatedGrads[r]={originalName:`${s}/accumulator`,variable:K(()=>Mm(i.shape,this.initialAccumulatorValue).variable(!1))});const o=Array.isArray(e)?e[r].tensor:e[s];if(o==null)return;const a=this.accumulatedGrads[r].variable;K(()=>{const l=re(a,et(o));a.assign(l);const c=re(L(ye(o,sn(re(l,z.backend.epsilon()))),-this.learningRate),i);i.assign(c)})}),this.incrementIterations()}dispose(){this.accumulatedGrads!=null&&Re(this.accumulatedGrads.map(e=>e.variable))}async getWeights(){return[await this.saveIterations()].concat(this.accumulatedGrads.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);const n=!1;this.accumulatedGrads=e.map(s=>({originalName:s.name,variable:s.tensor.variable(n)}))}getConfig(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}static fromConfig(e,n){return new e(n.learningRate,n.initialAccumulatorValue)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class nR extends co{static get className(){return"Adam"}constructor(e,n,s,r=null){super(),this.learningRate=e,this.beta1=n,this.beta2=s,this.epsilon=r,this.accumulatedFirstMoment=[],this.accumulatedSecondMoment=[],K(()=>{this.accBeta1=ze(n).variable(),this.accBeta2=ze(s).variable()}),r==null&&(this.epsilon=z.backend.epsilon())}applyGradients(e){const n=Array.isArray(e)?e.map(s=>s.name):Object.keys(e);K(()=>{const s=ve(1,this.accBeta1),r=ve(1,this.accBeta2);n.forEach((i,o)=>{const a=z.registeredVariables[i],l=!1;this.accumulatedFirstMoment[o]==null&&(this.accumulatedFirstMoment[o]={originalName:`${i}/m`,variable:K(()=>Fe(a).variable(l))}),this.accumulatedSecondMoment[o]==null&&(this.accumulatedSecondMoment[o]={originalName:`${i}/v`,variable:K(()=>Fe(a).variable(l))});const c=Array.isArray(e)?e[o].tensor:e[i];if(c==null)return;const u=this.accumulatedFirstMoment[o].variable,d=this.accumulatedSecondMoment[o].variable,h=re(L(u,this.beta1),L(c,1-this.beta1)),p=re(L(d,this.beta2),L(et(c),1-this.beta2)),f=ye(h,s),g=ye(p,r);u.assign(h),d.assign(p);const x=re(L(ye(f,re(sn(g),this.epsilon)),-this.learningRate),a);a.assign(x)}),this.accBeta1.assign(L(this.accBeta1,this.beta1)),this.accBeta2.assign(L(this.accBeta2,this.beta2))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&Re(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedSecondMoment!=null&&Re(this.accumulatedSecondMoment.map(e=>e.variable))}async getWeights(){const e=[...this.accumulatedFirstMoment,...this.accumulatedSecondMoment];return[await this.saveIterations()].concat(e.map(n=>({name:n.originalName,tensor:n.variable})))}async setWeights(e){e=await this.extractIterations(e),K(()=>{this.accBeta1.assign(Zo(this.beta1,this.iterations_+1)),this.accBeta2.assign(Zo(this.beta2,this.iterations_+1))});const n=e.length/2,s=!1;this.accumulatedFirstMoment=e.slice(0,n).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.accumulatedSecondMoment=e.slice(n,n*2).map(r=>({originalName:r.name,variable:r.tensor.variable(s)}))}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}static fromConfig(e,n){return new e(n.learningRate,n.beta1,n.beta2,n.epsilon)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class sR extends co{static get className(){return"Adamax"}constructor(e,n,s,r=null,i=0){super(),this.learningRate=e,this.beta1=n,this.beta2=s,this.epsilon=r,this.decay=i,this.accumulatedFirstMoment=[],this.accumulatedWeightedInfNorm=[],K(()=>{this.iteration=ze(0).variable(),this.accBeta1=ze(n).variable()}),r==null&&(this.epsilon=z.backend.epsilon())}applyGradients(e){const n=Array.isArray(e)?e.map(s=>s.name):Object.keys(e);K(()=>{const s=ve(1,this.accBeta1),r=ye(-this.learningRate,re(L(this.iteration,this.decay),1));n.forEach((i,o)=>{const a=z.registeredVariables[i],l=!1;this.accumulatedFirstMoment[o]==null&&(this.accumulatedFirstMoment[o]={originalName:`${i}/m`,variable:Fe(a).variable(l)}),this.accumulatedWeightedInfNorm[o]==null&&(this.accumulatedWeightedInfNorm[o]={originalName:`${i}/v`,variable:Fe(a).variable(l)});const c=Array.isArray(e)?e[o].tensor:e[i];if(c==null)return;const u=this.accumulatedFirstMoment[o].variable,d=this.accumulatedWeightedInfNorm[o].variable,h=re(L(u,this.beta1),L(c,1-this.beta1)),p=L(d,this.beta2),f=hn(c),g=ao(p,f);u.assign(h),d.assign(g);const x=re(L(ye(r,s),ye(h,re(g,this.epsilon))),a);a.assign(x)}),this.iteration.assign(re(this.iteration,1)),this.accBeta1.assign(L(this.accBeta1,this.beta1))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&Re(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedWeightedInfNorm!=null&&Re(this.accumulatedWeightedInfNorm.map(e=>e.variable))}async getWeights(){throw new Error("getWeights() is not implemented for Adamax yet.")}async setWeights(e){throw new Error("setWeights() is not implemented for Adamax yet.")}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}static fromConfig(e,n){return new e(n.learningRate,n.beta1,n.beta2,n.epsilon,n.decay)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Uv extends co{static get className(){return"SGD"}constructor(e){super(),this.learningRate=e,this.setLearningRate(e)}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const i=Array.isArray(e)?e[r].tensor:e[s];if(i==null)return;const o=z.registeredVariables[s];K(()=>{const a=re(L(this.c,i),o);o.assign(a)})}),this.incrementIterations()}setLearningRate(e){this.learningRate=e,this.c!=null&&this.c.dispose(),this.c=yr(ze(-e))}dispose(){this.c.dispose()}async getWeights(){return[await this.saveIterations()]}async setWeights(e){if(e=await this.extractIterations(e),e.length!==0)throw new Error("SGD optimizer does not have settable weights.")}getConfig(){return{learningRate:this.learningRate}}static fromConfig(e,n){return new e(n.learningRate)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class rR extends Uv{static get className(){return"Momentum"}constructor(e,n,s=!1){super(e),this.learningRate=e,this.momentum=n,this.useNesterov=s,this.accumulations=[],this.m=ze(this.momentum)}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const i=z.registeredVariables[s];this.accumulations[r]==null&&(this.accumulations[r]={originalName:`${s}/momentum`,variable:K(()=>Fe(i).variable(!1))});const o=this.accumulations[r].variable,a=Array.isArray(e)?e[r].tensor:e[s];a!=null&&K(()=>{let l;const c=re(L(this.m,o),a);this.useNesterov?l=re(L(this.c,re(a,L(c,this.m))),i):l=re(L(this.c,c),i),o.assign(c),i.assign(l)})}),this.incrementIterations()}dispose(){this.m.dispose(),this.accumulations!=null&&Re(this.accumulations.map(e=>e.variable))}setMomentum(e){this.momentum=e}async getWeights(){return[await this.saveIterations()].concat(this.accumulations.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);const n=!1;this.accumulations=e.map(s=>({originalName:s.name,variable:s.tensor.variable(n)}))}getConfig(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}static fromConfig(e,n){return new e(n.learningRate,n.momentum,n.useNesterov)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class iR extends co{static get className(){return"RMSProp"}constructor(e,n=.9,s=0,r=null,i=!1){if(super(),this.learningRate=e,this.decay=n,this.momentum=s,this.epsilon=r,this.accumulatedMeanSquares=[],this.accumulatedMoments=[],this.accumulatedMeanGrads=[],this.centered=i,r==null&&(this.epsilon=z.backend.epsilon()),e==null)throw new Error("learningRate for RMSPropOptimizer must be defined.")}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const i=z.registeredVariables[s],o=!1;this.accumulatedMeanSquares[r]==null&&(this.accumulatedMeanSquares[r]={originalName:`${s}/rms`,variable:K(()=>Fe(i).variable(o))}),this.accumulatedMoments[r]==null&&(this.accumulatedMoments[r]={originalName:`${s}/momentum`,variable:K(()=>Fe(i).variable(o))}),this.accumulatedMeanGrads[r]==null&&this.centered&&(this.accumulatedMeanGrads[r]={originalName:`${s}/mg`,variable:K(()=>Fe(i).variable(o))});const a=Array.isArray(e)?e[r].tensor:e[s];if(a==null)return;const l=this.accumulatedMeanSquares[r].variable,c=this.accumulatedMoments[r].variable;K(()=>{const u=re(L(l,this.decay),L(et(a),1-this.decay));if(this.centered){const d=this.accumulatedMeanGrads[r].variable,h=re(L(d,this.decay),L(a,1-this.decay)),p=ye(L(a,this.learningRate),sn(ve(u,re(et(h),this.epsilon)))),f=re(L(c,this.momentum),p);l.assign(u),d.assign(h),c.assign(f);const g=ve(i,f);i.assign(g)}else{const d=re(L(l,this.decay),L(et(a),1-this.decay)),h=re(L(c,this.momentum),ye(L(a,this.learningRate),sn(re(d,this.epsilon))));l.assign(d),c.assign(h);const p=ve(i,h);i.assign(p)}})}),this.incrementIterations()}dispose(){this.accumulatedMeanSquares!=null&&Re(this.accumulatedMeanSquares.map(e=>e.variable)),this.accumulatedMeanGrads!=null&&this.centered&&Re(this.accumulatedMeanGrads.map(e=>e.variable)),this.accumulatedMoments!=null&&Re(this.accumulatedMoments.map(e=>e.variable))}async getWeights(){const e=[...this.accumulatedMeanSquares,...this.accumulatedMoments];return this.centered&&e.push(...this.accumulatedMeanGrads),[await this.saveIterations()].concat(e.map(n=>({name:n.originalName,tensor:n.variable})))}async setWeights(e){e=await this.extractIterations(e);const n=this.centered?e.length/3:e.length/2,s=!1;this.accumulatedMeanSquares=e.slice(0,n).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.accumulatedMoments=e.slice(n,n*2).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.centered&&(this.accumulatedMeanGrads=e.slice(n*2,n*3).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})))}getConfig(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}static fromConfig(e,n){return new e(n.learningRate,n.decay,n.momentum,n.epsilon,n.centered)}}/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DU=[eR,tR,nR,sR,rR,iR,Uv];function FU(){for(const t of DU)te(t)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let mo;function OU(t,e=3){if(e>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(t==null)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");let n=!1,s=!1,r=!1,i=!1,o=!1,a=!1;if(t.data instanceof Uint8Array)n=!0;else if(typeof ImageData<"u"&&t instanceof ImageData)s=!0;else if(typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement)r=!0;else if(typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement)i=!0;else if(t.getContext!=null)o=!0;else if(typeof ImageBitmap<"u"&&t instanceof ImageBitmap)a=!0;else throw new Error(`pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was ${t.constructor.name}`);if(k0(b0,z.backendName)!=null){const f={pixels:t},g={numChannels:e};return z.runKernel(b0,f,g)}const[c,u]=r?[t.videoWidth,t.videoHeight]:[t.width,t.height];let d;if(o)d=t.getContext("2d").getImageData(0,0,c,u).data;else if(s||n)d=t.data;else if(i||r||a){if(mo==null)if(typeof document>"u")if(typeof OffscreenCanvas<"u"&&typeof OffscreenCanvasRenderingContext2D<"u")mo=new OffscreenCanvas(1,1).getContext("2d");else throw new Error("Cannot parse input in current context. Reason: OffscreenCanvas Context2D rendering is not supported.");else mo=document.createElement("canvas").getContext("2d",{willReadFrequently:!0});mo.canvas.width=c,mo.canvas.height=u,mo.drawImage(t,0,0,c,u),d=mo.getImageData(0,0,c,u).data}let h;if(e===4)h=new Int32Array(d);else{const f=c*u;h=new Int32Array(f*e);for(let g=0;g<f;g++)for(let x=0;x<e;++x)h[g*e+x]=d[g*4+x]}return Fv(h,[u,c,e],"int32")}const PU=G({fromPixels_:OU});function Gv(t,e){const n=t.shape.length,s=e.shape.length;if(n<1)throw new Error(`tf.gatherND() expects the input to be rank 1 or higher, but the rank was ${n}.`);if(s<1)throw new Error(`tf.gatherND() expects the indices to be rank 1 or higher, but the rank was ${s}.`);if(e.dtype!=="int32")throw new Error(`tf.gatherND() expects the indices to be int32 type, but the dtype was ${e.dtype}.`);if(e.shape[s-1]>n)throw new Error(`index innermost dimension length must be <= tensor rank; saw: ${e.shape[s-1]} vs. ${n}`);if(J(t.shape)===0)throw new Error(`Requested more than 0 entries, but input is empty. Input shape: ${t.shape}.`);const r=e.shape,i=r[r.length-1];let o=1;for(let d=0;d<r.length-1;++d)o*=r[d];const a=t.shape,l=r.slice();l.pop();let c=1;for(let d=i;d<n;++d)c*=a[d],l.push(a[d]);const u=[...me(t.shape).map(d=>d/c),1].slice(0,i);return[l,o,c,u]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const P0=-2,MU=-1;function Hv(t,e,n){const s=t.shape.length;T(s===e.length,()=>`Error in slice${s}D: Length of begin ${e} must match the rank of the array (${s}).`),T(s===n.length,()=>`Error in slice${s}D: Length of size ${n} must match the rank of the array (${s}).`);for(let r=0;r<s;++r)T(e[r]+n[r]<=t.shape[r],()=>`Error in slice${s}D: begin[${r}] + size[${r}] (${e[r]+n[r]}) would overflow input.shape[${r}] (${t.shape[r]})`)}function LU(t){const e=[];let n=0;for(;t>0;)t&1&&e.push(n),t/=2,n++;return e}function Kv(t,e,n){const s=[];for(let r=0;r<t.length;r++)s[r]=Math.ceil((e[r]-t[r])/n[r]);return s}function oR(t,e,n,s){const r=[...t];for(let i=r.length;i<s.length;i++)r.push(1);for(let i=0;i<n;i++)i===0?r[e]=1:(r.splice(e,0,1),r.pop());return r}function aR(t,e,n){return n<=t?n:n-(e-1)}function lR(t,e){const n=[];for(let s=0;s<t;s++)n.push(e+s);return n}function zU(t,e,n,s,r,i,o,a,l){const c=t.length;let u=new Array(c),d=new Array(c),h=new Array(c);if(e.length&&n>0){const p=e[0],f=n+1;u=cR(o,p,f,s,t),d=uR(a,p,f,r,t),h=oR(i,p,f,t)}else for(let p=0;p<c;p++)u[p]=hR(o,s,i,t,p,l),d[p]=pR(a,r,i,t,p,l),h[p]=dR(i,p,l);return{begin:u,end:d,strides:h}}function cR(t,e,n,s,r){const i=[...r],o=lR(n,e);for(let a=0;a<i.length;a++)if(o.indexOf(a)>-1)i[a]=0;else{const l=aR(e,n,a);let c=s[l];t&1<<l&&(c=0),i[a]=c}return i}function uR(t,e,n,s,r){const i=[...r],o=lR(n,e);for(let a=0;a<i.length;a++)if(o.indexOf(a)>-1)i[a]=Number.MAX_SAFE_INTEGER;else{const l=aR(e,n,a);let c=s[l];t&1<<l&&(c=Number.MAX_SAFE_INTEGER),i[a]=c}for(let a=0;a<i.length;a++){const l=r[a];i[a]<0&&(i[a]+=l),i[a]=Ho(0,i[a],r[a])}return i}function dR(t,e,n){let s=t[e];return(n&1<<e||s==null)&&(s=1),s}function hR(t,e,n,s,r,i){let o=e[r];const a=n[r]||1;(t&1<<r||i&1<<r||o==null)&&(a>0?o=Number.MIN_SAFE_INTEGER:o=Number.MAX_SAFE_INTEGER);const l=s[r];return o<0&&(o+=l),o=Ho(0,o,l-1),o}function pR(t,e,n,s,r,i){let o=e[r];const a=n[r]||1;(t&1<<r||i&1<<r||o==null)&&(a>0?o=Number.MAX_SAFE_INTEGER:o=Number.MIN_SAFE_INTEGER);const l=s[r];return o<0&&(o+=l),a>0?o=Ho(0,o,l):o=Ho(-1,o,l-1),o}function qv(t,e,n){let s=n.length;for(let r=0;r<n.length;r++)if(n[r]>1){s=r;break}for(let r=s+1;r<n.length;r++)if(e[r]>0||n[r]!==t[r])return!1;return!0}function Xv(t,e){let n=t.length>0?t[t.length-1]:1;for(let s=0;s<t.length-1;s++)n+=t[s]*e[s];return n}function Bm(t,e,n){let s;const r=t.shape.length;typeof e=="number"?s=[e,...new Array(r-1).fill(0)]:e.length<r?s=e.concat(new Array(r-e.length).fill(0)):s=e.slice(),s.forEach(o=>{T(o!==-1,()=>"slice() does not support negative begin indexing.")});let i;return n==null?i=new Array(r).fill(-1):typeof n=="number"?i=[n,...new Array(r-1).fill(-1)]:n.length<r?i=n.concat(new Array(r-n.length).fill(-1)):i=n,i=i.map((o,a)=>o>=0?o:(T(o===-1,()=>`Negative size values should be exactly -1 but got ${o} for the slice() size at index ${a}.`),t.shape[a]-s[a])),[s,i]}function Yv(t,e,n,s,r,i,o,a,l){let c;if(s==null?(c=new Array(e.length),c.fill(1)):c=s,o!=null&&o&o-1)throw new Error("Multiple ellipses in slice is not allowed.");let u=!1;const d={dims:c.length,numAddAxisAfterEllipsis:0,begin:e.slice(),end:n.slice(),strides:c.slice(),beginMask:r,endMask:i,ellipsisMask:o,newAxisMask:a,shrinkAxisMask:l};for(let b=0;b<d.dims;b++)u&&1<<b&a&&d.numAddAxisAfterEllipsis++,1<<b&o&&(u=!0);u||(d.ellipsisMask|=1<<d.dims,d.dims++);const h={dims:t.length,beginMask:0,endMask:0,beginValid:!1,endValid:!1};jU(d,h);let p=!0,f=!0,g=!0;const x=[],y=[];for(let b=0;b<t.length;++b){if(h.strides[b]===0)throw Error(`strides[${b}] must be non-zero`);const w=!!(h.shrinkAxisMask&1<<b),k=t[b];if(k===-1){x.push(w?1:-1);continue}const S=[h.beginMask&1<<b,h.endMask&1<<b],I=[h.strides[b]>0?0:-1,h.strides[b]>0?k:k-1];if(w&&h.strides[b]<=0)throw Error("only stride 1 allowed on non-range indexing.");g=g&&h.strides[b]===1;const C=!!(h.beginMask&1<<b&&h.endMask&1<<b);if(h.beginValid&&h.endValid){if(w){const M=h.begin[b]<0?k+h.begin[b]:h.begin[b];if(h.begin[b]=M,h.end[b]=h.begin[b]+1,M<0||M>=k)throw Error(`slice index ${h.begin[b]} of dimension ${b} out of bounds.`)}else h.begin[b]=Tk(h.begin[b],0,h.strides[b],k,S,I),h.end[b]=Tk(h.end[b],1,h.strides[b],k,S,I);const _=h.strides[b]===1&&h.begin[b]===0&&h.end[b]===k;p=p&&_,f=f&&(b===0&&h.strides[b]===1||_)}else p=p&&h.strides[b]===1&&C,f=f&&(b===0&&h.strides[b]===1||C);let $,R=!1;if(h.beginValid&&h.endValid?($=h.end[b]-h.begin[b],R=!0):w?($=1,R=!0):C&&k>=0&&(h.strides[b]<0?$=-k:$=k,R=!0),R){let _;$===0||$<0!=h.strides[b]<0?_=0:_=Math.trunc($/h.strides[b])+($%h.strides[b]!==0?1:0),x.push(_)}else x.push(-1)}for(let b=0;b<h.finalShapeGatherIndices.length;++b){const w=h.finalShapeGatherIndices[b];w>=0?y.push(x[w]):w===P0&&y.push(1)}return{finalShapeSparse:y.filter((b,w)=>h.finalShapeGatherIndices[w]!==P0),finalShape:y,isIdentity:p,sliceDim0:f,isSimpleSlice:g,begin:h.begin,end:h.end,strides:h.strides}}function jU(t,e){e.beginMask=0,e.endMask=0,e.shrinkAxisMask=0;let n=0;e.beginValid=t.begin!=null,e.endValid=t.end!=null,e.begin=new Array(e.dims),e.end=new Array(e.dims),e.strides=new Array(e.dims),e.finalShapeGatherIndices=[],e.finalShapeGatherIndicesSparse=[],e.inputShapeGatherIndicesSparse=new Array(e.dims);for(let s=0;s<t.dims;s++)if(1<<s&t.ellipsisMask){const r=Math.min(e.dims-(t.dims-s)+1+t.numAddAxisAfterEllipsis,e.dims);for(;n<r;n++)e.begin[n]=0,e.end[n]=0,e.strides[n]=1,e.beginMask|=1<<n,e.endMask|=1<<n,e.finalShapeGatherIndices.push(n),e.finalShapeGatherIndicesSparse.push(-1),e.inputShapeGatherIndicesSparse[n]=s}else if(1<<s&t.newAxisMask)e.finalShapeGatherIndices.push(P0),e.finalShapeGatherIndicesSparse.push(-1);else{if(n===e.begin.length)throw Error(`Index out of range using input dim ${n}; input has only ${e.dims} dims, ${e.begin.length}.`);t.begin!=null&&(e.begin[n]=t.begin[s]),t.end!=null&&(e.end[n]=t.end[s]),e.strides[n]=t.strides[s],t.beginMask&1<<s&&(e.beginMask|=1<<n),t.endMask&1<<s&&(e.endMask|=1<<n),t.shrinkAxisMask&1<<s?(e.finalShapeGatherIndices.push(MU),e.finalShapeGatherIndicesSparse.push(-1),e.shrinkAxisMask|=1<<n):(e.finalShapeGatherIndices.push(n),e.finalShapeGatherIndicesSparse.push(s)),e.inputShapeGatherIndicesSparse[n]=s,n++}}function Tk(t,e,n,s,r,i){if(r[e])return n>0?i[e]:i[e+1&1];{const o=t<0?s+t:t;return o<i[0]?i[0]:o>i[1]?i[1]:o}}const BU=Object.freeze(Object.defineProperty({__proto__:null,assertParamsValid:Hv,computeFlatOffset:Xv,computeOutShape:Kv,getNormalizedAxes:zU,isSliceContinous:qv,maskToAxes:LU,parseSliceParams:Bm,sliceInfo:Yv,startForAxis:hR,startIndicesWithElidedDims:cR,stopForAxis:pR,stopIndicesWithElidedDims:uR,stridesForAxis:dR,stridesWithElidedDims:oR},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class WU{static sgd(e){return new Uv(e)}static momentum(e,n,s=!1){return new rR(e,n,s)}static rmsprop(e,n=.9,s=0,r=null,i=!1){return new iR(e,n,s,r,i)}static adam(e=.001,n=.9,s=.999,r=null){return new nR(e,n,s,r)}static adadelta(e=.001,n=.95,s=null){return new eR(e,n,s)}static adamax(e=.002,n=.9,s=.999,r=null,i=0){return new sR(e,n,s,r,i)}static adagrad(e,n=.1){return new tR(e,n)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ps=WU;/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VU=typeof requestAnimationFrame<"u"?requestAnimationFrame:typeof setImmediate<"u"?setImmediate:t=>t();function fR(){return new Promise(t=>VU(()=>t()))}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qv(t,e){const n=t[0].length;t.forEach((r,i)=>{T(r.length===n,()=>`Error in concat${n}D: rank of tensors[${i}] must be the same as the rank of the rest (${n})`)}),T(e>=0&&e<n,()=>`Error in concat${n}D: axis must be between 0 and ${n-1}.`);const s=t[0];t.forEach((r,i)=>{for(let o=0;o<n;o++)T(o===e||r[o]===s[o],()=>`Error in concat${n}D: Shape of tensors[${i}] (${r}) does not match the shape of the rest (${s}) along the non-concatenated axis ${i}.`)})}function xr(t,e){const n=t[0].slice();for(let s=1;s<t.length;s++)n[e]+=t[s][e];return n}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var js;(function(t){t[t.FIRST_DIM_SIZE=0]="FIRST_DIM_SIZE",t[t.VALUE_ROWIDS=1]="VALUE_ROWIDS",t[t.ROW_LENGTHS=2]="ROW_LENGTHS",t[t.ROW_SPLITS=3]="ROW_SPLITS",t[t.ROW_LIMITS=4]="ROW_LIMITS",t[t.ROW_STARTS=5]="ROW_STARTS"})(js||(js={}));function mR(t,e,n){let s=new Array;if(n==null&&e==null)return s;if(e==null)for(;s.length<t+n.length;)s.push(-1);else s=e.slice();if(n==null)return s;if(t+n.length!==s.length)throw new Error(`rt input.shape and shape=${e} are incompatible: rt input.rank = ${t+n.length}, but shape.rank = ${s.length}`);for(let r=1;r<n.length;++r){const i=n[r],o=s[s.length-n.length+r],a=s[o];if(i>=0)if(a>=0){if(a!==i)throw new Error(`rt input.shape and shape=${e} are incompatible: rt input.shape[${r+t}] = ${i} but shape[${r+t}] = ${a}`)}else s[o]=i}return s}function gR(t){const e={FIRST_DIM_SIZE:js.FIRST_DIM_SIZE,VALUE_ROWIDS:js.VALUE_ROWIDS,ROW_LENGTHS:js.ROW_LENGTHS,ROW_SPLITS:js.ROW_SPLITS,ROW_LIMITS:js.ROW_LIMITS,ROW_STARTS:js.ROW_STARTS},n=[];for(const s of t)if(s in e)n.push(e[s]);else break;return n}function yR(t){return t.length===0?0:t[0]===js.FIRST_DIM_SIZE?t.length-1:t.length}function xR(t,e){if(t==null||e==null)return;const n=t.length,s=e.length;if(n>=s)throw new Error(`defaultValue.shape=${t} and ragged tensor flatValues.shape=${e}, are incompatible: defaultValue.rank = ${n} must be less than ragged tensor input flatValues.rank = ${s})`);for(let r=0;r<Math.min(n,s-1);++r){const i=t[r],o=e[r+1];if(i>=0&&o>=0&&i!==1&&i!==o)throw new Error(`defaultValue.shape=${t}, and ragged tensor input flatValues.shape=${e} are incompatible: defaultValue.shape[${r-t.length}] = ${i} but ragged tensor input.flatValues.shape[${r-t.length}] = ${o}`)}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jv=30;function Wm(t){return t<=Jv?t:y0(t,Math.floor(Math.sqrt(t)))}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zv(t,e,n){const s=n*(typeof t=="number"?t:t[0]),r=e*(typeof t=="number"?t:t[1]);return[s,r]}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pd(t,e,n,s=!0){let r=[];if(s)r=r.concat(e.slice(0)),r.push(t[0]/n),r=r.concat(t.slice(1));else{r=r.concat(t[0]);const i=e.length;for(let o=0;o<i;++o)r=r.concat([t[o+1]/e[o],e[o]]);r=r.concat(t.slice(i+1))}return r}function Md(t,e,n=!0){const s=[];if(n){s.push(e);for(let r=e+1;r<t;++r)r<=2*e?(s.push(r),s.push(r-(e+1))):s.push(r)}else{const r=[],i=[];for(let o=1;o<t;++o)o>=e*2+1||o%2===1?i.push(o):r.push(o);s.push(...r),s.push(0),s.push(...i)}return s}function Ld(t,e,n,s=!0){const r=[];s?r.push(t[0]/n):r.push(t[0]*n);for(let i=1;i<t.length;++i)i<=e.length?s?r.push(e[i-1]*t[i]):r.push(t[i]/e[i-1]):r.push(t[i]);return r}function eb(t,e){const n=[0];for(let s=0;s<e;++s)n.push(t[s][0]);return n}function tb(t,e,n){const s=t.slice(0,1);for(let r=0;r<n;++r)s.push(t[r+1]-e[r][0]-e[r][1]);return s}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vm=1.7580993408473768,Um=1.0507009873554805;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nb=.3275911,sb=.254829592,rb=-.284496736,ib=1.421413741,ob=-1.453152027,ab=1.061405429;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qr(t,e){if(t.length!==e.length)throw new Error(`Cannot merge real and imag arrays of different lengths. real:${t.length}, imag: ${e.length}.`);const n=new Float32Array(t.length*2);for(let s=0;s<n.length;s+=2)n[s]=t[s/2],n[s+1]=e[s/2];return n}function vR(t){const e=new Float32Array(t.length/2),n=new Float32Array(t.length/2);for(let s=0;s<t.length;s+=2)e[s/2]=t[s],n[s/2]=t[s+1];return{real:e,imag:n}}function bR(t){const e=Math.ceil(t.length/4),n=new Float32Array(e),s=new Float32Array(e);for(let r=0;r<t.length;r+=4)n[Math.floor(r/4)]=t[r],s[Math.floor(r/4)]=t[r+1];return{real:n,imag:s}}function wR(t){const e=Math.floor(t.length/4),n=new Float32Array(e),s=new Float32Array(e);for(let r=2;r<t.length;r+=4)n[Math.floor(r/4)]=t[r],s[Math.floor(r/4)]=t[r+1];return{real:n,imag:s}}function lb(t,e){const n=t[e*2],s=t[e*2+1];return{real:n,imag:s}}function kR(t,e,n,s){t[s*2]=e,t[s*2+1]=n}function CR(t,e){const n=new Float32Array(t/2),s=new Float32Array(t/2);for(let r=0;r<Math.ceil(t/2);r++){const i=(e?2:-2)*Math.PI*(r/t);n[r]=Math.cos(i),s[r]=Math.sin(i)}return{real:n,imag:s}}function SR(t,e,n){const s=(n?2:-2)*Math.PI*(t/e),r=Math.cos(s),i=Math.sin(s);return{real:r,imag:i}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xg="->",UU=/->/g,Ek=",",Rk="...";function cb(t,e){t=t.replace(/\s/g,"");const n=(t.length-t.replace(UU,"").length)/Xg.length;if(n<1)throw new Error("Equations without an arrow are not supported.");if(n>1)throw new Error(`Equation must contain exactly one arrow ("${Xg}").`);const[s,r]=t.split(Xg);T(s.indexOf(Rk)===-1,()=>`The ellipsis notation ("${Rk}") is not supported yet.`);const i=s.split(Ek),o=i.length;if(e!==o)throw new Error(`Expected ${o} input tensors, received ${e}`);if(o>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");const a=[];for(let h=0;h<r.length;++h){const p=r[h];if(!i.some(f=>f.indexOf(p)!==-1))throw new Error(`Output subscripts contain the label ${p} not present in the input subscripts.`);a.indexOf(p)===-1&&a.push(p)}for(let h=0;h<s.length;++h){const p=s[h];a.indexOf(p)===-1&&p!==Ek&&a.push(p)}const l=new Array(i.length);for(let h=0;h<o;++h){if(new Set(i[h].split("")).size!==i[h].length)throw new Error(`Found duplicate axes in input component ${i[h]}. Support for duplicate axes in input is not implemented yet.`);l[h]=[];for(let p=0;p<i[h].length;++p)l[h].push(a.indexOf(i[h][p]))}const c=a.length,u=r.length,d=[];for(let h=u;h<c;++h)d.push(h);return{allDims:a,summedDims:d,idDims:l}}function ub(t,e){let n=new Array(t);n.fill(-1);for(let r=0;r<e.length;++r)n[e[r]]=r;const s=[];for(let r=0;r<t;++r)n[r]===-1&&s.push(r);return n=n.filter(r=>r!==-1),{permutationIndices:n,expandDims:s}}function db(t,e,n){const s=new Array(t);for(let r=0;r<n.length;++r){const i=n[r].shape;for(let o=0;o<e[r].length;++o)s[e[r][o]]===void 0?s[e[r][o]]=i[o]:T(s[e[r][o]]===i[o],()=>`Expected dimension ${s[e[r][o]]} at axis ${o} of input shaped ${JSON.stringify(i)}, but got dimension ${i[o]}`)}}function hb(t,e){const n=t,s=[];let r=0;t.length===0&&n.push(-1),r=t.length+1;for(let o=0;o<r;++o)s.push([]);const i=[];for(let o=0;o<n.length;++o){const a=n[o],l=GU(e,a);for(const c of l)i.indexOf(c)===-1&&(s[o].push(c),i.push(c))}return{path:n,steps:s}}function pb(t){return t.every((e,n)=>e===n)}function GU(t,e){const n=[];for(let s=0;s<t.length;++s)(t[s].length===0||t[s].indexOf(e)!==-1||e===-1)&&n.push(s);return n}function fb(t,e,n=0){let s=[];if(typeof e=="number")T(t.shape[n]%e===0,()=>"Number of splits must evenly divide the axis."),s=new Array(e).fill(t.shape[n]/e);else{const r=e.reduce((o,a)=>(a===-1&&(o+=1),o),0);T(r<=1,()=>"There should be only one negative value in split array.");const i=e.indexOf(-1);if(i!==-1){const o=e.reduce((a,l)=>l>0?a+l:a);e[i]=t.shape[n]-o}T(t.shape[n]===e.reduce((o,a)=>o+a),()=>"The sum of sizes must match the size of the axis dimension."),s=e}return s}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IR(t){return`Received SparseTensor with denseShape[0] = 0 but
  indices.shape[0] = ${t}`}function $R(t,e){return`indices(${t}, 0) is invalid: ${e} < 0`}function TR(t,e,n){return`indices(${t}, 0) is invalid: ${e} >= ${n}`}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ER(t,e){return`only one output dimension may be -1, not both ${t} and ${e}`}function RR(t,e){return`size ${t} must be non-negative, not ${e}`}function NR(){return"reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero"}function AR(t,e){const n=J(t),s=J(e);return`Input to reshape is a SparseTensor with ${n}
  dense values, but the requested shape requires a multiple of ${s}. inputShape=${t} outputShape= ${e}`}function _R(t,e){const n=J(t),s=J(e);return`Input to reshape is a tensor with ${n} dense values, but the requested shape has ${s}. inputShape=${t} outputShape=${e}`}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function M0(){return"segment ids must be >= 0"}function DR(){return"segment ids are not increasing"}function FR(t,e){return`Segment id ${t} out of range [0, ${e}), possibly because segmentIds input is not sorted.`}function OR(t,e,n){return`Bad: indices[${t}] == ${e} out of range [0, ${n})`}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PR(t,e){let n=!1,s;for(t<=Jv?(s=t,n=!0):s=y0(t,Math.floor(Math.sqrt(t)));!n;)s>e||s===t?n=!0:s=y0(t,s+1);return s}function MR(t,e,n){const s=[],r=t.length;for(let i=0;i<r;i++)i!==e?s.push(t[i]):s.push(n);return s}function mb(t,e,n,s){const r=e.shape.length,i=t.shape.length;if(s!==0&&(s<-r||s>r))throw new Error(`Expect batchDims in the range of [-${r}, ${r}], but got ${s}`);if(s<0&&(s+=r),s>i)throw new Error(`batchDims (${s}) must be less than rank(x) (
    ${i}).`);if(n<s)throw new Error(`batchDims (${s}) must be less than or equal to axis (${n}).`);for(let d=0;d<s;++d)if(t.shape[d]!==e.shape[d])throw new Error(`x.shape[${d}]: ${t.shape[d]} should be equal to indices.shape[${d}]: ${e.shape[d]}.`);const o=t.shape[n],a=[];let l=1,c=1,u=1;for(let d=0;d<s;++d)a.push(t.shape[d]),l*=t.shape[d];for(let d=s;d<n;d++)a.push(t.shape[d]),c*=t.shape[d];for(let d=s;d<r;d++)a.push(e.shape[d]);for(let d=n+1;d<i;d++)a.push(t.shape[d]),u*=t.shape[d];return{batchSize:l,sliceSize:u,outerSize:c,dimSize:o,outputShape:a}}const HU=Object.freeze(Object.defineProperty({__proto__:null,collectGatherOpShapeInfo:mb,computeOutShape:MR,segOpComputeOptimalWindowSize:PR},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jr(t){try{return t.map(e=>Gi(e))}catch(e){throw new Error(`Failed to decode encoded string bytes into utf-8, error: ${e}`)}}function LR(t){return t.map(e=>ji(e))}const KU=Object.freeze(Object.defineProperty({__proto__:null,ERF_A1:sb,ERF_A2:rb,ERF_A3:ib,ERF_A4:ob,ERF_A5:ab,ERF_P:nb,PARALLELIZE_THRESHOLD:Jv,get RowPartitionType(){return js},SELU_SCALE:Um,SELU_SCALEALPHA:Vm,applyActivation:Lv,assertAndGetBroadcastShape:Se,assertAxesAreInnerMostDims:Xt,assertParamsConsistent:Qv,assignToTypedArray:kR,axesAreInnerMostDims:fv,calculateShapes:ya,checkEinsumDimSizes:db,checkPadOnDimRoundingMode:_n,combineLocations:RE,combineRaggedTensorToTensorShapes:mR,complexWithEvenIndex:bR,complexWithOddIndex:wR,computeConv2DInfo:qt,computeConv3DInfo:io,computeDefaultPad:lv,computeDilation2DInfo:Ad,computeOptimalWindowSize:Wm,computeOutAndReduceShapes:Wt,computeOutShape:xr,computePool2DInfo:Ts,computePool3DInfo:ri,convertConv2DDataFormat:ii,decodeEinsumEquation:cb,eitherStridesOrDilationsAreOne:rn,expandShapeToKeepDim:Tt,exponent:SR,exponents:CR,fromStringArrayToUint8:LR,fromUint8ToStringArray:Jr,getAxesPermutation:dt,getBroadcastDims:bl,getComplexWithIndex:lb,getEinsumComputePath:hb,getEinsumPermutation:ub,getFusedBiasGradient:Mv,getFusedDyActivation:Pv,getImageCenter:Zv,getInnerMostAxes:wt,getPermuted:Md,getRaggedRank:yR,getReductionAxes:Ft,getReshaped:Pd,getReshapedPermuted:Ld,getRowPartitionTypesHelper:gR,getSliceBeginCoords:eb,getSliceSize:tb,getSparseFillEmptyRowsIndicesDenseShapeMismatch:IR,getSparseFillEmptyRowsNegativeIndexErrorMessage:$R,getSparseFillEmptyRowsOutOfRangeIndexErrorMessage:TR,getSparseReshapeEmptyTensorZeroOutputDimErrorMessage:NR,getSparseReshapeInputOutputMismatchErrorMessage:_R,getSparseReshapeInputOutputMultipleErrorMessage:AR,getSparseReshapeMultipleNegativeOneOutputDimErrorMessage:ER,getSparseReshapeNegativeOutputDimErrorMessage:RR,getSparseSegmentReductionIndicesOutOfRangeErrorMessage:OR,getSparseSegmentReductionNegativeSegmentIdsErrorMessage:M0,getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage:DR,getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage:FR,getUndoAxesPermutation:oo,isIdentityPermutation:pb,log:$j,mergeRealAndImagArrays:Qr,prepareAndValidate:Gv,prepareSplitSize:fb,segment_util:HU,shouldFuse:zv,slice_util:BU,splitRealAndImagArrays:vR,stridesOrDilationsArePositive:Qo,tupleValuesAreOne:Yo,upcastType:Vn,validateDefaultValueShape:xR,validateInput:kV,validateUpdateShape:qE,warn:Xn},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */FU();/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zR={kernelName:Ff,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>L(t,Od(de(n,"float32"),-1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qU={kernelName:Fu,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>{const s=et(de(n,"float32")),r=sn(ve(ze(1),s));return vt(ye(t,r))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XU={kernelName:Ou,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>{const s=sn(ve(et(de(n,"float32")),1));return ye(t,s)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YU={kernelName:Ll,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e,r=Se(n.shape,s.shape);return{a:()=>{let a=t;const l=Ft(n.shape,r);return l.length>0&&(a=ge(a,l)),U(a,n.shape)},b:()=>{let a=t;const l=Ft(s.shape,r);return l.length>0&&(a=ge(a,l)),U(a,s.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QU={kernelName:x1,saveAllInputs:!0,gradFunc:(t,e)=>{const n={};return e.forEach((s,r)=>{n[r]=()=>t.clone()}),n}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JU={kernelName:Of,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Fe(n)}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZU={kernelName:Pf,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Fe(n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const e8={kernelName:Pu,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>ye(t,sn(ve(ze(1),et(de(n,"float32")))))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const t8={kernelName:Mu,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>{const s=sn(re(ze(1),et(de(n,"float32"))));return ye(t,s)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const n8={kernelName:ju,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e,r=Se(n.shape,s.shape);return{a:()=>{const a=re(et(n),et(s));let l=L(t,ye(s,a));const c=Ft(n.shape,r);return c.length>0&&(l=ge(l,c)),U(l,n.shape)},b:()=>{const a=re(et(n),et(s));let l=vt(L(t,ye(n,a)));const c=Ft(s.shape,r);return c.length>0&&(l=ge(l,c)),U(l,s.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const s8={kernelName:Lu,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>ye(t,re(et(de(n,"float32")),1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const r8={kernelName:zu,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>ye(t,ve(ze(1),et(de(n,"float32"))))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function i8(t,e,n,s,r,i){const o=N(t,"dy","avgPool3dGrad"),a=N(e,"input","avgPool3dGrad");let l=o,c=a,u=!1;a.rank===4&&(u=!0,l=U(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]]),c=U(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]])),T(l.rank===5,()=>`Error in avgPool3dGrad: dy must be rank 5 but got rank ${l.rank}.`),T(c.rank===5,()=>`Error in avgPool3dGrad: input must be rank 5 but got rank ${c.rank}.`),_n("avgPool3dGrad",r,i);const d={dy:l,input:c},h={filterSize:n,strides:s,pad:r,dimRoundingMode:i},p=z.runKernel(k1,d,h);return u?U(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}const o8=G({avgPool3dGrad_:i8});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const a8={kernelName:Lf,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,{filterSize:r,strides:i,pad:o,dimRoundingMode:a}=n;return{x:()=>o8(t,s,r,i,o,a)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function l8(t,e,n,s,r){const i=N(t,"dy","avgPoolGrad"),o=N(e,"input","avgPoolGrad");T(o.rank===i.rank,()=>`Rank of input (${o.rank}) does not match rank of dy (${i.rank})`);let a=o,l=i,c=!1;o.rank===3&&(c=!0,a=U(o,[1,o.shape[0],o.shape[1],o.shape[2]]),l=U(i,[1,i.shape[0],i.shape[1],i.shape[2]])),T(l.rank===4,()=>`Error in avgPoolGrad: dy must be rank 4 but got rank ${l.rank}.`),T(a.rank===4,()=>`Error in avgPoolGrad: input must be rank 4 but got rank ${a.rank}.`);const u={dy:l,input:a},d={filterSize:n,strides:s,pad:r},h=z.runKernel(w1,u,d);return c?U(h,[h.shape[1],h.shape[2],h.shape[3]]):h}const c8=G({avgPoolGrad_:l8});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const u8={kernelName:Mf,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,{filterSize:r,strides:i,pad:o}=n;return{x:()=>c8(t,s,r,i,o)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const d8={kernelName:zf,inputsToSave:["a","b"],gradFunc:(t,e,n)=>{const[s,r]=e,{transposeA:i,transposeB:o}=n;return!i&&!o?{a:()=>Le(t,r,!1,!0),b:()=>Le(s,t,!0,!1)}:!i&&o?{a:()=>Le(t,r,!1,!1),b:()=>Le(t,s,!0,!1)}:i&&!o?{a:()=>Le(r,t,!1,!0),b:()=>Le(s,t,!1,!1)}:{a:()=>Le(r,t,!0,!0),b:()=>Le(t,s,!0,!0)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const h8={kernelName:jf,gradFunc:(t,e,n)=>{const{blockShape:s,crops:r}=n;return{x:()=>kv(t,s,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const p8={kernelName:Cj,gradFunc:(t,e,n)=>{const s=n,r=s.inputShape,i=s.shape,o=Array.from(i);for(let l=r.length-1;l>=0;l--)if(r[l]===i[l])o[l]=1;else if(r[l]!==1)throw new Error(`broadcastTo(): [${r}] cannot be broadcast to [${i}].`);const a=[];for(let l=0;l<o.length;l++)o[l]>1&&a.push(l);return{x:()=>ge(t,a,!0)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const f8={kernelName:Bu,gradFunc:t=>({x:()=>t.clone()})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const m8={kernelName:Wu,gradFunc:t=>({x:()=>Fe(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const g8={kernelName:Vu,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,{clipValueMin:r,clipValueMax:i}=n;return{x:()=>yn(Xr(fa(s,r),Bl(s,i)),t,Fe(t))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const y8={kernelName:Bf,inputsToSave:["x"],gradFunc:zR.gradFunc};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const x8={kernelName:Wf,saveAllInputs:!0,gradFunc:(t,e,n)=>{const s=e.map(l=>l.shape),{axis:r}=n,i=Te(r,e[0].shape)[0],o=s.map(l=>l[i]);return es(t,o,i).map(l=>()=>l)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const v8={kernelName:Vf,inputsToSave:["x","filter"],gradFunc:(t,e,n)=>{const[s,r]=e,{dilations:i,strides:o,pad:a,dataFormat:l}=n;return T(Yo(i),()=>`Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${i}'`),{x:()=>dv(s.shape,t,r,o,a,l),filter:()=>Ov(s,t,r.shape,o,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const b8={kernelName:Uf,inputsToSave:["dy","filter"],gradFunc:(t,e,n)=>{const[s,r]=e,{strides:i,pad:o,dataFormat:a,dimRoundingMode:l}=n;return{dy:()=>Jo(t,r,i,o,a,1,l),filter:()=>Ov(t,s,r.shape,i,o,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function w8(t,e,n,s,r){let i=t;t.rank===4&&(i=U(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]]));let o=e;o.rank===4&&(o=U(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]])),T(i.rank===5,()=>`Error in conv3dDerFilter: input must be rank 5, but got shape ${i.shape}.`),T(o.rank===5,()=>`Error in conv3dDerFilter: dy must be rank 5, but got shape ${o.shape}.`),T(n.length===5,()=>`Error in conv3dDerFilter: filterShape must be length 5, but got ${n}.`),T(i.shape[4]===n[3],()=>`Error in conv3dDerFilter: depth of input ${i.shape[4]}) must match input depth in filter (${n[3]}.`),T(o.shape[4]===n[4],()=>`Error in conv3dDerFilter: depth of dy (${o.shape[4]}) must match output depth for filter (${n[4]}).`);const a={x:i,dy:o},l={strides:s,pad:r,filterShape:n};return z.runKernel(T1,a,l)}const k8=G({conv3DBackpropFilter_:w8});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const C8={kernelName:Gf,inputsToSave:["x","filter"],gradFunc:(t,e,n)=>{const{dilations:s,strides:r,pad:i}=n;T(Yo(s),()=>`Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${s}'`);const[o,a]=e;return{x:()=>IE(o.shape,t,a,r,i),filter:()=>k8(o,t,a.shape,r,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const S8={kernelName:Uu,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>L(vt(UE(de(n,"float32"))),t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const I8={kernelName:Gu,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>L(GE(de(n,"float32")),t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $8={kernelName:Hf,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,{axis:r,exclusive:i,reverse:o}=n;return{x:()=>{const a=dt([r],s.rank);let l=TE(t,r,i,!o);return a!=null&&(l=De(l,a)),l}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const T8={kernelName:Kf,inputsToSave:["x","filter"],gradFunc:(t,e,n)=>{const{dilations:s,strides:r,pad:i,dimRoundingMode:o}=n,a=s??[1,1];T(Yo(a),()=>`Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations '${a}'`);const[l,c]=e;return T(l.rank===4,()=>`Error in gradient of depthwiseConv2dNative: input must be rank 4, but got rank ${l.rank}.`),T(c.rank===4,()=>`Error in gradient of depthwiseConv2dNative: filter must be rank 4, but got rank ${c.rank}.`),T(l.shape[3]===c.shape[2],()=>`Error in gradient of depthwiseConv2d: number of input channels (${l.shape[3]}) must match the inChannels dimension in filter ${c.shape[2]}.`),T(rn(r,a),()=>`Error in gradient of depthwiseConv2d: Either strides or dilations must be  1. Got strides ${r} and dilations '${a}'.`),_n("depthwiseConv2d",i,o),{x:()=>BV(l.shape,t,c,r,i,a,o),filter:()=>zV(l,t,c.shape,r,i,a,o)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const E8={kernelName:qf,inputsToSave:["x","filter"],gradFunc:(t,e,n)=>{const[s,r]=e,i={x:s,filter:r,dy:t},o={x:s,filter:r,dy:t};return{x:()=>z.runKernel(x0,i,n),filter:()=>z.runKernel(v0,o,n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const R8={kernelName:Ku,outputsToSave:[!0],gradFunc:(t,e)=>{const[n]=e,s={dy:t,y:n};return{x:()=>z.runKernel(P1,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const N8={kernelName:qu,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e,s=L(kr(vt(et(n))),2/Math.sqrt(Math.PI));return{x:()=>L(t,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const A8={kernelName:Xu,outputsToSave:[!0],gradFunc:(t,e)=>{const[n]=e;return{x:()=>L(t,n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _8={kernelName:Yf,inputsToSave:["input"],gradFunc:(t,e)=>{const[n]=e;return{input:()=>U(t,n.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const D8={kernelName:Yu,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>L(t,kr(n))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const F8={kernelName:Qu,gradFunc:t=>({x:()=>Fe(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const O8={kernelName:Ju,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e,r=Se(n.shape,s.shape);return{a:()=>{const a=ye(t,de(s,"float32")),l=Ft(n.shape,r);return l.length>0?U(ge(a,l),n.shape):a},b:()=>{let a=L(t,de(n,"float32"));const l=Ft(s.shape,r);l.length>0&&(a=U(ge(a,l),s.shape));const c=et(s);return vt(ye(a,de(c,"float32")))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const P8={kernelName:Qf,inputsToSave:["x","mean","variance","scale"],gradFunc:(t,e,n)=>{const{varianceEpsilon:s}=n,[r,i,o,a]=e,l=a??ze(1),c=Ft(i.shape,r.shape),u=[];if(i.rank===1){for(let w=0;w<r.shape.length-1;++w)u.push(r.shape[w]);u.push(1)}const d=ve(r,i),h=L(t,l),p=BE(re(o,ze(s))),f=L(L(L(p,p),p),ze(-.5));return{x:()=>i.rank===1?U(L(L(t,Us(U(p,[1,1,1,i.shape[0]]),u)),l),r.shape):U(L(L(t,p),l),r.shape),mean:()=>{let w=L(L(p,ze(-1)),h);return i.rank===1&&(w=ge(w,c)),U(w,i.shape)},variance:()=>{let w=L(L(f,d),h);return i.rank===1&&(w=ge(w,c)),U(w,i.shape)},scale:()=>{const w=L(d,p);let k=L(t,w);return i.rank===1&&(k=ge(k,c)),U(k,i.shape)},offset:()=>{let w=t;return i.rank===1&&(w=ge(w,c)),U(w,i.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const M8={kernelName:Jf,inputsToSave:["x","indices"],gradFunc:(t,e,n)=>{const[s,r]=e,{axis:i,batchDims:o}=n,a=Te(i,s.shape)[0],l=(c,u,d)=>()=>{const h=c.shape,p=u.size,f=h.slice(0,a),g=f.length,x=h.slice(i,h.length).slice(1),y=x.length,v=Nk(0,g),b=Nk(g+1,g+1+y),w=Ak([f,[p],x]),k=U(d,w),S=U(u,[p]),I=Ak([[g],v,b]),C=De(k,I);let $=YE(C,S,c.shape[a]);const R=oo(I);return $=De($,R),$};if(o===1){const c=s.shape[0],u=s.split(c,0);return{x:()=>Yr(u.map((p,f)=>l(p,r.slice(f,1),t.slice(f,1))())).reshape(s.shape),indices:()=>r}}else return{x:l(s,r,t),indices:()=>r}}};function Nk(t,e){const n=[];for(let s=t;s<e;++s)n.push(s);return n}function Ak(t){const e=[];for(let n=0;n<t.length;++n)for(let s=0;s<t[n].length;++s)e.push(t[n][s]);return e}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const L8={kernelName:Zu,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e;return{a:()=>Fe(n),b:()=>Fe(s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const z8={kernelName:ed,gradFunc:t=>({x:()=>de(t,"float32")})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const j8={kernelName:td,gradFunc:t=>({x:()=>Fe(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const B8={kernelName:nd,gradFunc:t=>({x:()=>Fe(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const W8={kernelName:sd,gradFunc:t=>({x:()=>Fe(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const V8={kernelName:em,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,{alpha:r}=n,i=os(s,0);return{x:()=>yn(i,t,L(t,r))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const U8={kernelName:id,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>ye(t,re(n,1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const G8={kernelName:rd,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>ye(t,de(n,"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const H8={kernelName:Ij,inputsToSave:[],outputsToSave:[!0],gradFunc:(t,e,n)=>{const[s]=e,{axis:r}=n;return{logits:()=>{const o=kr(s);return ve(t,L(ge(t,r,!0),o))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function K8(t,e,n,s=5,r=1,i=1,o=.5){const a={x:t,y:e,dy:n},l={depthRadius:s,bias:r,alpha:i,beta:o};return z.runKernel(W1,a,l)}const q8=G({localResponseNormalizationBackprop_:K8});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const X8={kernelName:om,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,n)=>{const[s,r]=e,{depthRadius:i,bias:o,alpha:a,beta:l}=n;return{x:()=>q8(s,r,t,i,o,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jR(t,e,n,s){return e.rank<n.rank&&(e=U(e,Tt(e.shape,s))),t.rank<n.rank&&(t=U(t,Tt(t.shape,s))),{x:()=>L(t,de(wr(n,e),t.dtype))}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _k={kernelName:am,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,n)=>{const s=n,{reductionIndices:r}=s,i=e[0],o=e[1],a=Te(r,i.shape),l=jR(t,o,i,a);return{x:()=>l.x()}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Y8={kernelName:od,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e;return{a:()=>L(t,de(fa(n,s),"float32")),b:()=>L(t,de(zp(n,s),"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Q8(t,e,n,s,r,i,o){const a=N(t,"dy","maxPool3dGrad"),l=N(e,"input","maxPool3dGrad"),c=N(n,"output","maxPool3dGrad");let u=a,d=l,h=c,p=!1;l.rank===4&&(p=!0,u=U(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]]),d=U(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]]),h=U(c,[1,c.shape[0],c.shape[1],c.shape[2],c.shape[3]])),T(u.rank===5,()=>`Error in maxPool3dGrad: dy must be rank 5 but got rank ${u.rank}.`),T(d.rank===5,()=>`Error in maxPool3dGrad: input must be rank 5 but got rank ${d.rank}.`),T(h.rank===5,()=>`Error in maxPool3dGrad: output must be rank 5 but got rank ${h.rank}.`),_n("maxPool3dGrad",i,o);const f={dy:u,input:d,output:h},g={filterSize:s,strides:r,pad:i,dimRoundingMode:o},x=z.runKernel(U1,f,g);return p?U(x,[x.shape[1],x.shape[2],x.shape[3],x.shape[4]]):x}const J8=G({maxPool3dGrad_:Q8});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Z8={kernelName:cm,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,n)=>{const[s,r]=e,{filterSize:i,strides:o,pad:a,dimRoundingMode:l}=n;return{x:()=>J8(t,s,r,i,o,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eG(t,e,n,s,r,i,o){const a=N(t,"dy","maxPoolGrad"),l=N(e,"input","maxPoolGrad"),c=N(n,"output","maxPoolGrad");T(l.rank===a.rank,()=>`Rank of input (${l.rank}) does not match rank of dy (${a.rank})`),T(a.rank===4,()=>`Error in maxPoolGrad: dy must be rank 4 but got rank ${a.rank}.`),T(l.rank===4,()=>`Error in maxPoolGrad: input must be rank 4 but got rank ${l.rank}.`),_n("maxPoolGrad",i,o);const u={dy:a,input:l,output:c},d={filterSize:s,strides:r,pad:i,dimRoundingMode:o};return z.runKernel(V1,u,d)}const tG=G({maxPoolGrad_:eG});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nG={kernelName:lm,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,n)=>{const[s,r]=e,{filterSize:i,strides:o,pad:a}=n;return{x:()=>tG(t,s,r,i,o,a)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sG={kernelName:um,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,{axis:r}=n,i=Te(r,s.shape),a=Wt(s.shape,i)[1],l=J(a);return{x:()=>{const u=s.shape.slice();i.forEach(p=>{u[p]=1});const d=U(t,u);return ye(L(d,lo(s.shape,"float32")),l)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rG={kernelName:dm,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,n)=>{const s=n,{axis:r}=s,[i,o]=e,a=Te(r,i.shape),l=jR(t,o,i,a);return{x:()=>l.x()}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iG={kernelName:ad,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e;return{a:()=>L(t,de(Bl(n,s),"float32")),b:()=>L(t,de(os(n,s),"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oG={kernelName:hm,inputsToSave:["x"],gradFunc:(t,e,n)=>{const s=e[0],{paddings:r}=n,i=r.map(o=>o[0]);return{x:()=>Qe(t,i,s.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aG={kernelName:ld,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e,r=Se(n.shape,s.shape);return{a:()=>{const a=Ft(n.shape,r);return a.length>0?U(ge(t,a),n.shape):t},b:()=>{const a=L(t,vt(jm(ye(n,s)))),l=Ft(s.shape,r);return l.length>0?U(ge(a,l),s.shape):a}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lG={kernelName:cd,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e,r=Se(n.shape,s.shape);return{a:()=>{const a=L(t,de(s,"float32")),l=Ft(n.shape,r);return l.length>0?U(ge(a,l),n.shape):a},b:()=>{const a=L(t,de(n,"float32")),l=Ft(s.shape,r);return l.length>0?U(ge(a,l),s.shape):a}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cG={kernelName:pm,gradFunc:t=>({x:()=>vt(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uG={kernelName:gm,inputsToSave:["indices"],gradFunc:(t,e)=>{const n=e[0];return{indices:()=>zt(n.shape,"float32")}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dG={kernelName:mm,gradFunc:t=>({x:()=>Fe(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hG={kernelName:ym,saveAllInputs:!0,gradFunc:(t,e,n)=>{const{axis:s}=n;return ta(t,s).map(i=>()=>i)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Dk={kernelName:xm,inputsToSave:["x"],gradFunc:(t,e,n)=>{const s=e[0],{paddings:r}=n,i=r.map(o=>o[0]);return{x:()=>Qe(t,i,s.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pG={kernelName:ud,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:(t,e)=>{const[n,s,r]=e,i=n,o=s,a=Se(i.shape,o.shape);return{a:()=>{const u=de(o,"float32");let d=L(t,L(u,Zo(i,ve(u,ze(1)))));const h=Ft(i.shape,a);return h.length>0&&(d=ge(d,h)),U(d,i.shape)},b:()=>{const u=os(i,0),d=yn(u,Cr(i),Fe(i));let h=L(t,L(r,d));const p=Ft(o.shape,a);return p.length>0&&(h=ge(h,p)),U(h,o.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fG={kernelName:vm,inputsToSave:["x","alpha"],gradFunc:(t,e)=>{const[n,s]=e,r=os(n,0);return{x:()=>yn(r,t,L(t,s)),alpha:()=>{let i=yn(r,Fe(t),L(t,n));const o=Ft(s.shape,t.shape);return o.length>0&&(i=ge(i,o)),U(i,s.shape)}}}};/**
 * @license
 * Copyright 2022 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mG(t,e,n){const s=t.shape.slice();s[n]=1;const r=U(e,s),i=F0(t,n,!0,!1),o=F0(t,n,!0,!0),a=L(i,o);return L(r,a)}function gG(t,e,n){const s=t.shape.length,r=s-n.length,i=dt(n,s);let o=t;i!=null&&(o=De(t,i));const a=o.shape.slice(),c=a.splice(s-n.length,n.length).reduce((h,p)=>h*p,1);a.push(c);const u=o.reshape(a);let d=mG(u,e,r);if(d=d.reshape(o.shape),i!=null){const h=oo(i);d=De(d,h)}return d}const yG={kernelName:bm,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,{axis:r}=n;let i=[];return r==null?i=s.shape.map((o,a)=>a):typeof r=="number"?i=[r]:i=r,{x:()=>gG(s,t,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xG={kernelName:Hu,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e,r=Se(n.shape,s.shape);return{a:()=>{const a=ye(t,de(s,"float32")),l=Ft(n.shape,r);return l.length>0?U(ge(a,l),n.shape):a},b:()=>{let a=L(t,de(n,"float32"));const l=Ft(s.shape,r);l.length>0&&(a=U(ge(a,l),s.shape));const c=et(s);return vt(ye(a,de(c,"float32")))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vG={kernelName:dd,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>ye(t,vt(et(n)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bG={kernelName:pd,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e,s=L(Bl(n,6),Od(n));return{x:()=>L(t,de(s,"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wG={kernelName:hd,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>L(t,de(Od(n),"float32"))}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kG={kernelName:wm,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>U(t,n.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CG={kernelName:Cm,inputsToSave:["images"],gradFunc:(t,e,n)=>{const[s]=e,r={dy:t,images:s};return{images:()=>z.runKernel(Q1,r,n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SG={kernelName:km,inputsToSave:["images"],gradFunc:(t,e,n)=>{const[s]=e,r={dy:t,images:s};return{images:()=>z.runKernel(Y1,r,n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IG={kernelName:Sm,gradFunc:(t,e,n)=>{const{dims:s}=n,r=Te(s,t.shape);return{x:()=>ea(t,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $G={kernelName:fd,gradFunc:t=>({x:()=>Fe(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TG={kernelName:md,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>vt(ye(t,L(Zo(n,1.5),2)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const EG={kernelName:Im,inputsToSave:["condition"],gradFunc:(t,e)=>{const[n]=e;return{condition:()=>de(Fe(n),"float32"),t:()=>L(t,de(n,t.dtype)),e:()=>L(t,de(xv(n),t.dtype))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RG={kernelName:gd,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>{const s=os(n,ze(0)),r=ze(Vm),i=ze(Um),o=L(t,i),a=L(L(t,r),kr(de(n,"float32")));return yn(s,o,a)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NG={kernelName:bd,outputsToSave:[!0],gradFunc:(t,e)=>{const[n]=e;return{x:()=>L(t,L(n,ve(ze(1),n)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AG={kernelName:vd,gradFunc:t=>({x:()=>Fe(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _G={kernelName:yd,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>L(hv(de(n,"float32")),t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DG={kernelName:xd,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>L($E(de(n,"float32")),t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FG={kernelName:$m,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,{begin:r,size:i}=n,o=s.shape,[a,l]=Bm(s,r,i),c=[];for(let u=0;u<t.rank;u++)c.push([a[u],o[u]-a[u]-l[u]]);return{x:()=>wv(t,c)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OG={kernelName:Nm,outputsToSave:[!0],gradFunc:(t,e,n)=>{const[s]=e,{dim:r}=n,i=!0,o=L(t,s);return{logits:()=>ve(o,L(ge(o,[r],i),s))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PG={kernelName:wd,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>L(t,jl(n))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fk={kernelName:Em,gradFunc:(t,e,n)=>{const{blockShape:s,paddings:r}=n;return{x:()=>uv(t,s,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ok={kernelName:Rm,gradFunc:(t,e,n)=>{const{axis:s}=n;return{x:()=>$n(t,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MG={kernelName:kd,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>ye(t,L(sn(de(n,"float32")),2))}}};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LG={kernelName:J1,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>L(t,L(de(n,"float32"),2))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zG={kernelName:Cd,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e,r=ze(2);return{a:()=>L(t,L(r,ve(n,s))),b:()=>L(t,L(r,ve(s,n)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jG={kernelName:Ed,gradFunc:t=>({x:()=>Fe(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BG={kernelName:Sd,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e,r=Se(n.shape,s.shape);return{a:()=>{let a=t;const l=Ft(n.shape,r);return l.length>0&&(a=ge(a,l)),U(a,n.shape)},b:()=>{let a=t;const l=Ft(s.shape,r);return l.length>0&&(a=ge(a,l)),U(vt(a),s.shape)}}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WG={kernelName:Tm,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,r=s.shape.slice(),{axis:i}=n;Te(i,s.shape).forEach(c=>{r[c]=1});const a=U(t,r),l=L(a,lo(s.shape,"float32"));return{x:()=>l}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VG={kernelName:Id,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>ye(t,et(hv(n)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UG={kernelName:$d,outputsToSave:[!0],gradFunc:(t,e)=>{const[n]=e;return{x:()=>L(ve(ze(1),et(n)),t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GG={kernelName:Td,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,{reps:r}=n;return{x:()=>{let o=Fe(s);if(s.rank===1)for(let a=0;a<r[0];++a)o=re(o,Qe(t,[a*s.shape[0]],[s.shape[0]]));else if(s.rank===2)for(let a=0;a<r[0];++a)for(let l=0;l<r[1];++l)o=re(o,Qe(t,[a*s.shape[0],l*s.shape[1]],[s.shape[0],s.shape[1]]));else if(s.rank===3)for(let a=0;a<r[0];++a)for(let l=0;l<r[1];++l)for(let c=0;c<r[2];++c)o=re(o,Qe(t,[a*s.shape[0],l*s.shape[1],c*s.shape[2]],[s.shape[0],s.shape[1],s.shape[2]]));else if(s.rank===4)for(let a=0;a<r[0];++a)for(let l=0;l<r[1];++l)for(let c=0;c<r[2];++c)for(let u=0;u<r[3];++u)o=re(o,Qe(t,[a*s.shape[0],l*s.shape[1],c*s.shape[2],u*s.shape[3]],[s.shape[0],s.shape[1],s.shape[2],s.shape[3]]));else throw new Error(`Gradient for tile operation is not implemented for rank-${s.rank} tensors yet.`);return o}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HG={kernelName:tl,gradFunc:(t,e,n)=>{const s=n,{perm:r}=s,i=oo(r);return{x:()=>De(t,i)}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KG={kernelName:Am,gradFunc:(t,e,n)=>{const s=n,{axis:r}=s;return{value:()=>Yr(t,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qG={kernelName:_m,inputsToSave:["segmentIds"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>XG(t,n)}}};function XG(t,e){const n=ao(e,Fe(e)),s=mv(t,n);let r=fa(e,ze(0,"int32"));const i=s.rank-r.rank;for(let a=0;a<i;++a)r=Cn(r,a+1);r=Xr(r,lo(s.shape,"bool"));const o=Fe(s);return yn(r,s,o)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YG={kernelName:Dm,gradFunc:t=>({x:()=>Fe(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QG=[zR,qU,XU,YU,QU,JU,ZU,e8,t8,n8,s8,r8,a8,u8,d8,h8,p8,f8,m8,g8,y8,x8,b8,v8,C8,S8,I8,$8,T8,E8,xG,R8,N8,A8,_8,D8,O8,F8,P8,M8,L8,z8,j8,B8,W8,V8,U8,G8,H8,X8,_k,_k,Y8,Z8,nG,sG,rG,iG,oG,aG,lG,cG,uG,dG,hG,Dk,Dk,pG,fG,yG,vG,bG,wG,kG,CG,SG,IG,$G,TG,EG,RG,NG,AG,_G,DG,FG,OG,PG,Fk,Fk,Ok,Ok,MG,zG,LG,jG,BG,WG,VG,UG,GG,HG,KG,qG,YG];for(const t of QG)Tj(t);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.abs=function(){return this.throwIfDisposed(),hn(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.acos=function(){return this.throwIfDisposed(),AB(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.acosh=function(){return this.throwIfDisposed(),DB(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.add=function(t){return this.throwIfDisposed(),re(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.all=function(t,e){return this.throwIfDisposed(),kE(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.any=function(t,e){return this.throwIfDisposed(),_0(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.argMax=function(t){return this.throwIfDisposed(),lu(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.argMin=function(t){return this.throwIfDisposed(),LB(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.asScalar=function(){return this.throwIfDisposed(),T(this.size===1,()=>"The array must have only 1 element."),U(this,[])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.asType=function(t){return this.throwIfDisposed(),de(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.as1D=function(){return this.throwIfDisposed(),U(this,[this.size])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.as2D=function(t,e){return this.throwIfDisposed(),U(this,[t,e])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.as3D=function(t,e,n){return this.throwIfDisposed(),U(this,[t,e,n])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.as4D=function(t,e,n,s){return this.throwIfDisposed(),U(this,[t,e,n,s])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.as5D=function(t,e,n,s,r){return this.throwIfDisposed(),U(this,[t,e,n,s,r])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.asin=function(){return this.throwIfDisposed(),jB(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.asinh=function(){return this.throwIfDisposed(),WB(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.atan=function(){return this.throwIfDisposed(),UB(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.atan2=function(t){return this.throwIfDisposed(),HB(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.atanh=function(){return this.throwIfDisposed(),qB(this)};Y().prototype.avgPool=function(t,e,n,s){return this.throwIfDisposed(),cv(this,t,e,n,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.batchToSpaceND=function(t,e){return this.throwIfDisposed(),uv(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.batchNorm=function(t,e,n,s,r){return this.throwIfDisposed(),Pm(this,t,e,n,s,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.broadcastTo=function(t){return this.throwIfDisposed(),Mc(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.cast=function(t){return this.throwIfDisposed(),de(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.ceil=function(){return this.throwIfDisposed(),w6(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.clipByValue=function(t,e){return this.throwIfDisposed(),ss(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.concat=function(t,e){return this.throwIfDisposed(),t instanceof Et&&(t=[t]),$n([this,...t],e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.conv1d=function(t,e,n,s,r,i){return this.throwIfDisposed(),CE(this,t,e,n,s,r,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.conv2dTranspose=function(t,e,n,s,r){return this.throwIfDisposed(),SE(this,t,e,n,s,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.conv2d=function(t,e,n,s,r,i){return this.throwIfDisposed(),Jo(this,t,e,n,s,r,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.cos=function(){return this.throwIfDisposed(),hv(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.cosh=function(){return this.throwIfDisposed(),$E(this)};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.cumprod=function(t,e,n){return this.throwIfDisposed(),F0(this,t,e,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.cumsum=function(t,e,n){return this.throwIfDisposed(),TE(this,t,e,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.depthToSpace=function(t,e){return this.throwIfDisposed(),H6(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.depthwiseConv2d=function(t,e,n,s,r,i){return this.throwIfDisposed(),pv(this,t,e,n,s,r,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.dilation2d=function(t,e,n,s,r){return this.throwIfDisposed(),X6(this,t,e,n,s,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.divNoNan=function(t){return this.throwIfDisposed(),eW(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.div=function(t){return this.throwIfDisposed(),ye(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.dot=function(t){return this.throwIfDisposed(),nW(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.elu=function(){return this.throwIfDisposed(),Lm(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.equal=function(t){return this.throwIfDisposed(),wr(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.erf=function(){return this.throwIfDisposed(),EE(this)};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.euclideanNorm=function(t,e){return this.throwIfDisposed(),fW(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.exp=function(){return this.throwIfDisposed(),kr(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.expandDims=function(t){return this.throwIfDisposed(),Cn(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.expm1=function(){return this.throwIfDisposed(),xW(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.fft=function(){return this.throwIfDisposed(),KE(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.flatten=function(){return this.throwIfDisposed(),U(this,[this.size])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.floor=function(){return this.throwIfDisposed(),jm(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.floorDiv=function(t){return this.throwIfDisposed(),wE(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.gather=function(t,e,n){return this.throwIfDisposed(),mv(this,t,e,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.greaterEqual=function(t){return this.throwIfDisposed(),fa(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.greater=function(t){return this.throwIfDisposed(),os(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.ifft=function(){return this.throwIfDisposed(),O0(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.irfft=function(){return this.throwIfDisposed(),cV(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.isFinite=function(){return this.throwIfDisposed(),TW(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.isInf=function(){return this.throwIfDisposed(),RW(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.isNaN=function(){return this.throwIfDisposed(),AW(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.leakyRelu=function(t){return this.throwIfDisposed(),yv(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.lessEqual=function(t){return this.throwIfDisposed(),Bl(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.less=function(t){return this.throwIfDisposed(),zp(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.localResponseNormalization=function(t,e,n,s){return this.throwIfDisposed(),PW(this,t,e,n,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.logSigmoid=function(){return this.throwIfDisposed(),VW(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.logSoftmax=function(t){return this.throwIfDisposed(),DE(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.logSumExp=function(t,e){return this.throwIfDisposed(),FE(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.log=function(){return this.throwIfDisposed(),Cr(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.log1p=function(){return this.throwIfDisposed(),_E(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.logicalAnd=function(t){return this.throwIfDisposed(),Xr(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.logicalNot=function(){return this.throwIfDisposed(),xv(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.logicalOr=function(t){return this.throwIfDisposed(),OE(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.logicalXor=function(t){return this.throwIfDisposed(),QW(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.matMul=function(t,e,n){return this.throwIfDisposed(),Le(this,t,e,n)};Y().prototype.maxPool=function(t,e,n,s){return this.throwIfDisposed(),vv(this,t,e,n,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.max=function(t,e){return this.throwIfDisposed(),qs(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.maximum=function(t){return this.throwIfDisposed(),ao(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.mean=function(t,e){return this.throwIfDisposed(),It(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.min=function(t,e){return this.throwIfDisposed(),Lp(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.minimum=function(t){return this.throwIfDisposed(),du(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.mirrorPad=function(t,e){return this.throwIfDisposed(),i5(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.mod=function(t){return this.throwIfDisposed(),a5(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.mul=function(t){return this.throwIfDisposed(),L(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.neg=function(){return this.throwIfDisposed(),vt(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.norm=function(t,e,n){return this.throwIfDisposed(),zm(this,t,e,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.notEqual=function(t){return this.throwIfDisposed(),jp(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.oneHot=function(t,e=1,n=0){return this.throwIfDisposed(),PE(this,t,e,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.onesLike=function(){return this.throwIfDisposed(),$s(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.pad=function(t,e){return this.throwIfDisposed(),wv(this,t,e)};Y().prototype.pool=function(t,e,n,s,r,i){return this.throwIfDisposed(),y5(this,t,e,n,s,r,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.pow=function(t){return this.throwIfDisposed(),Zo(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.prelu=function(t){return this.throwIfDisposed(),Cv(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.prod=function(t,e){return this.throwIfDisposed(),b5(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.reciprocal=function(){return this.throwIfDisposed(),V5(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.relu=function(){return this.throwIfDisposed(),ga(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.relu6=function(){return this.throwIfDisposed(),zE(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.reshapeAs=function(t){return this.throwIfDisposed(),U(this,t.shape)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.reshape=function(t){return this.throwIfDisposed(),U(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.resizeBilinear=function(t,e,n){return this.throwIfDisposed(),JE(this,t,e,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.resizeNearestNeighbor=function(t,e,n){return this.throwIfDisposed(),ZE(this,t,e,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.reverse=function(t){return this.throwIfDisposed(),ea(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.rfft=function(){return this.throwIfDisposed(),hV(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.round=function(){return this.throwIfDisposed(),jE(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.rsqrt=function(){return this.throwIfDisposed(),BE(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.selu=function(){return this.throwIfDisposed(),WE(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.separableConv2d=function(t,e,n,s,r,i){return this.throwIfDisposed(),VE(this,t,e,n,s,r,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.sigmoid=function(){return this.throwIfDisposed(),jl(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.sign=function(){return this.throwIfDisposed(),J5(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.sin=function(){return this.throwIfDisposed(),UE(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.sinh=function(){return this.throwIfDisposed(),GE(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.slice=function(t,e){return this.throwIfDisposed(),Qe(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.softmax=function(t){return this.throwIfDisposed(),Dv(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.softplus=function(){return this.throwIfDisposed(),_d(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.spaceToBatchND=function(t,e){return this.throwIfDisposed(),kv(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.split=function(t,e){return this.throwIfDisposed(),es(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.sqrt=function(){return this.throwIfDisposed(),sn(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.square=function(){return this.throwIfDisposed(),et(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.squaredDifference=function(t){return this.throwIfDisposed(),fV(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.squeeze=function(t){return this.throwIfDisposed(),Fd(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.stack=function(t,e){this.throwIfDisposed();const n=t instanceof Et?[this,t]:[this,...t];return Yr(n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.step=function(t){return this.throwIfDisposed(),Od(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.stridedSlice=function(t,e,n,s,r,i,o,a){return this.throwIfDisposed(),vV(this,t,e,n,s,r,i,o,a)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.sub=function(t){return this.throwIfDisposed(),ve(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.sum=function(t,e){return this.throwIfDisposed(),ge(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.tan=function(){return this.throwIfDisposed(),wV(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.tanh=function(){return this.throwIfDisposed(),Om(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.tile=function(t){return this.throwIfDisposed(),Us(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.toBool=function(){return this.throwIfDisposed(),de(this,"bool")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.toFloat=function(){return this.throwIfDisposed(),de(this,"float32")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.toInt=function(){return this.throwIfDisposed(),de(this,"int32")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.topk=function(t,e){return this.throwIfDisposed(),SV(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.transpose=function(t){return this.throwIfDisposed(),De(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.unique=function(t){return this.throwIfDisposed(),TV(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.unsortedSegmentSum=function(t,e){return this.throwIfDisposed(),YE(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.unstack=function(t){return this.throwIfDisposed(),ta(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.where=function(t,e){return this.throwIfDisposed(),yn(t,this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.zerosLike=function(){return this.throwIfDisposed(),Fe(this)};/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class ar extends Error{constructor(e){super(e),Object.setPrototypeOf(this,ar.prototype)}}class vs extends Error{constructor(e){super(e),Object.setPrototypeOf(this,vs.prototype)}}class O extends Error{constructor(e){super(e),Object.setPrototypeOf(this,O.prototype)}}class Ie extends Error{constructor(e){super(e),Object.setPrototypeOf(this,Ie.prototype)}}class gb extends Error{constructor(e){super(e),Object.setPrototypeOf(this,gb.prototype)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class BR{constructor(e){this.maxEntries=e||100,this.cache=new Map}get(e){let n;return this.cache.has(e)&&(n=this.cache.get(e),this.cache.delete(e),this.cache.set(e,n)),n}put(e,n){if(this.cache.has(e))this.cache.delete(e);else if(this.cache.size>=this.maxEntries){const s=this.cache.keys().next().value;this.cache.delete(s)}this.cache.set(e,n)}getMaxEntries(){return this.maxEntries}setMaxEntries(e){if(e<0)throw new Error(`The maxEntries of LRU caches must be at least 0, but got ${e}.`);if(this.maxEntries>e)for(let n=0;n<this.maxEntries-e;n++){const s=this.cache.keys().next().value;this.cache.delete(s)}this.maxEntries=e}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function na(t,e){if(Array.isArray(t)){let n=[];for(let s=0;s<e;s++)n=n.concat(t);return n}else{const n=new Array(e);return n.fill(t),n}}function lr(t,e){if(!t)throw new gb(e)}function Pk(t,e){let n=0;for(const s of t)s===e&&n++;return n}function Sn(t){return t.length===1?t[0]:t}function Be(t){return Array.isArray(t)?t:[t]}function _r(t){const n=t.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return n[0]!=="_"?n:"private"+n}function Co(t){return t.length<=1||t.indexOf("_")===-1?t:t.replace(/[_]+(\w|$)/g,(e,n)=>n.toUpperCase())}let ls={};function yb(t){if(t==null)return null;const e={};return e.className=t.getClassName(),e.config=t.getConfig(),e}function L0(t){if(!(t==null||typeof t!="object"))if(Array.isArray(t))t.forEach(e=>L0(e));else{const e=Object.keys(t);for(const n of e){const s=t[n];s!=null&&typeof s=="object"&&(!Array.isArray(s)&&s.type==="ndarray"&&typeof s.value=="number"?t[n]=s.value:L0(s))}}}function zd(t,e={},n={},s="object",r=!1){if(typeof t=="string"){const i=t;let o;if(i in n)o=n[i];else if(i in ls)o=ls[i];else if(o=e[i],o==null)throw new O(`Unknown ${s}: ${t}. This may be due to one of the following reasons:
1. The ${s} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${s} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);return o}else{const i=t;if(i.className==null||i.config==null)throw new O(`${s}: Improper config format: ${JSON.stringify(i)}.
'className' and 'config' must set.`);const o=i.className;let a,l;if(o in n?[a,l]=n[o]:o in ls?[a,l]=ls.className:o in e&&([a,l]=e[o]),a==null)throw new O(`Unknown ${s}: ${o}. This may be due to one of the following reasons:
1. The ${s} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${s} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);if(l!=null){const c={};for(const p of Object.keys(ls))c[p]=ls[p];for(const p of Object.keys(n))c[p]=n[p];const u=i.config;u.customObjects=c;const d=Object.assign({},ls);for(const p of Object.keys(n))ls[p]=n[p];L0(i.config);const h=l(a,i.config,n,r);return ls=Object.assign({},d),h}else{const c=Object.assign({},ls);for(const d of Object.keys(n))ls[d]=n[d];const u=new a(i.config);return ls=Object.assign({},c),u}}}function JG(t,e){return t<e?-1:t>e?1:0}function wh(t,e){return-1*JG(t,e)}function Bi(t){if(t==null)return t;const e=[];for(const n of t)e.indexOf(n)===-1&&e.push(n);return e}function ZG(t){if(t==null)throw new O(`Invalid value in obj: ${JSON.stringify(t)}`);for(const e in t)if(t.hasOwnProperty(e))return!1;return!0}function xa(t,e,n){if(n!=null&&t.indexOf(n)<0)throw new O(`${n} is not a valid ${e}.  Valid values are ${t} or null/undefined.`)}function xb(t,e,n=0,s=1/0){return lr(n>=0),lr(s>=n),Array.isArray(t)&&t.length>=n&&t.length<=s&&t.every(r=>typeof r===e)}function Bt(t,e){Array.isArray(t)?(T(t.length>0,()=>`${e} is unexpectedly an empty array.`),t.forEach((n,s)=>Bt(n,`element ${s+1} of ${e}`))):T(Number.isInteger(t)&&t>0,()=>`Expected ${e} to be a positive integer, but got ${WR(t)}.`)}function WR(t){return t===null?"null":Array.isArray(t)?"["+t.map(e=>WR(e)).join(",")+"]":typeof t=="string"?`"${t}"`:`${t}`}function eH(t,e,n){let s=n!=null?n():kn(),r;return(...o)=>{const a=n!=null?n():kn();return a-s<e||(s=a,r=t(...o)),r}}function VR(t){return t==="relu"?"relu":t==="linear"?"linear":t==="elu"?"elu":null}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let tH=0;function UR(){return tH++}const kh={};function Gm(t=""){return t in kh||(kh[t]=0),kh[t]+=1,t+kh[t].toString()}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const nH=["channelsFirst","channelsLast"],sH=["nearest","bilinear"],rH=["valid","same","causal"],iH=["max","avg"],oH=["sum","mul","concat","ave"];/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const Ia=new Map;function kt(t){xa(nH,"DataFormat",t)}function aH(t){xa(sH,"InterpolationFormat",t)}function as(t){xa(rH,"PaddingMode",t)}function GR(t){xa(iH,"PoolMode",t)}const Lc=[],Mk="/";function Po(t,e){Lc.push(t);try{const n=e();return Lc.pop(),n}catch(n){throw Lc.pop(),n}}function lH(){return Lc.length===0?"":Lc.join(Mk)+Mk}function HR(t){if(!qR(t))throw new Error("Not a valid tensor name: '"+t+"'");return lH()+t}function KR(t){if(!qR(t))throw new Error("Not a valid tensor name: '"+t+"'");Ia.has(t)||Ia.set(t,0);const e=Ia.get(t);if(Ia.set(t,Ia.get(t)+1),e>0){const n=`${t}_${e}`;return Ia.set(n,1),n}else return t}const cH=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function qR(t){return!!t.match(cH)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function uH(t){return t===parseInt(t.toString(),10)}function Wi(t,e,n){e==null&&(e=0),n==null&&(n=t.length);let s=1;for(let r=e;r<n;++r)s*=t[r];return s}function kl(t){if(t.length===0)return Number.NaN;let e=Number.POSITIVE_INFINITY;for(let n=0;n<t.length;n++){const s=t[n];s<e&&(e=s)}return e}function Hi(t){if(t.length===0)return Number.NaN;let e=Number.NEGATIVE_INFINITY;for(let n=0;n<t.length;n++){const s=t[n];s>e&&(e=s)}return e}function Js(t,e){if(e<t)throw new O(`end (${e}) < begin (${t}) is forbidden.`);const n=[];for(let s=t;s<e;++s)n.push(s);return n}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let Yg;function Nt(){return Yg==null&&(Yg=tB().epsilon()),Yg}function Zs(){return"channelsLast"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function vr(t,e){return de(t,e)}function jd(t,e=-1){const n=t.shape.slice();return e<0&&(e=n.length+e+1),n.splice(e,0,1),U(t,n)}function dH(t,e){return K(()=>{if(t.shape.length!==2)throw new O(`repeat() expects a rank-2 tensor, but received a rank-${t.shape.length} tensor.`);const n=jd(t,1);return z0(n,[1,e,1])})}function hH(t){const e=[Wi(t.shape)];return U(t,e)}function pH(t){if(t.rank<=1)throw new O(`batchFlatten requires a minimum rank of 2. Got rank: ${t.rank}.`);const e=[t.shape[0],Wi(t.shape,1)];return U(t,e)}function Mo(t,e,n){return K(()=>{switch(t.rank){case 1:return Av(t,e,n);case 2:return HE(t,[e,0],[n,t.shape[1]]);case 3:return _v(t,[e,0,0],[n,t.shape[1],t.shape[2]]);case 4:return Wp(t,[e,0,0,0],[n,t.shape[1],t.shape[2],t.shape[3]]);case 5:return Qe(t,[e,0,0,0,0],[n,t.shape[1],t.shape[2],t.shape[3],t.shape[4]]);case 6:return Qe(t,[e,0,0,0,0,0],[n,t.shape[1],t.shape[2],t.shape[3],t.shape[4],t.shape[5]]);default:throw new O(`sliceAlongFirstAxis() received an unsupported tensor rank: ${t.rank}`)}})}function Qg(t,e,n){return K(()=>{switch(t.rank){case 1:return Av(t,e,n);case 2:return HE(t,[0,e],[t.shape[0],n]);case 3:return _v(t,[0,0,e],[t.shape[0],t.shape[1],n]);case 4:return Wp(t,[0,0,0,e],[t.shape[0],t.shape[1],t.shape[2],n]);default:throw new O(`sliceAlongLastAxis() received an unsupported tensor rank: ${t.rank}`)}})}function Ch(t,e,n,s){return K(()=>{switch(t.rank){case 1:return Av(t,e,n);case 2:switch(s){case 1:return Mo(t,e,n);case 2:return Qg(t,e,n);default:throw new O(`The axis is not within the rank of the tensor ${s}`)}case 3:switch(s){case 1:return Mo(t,e,n);case 2:return _v(t,[0,e,0],[t.shape[0],n,t.shape[2]]);case 3:return Qg(t,e,n);default:throw new O(`The axis is not within the rank of the tensor ${s}`)}case 4:switch(s){case 1:return Mo(t,e,n);case 2:return Wp(t,[0,e,0,0],[t.shape[0],n,t.shape[2],t.shape[3]]);case 3:return Wp(t,[0,0,e,0],[t.shape[0],t.shape[1],n,t.shape[3]]);case 4:return Qg(t,e,n);default:throw new O(`The axis is not within the rank of the tensor ${s}`)}default:throw new O(`sliceAlongLastAxis() received an unsupported tensor rank: ${t.rank}`)}})}function vb(t,e=-1){let n;return e<0&&(n=t[0].rank,n!==0?e=n:e=0),e===t[0].rank&&(e=-1),$n(t,e)}function Lk(t,e){switch(t.rank){case 1:return S6([t,e]);case 2:return $6([t,e],0);case 3:return E6([t,e],0);case 4:return N6([t,e],0);default:throw new O(`concatAlongFirstAxis() received an unsupported tensor rank: ${t.rank}`)}}function z0(t,e){if(Array.isArray(e)||(e=[e]),t.rank!==e.length)throw new O(`The length of input n (${e.length}) does not match the number of dimensions in input x (${t.rank})`);return Us(t,e)}function Hm(t,e=0,n=1,s,r){return z5(t,e,n,s,r)}function br(t,e,n,s){if(t.rank<2||e.rank<2)throw new Ie(`dot requires both inputs to be rank >= 2 but got x shape = ${t.shape} and y shape = ${e.shape}`);if(e.rank>=3){const r=t.shape.slice(-1)[0],i=e.shape.slice(-2)[0];if(r!==i)throw new Ie(`If rank y >= 3, then the second last dim of y must equal the last dim of x but got x shape = ${t.shape} and  y shape = ${e.shape}`)}if(t.rank===2&&e.rank===2)return Sk({a:t,b:e,transposeA:!1,transposeB:!1,bias:s?j0(t.rank,s,Zs()):null,activation:n});{const r=t.shape.slice(),i=r.pop();t=U(t,[-1,i]);const o=e.shape.slice(),a=o.pop(),l=o.pop(),c=[...o,a],u=Array.from({length:e.rank},(f,g)=>g===0?e.rank-2:g<=e.rank-2?g-1:g);e=U(De(e,u),[l,-1]);const d=[...r,...c];return U(Sk({a:t,b:e,transposeA:!1,transposeB:!1,bias:s?j0(t.rank,s,Zs()):null,activation:n}),d)}}function XR(t,e,n){return K(()=>(Array.isArray(e)?e=Ln(e,"int32"):e=de(e,"int32"),mv(t,e,n)))}function Bd(t){return L(t,t)}function j0(t,e,n){const s=e.shape;if(e.rank!==1&&e.rank!==t)throw new O(`Unexpected bias dimensions: ${e.rank}; expected it to be 1 or ${t}`);if(t===5){if(n==="channelsFirst")return s.length===1?U(e,[1,s[0],1,1,1]):U(e,[1,s[3],s[0],s[1],s[2]]);if(n==="channelsLast")return s.length===1?U(e,[1,1,1,1,s[0]]):U(e,[1].concat(s))}else if(t===4){if(n==="channelsFirst")return s.length===1?U(e,[1,s[0],1,1]):U(e,[1,s[2],s[0],s[1]]);if(n==="channelsLast")return s.length===1?U(e,[1,1,1,s[0]]):U(e,[1].concat(s))}else if(t===3){if(n==="channelsFirst")return s.length===1?U(e,[1,s[0],1]):U(e,[1,s[1],s[0]]);if(n==="channelsLast")return s.length===1?U(e,[1,1,s[0]]):U(e,[1].concat(s))}else if(t<3)return e;throw new O(`Unsupported input rank by biasAdd: ${e.rank}`)}function nr(t,e,n){return K(()=>(n==null&&(n=Zs()),kt(n),re(t,j0(t.rank,e,n))))}function fH(t,e=1){if(e!==1)throw new Ie(`Support for alpha values other than 1 (${e}) is not implemented yet.`);return Lm(t)}function mH(t){return K(()=>ye(t,re(hn(t),1)))}function YR(t,e,n,s){return K(()=>FV(t,e,n,s))}function gH(t){return K(()=>{const e=re(.5,L(.2,t));return ss(e,0,1)})}function Wd(t,e,n=!1){return n?t():e()}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const yH=["fanIn","fanOut","fanAvg"],xH=["normal","uniform","truncatedNormal"];/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function vH(t){xa(yH,"FanMode",t)}function bH(t){xa(xH,"Distribution",t)}class Es extends Vl{fromConfigUsesCustomObjects(){return!1}getConfig(){return{}}}class QR extends Es{apply(e,n){return zt(e,n)}}QR.className="Zeros";te(QR);class bb extends Es{apply(e,n){return lo(e,n)}}bb.className="Ones";te(bb);class JR extends Es{constructor(e){if(super(),typeof e!="object")throw new O(`Expected argument of type ConstantConfig but got ${e}`);if(e.value===void 0)throw new O(`config must have value set but got ${e}`);this.value=e.value}apply(e,n){return K(()=>L(ze(this.value),lo(e,n)))}getConfig(){return{value:this.value}}}JR.className="Constant";te(JR);class ZR extends Es{constructor(e){super(),this.DEFAULT_MINVAL=-.05,this.DEFAULT_MAXVAL=.05,this.minval=e.minval||this.DEFAULT_MINVAL,this.maxval=e.maxval||this.DEFAULT_MAXVAL,this.seed=e.seed}apply(e,n){return Dd(e,this.minval,this.maxval,n,this.seed)}getConfig(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}}}ZR.className="RandomUniform";te(ZR);class eN extends Es{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,n){if(n=n||"float32",n!=="float32"&&n!=="int32")throw new Ie(`randomNormal does not support dType ${n}.`);return Hm(e,this.mean,this.stddev,n,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}eN.className="RandomNormal";te(eN);class tN extends Es{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,n){if(n=n||"float32",n!=="float32"&&n!=="int32")throw new Ie(`truncatedNormal does not support dType ${n}.`);return XE(e,this.mean,this.stddev,n,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}tN.className="TruncatedNormal";te(tN);class nN extends Es{constructor(e){super(),this.gain=e.gain!=null?e.gain:1}apply(e,n){return K(()=>{if(e.length!==2||e[0]!==e[1])throw new O("Identity matrix initializer can only be used for 2D square matrices.");return L(this.gain,AE(e[0]))})}getConfig(){return{gain:this.gain}}}nN.className="Identity";te(nN);function wH(t,e="channelsLast"){let n,s;if(kt(e),t.length===2)n=t[0],s=t[1];else if([3,4,5].indexOf(t.length)!==-1){if(e==="channelsFirst"){const r=Wi(t,2);n=t[1]*r,s=t[0]*r}else if(e==="channelsLast"){const r=Wi(t,0,t.length-2);n=t[t.length-2]*r,s=t[t.length-1]*r}}else{const r=Wi(t);n=Math.sqrt(r),s=Math.sqrt(r)}return[n,s]}class Un extends Es{constructor(e){if(super(),e.scale<0)throw new O(`scale must be a positive float. Got: ${e.scale}`);this.scale=e.scale==null?1:e.scale,this.mode=e.mode==null?"fanIn":e.mode,vH(this.mode),this.distribution=e.distribution==null?"normal":e.distribution,bH(this.distribution),this.seed=e.seed}apply(e,n){const s=wH(e),r=s[0],i=s[1];let o=this.scale;if(this.mode==="fanIn"?o/=Math.max(1,r):this.mode==="fanOut"?o/=Math.max(1,i):o/=Math.max(1,(r+i)/2),this.distribution==="normal"){const a=Math.sqrt(o);if(n=n||"float32",n!=="float32"&&n!=="int32")throw new Ie(`${this.getClassName()} does not support dType ${n}.`);return XE(e,0,a,n,this.seed)}else{const a=Math.sqrt(3*o);return Dd(e,-a,a,n,this.seed)}}getConfig(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}}}Un.className="VarianceScaling";te(Un);class wb extends Un{constructor(e){super({scale:1,mode:"fanAvg",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return Un.className}}wb.className="GlorotUniform";te(wb);class kb extends Un{constructor(e){super({scale:1,mode:"fanAvg",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return Un.className}}kb.className="GlorotNormal";te(kb);class Cb extends Un{constructor(e){super({scale:2,mode:"fanIn",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return Un.className}}Cb.className="HeNormal";te(Cb);class Sb extends Un{constructor(e){super({scale:2,mode:"fanIn",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return Un.className}}Sb.className="HeUniform";te(Sb);class Ib extends Un{constructor(e){super({scale:1,mode:"fanIn",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return Un.className}}Ib.className="LeCunNormal";te(Ib);class $b extends Un{constructor(e){super({scale:1,mode:"fanIn",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return Un.className}}$b.className="LeCunUniform";te($b);class sN extends Es{constructor(e){super(),this.DEFAULT_GAIN=1,this.ELEMENTS_WARN_SLOW=2e3,this.gain=e.gain==null?this.DEFAULT_GAIN:e.gain,this.seed=e.seed}apply(e,n){return K(()=>{if(e.length<2)throw new Ie("Shape must be at least 2D.");if(n!=="int32"&&n!=="float32"&&n!==void 0)throw new TypeError(`Unsupported data type ${n}.`);n=n;const s=J(e.slice(0,-1)),r=e[e.length-1],i=s*r;i>this.ELEMENTS_WARN_SLOW&&console.warn(`Orthogonal initializer is being called on a matrix with more than ${this.ELEMENTS_WARN_SLOW} (${i}) elements: Slowness may result.`);const o=[Math.max(r,s),Math.min(r,s)],a=Hm(o,0,1,n,this.seed),l=NU.qr(a,!1);let c=l[0];const d=l[1].flatten().stridedSlice([0],[Math.min(r,s)*Math.min(r,s)],[Math.min(r,s)+1]);return c=L(c,d.sign()),s<r&&(c=c.transpose()),L(ze(this.gain),c.reshape(e))})}getConfig(){return{gain:this.gain,seed:this.seed}}}sN.className="Orthogonal";te(sN);const zk={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function jk(t,e={}){return zd(t,fs.getMap().classNameMap,e,"initializer")}function ut(t){return yb(t)}function ot(t){if(typeof t=="string"){const e=t in zk?zk[t]:t;if(e==="GlorotNormal")return new kb;if(e==="GlorotUniform")return new wb;if(e==="HeNormal")return new Cb;if(e==="HeUniform")return new Sb;if(e==="LeCunNormal")return new Ib;if(e==="LeCunUniform")return new $b;{const n={};return n.className=e,n.config={},jk(n)}}else return t instanceof Es?t:jk(t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function B0(t){return Array.isArray(t)&&Array.isArray(t[0])}function Vp(t){return t.length===0?[]:Array.isArray(t[0])?t:[t]}function be(t){let e;if(Array.isArray(t)){if(t.length!==1)throw new O(`Expected Tensor length to be 1; got ${t.length}`);e=t[0]}else e=t;return e}function Pe(t){if(Array.isArray(t)&&Array.isArray(t[0])){if(t.length===1)return t=t,t[0];throw new O(`Expected exactly 1 Shape; got ${t.length}`)}else return t}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Up(t){let e=0;for(const n of t)n.shape.length===0?e+=1:e+=n.shape.reduce((s,r)=>s*r);return e}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const Bk="Variable";class kH{constructor(e,n="float32",s=Bk,r=!0,i=null){this.dtype=n??"float32",this.shape=e.shape,this.id=UR(),s=s??Bk,this.originalName=HR(s),this.name=KR(this.originalName),this.trainable_=r,this.constraint=i,this.val=NV(e,this.trainable_,this.name,this.dtype)}read(){return this.assertNotDisposed(),this.val}write(e){return this.assertNotDisposed(),CH(this.val,e),this.val.id!==e.id&&(this.val.assign(e),this.constraint!=null&&this.val.assign(this.constraint.apply(this.val))),this}dispose(){this.assertNotDisposed(),this.val.dispose()}assertNotDisposed(){if(this.val.isDisposed)throw new Error(`LayersVariable ${this.name} is already disposed.`)}get trainable(){return this.trainable_}set trainable(e){this.trainable_=e,this.val.trainable=e}}function CH(t,e){if(t.shape.toString()!==e.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(t.shape)+" vs. "+JSON.stringify(e.shape))}function W0(t){return t.map(e=>e.read())}function Tb(t){t.forEach(e=>{e[0].write(e[1])})}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class At{constructor(e){this.dtype=e.dtype,this.shape=e.shape,e.shape!=null?this.ndim=e.shape.length:this.ndim=e.ndim,this.maxNDim=e.maxNDim,this.minNDim=e.minNDim,this.axes=e.axes||{}}}class Sr{constructor(e,n,s,r,i,o,a){this.dtype=e,this.shape=n,this.sourceLayer=s,this.inputs=r,this.callArgs=i,this.outputTensorIndex=a,this.id=UR(),o!=null&&(this.originalName=HR(o),this.name=KR(this.originalName)),this.rank=n.length}}let SH=0;class Km{constructor(e,n){this.callArgs=n,this.id=SH++,this.outboundLayer=e.outboundLayer,this.inboundLayers=e.inboundLayers,this.nodeIndices=e.nodeIndices,this.tensorIndices=e.tensorIndices,this.inputTensors=e.inputTensors,this.outputTensors=e.outputTensors,this.inputMasks=e.inputMasks,this.outputMasks=e.outputMasks,this.inputShapes=e.inputShapes,this.outputShapes=e.outputShapes;for(const s of e.inboundLayers)s!=null&&s.outboundNodes.push(this);e.outboundLayer.inboundNodes.push(this)}getConfig(){const e=[];for(const n of this.inboundLayers)n!=null?e.push(n.name):e.push(null);return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:e,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}}}let IH=0;class Ee extends Vl{constructor(e={}){super(),this._callHook=null,this._addedWeightNames=[],this._stateful=!1,this.id=IH++,this.activityRegularizer=null,this.inputSpec=null,this.supportsMasking=!1,this._trainableWeights=[],this._nonTrainableWeights=[],this._losses=[],this._updates=[],this._built=!1,this.inboundNodes=[],this.outboundNodes=[];let n=e.name;if(!n){const s=this.getClassName();n=_r(s)+"_"+Gm(s)}if(this.name=n,this.trainable_=e.trainable==null?!0:e.trainable,e.inputShape!=null||e.batchInputShape!=null){let s;if(e.batchInputShape!=null)s=e.batchInputShape;else if(e.inputShape!=null){let i=null;e.batchSize!=null&&(i=e.batchSize),s=[i].concat(e.inputShape)}this.batchInputShape=s;let r=e.dtype;r==null&&(r=e.inputDType),r==null&&(r="float32"),this.dtype=r}e.weights!=null?this.initialWeights=e.weights:this.initialWeights=null,this._refCount=null,this.fastWeightInitDuringBuild=!1}static nodeKey(e,n){return e.name+"_ib-"+n.toString()}getNodeAtIndex(e,n){if(this.inboundNodes.length===0)throw new vs(`The layer has never been called and thus has no defined ${n}.`);if(this.inboundNodes.length<=e)throw new O(`Asked to get ${n} at node ${e}, but the layer has only ${this.inboundNodes.length} inbound nodes.`);return this.inboundNodes[e]}getInputAt(e){return Sn(this.getNodeAtIndex(e,"input").inputTensors)}getOutputAt(e){return Sn(this.getNodeAtIndex(e,"output").outputTensors)}get input(){if(this.inboundNodes.length>1)throw new ar(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use \`getInputAt(nodeIndex)\` instead.`);if(this.inboundNodes.length===0)throw new ar(`Layer ${this.name} is not connected, no input to return.`);return Sn(this.getNodeAtIndex(0,"input").inputTensors)}get output(){if(this.inboundNodes.length===0)throw new ar(`Layer ${this.name} has no inbound nodes.`);if(this.inboundNodes.length>1)throw new ar(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use \`getOutputAt(nodeIndex)\` instead.`);return Sn(this.getNodeAtIndex(0,"output").outputTensors)}get losses(){return this._losses}calculateLosses(){return this.losses.map(e=>e())}get updates(){return this._updates}get built(){return this._built}set built(e){this._built=e}get trainable(){return this.trainable_}set trainable(e){this._trainableWeights.forEach(n=>n.trainable=e),this.trainable_=e}get trainableWeights(){return this.trainable_?this._trainableWeights.filter(e=>e.trainable):[]}set trainableWeights(e){this._trainableWeights=e}get nonTrainableWeights(){return this.trainable?this._trainableWeights.filter(e=>!e.trainable).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)}set nonTrainableWeights(e){this._nonTrainableWeights=e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}get stateful(){return this._stateful}resetStates(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")}assertInputCompatibility(e){const n=Be(e);if(this.inputSpec==null||this.inputSpec.length===0)return;const s=Be(this.inputSpec);if(n.length!==s.length)throw new O(`Layer ${this.name} expects ${s.length} inputs, but it received ${n.length} input tensors. Input received: ${e}`);for(let r=0;r<n.length;r++){const i=n[r],o=s[r];if(o==null)continue;const a=i.rank;if(o.ndim!=null&&a!==o.ndim)throw new O(`Input ${r} is incompatible with layer ${this.name}: expected ndim=${o.ndim}, found ndim=${a}`);if(o.maxNDim!=null&&a>o.maxNDim)throw new O(`Input ${r} is incompatible with layer ${this.name}: expected max_ndim=${o.maxNDim}, found ndim=${a}`);if(o.minNDim!=null&&a<o.minNDim)throw new O(`Input ${r} is incompatible with layer ${this.name}: expected min_ndim=${o.minNDim}, found ndim=${a}.`);if(o.dtype!=null&&i.dtype!==o.dtype)throw new O(`Input ${r} is incompatible with layer ${this.name} : expected dtype=${o.dtype}, found dtype=${i.dtype}.`);if(o.axes){const l=i.shape;for(const c in o.axes){const u=Number(c),d=o.axes[c],h=u>=0?l[u]:l[l.length+u];if(d!=null&&[d,null].indexOf(h)===-1)throw new O(`Input ${r} is incompatible with layer ${this.name}: expected axis ${u} of input shape to have value ${d} but got shape ${l}.`)}}if(o.shape!=null)for(let l=0;l<o.shape.length;++l){const c=o.shape[l],u=i.shape[l];if(c!=null&&u!=null&&c!==u)throw new O(`Input ${r} is incompatible with layer ${this.name}: expected shape=${o.shape}, found shape=${i.shape}.`)}}}call(e,n){return e}invokeCallHook(e,n){this._callHook!=null&&this._callHook(e,n)}setCallHook(e){this._callHook=e}clearCallHook(){this._callHook=null}apply(e,n){n=n||{},this.assertNotDisposed();const s=Be(e),r=EH(e),i=RH(e);if(r===i)throw new O("Arguments to apply() must be all SymbolicTensors or all Tensors");return Po(this.name,()=>{if(!this.built){this.assertInputCompatibility(e);const o=[];for(const a of Be(e))o.push(a.shape);this.build(Sn(o)),this.built=!0,this.initialWeights&&this.setWeights(this.initialWeights),this._refCount===null&&i&&(this._refCount=1)}if(this.assertInputCompatibility(e),i){let o=this.call(e,n);this.supportsMasking&&this.setMaskMetadata(e,o);const a=Be(o),l=[];for(let c of a)s.indexOf(c)!==-1&&(c=c.clone()),l.push(c);if(o=Sn(l),this.activityRegularizer!=null)throw new Ie("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return o}else{const o=$H(e),a=this.computeOutputShape(o);let l;const c=TH(e);if(this.warnOnIncompatibleInputShape(Array.isArray(e)?o[0]:o),a!=null&&a.length>0&&Array.isArray(a[0])?l=a.map((u,d)=>new Sr(c,u,this,Be(e),n,this.name,d)):l=new Sr(c,a,this,Be(e),n,this.name),this.addInboundNode(e,l,null,null,o,a,n),this._refCount++,this.activityRegularizer!=null)throw new Ie("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return l}})}warnOnIncompatibleInputShape(e){if(this.batchInputShape!=null)if(e.length!==this.batchInputShape.length)console.warn(`The rank of the input tensor provided (shape: ${JSON.stringify(e)}) does not match that of the batchInputShape (${JSON.stringify(this.batchInputShape)}) of the layer ${this.name}`);else{let n=!1;this.batchInputShape.forEach((s,r)=>{s!=null&&e[r]!=null&&e[r]!==s&&(n=!0)}),n&&console.warn(`The shape of the input tensor (${JSON.stringify(e)}) does not match the expectation of layer ${this.name}: ${JSON.stringify(this.batchInputShape)}`)}}get outputShape(){if(this.inboundNodes==null||this.inboundNodes.length===0)throw new ar(`The layer ${this.name} has never been called and thus has no defined output shape.`);const e=[];for(const n of this.inboundNodes){const s=JSON.stringify(n.outputShapes);e.indexOf(s)===-1&&e.push(s)}if(e.length===1){const n=this.inboundNodes[0].outputShapes;return Array.isArray(n)&&Array.isArray(n[0])&&n.length===1?n[0]:n}else throw new ar(`The layer ${this.name} has multiple inbound nodes with different output shapes. Hence the notion of "output shape" is ill-defined for the layer.`)}countParams(){if(!this.built)throw new vs(`You tried to call countParams() on ${this.name}, but the layer is not built yet. Build it first by calling build(batchInputShape).`);return Up(this.weights)}build(e){this.built=!0}getWeights(e=!1){return W0(e?this.trainableWeights:this.weights)}setWeights(e){K(()=>{const n=this.weights;if(n.length!==e.length)throw new O(`You called setWeights(weights) on layer "${this.name}" with a weight list of length ${e.length}, but the layer was expecting ${n.length} weights. Provided weights: ${e}...`);if(n.length===0)return;const s=[],r=W0(n);for(let i=0;i<r.length;++i){const o=r[i],a=n[i],l=e[i];if(!je(o.shape,l.shape))throw new O(`Layer weight shape ${o.shape} not compatible with provided weight shape ${l.shape}`);s.push([a,l])}Tb(s)})}addWeight(e,n,s,r,i,o,a,l){if(this._addedWeightNames.indexOf(e)!==-1)throw new O(`Duplicate weight name ${e} for layer ${this.name}`);this._addedWeightNames.push(e),s==null&&(s="float32"),this.fastWeightInitDuringBuild&&(r=l!=null?l():ot("zeros"));const c=r.apply(n,s),u=new kH(c,s,e,o,a);return c.dispose(),i!=null&&this.addLoss(()=>i.apply(u.read())),o==null&&(o=!0),o?this._trainableWeights.push(u):this._nonTrainableWeights.push(u),u}setFastWeightInitDuringBuild(e){this.fastWeightInitDuringBuild=e}addLoss(e){e==null||Array.isArray(e)&&e.length===0||(e=Be(e),this._losses!==void 0&&this._losses!==null&&this.losses.push(...e))}computeOutputShape(e){return e}computeMask(e,n){if(!this.supportsMasking){if(n!=null)if(Array.isArray(n))n.forEach(s=>{if(s!=null)throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`)});else throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`);return null}return n}setMaskMetadata(e,n,s){if(!this.supportsMasking)return;const r=this.computeMask(e,s),i=Be(n),o=Be(r);if(i.length!==o.length)throw new Error(`${this.name} outputs ${i.length} tensors but ${i.length} masks for those tensors`);for(let a=0;a<i.length;a++)i[a].kerasMask=o[a]}addInboundNode(e,n,s,r,i,o,a=null){const l=Be(e);n=Be(n),s=Be(s),r=Be(r),i=Vp(i),o=Vp(o);const c=[],u=[],d=[];for(const h of l)c.push(h.sourceLayer),u.push(h.nodeIndex),d.push(h.tensorIndex);new Km({outboundLayer:this,inboundLayers:c,nodeIndices:u,tensorIndices:d,inputTensors:l,outputTensors:n,inputMasks:s,outputMasks:r,inputShapes:i,outputShapes:o},a);for(let h=0;h<n.length;h++)n[h].sourceLayer=this,n[h].nodeIndex=this.inboundNodes.length-1,n[h].tensorIndex=h}getConfig(){const e={name:this.name,trainable:this.trainable};return this.batchInputShape!=null&&(e.batchInputShape=this.batchInputShape),this.dtype!=null&&(e.dtype=this.dtype),e}disposeWeights(){return this.weights.forEach(e=>e.dispose()),this.weights.length}assertNotDisposed(){if(this._refCount===0)throw new Error(`Layer '${this.name}' is already disposed.`)}dispose(){if(!this.built)throw new Error(`Cannot dispose Layer ${this.name} because it has not been built yet.`);if(this._refCount===null)throw new Error(`Cannot dispose Layer ${this.name} because it has not been used yet.`);this.assertNotDisposed();let e=0;return--this._refCount===0&&(e=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:e}}}function $H(t){t=Be(t);const e=[];for(const n of t)e.push(n.shape);return Sn(e)}function TH(t){return"float32"}function rN(t,e,n){if((e==null||n!=null&&n>0)&&(e=t.sourceLayer,n=t.nodeIndex),e.inboundNodes.length===0)return[t];{const s=e.inboundNodes[n];if(s.inboundLayers.length===0)return s.inputTensors;{const r=[];for(let i=0;i<s.inboundLayers.length;i++){const o=s.inputTensors[i],a=s.inboundLayers[i],l=s.nodeIndices[i],c=rN(o,a,l);for(const u of c)r.indexOf(u)===-1&&r.push(u)}return r}}}function EH(t){let e=!0;for(const n of Be(t))if(!(n instanceof Sr)){e=!1;break}return e}function RH(t){let e=!0;for(const n of Be(t))if(n instanceof Sr){e=!1;break}return e}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Vd extends Ee{constructor(e){if(super({dtype:e.dtype,name:e.name!=null?e.name:Gm("input").toString()}),e.batchSize==null&&(e.batchSize=null),e.sparse==null&&(e.sparse=!1),this.trainable=!1,this.built=!0,this.sparse=e.sparse,e.inputShape!=null&&e.batchInputShape!=null)throw new O("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");let n=e.batchInputShape;if(n==null){if(e.inputShape==null)throw new O("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");n=[e.batchSize].concat(e.inputShape)}else if(e.batchSize!=null)throw new O("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");const s=e.dtype||"float32";this.batchInputShape=n,this.dtype=s,this.inputSpec=[{shape:n}];const r=new Sr(this.dtype,this.batchInputShape,this,[],{},this.name);r.nodeIndex=0,r.tensorIndex=0,new Km({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[r],outputTensors:[r],inputMasks:[null],outputMasks:[null],inputShapes:[n],outputShapes:[n]})}apply(e,n){throw new O(`Cannot pass any input to an InputLayer's apply() method. InputLayer name: ${this.name}`)}dispose(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}}getConfig(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}}}Vd.className="InputLayer";te(Vd);function iN(t){if(t.batchShape==null&&t.shape==null)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(t.batchShape!=null&&t.shape!=null)throw new O("Please provide either a `shape` or `batchShape` argument to Input, but not both.");let e=t.batchShape;t.shape!=null&&e==null&&(e=[null].concat(t.shape));let n=t.dtype;return n==null&&(n="float32"),new Vd({batchInputShape:e,name:t.name,dtype:n,sparse:t.sparse}).inboundNodes[0].outputTensors[0]}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function NH(t,e){if(t.dtype==null||t.dtype===e.dtype)return e;try{return de(e,t.dtype)}catch{throw new O(`The dtype of the feed (${e.dtype}) can not be cast to the dtype of the key '${t.name}' (${t.dtype}).`)}}class $i{constructor(e){if(this.id2Value={},this.id2Mask={},this.name2Id={},e instanceof $i)for(const n in e.id2Value)this.id2Value[n]=e.id2Value[n],n in e.id2Mask&&(this.id2Mask[n]=e.id2Mask[n]);else{if(e==null)return;for(const n of e)this.add(n.key,n.value)}}add(e,n,s){if(this.id2Value[e.id]==null)this.id2Value[e.id]=NH(e,n),this.name2Id[e.name]=e.id,s!=null&&(this.id2Mask[e.id]=s);else throw new O(`Duplicate key: name=${e.name}, id=${e.id}`);return this}addFeed(e){this.add(e.key,e.value)}hasKey(e){return this.id2Value[e.id]!=null}names(){return Object.keys(this.name2Id)}getValue(e){if(e instanceof Sr){if(this.id2Value[e.id]==null)throw new O(`Nonexistent key: ${e.name}`);return this.id2Value[e.id]}else{const n=this.name2Id[e];if(n==null)throw new O(`Feed dict has no SymbolicTensor name: ${e}`);return this.id2Value[n]}}getMask(e){if(e instanceof Sr){if(this.id2Value[e.id]==null)throw new O(`Nonexistent key: ${e.name}`);return this.id2Mask[e.id]}else{const n=this.name2Id[e];if(n==null)throw new O(`Feed dict has no SymbolicTensor name: ${e}`);return this.id2Mask[n]}}disposeMasks(){this.id2Mask!=null&&Re(this.id2Mask)}}const Gp=new BR,Hp=new BR;function AH(t){Gp!=null&&Gp.setMaxEntries(t),Hp!=null&&Hp.setMaxEntries(t)}function kc(t,e,n,s){const r=n==null?!1:n.training,i=Array.isArray(t),o=i?t:[t],a=o.map(f=>f.name),l=[],c=e.names();for(const f of a)c.indexOf(f)!==-1?l.push(e.getValue(f)):l.push(null);const u=a.join(",")+"|"+e.names().sort().join(",");let d=Gp.get(u),h;if(d==null){const f=_H(o,e);d=f.sorted,h=f.recipientCounts,Gp.put(u,d),Hp.put(u,h)}h={},r||Object.assign(h,Hp.get(u));const p=new $i(e);for(let f=0;f<d.length;++f){const g=d[f],x=g.sourceLayer;if(x instanceof Vd)continue;const y=[],v=[],b=[];let w=!1;for(const $ of g.inputs){const R=p.getValue($),_=p.getMask($);y.push(R),v.push(_),_!=null&&(w=!0),r||(h[$.name]--,h[$.name]===0&&!e.hasKey($)&&a.indexOf($.name)===-1&&!R.isDisposed&&$.sourceLayer.stateful!==!0&&b.push(R))}w&&(n=n||{},n.mask=v[0]);const k=Be(x.apply(y,n));let S=null;x.supportsMasking&&(S=x.computeMask(y,v));const I=FH(g),C=Array.isArray(I)?I:[I];for(let $=0;$<C.length;++$){p.hasKey(C[$])||p.add(C[$],k[$],Array.isArray(S)?S[0]:S);const R=a.indexOf(C[$].name);R!==-1&&(l[R]=k[$])}r||Re(b)}return p.disposeMasks(),i?l:l[0]}function _H(t,e){T(t!=null&&t.length>0,()=>"Expected at least one fetch, got none");let n=[],s={};if(t.length===1){const r=Wk(t[0],e);n=r.sorted,s=r.recipientMap}else{const r=new Set;for(const i of t){const{sorted:o,recipientMap:a}=Wk(i,e);for(const l of o)r.has(l.name)||(n.push(l),r.add(l.name));for(const l in a)s[l]==null&&(s[l]=new Set),a[l].forEach(c=>s[l].add(c))}}return{sorted:n,recipientCounts:DH(s)}}function DH(t){const e={};for(const n in t)e[n]=t[n].size;return e}function Wk(t,e){const n=new Set,s=[],r={};for(const a of e.names())n.add(a);const i=[],o=[];for(i.push(t);i.length>0;){const a=i[i.length-1];if(n.has(a.name)){i.pop();continue}const l=o[o.length-1]===i.length-1;if(a.inputs.length===0||l)i.pop(),s.push(a),n.add(a.name),l&&o.pop();else{o.push(i.length-1);for(const c of a.inputs)r[c.name]==null&&(r[c.name]=new Set),r[c.name].add(a.name),!n.has(c.name)&&i.push(c)}}return{sorted:s,recipientMap:r}}function FH(t){let e;if(t.sourceLayer.inboundNodes.length===1)e=t.sourceLayer.output;else{let n=null;for(let s=0;s<t.sourceLayer.inboundNodes.length;++s)for(const r of t.sourceLayer.inboundNodes[s].outputTensors)if(r.id===t.id){n=s;break}e=t.sourceLayer.getOutputAt(n)}return e}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OH=q();OH.registerFlag("TOPOLOGICAL_SORT_CACHE_MAX_ENTRIES",()=>100,AH);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Eb(t,e){return K(()=>sn(ge(L(t,t),e,!0)))}class Ud extends Vl{getConfig(){return{}}}class oN extends Ud{constructor(e){super(),this.defaultMaxValue=2,this.defaultAxis=0,this.maxValue=e.maxValue!=null?e.maxValue:this.defaultMaxValue,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return K(()=>{const n=Eb(e,this.axis),s=ss(n,0,this.maxValue);return L(e,ye(s,re(Nt(),n)))})}getConfig(){return{maxValue:this.maxValue,axis:this.axis}}}oN.className="MaxNorm";te(oN);class aN extends Ud{constructor(e){super(),this.defaultAxis=0,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return K(()=>ye(e,re(Nt(),Eb(e,this.axis))))}getConfig(){return{axis:this.axis}}}aN.className="UnitNorm";te(aN);class lN extends Ud{apply(e){return ga(e)}}lN.className="NonNeg";te(lN);class cN extends Ud{constructor(e){super(),this.defaultMinValue=0,this.defaultMaxValue=1,this.defaultRate=1,this.defaultAxis=0,this.minValue=e.minValue!=null?e.minValue:this.defaultMinValue,this.maxValue=e.maxValue!=null?e.maxValue:this.defaultMaxValue,this.rate=e.rate!=null?e.rate:this.defaultRate,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return K(()=>{const n=Eb(e,this.axis),s=re(L(this.rate,ss(n,this.minValue,this.maxValue)),L(1-this.rate,n));return L(e,ye(s,re(Nt(),n)))})}getConfig(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}}}cN.className="MinMaxNorm";te(cN);const Vk={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function _t(t){return yb(t)}function Uk(t,e={}){return zd(t,fs.getMap().classNameMap,e,"constraint")}function Dt(t){if(t==null)return null;if(typeof t=="string"){const n={className:t in Vk?Vk[t]:t,config:{}};return Uk(n)}else return t instanceof Ud?t:Uk(t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */async function go(t){if(t==null)return;const e=[],n=[],s=[];for(const r in t){const i=t[r];if(typeof i!="number"){const o=i;e.push(o.data()),n.push(r),s.push(o)}}if(e.length>0){const r=await Promise.all(e);for(let i=0;i<r.length;++i)t[n[i]]=r[i][0];Re(s)}}function uN(t){if(t!=null)for(const e in t){const n=t[e];typeof n!="number"&&n.dispose()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */var Gk;(function(t){t[t.SILENT=0]="SILENT",t[t.VERBOSE=1]="VERBOSE"})(Gk||(Gk={}));const PH=125;class pu{constructor(){this.validationData=null}setParams(e){this.params=e}async onEpochBegin(e,n){}async onEpochEnd(e,n){}async onBatchBegin(e,n){}async onBatchEnd(e,n){}async onTrainBegin(e){}async onTrainEnd(e){}setModel(e){}}class MH{constructor(e,n=10){e==null&&(e=[]),this.callbacks=e,this.queueLength=n}append(e){this.callbacks.push(e)}setParams(e){for(const n of this.callbacks)n.setParams(e)}setModel(e){for(const n of this.callbacks)n.setModel(e)}async onEpochBegin(e,n){n==null&&(n={});for(const s of this.callbacks)await s.onEpochBegin(e,n)}async onEpochEnd(e,n){n==null&&(n={});for(const s of this.callbacks)await s.onEpochEnd(e,n)}async onBatchBegin(e,n){n==null&&(n={});for(const s of this.callbacks)await s.onBatchBegin(e,n)}async onBatchEnd(e,n){n==null&&(n={});for(const s of this.callbacks)await s.onBatchEnd(e,n)}async onTrainBegin(e){e==null&&(e={});for(const n of this.callbacks)await n.onTrainBegin(e)}async onTrainEnd(e){e==null&&(e={});for(const n of this.callbacks)await n.onTrainEnd(e)}}class LH extends pu{constructor(){super()}async onEpochBegin(e){this.seen=0,this.totals={}}async onBatchEnd(e,n){n==null&&(n={});const s=n.size==null?0:n.size;this.seen+=s;for(const r in n){const i=n[r];if(typeof i=="number")this.totals.hasOwnProperty(r)||(this.totals[r]=0),this.totals[r]=this.totals[r]+i*s;else{let o;r in this.totals?o=this.totals[r]:this.totals[r]=0;const a=K(()=>re(this.totals[r],L(i,s)));this.totals[r]=a,o!=null&&o.dispose()}}}async onEpochEnd(e,n){if(n!=null)for(const s of this.params.metrics)this.totals[s]!=null&&(typeof this.totals[s]=="number"?n[s]=this.totals[s]/this.seen:K(()=>{const r=L(ye(1,this.seen),this.totals[s]);n[s]=r,this.totals[s].dispose(),yr(n[s])}))}}class zH extends pu{async onTrainBegin(e){this.epoch=[],this.history={}}async onEpochEnd(e,n){n==null&&(n={}),this.epoch.push(e);for(const s in n)this.history[s]==null&&(this.history[s]=[]),this.history[s].push(n[s])}async syncData(){const e=[],n=[],s=[];for(const i in this.history){const o=this.history[i];for(let a=0;a<o.length;++a)if(typeof o[a]!="number"){const l=o[a];e.push(l.data()),n.push(i),s.push(a)}}const r=await Promise.all(e);for(let i=0;i<r.length;++i)this.history[n[i]][s[i]].dispose(),this.history[n[i]][s[i]]=r[i][0]}}class jH extends pu{constructor(e,n){if(super(),this.currentEpoch=0,this.nowFunc=e.nowFunc,this.nextFrameFunc=e.nextFrameFunc||fR,this.yieldEvery=n||"auto",this.yieldEvery==="auto"&&(this.yieldEvery=PH),this.yieldEvery==="never"&&e.onYield!=null)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");m0(this.yieldEvery)&&(this.maybeWait=eH(this.maybeWait.bind(this),this.yieldEvery,this.nowFunc)),this.trainBegin=e.onTrainBegin,this.trainEnd=e.onTrainEnd,this.epochBegin=e.onEpochBegin,this.epochEnd=e.onEpochEnd,this.batchBegin=e.onBatchBegin,this.batchEnd=e.onBatchEnd,this.yield=e.onYield}async maybeWait(e,n,s){const r=[];this.yield!=null&&(await go(s),r.push(this.yield(e,n,s))),r.push(this.nextFrameFunc()),await Promise.all(r)}async onEpochBegin(e,n){this.currentEpoch=e,this.epochBegin!=null&&(await go(n),await this.epochBegin(e,n))}async onEpochEnd(e,n){const s=[];this.epochEnd!=null&&(await go(n),s.push(this.epochEnd(e,n))),this.yieldEvery==="epoch"&&s.push(this.nextFrameFunc()),await Promise.all(s)}async onBatchBegin(e,n){this.batchBegin!=null&&(await go(n),await this.batchBegin(e,n))}async onBatchEnd(e,n){const s=[];this.batchEnd!=null&&(await go(n),s.push(this.batchEnd(e,n))),this.yieldEvery==="batch"?s.push(this.nextFrameFunc()):m0(this.yieldEvery)&&s.push(this.maybeWait(this.currentEpoch,e,n)),await Promise.all(s)}async onTrainBegin(e){this.trainBegin!=null&&(await go(e),await this.trainBegin(e))}async onTrainEnd(e){this.trainEnd!=null&&(await go(e),await this.trainEnd(e))}}function dN(t,e){return t==null&&(t={}),t instanceof pu?[t]:Array.isArray(t)&&t[0]instanceof pu?t:Be(t).map(s=>new jH(s,e))}class us{constructor(){}static registerCallbackConstructor(e,n){T(e>=0&&Number.isInteger(e),()=>`Verbosity level is expected to be an integer >= 0, but got ${e}`),us.checkForDuplicate(n),us.constructors[e]==null&&(us.constructors[e]=[]),us.constructors[e].push(n)}static checkForDuplicate(e){for(const n in us.constructors)us.constructors[+n].forEach(r=>{if(r===e)throw new O("Duplicate callback constructor.")})}static clear(){us.constructors={}}static createCallbacks(e){const n=[];for(const s in us.constructors){const r=+s;e>=r&&n.push(...us.constructors[r])}return n.map(s=>new s)}}us.constructors={};function hN(t,e,n,s,r,i,o,a,l){const c=new zH,u=[new LH,...us.createCallbacks(e)];t!=null&&u.push(...t),u.push(c);const d=new MH(u);return d.setParams({epochs:n,initialEpoch:s,samples:r,steps:i,batchSize:o,verbose:e,doValidation:a,metrics:l}),{callbackList:d,history:c}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Br(t,e={},n=!1){return zd(t,fs.getMap().classNameMap,e,"layer",n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Kp(t,e){return K(()=>{t.dtype!=="float32"&&(t=de(t,"float32"));const n=ge(Bd(t),e,!0),s=Mm(n.shape,Nt()),r=sn(ao(n,s));return ye(t,r)})}function qm(t,e){return K(()=>It(Bd(ve(e,t)),-1))}function Rb(t,e){return K(()=>It(hn(ve(e,t)),-1))}function Nb(t,e){return K(()=>{const n=ve(t,e),s=ss(hn(t),Nt(),Number.MAX_VALUE),r=hn(ye(n,s));return L(100,It(r,-1))})}function BH(t,e){return K(()=>{const n=ss(e,Nt(),Number.MAX_VALUE),s=Cr(re(1,n)),r=ss(t,Nt(),Number.MAX_VALUE),i=Cr(re(1,r));return It(Bd(ve(s,i)),-1)})}function WH(t,e){return K(()=>{const n=ao(0,ve(1,L(t,e)));return It(Bd(n),-1)})}function VH(t,e){return K(()=>{const n=ao(0,ve(1,L(t,e)));return It(n,-1)})}function UH(t,e){return K(()=>{const n=ge(L(t,e),-1),s=qs(L(ve(1,t),e),-1);return ao(0,re(1,ve(s,n)))})}function GH(t,e){return K(()=>{const n=Math.log(2),s=ve(e,t),r=ve(re(s,_d(L(-2,s))),n);return It(r,-1)})}function fu(t,e,n=!1){return K(()=>{if(n)e=Dv(e);else{const s=ge(e,e.shape.length-1,!0);e=ye(e,s)}return e=ss(e,Nt(),1-Nt()),vt(ge(L(de(t,"float32"),Cr(e)),e.shape.length-1))})}function qp(t,e,n=!1){return K(()=>{const s=de(jm(hH(t)),"int32");e=ss(e,Nt(),1-Nt());const r=e.shape,i=U(PE(s,r[r.length-1]),r);return fu(i,e,n)})}function HH(t,e){if(!je(t.shape,e.shape))throw new O(`logits and labels must have the same shape, but got shapes ${JSON.stringify(t.shape)} and ${JSON.stringify(e.shape)}`);return K(()=>{const n=ga(e),s=vt(hn(e));return re(ve(n,L(e,t)),_E(kr(s)))})}function Xm(t,e){return K(()=>{let n;return n=ss(e,Nt(),1-Nt()),n=Cr(ye(n,ve(1,n))),It(HH(t,n),-1)})}function KH(t,e){return K(()=>{const n=ss(t,Nt(),1),s=ss(e,Nt(),1);return ge(L(t,Cr(ye(n,s))),-1)})}function qH(t,e){return K(()=>{const n=Cr(re(Nt(),e));return It(ve(e,L(t,n)),-1)})}function pN(t,e){return K(()=>{const n=Kp(t,-1),s=Kp(e,-1),r=L(n,s);return vt(ge(r,-1))})}const Xp={meanSquaredError:qm,meanAbsoluteError:Rb,meanAbsolutePercentageError:Nb,meanSquaredLogarithmicError:BH,squaredHinge:WH,hinge:VH,categoricalHinge:UH,logcosh:GH,categoricalCrossentropy:fu,sparseCategoricalCrossentropy:qp,binaryCrossentropy:Xm,kullbackLeiblerDivergence:KH,poisson:qH,cosineProximity:pN};function Jg(t){if(typeof t=="string"){if(t in Xp)return Xp[t];let e=`Unknown loss ${t}`;throw t.toLowerCase().includes("softmaxcrossentropy")&&(e=`Unknown loss ${t}. Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy`),new O(e)}else return t}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function fN(t,e){return K(()=>{const n=L(.5,$s(e)),s=vr(os(e,n),t.dtype);return It(wr(t,s),-1)})}function mN(t,e){return K(()=>vr(wr(lu(t,-1),lu(e,-1)),"float32"))}function XH(t,e){return K(()=>de(ge(Xr(wr(t,1),wr(e,1))),"float32"))}function YH(t,e){return K(()=>de(ge(Xr(wr(t,0),wr(e,1))),"float32"))}function QH(t,e){return K(()=>{const n=XH(t,e),s=YH(t,e),r=re(n,s);return de(yn(os(r,0),ye(n,r),0),"float32")})}function JH(t,e){return Xm(t,e)}function ZH(t,e){return t.rank===e.rank&&(t=Fd(t,[t.rank-1])),e=lu(e,-1),e.dtype!==t.dtype&&(e=de(e,t.dtype)),de(wr(t,e),"float32")}const e7=qm,t7=qm,n7=Rb,s7=Rb,r7=Nb,i7=Nb,gN=fu,o7=pN,yN=qp,Yp={binaryAccuracy:fN,categoricalAccuracy:mN,precision:QH,categoricalCrossentropy:gN,sparseCategoricalCrossentropy:yN,mse:e7,MSE:t7,mae:n7,MAE:s7,mape:r7,MAPE:i7,cosine:o7};function a7(t){if(typeof t=="string"&&t in Yp)return Yp[t];if(typeof t!="string"&&t!=null)return t;throw new O(`Unknown metric ${t}`)}function Sh(t){if(lr(t!==null,`Unknown LossOrMetricFn ${t}`),typeof t=="string")return t;{let e;for(const n of Object.keys(Xp))if(Xp[n]===t){e=n;break}if(e!==void 0)return e;for(const n of Object.keys(Yp))if(Yp[n]===t){e=n;break}return e!==void 0?e:t.name}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function l7(t){const e={Adagrad:()=>ps.adagrad(.01),Adadelta:()=>ps.adadelta(1,.95,Nt()),Adam:()=>ps.adam(.001,.9,.999,Nt()),Adamax:()=>ps.adamax(.002,.9,.999,Nt(),0),RMSProp:()=>ps.rmsprop(.001,.9,0,Nt()),SGD:()=>ps.sgd(.01)};if(e.adagrad=e.Adagrad,e.adadelta=e.Adadelta,e.adam=e.Adam,e.adamax=e.Adamax,e.rmsprop=e.RMSProp,e.sgd=e.SGD,t in e)return e[t]();throw new O(`Unknown Optimizer ${t}`)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const Hk=1*1024*1024;function Kk(t,e,n=!1){if(t==null||typeof t!="object"||Object.getPrototypeOf(t)!==Object.prototype||!V0(t))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(n){const s=JSON.stringify(t);s.length>Hk&&console.warn(`User-defined metadata of model "${e}" is too large in size (length=${s.length} when serialized). It is not recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= ${Hk}.`)}}function V0(t){if(t===null)return!0;if(typeof t=="object")if(Object.getPrototypeOf(t)===Object.prototype){const e=Object.keys(t);for(const n of e)if(typeof n!="string"||!V0(t[n]))return!1;return!0}else if(Array.isArray(t)){for(const e of t)if(!V0(e))return!1;return!0}else return!1;else{const e=typeof t;return e==="string"||e==="number"||e==="boolean"}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function c7(t,e,n,s=console.log){const r=d7(t),i=["Layer (type)","Input Shape","Output shape","Param #"];r?(e=e||90,n=n||[.32,.61,.89,1]):(e=e||115,n=n||[.24,.48,.7,.8,1]),n[n.length-1]<=1&&(n=n.map(u=>Math.floor(e*u)));let o;if(!r){i.push("Receives inputs"),o=[];for(const u in t.nodesByDepth)o.push(...t.nodesByDepth[u])}s("_".repeat(e)),Qp(i,n,s),s("=".repeat(e));const a=t.layers;for(let u=0;u<a.length;++u)r?h7(a[u],n,s):p7(a[u],n,o,s),s((u===a.length-1?"=":"_").repeat(e));t.checkTrainableWeightsConsistency();const l=u7(t),c=Up(t.nonTrainableWeights);s(`Total params: ${l+c}`),s(`Trainable params: ${l}`),s(`Non-trainable params: ${c}`),s("_".repeat(e))}function u7(t){let e;return t.collectedTrainableWeights!=null?e=Up(t.collectedTrainableWeights):e=Up(t.trainableWeights),e}function d7(t){let e=!0;const n=[],s=[];for(const r in t.nodesByDepth)n.push(t.nodesByDepth[r]);for(const r of n){if(r.length>1||r.length===1&&r[0].inboundLayers.length>1){e=!1;break}s.push(...r)}if(e)for(const r of t.layers){let i=!1;for(const o of r.inboundNodes)if(s.indexOf(o)!==-1)if(i){e=!1;break}else i=!0;if(!e)break}return e}function Qp(t,e,n=console.log){let s="";for(let r=0;r<t.length;++r)r>0&&(s=s.slice(0,s.length-1)+" "),s+=t[r],s=s.slice(0,e[r]),s+=" ".repeat(e[r]-s.length);n(s)}function h7(t,e,n){let s,r;try{r=t.inboundNodes.map(l=>JSON.stringify(l.inputShapes)).join(",")}catch{r="multiple"}try{s=JSON.stringify(t.outputShape)}catch{s="multiple"}const i=t.name,o=t.getClassName(),a=[`${i} (${o})`,r,s,t.countParams().toString()];Qp(a,e,n)}function p7(t,e,n,s){let r,i;try{i=t.inboundNodes.map(d=>JSON.stringify(d.inputShapes)).join(",")}catch{i="multiple"}try{r=JSON.stringify(t.outputShape)}catch{r="multiple"}const o=[];for(const d of t.inboundNodes)if(!(n!=null&&n.length>0&&n.indexOf(d)===-1))for(let h=0;h<d.inboundLayers.length;++h){const p=d.inboundLayers[h].name,f=d.nodeIndices[h],g=d.tensorIndices[h];o.push(`${p}[${f}][${g}]`)}const a=t.name,l=t.getClassName(),c=o.length===0?"":o[0],u=[`${a} (${l})`,i,r,t.countParams().toString(),c];Qp(u,e,s);for(let d=1;d<o.length;++d)Qp(["","","","",o[d]],e,s)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function xN(t,e,n){return(t==="inboundNodes"||t==="outputLayers"||t==="inputLayers")&&e===0&&typeof n=="string"}function U0(t,e){if(t===null)return null;if(typeof t=="string")return Co(t);if(typeof t=="number"||typeof t=="boolean")return t;if(t instanceof Array){const n=[],s=t.length;for(let r=0;r<s;++r){const i=t[r];xN(e,r,i)?n.push(i):n.push(U0(i,e))}return n}else{const n={};for(const s of Object.keys(t)){const r=t[s];if(s==="name"&&typeof r=="string")n[s]=r;else{const i=Co(s);n[i]=U0(r,i)}}return n}}function G0(t,e){if(t==null)return null;if(typeof t=="string")return _r(t);if(typeof t=="number"||typeof t=="boolean")return t;if(t instanceof Array){const n=[],s=t.length;for(let r=0;r<s;++r){const i=t[r];xN(e,r,i)?n.push(i):n.push(G0(i,e))}return n}else{const n={};for(const s of Object.keys(t)){const r=t[s],i=_r(s);(s==="name"||s==="className")&&typeof r=="string"?n[i]=r:n[i]=G0(r,s)}return n}}/** @license See the LICENSE file. */const vN="4.22.0";/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const f7=t=>{const e=Object.keys(t);if(e.length===0)return!1;const n=e[0].split("/");return!isNaN(parseInt(n[n.length-1],10))};class Os extends Ee{constructor(e){if(super({}),this.containerNodes=new Set,this.name=e.name,this.name==null){const v=this.getClassName().toLowerCase();this.name=Gm(v)}if(this.supportsMasking=!1,this.trainable_=!0,Array.isArray(e.inputs)?this.inputs=e.inputs.slice():this.inputs=[e.inputs],Array.isArray(e.outputs)?this.outputs=e.outputs.slice():this.outputs=[e.outputs],Bi(this.inputs).length!==this.inputs.length)throw new O(`The list of inputs passed to the model is redundant. All inputs should only appear once. Found: ${this.inputs.map(v=>v.name)}`);Bi(this.outputs).length!==this.outputs.length&&console.warn(`The list of outputs passed to the model is redundant. All outputs should only appear once. Found: ${this.outputs.map(v=>v.name)}`),this.inputLayers=[],this.inputLayersNodeIndices=[],this.inputLayersTensorIndices=[],this.outputLayers=[],this.outputLayersNodeIndices=[],this.outputLayersTensorIndices=[],this.layers=[],this.internalContainerRefs=[];for(const v of this.outputs){const b=v.sourceLayer,w=v.nodeIndex,k=v.tensorIndex;this.outputLayers.push(b),this.outputLayersNodeIndices.push(w),this.outputLayersTensorIndices.push(k)}for(const v of this.inputs){const b=v.sourceLayer,w=v.nodeIndex,k=v.tensorIndex;lr(w===0,"input layer has >1 nodes"),lr(k===0,"input layer has >1 tensors"),this.inputLayers.push(b),this.inputLayersNodeIndices.push(w),this.inputLayersTensorIndices.push(k)}this.inputNames=[],this.outputNames=[],this.feedInputShapes=[],this.feedInputNames=[],this.feedOutputNames=[];for(let v=0;v<this.inputLayers.length;v++){const b=this.inputLayers[v];if(!(b instanceof Vd))throw new TypeError(`Input layers to a LayersModel must be InputLayer objects. Received inputs: ${e.inputs}. Input ${v} (0-based) originates from layer type ${b.getClassName()}.`);this.inputNames.push(b.name),this.feedInputShapes.push(b.batchInputShape),this.feedInputNames.push(b.name)}for(const v of this.outputLayers)this.outputNames.push(v.name);this.internalInputShapes=this.inputs.map(v=>v.shape),this.internalOutputShapes=this.outputs.map(v=>v.shape);const n={},s={},r={},i={},o={},a=[],l=(v,b,w,k,S,I)=>{(k==null||S==null||I==null)&&(k=v.sourceLayer,S=v.nodeIndex,I=v.tensorIndex);const C=k.inboundNodes[S];if(w.indexOf(C)!==-1)throw new vs(`The tensor ${v.name} at layer "${k.name}" is part of a cycle.`);if(b.indexOf(C)!==-1)return;this.containerNodes.add(Os.nodeKey(k,S)),k.id in o||(o[k.id]=Object.keys(o).length),w.indexOf(C)===-1&&w.push(C);const $=C.inboundLayers.length;for(let R=0;R<$;R++){const _=C.inputTensors[R],M=C.inboundLayers[R],B=C.nodeIndices[R],A=C.tensorIndices[R];l(_,b,w,M,B,A)}for(b.push(C);w.indexOf(C)>=0;)w.splice(w.indexOf(C),1);a.push(C)},c=[],u=[];for(const v of this.outputs)l(v,c,u);const d=a.slice().reverse();for(const v of d){s[v.id]=v,v.id in n||(n[v.id]=0);let b=n[v.id];const w=r[v.outboundLayer.id]==null?0:r[v.outboundLayer.id];b=Math.max(b,w),r[v.outboundLayer.id]=b,i[v.outboundLayer.id]=v.outboundLayer,n[v.id]=b;for(let k=0;k<v.inboundLayers.length;k++){const S=v.inboundLayers[k],I=v.nodeIndices[k],C=S.inboundNodes[I],$=n[C.id]==null?0:n[C.id];n[C.id]=Math.max(b+1,$),s[C.id]=C}}const h={};for(const v in n){const b=n[v];b in h||(h[b]=[]),h[b].push(s[v])}const p={};for(const v in r){const b=r[v];b in p||(p[b]=[]),p[b].push(i[v])}let f=Object.keys(p).map(v=>parseInt(v,10)).sort(wh);this.layers=[];for(const v of f){const b=p[v];b.sort((w,k)=>{const S=o[w.id],I=o[k.id];return S<I?-1:S>I?1:0});for(const w of b)w instanceof Os&&this.internalContainerRefs.push(w),this.layers.push(w)}this.layersByDepth=p,f=Object.keys(h).map(v=>parseInt(v,10)).sort(wh);const g=this.inputs.slice(),x=[];for(const v of f)for(const b of h[v]){const w=b.outboundLayer;if(w!=null){for(const k of b.inputTensors)if(g.indexOf(k)===-1)throw new vs(`Graph disconnected: cannot obtain value for tensor ${k} at layer "${w.name}". The following previous layers were accessed without issue: ${x}`);for(const k of b.outputTensors)g.push(k);x.push(w.name)}}this.nodesByDepth=h;const y=this.layers.map(v=>v.name);for(const v of y){const b=y.filter(w=>w===v).length;if(b!==1)throw new vs(`The name "${v}" is used ${b} times in the model. All layer names should be unique. Layer names: `+JSON.stringify(y))}this.outboundNodes=[],this.inboundNodes=[],new Km({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:this.inputs.map(v=>null),outputMasks:this.outputs.map(v=>null),inputShapes:this.inputs.map(v=>v.shape),outputShapes:this.outputs.map(v=>v.shape)}),this.built=!0,this._refCount=1}assertNotDisposed(){if(this._refCount===0)throw new Error(`Container '${this.name}' is already disposed.`)}dispose(){this.assertNotDisposed();const e={refCountAfterDispose:null,numDisposedVariables:0};if(--this._refCount===0){for(const n of this.layers)e.numDisposedVariables+=n.dispose().numDisposedVariables;for(const n of this.internalContainerRefs)e.numDisposedVariables+=n.dispose().numDisposedVariables}return e.refCountAfterDispose=this._refCount,e}get trainable(){return this.trainable_}set trainable(e){this.layers.forEach(n=>{n._trainableWeights.forEach(s=>s.trainable=e)}),this.trainable_=e}get trainableWeights(){if(this._trainableWeights.length>0)throw new O("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];let e=[];for(const n of this.layers)e=e.concat(n.trainableWeights);return e}get nonTrainableWeights(){const e=[];for(const n of this.layers)e.push(...n.nonTrainableWeights);if(!this.trainable){const n=[];for(const s of this.layers)n.push(...s.trainableWeights);return n.concat(e)}return e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}loadWeights(e,n=!0){const s={};let r=0;const i=f7(e);i&&this.parseWeights(e);for(const a of this.layers)for(const[l,c]of a.weights.entries()){const u=i?`${c.name.split("/").slice(0,-1).join("/")+"/"}${l}`:c.originalName;if(s[u]!=null)throw new O(`Duplicate weight name: ${u}`);s[u]=c,r++}const o=[];for(const a in e){let l=a;if(s[a]==null){const c=a.split("/");l=c.slice(0,-2).concat([c[c.length-1]]).join("/")}if(s[l]!=null)o.push([s[l],e[a]]);else if(n)throw new O(`Provided weight data has no target variable: ${a}`);delete s[l]}if(n){const a=[];for(const l in s)a.push(l);if(a.length>0)throw new O(`${a.length} of ${r} weights are not set: ${a}`)}Tb(o)}parseWeights(e){for(const n in Object.keys(e)){const s=n.split("/"),r=["vars","layer_checkpoint_dependencies"],i=s.map(o=>o.startsWith("_")?o.slice(1):o).filter(o=>!r.includes(o)).join("/");i!==n&&(e[i]=e[n],delete e[n])}}updatedConfig(){const e=this.getConfig(),n={};return n.className=this.getClassName(),n.config=e,n.kerasVersion=`tfjs-layers ${vN}`,n.backend="TensorFlow.js",n}toJSON(e,n=!0){const s=G0(this.updatedConfig());return n?JSON.stringify(s):s}call(e,n){return K(()=>{e=Be(e);const s=new $i;for(let r=0;r<this.inputs.length;++r)s.add(this.inputs[r],e[r]);return kc(this.outputs,s,n)})}computeMask(e,n){return K(()=>{e=Be(e);let s;return n==null?s=na(null,e.length):s=Be(n),this.runInternalGraph(e,s)[1]})}computeOutputShape(e){const n=Vp(e);if(n.length!==this.inputLayers.length)throw new O(`Invalid inputShape argument ${e}: model has ${this.inputLayers.length} tensor inputs.`);const s={};for(let a=0;a<n.length;a++){const l=this.inputLayers[a],c=n[a],u=l.name+"_0_0";s[u]=c}const r=Object.keys(this.nodesByDepth).map(a=>parseInt(a,10)).sort(wh);if(r.length>1)for(const a of r){const l=this.nodesByDepth[a];for(const c of l){const u=c.outboundLayer;if(this.inputLayers.map(g=>g.id).indexOf(u.id)!==-1)continue;const d=[];for(let g=0;g<c.inboundLayers.length;g++){const x=c.inboundLayers[g],y=c.nodeIndices[g],v=c.tensorIndices[g],b=`${x.name}_${y}_${v}`,w=s[b];d.push(w)}const h=u.computeOutputShape(Sn(d)),p=Vp(h),f=u.inboundNodes.indexOf(c);for(let g=0;g<p.length;g++){const x=`${u.name}_${f}_${g}`;s[x]=p[g]}}}const i=[],o=[];for(let a=0;a<this.outputLayers.length;a++){const l=this.outputLayers[a],c=this.outputLayersNodeIndices[a],u=this.outputLayersTensorIndices[a],d=`${l.name}_${c}_${u}`;o.push(d)}for(let a=0;a<o.length;a++){const l=o[a];lr(l in s),i.push(s[l])}return Sn(i)}runInternalGraph(e,n){n==null&&(n=na(null,e.length));const s={};for(let l=0;l<this.inputs.length;++l){const c=this.inputs[l],u=e[l],d=n[l];s[c.id]=[u,d]}const r=Object.keys(this.nodesByDepth).map(l=>parseInt(l,10)).sort(wh);for(const l of r){const c=this.nodesByDepth[l];for(const u of c){const d=u.outboundLayer,h=u.inputTensors,p=u.outputTensors,f=new Array;for(const g of h)g.id in s&&f.push(s[g.id]);if(f.length===h.length){let g={},x,y,v,b;if(u.callArgs!=null&&(g=u.callArgs),f.length===1){const[w,k]=f[0];g.mask==null&&(g.mask=k),v=Be(d.call(w,g)),b=Be(d.computeMask(w,k)),x=[w],y=[k]}else x=f.map(w=>w[0]),y=f.map(w=>w[1]),g.mask==null&&(g.mask=y),v=Be(d.call(x,g)),b=Be(d.computeMask(x,y));if(d.activityRegularizer)throw new Ie("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(let w=0;w<p.length;++w){const k=p[w],S=v[w],I=b[w];s[k.id]=[S,I]}}}}const i=[],o=[],a=[];for(const l of this.outputs){lr(l.id in s,`Could not compute output ${l.name} : ${l.id}`);const[c,u]=s[l.id];a.push(c.shape),i.push(c),o.push(u)}return[i,o,a]}buildNodeConversionMap(e){const n={};let s;for(const r of this.layers){s=r instanceof Os?1:0;for(let i=0;i<r.inboundNodes.length;i++){const o=Os.nodeKey(r,i);this.containerNodes.has(o)&&(n[o]=s,s+=1)}}return n}getLayer(e,n){if(n!=null)return this.findLayer(n);if(e==null)throw new O("Provide either a layer name or layer index");if(typeof e=="number")return this.findLayer(e);for(const s of this.layers)if(s.name===e)return s;throw new O(`No such layer: ${e}`)}findLayer(e){if(this.layers.length<=e)throw new O(`Was asked to retrieve layer at index ${e}, but model only has ${this.layers.length} layer(s).`);return this.layers[e]}calculateLosses(){return K(()=>{const e=[];for(const n of this.layers)for(let s=0;s<n.inboundNodes.length;++s){const r=Os.nodeKey(n,s);this.containerNodes.has(r)&&e.push(...n.calculateLosses())}return e})}getConfig(){const e={name:this.name},n=this.buildNodeConversionMap(this.layers),s=[];for(const o of this.layers){const a=o.getClassName(),l=o.getConfig(),c=[];for(let d=0;d<o.inboundNodes.length;d++){const h=o.inboundNodes[d],p=Os.nodeKey(o,d);let f={};if(this.containerNodes.has(p)){if(h.callArgs)try{JSON.stringify(h.callArgs),f=h.callArgs}catch{console.warn(`Layer ${o.name} was passed non-serializable keyword arguments: ${h.callArgs}. They will not be included in the serialized model (and thus will be missing at deserialization time).`),f={}}if(h.inboundLayers.length>0){const g=[];for(let x=0;x<h.inboundLayers.length;x++){const y=h.inboundLayers[x],v=h.nodeIndices[x],b=h.tensorIndices[x],w=Os.nodeKey(y,v);let k=n[w];k==null&&(k=0),g.push([y.name,k,b,f])}c.push(g)}}}const u={};u.name=o.name,u.className=a,u.config=l,u.inboundNodes=c,s.push(u)}e.layers=s;const r=[];for(let o=0;o<this.inputLayers.length;o++){const a=this.inputLayers[o],l=this.inputLayersNodeIndices[o],c=Os.nodeKey(a,l);if(!this.containerNodes.has(c))continue;let u=n[c];u==null&&(u=0);const d=this.inputLayersTensorIndices[o];r.push([a.name,u,d])}e.inputLayers=r;const i=[];for(let o=0;o<this.outputLayers.length;o++){const a=this.outputLayers[o],l=this.outputLayersNodeIndices[o],c=Os.nodeKey(a,l);if(!this.containerNodes.has(c))continue;let u=n[c];u==null&&(u=0);const d=this.outputLayersTensorIndices[o];i.push([a.name,u,d])}return e.outputLayers=i,e}static fromConfig(e,n,s={},r=!1){const i={},o={};function a(x,y){x.name in o?o[x.name].push(y):o[x.name]=[y]}function l(x,y){const v=[];let b;for(const w of y){const k=w[0],S=w[1],I=w[2];if(b=w[3]==null?{}:w[3],!(k in i)){a(x,y);return}const C=i[k];if(C.inboundNodes.length<=S){a(x,y);return}const $=C.inboundNodes[S];v.push($.outputTensors[I])}v.length>0&&x.apply(Sn(v),b)}function c(x){const y=x.name,v=Br(x,n.customObjects!=null?n.customObjects:{});v.setFastWeightInitDuringBuild(r),i[y]=v,x.inboundNodes.forEach(w=>{if(!(w instanceof Array))throw new O(`Corrupted configuration, expected array for nodeData: ${w}`);a(v,w)})}const u=n.name,d=n.layers;for(const x of d)c(x);for(;!ZG(o);)for(const x of d){const y=i[x.name];if(y.name in o){const v=o[y.name];delete o[y.name];for(const b of v)l(y,b)}}const h=[],p=[],f=n.inputLayers;for(const x of f){const y=x[0],v=x[1],b=x[2];lr(y in i);const k=i[y].inboundNodes[v].outputTensors;h.push(k[b])}const g=n.outputLayers;for(const x of g){const y=x[0],v=x[1],b=x[2];lr(y in i);const k=i[y].inboundNodes[v].outputTensors;p.push(k[b])}return new e({inputs:h,outputs:p,name:u})}get stateful(){if(this._stateful)throw new O("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");for(const e of this.layers)if(e.stateful)return!0;return!1}resetStates(){K(()=>{this.layers.forEach(e=>{e.stateful&&e.resetStates()})})}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function m7(t,e,n){const s=e.length;if(t==null||Array.isArray(t)&&t.length===0)return e.map(r=>null);if(s===1)return Array.isArray(t)&&t.length===1?t:typeof t=="object"&&e[0]in t?[t[e[0]]]:[t];if(Array.isArray(t)){if(t.length!==s)throw new Error(`Provided ${n} is an array of ${t.length} element(s), but the model has ${s} outputs. Make sure a set of weights is provided for each model output.`);return t}else if(typeof t=="object"&&Object.keys(t).length>0&&typeof t[Object.keys(t)[0]]=="object"){const r=[];return e.forEach(i=>{i in t?r.push(t[i]):r.push(null)}),r}else throw new Error(`The model has multiple (${s}) outputs, so ${n} must be either an array with ${s} elements or an object with ${e} keys. Provided ${n} not understood: ${JSON.stringify(t)}`)}function bN(t,e){return m7(t,e,"classWeight")}async function wN(t,e,n,s){if(n!=null){const r=K(()=>{if(t.shape.length===1)return Fo(t);if(t.shape.length===2){if(t.shape[1]>1)return lu(t,1);if(t.shape[1]===1)return U(t,[t.shape[0]]);throw new Error(`Encountered unexpected last-dimension size (${t.shape[1]}) during handling of class weights. The size is expected to be >= 1.`)}else throw new Error(`Unexpected rank of target (y) tensor (${t.rank}) during handling of class weights. The rank is expected to be 1 or 2.`)}),i=Array.from(await r.data());Re(r);const o=[];return i.forEach(a=>{if(n[a]==null)throw new Error(`classWeight must contain all classes in the training data. The class ${a} exists in the data but not in classWeight`);o.push(n[a])}),Ln(o,"float32")}else return null}function g7(t,e){return L(t,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const y7=32;function kN(t,e){let n,s;const r=e;n=r.xs,s=r.ys,T(n!=null&&s!=null,()=>`A Dataset iterator for fitDataset() is expected to generate objects of the form \`{xs: xVal, ys: yVal}\`, where the two values may be \`tf.Tensor\`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates ${e}`);const i=qk("input",t.inputNames,n),o=qk("output",t.outputNames,s),a=i[0].shape[0];T(i.length===t.inputs.length,()=>`LayersModel has ${t.inputs.length} inputs, but the dataset provides ${i.length} inputs.  (Expected input keys: ${JSON.stringify(t.inputNames)})`),T(o.length===t.outputs.length,()=>`LayersModel has ${t.outputs.length} outputs, but the dataset provides ${o.length} outputs.  (Expected output keys: ${JSON.stringify(t.outputNames)})`);for(let l=0;l<i.length;l++)T(i[l].shape[0]===a,()=>`Batch size mismatch: input ${t.inputNames[l]} has ${i[l].shape[0]}; expected  ${a} based on input ${t.inputNames[0]}.`);for(let l=0;l<o.length;l++)T(o[l].shape[0]===a,()=>`Batch size mismatch: output ${t.outputNames[l]} has ${o[l].shape[0]}; expected  ${a} based on input ${t.inputNames[0]}.`);return{xs:i,ys:o}}function qk(t,e,n){if(n instanceof Et)return[n];if(Array.isArray(n))return T(n.length===e.length,()=>`Received an array of ${n.length} Tensors, but expected ${e.length} to match the ${t} keys ${e}.`),n;{const s=[];for(const r of e){if(n[r]==null)throw new O(`The feature data generated by the dataset lacks the required ${t} key '${r}'.`);s.push(n[r])}return s}}function x7(t){if(t.length===3)throw new Ie("Validation with sample weights is not implemented yet.");return{xs:t[0],ys:t[1]}}async function v7(t,e,n){const s=n.batchesPerEpoch!=null;if(T(t.optimizer!=null,()=>"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig)."),T(n!=null,()=>"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."),T(n.epochs!=null&&n.epochs>0&&Number.isInteger(n.epochs),()=>`For fitDataset(), config.epochs is expected to be a positive integer, but got ${n.epochs}`),T(!s||n.batchesPerEpoch>0&&Number.isInteger(n.batchesPerEpoch),()=>`For fitDataset(), config.batchesPerEpoch is expected to be a positive integer if specified, but got ${n.batchesPerEpoch}`),T(n.validationSplit==null,()=>"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."),t.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");t.isTraining=!0;try{const r=n.validationData!=null;let i,o;if(r)if(Xk(n.validationData))T(n.validationBatches==null||n.validationBatches>0&&Number.isInteger(n.validationBatches),()=>`For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, but got ${n.validationBatches}`);else{const x=x7(n.validationData);i=x.xs,o=x.ys}const a=t.makeTrainFunction(),l=t.getDedupedMetricsNames();let c;r?c=l.slice().concat(l.map(x=>"val_"+x)):c=l.slice();const u=dN(n.callbacks,n.yieldEvery),d=n.verbose==null?1:n.verbose,{callbackList:h,history:p}=hN(u,d,n.epochs,null,null,b7(e,n),null,r,c);h.setModel(t),t.history=p,await h.onTrainBegin(),t.stopTraining_=!1;let f=n.initialEpoch==null?0:n.initialEpoch,g=await e.iterator();for(;f<n.epochs;){const x={};await h.onEpochBegin(f);let y=0,v=0;for(s||(g=await e.iterator());!s||y<n.batchesPerEpoch;){const b=await g.next();if(s&&b.done){console.warn(`You provided \`batchesPerEpoch\` as ${n.batchesPerEpoch}, but your dataset iterator ran out of data after ${y} batches; interrupting training. Make sure that your dataset can generate at least \`batchesPerEpoch * epochs\` batches (in this case, ${n.batchesPerEpoch*n.epochs} batches). You may need to use the repeat() function when building your dataset.`);break}if(b.value!=null){const{xs:w,ys:k}=kN(t,b.value),S={};S.batch=v,S.size=w[0].shape[0],await h.onBatchBegin(v,S);const I=[];if(n.classWeight!=null){const R=bN(n.classWeight,t.outputNames);for(let _=0;_<R.length;++_)I.push(await wN(k[_],null,R[_]))}const C=w.concat(k).concat(I),$=a(C);Re(C);for(let R=0;R<l.length;++R){const _=l[R],M=$[R];S[_]=M,yr(M)}await h.onBatchEnd(v,S),uN(S),v++,y++}if(s?y>=n.batchesPerEpoch:b.done){if(r){let w;Xk(n.validationData)?w=Be(await t.evaluateDataset(n.validationData,{batches:n.validationBatches})):w=Be(t.evaluate(i,o,{batchSize:n.validationBatchSize==null?y7:n.validationBatchSize,verbose:0}));for(let k=0;k<t.metricsNames.length;++k)x[`val_${t.metricsNames[k]}`]=w[k]}break}if(t.stopTraining_)break}if(await h.onEpochEnd(f,x),f++,t.stopTraining_)break}return await h.onTrainEnd(),await t.history.syncData(),t.history}finally{t.isTraining=!1}}function b7(t,e){let n=null;return e.batchesPerEpoch!=null?n=e.batchesPerEpoch:Number.isFinite(t.size)&&(n=t.size),n}function Xk(t){return typeof t.iterator=="function"}function w7(t){return typeof t.next=="function"}async function k7(t,e,n){n=n||{};const s=n.batches!=null,r=t.testFunction;let i=[];if(n.verbose>0)throw new Ie("Verbose mode is not implemented yet.");T(!s||n.batches>0&&Number.isInteger(n.batches),()=>`Test loop expects \`batches\` to be a positive integer, but received ${JSON.stringify(n.batches)}`);const o=w7(e)?e:await e.iterator();let a=0,l=0;for(;!s||l<n.batches;){const c=await o.next();if(i=K(()=>{if(c.value){const{xs:u,ys:d}=kN(t,c.value),h=u.concat(d),p=K(()=>r(h));if(Re(h),l===0)for(let g=0;g<p.length;++g)i.push(ze(0));const f=h[0].shape[0];for(let g=0;g<p.length;++g){const x=p[g],y=i[g];i[g]=K(()=>re(i[g],L(f,x))),l>0&&Re(y)}Re(p),a+=f,++l}return i}),c.done){s&&console.warn(`Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least \`batches\` batches (in this case, ${n.batches} batches). You may need to use the repeat() function when building your dataset.`);break}}for(let c=0;c<i.length;++c){const u=i[c];i[c]=ye(i[c],a),Re(u)}return Sn(i)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Zg(t){T(t>0&&Number.isInteger(t),()=>`batchSize is required to be a positive integer, but got ${t}`)}function hc(t,e,n){return t==null?[null]:Array.isArray(t)?t.map(s=>Mo(s,e,n-e)):Mo(t,e,n-e)}function H0(t,e){return K(()=>t==null?null:Array.isArray(t)?t.map(n=>H0(n,e)):XR(t,e.dtype==="int32"?e:de(e,"int32")))}function ey(t,e){const n=[];let s=0,r=null;for(;s<t;)r=s+e,r>=t&&(r=t),n.push([s,r]),s=r;return n}function CN(t){const e=[];t instanceof Et&&(t=[t]);for(let n=0;n<t.length;++n){const s=t[n];if(s.rank===1)e.push(jd(s,1));else{if(s.rank===0)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");e.push(s)}}return e}function _s(t,e){if(t==null)return;const n=[];if(e instanceof Et)n.push(e.id);else if(Array.isArray(e))e.forEach(r=>n.push(r.id));else if(e!=null)for(const r in e){const i=e[r];n.push(i.id)}const s=[];if(t instanceof Et)n.indexOf(t.id)===-1&&s.push(t);else if(Array.isArray(t))t.forEach(r=>{n.indexOf(r.id)===-1&&s.push(r)});else if(t!=null)for(const r in t){const i=t[r];n.indexOf(i.id)===-1&&s.push(i)}s.forEach(r=>{r.isDisposed||r.dispose()})}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function C7(t){return t instanceof Et}function K0(t){return Array.isArray(t)}function Yk(t){return!C7(t)&&!K0(t)}function Qk(t,e,n,s=!0,r=""){if(e==null||e.length===0){if(t!=null){let o=!1;if(K0(t)&&t.length>0)o=!0;else if(Yk(t)){for(const a in t)if(t.hasOwnProperty(a)){o=!0;break}}else o=!0;if(o)throw new O(`Error when checking model ${r} expected no data, but got ${t}`)}return[]}if(t==null)return e.map(o=>null);let i;if(Yk(t)){t=t,i=[];for(const o of e){if(t[o]==null)throw new O(`No data provided for "${o}". Need data for each key in: ${e}`);i.push(t[o])}}else if(K0(t)){if(t=t,t.length!==e.length)throw new O(`Error when checking model ${r}: the Array of Tensors that you are passing to your model is not the size the model expected. Expected to see ${e.length} Tensor(s), but instead got the following list of Tensor(s): ${t}`);i=t}else{if(t=t,e.length>1)throw new O(`The model ${r} expects ${e.length} Tensor(s), but only received one Tensor. Found: Tensor with shape ${t.shape}`);i=[t]}if(i=CN(i),n!=null)for(let o=0;o<e.length;++o){if(n[o]==null)continue;const a=i[o];if(a.shape.length!==n[o].length)throw new O(`Error when checking ${r}: expected ${e[o]} to have ${n[o].length} dimension(s). but got array with shape ${a.shape}`);for(let l=0;l<n[o].length;++l){if(l===0&&!s)continue;const c=a.shape[l],u=n[o][l];if(u!=null&&u>=0&&c!==u)throw new O(`${r} expected a batch of elements where each example has shape [${n[o].slice(1,n[o].length)}] (i.e.,tensor shape [*,${n[o].slice(1,n[o].length)}]) but the ${r} received an input with ${a.shape[0]} examples, each with shape [${a.shape.slice(1,a.shape.length)}] (tensor shape [${a.shape}])`)}}return i}function S7(t,e,n){const s=Bi(t.map(i=>i.shape[0]));s.sort();const r=Bi(e.map(i=>i.shape[0]));if(r.sort(),s.length>1)throw new O(`All input Tensors (x) should have the same number of samples. Got array shapes: ${JSON.stringify(t.map(i=>i.shape))}`);if(r.length>1)throw new O(`All target Tensors (y) should have the same number of samples. Got array shapes: ${JSON.stringify(e.map(i=>i.shape))}`);if(s.length>0&&r.length>0&&!je(s,r))throw new O(`Input Tensors should have the same number of samples as target Tensors. Found ${s[0]} input sample(s) and ${r[0]} target sample(s).`)}function I7(t,e,n){const s=[qm,Xm,fu];for(let r=0;r<t.length;++r){const i=t[r],o=e[r],a=n[r];if(o!=null){if(o===fu&&i.shape[i.shape.length-1]===1)throw new O(`You are passing a target array of shape ${i.shape} while using a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].`);if(s.indexOf(o)!==-1){const l=i.shape.slice(1),c=a.slice(1);for(let u=0;u<l.length;++u){const d=l[u],h=c[u];if(h!=null&&d!==h)throw new O(`A target Tensor with shape ${i.shape} was passed for an output of shape ${a}, while using a loss function that expects targets to have the same shape as the output.`)}}}}}function Jk(t,e,n,s=!0,r=""){let i;if(Array.isArray(t)){if(t.length!==e.length)throw new O(`Error when checking model ${r}: the Array of Tensors that you are passing to your model is not the size the the model expected. Expected to see ${e.length} Tensor(s), but instead got ${t.length} Tensors(s).`);i=t}else{if(e.length>1)throw new O(`The model expects ${e.length} ${r} Tensors, but only received one Tensor. Found: array with shape ${JSON.stringify(t.shape)}.`);i=[t]}if(n!=null)for(let o=0;o<e.length;++o){if(n[o]==null)continue;const a=i[o];if(a.shape.length!==n[o].length)throw new O(`Error when checking ${r}: expected ${e[o]} to have ${n[o].length} dimension(s), but got array with shape ${JSON.stringify(a.shape)}`);for(let l=0;l<n[o].length;++l){if(l===0&&!s)continue;const c=a.shape[l],u=n[o][l];if(u!=null&&u!==c)throw new O(`Error when checking ${r}: expected ${e[o]} to have shape ${JSON.stringify(n[o])} but got array with shape ${JSON.stringify(a.shape)}.`)}}}function $7(t,e){if(t==null||Array.isArray(t)&&t.length===0)return e.map(s=>[]);let n;if(typeof t=="string"||typeof t=="function")n=[t];else if(Array.isArray(t)||typeof t=="object")n=t;else throw new TypeError(`Type of metrics argument not understood. Expected an string,function, Array, or Object, found: ${t}`);if(Array.isArray(n))return e.map(s=>n);{const s=[];for(const r of e){let i=n.hasOwnProperty(r)?n[r]:[];Array.isArray(i)||(i=[i]),s.push(i)}return s}}const T7="layers-model";class Lo extends Os{constructor(e){super(e),this.isTraining=!1}summary(e,n,s=console.log){if(!this.built)throw new O("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");c7(this,e,n,s)}compile(e){if(e.loss==null&&(e.loss=[]),this.loss=e.loss,typeof e.optimizer=="string")this.optimizer_=l7(e.optimizer),this.isOptimizerOwned=!0;else{if(!(e.optimizer instanceof co))throw new O("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=e.optimizer,this.isOptimizerOwned=!1}let n=[];if(!Array.isArray(e.loss)&&typeof e.loss!="string"&&typeof e.loss!="function"){e.loss=e.loss;for(const o in e.loss)if(this.outputNames.indexOf(o)===-1)throw new O(`Unknown entry in loss dictionary: "${o}". Only expected the following keys: ${this.outputNames}`);for(const o of this.outputNames)e.loss[o]==null&&console.warn(`Output "${o}" is missing from loss dictionary. We assume this was done on purpose, and we will not be expecting data to be passed to ${o} during training`),n.push(Jg(e.loss[o]))}else if(Array.isArray(e.loss)){if(e.loss.length!==this.outputs.length)throw new O(`When passing an Array as loss, it should have one entry per model output. The model has ${this.outputs.length} output(s), but you passed loss=${e.loss}.`);n=e.loss.map(a=>Jg(a))}else{const o=Jg(e.loss);this.outputs.forEach(a=>{n.push(o)})}this.lossFunctions=n,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(let o=0;o<this.outputs.length;++o){const a=this.internalOutputShapes[o],l=this.outputNames[o];this.feedOutputNames.push(l),this.feedOutputShapes.push(a),this.feedLossFns.push(this.lossFunctions[o])}const s=[];this.metrics=e.metrics,this.metricsNames=["loss"],this.metricsTensors=[],Po("loss",()=>{for(let o=0;o<this.outputs.length;++o){if(s.indexOf(o)!==-1)continue;const a=this.lossFunctions[o];this.outputs.length>1&&(this.metricsTensors.push([a,o]),this.metricsNames.push(this.outputNames[o]+"_loss"))}});const r=$7(e.metrics,this.outputNames),i=(o,a,l)=>{this.outputNames.length>1&&(a=this.outputNames[o]+"_"+a),this.metricsNames.push(a),this.metricsTensors.push([l,o])};Po("metric",()=>{for(let o=0;o<this.outputs.length;++o){if(s.indexOf(o)!==-1)continue;const a=r[o];(c=>{const u="";let d,h,p;for(const f of c){if(typeof f=="string"&&["accuracy","acc","crossentropy","ce"].indexOf(f)!==-1){const x=this.internalOutputShapes[o];x[x.length-1]===1||this.lossFunctions[o]===Xm?["accuracy","acc"].indexOf(f)!==-1?h=fN:["crossentropy","ce"].indexOf(f)!==-1&&(h=JH):this.lossFunctions[o]===qp?["accuracy","acc"].indexOf(f)!==-1?h=ZH:["crossentropy","ce"].indexOf(f)!==-1&&(h=yN):["accuracy","acc"].indexOf(f)!==-1?h=mN:["crossentropy","ce"].indexOf(f)!==-1&&(h=gN);let y;["accuracy","acc"].indexOf(f)!==-1?y="acc":["crossentropy","ce"].indexOf(f)!==-1&&(y="ce"),p=h,d=u+y}else p=a7(f),d=u+Sh(f);let g;Po(d,()=>{g=p}),i(o,d,g)}})(a)}}),this.collectedTrainableWeights=this.trainableWeights}checkTrainableWeightsConsistency(){this.collectedTrainableWeights!=null&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")}evaluate(e,n,s={}){const r=s.batchSize==null?32:s.batchSize;Zg(r);const o=this.standardizeUserDataXY(e,n,!0,r);try{const a=o[0].concat(o[1]);this.makeTestFunction();const l=this.testFunction,c=this.testLoop(l,a,r,s.verbose,s.steps);return Sn(c)}finally{_s(o[0],e),_s(o[1],n)}}async evaluateDataset(e,n){return this.makeTestFunction(),k7(this,e,n)}checkNumSamples(e,n,s,r="steps"){let i;if(s!=null){if(i=null,n!=null)throw new O(`If ${r} is set, batchSize must be null or undefined.Got batchSize = ${n}`)}else if(e!=null)Array.isArray(e)?i=e[0].shape[0]:i=e.shape[0];else throw new O(`Either the input data should have a defined shape, or ${r} shoud be specified.`);return i}execute(e,n){if(Array.isArray(n)&&n.length===0)throw new O("`outputs` is an empty Array, which is not allowed.");const s=Array.isArray(n),r=s?n:[n],i=this.retrieveSymbolicTensors(r),o=new $i;if(e instanceof Et&&(e=[e]),Array.isArray(e)){if(e.length!==this.inputs.length)throw new O(`The number of inputs provided (${e.length}) does not match the number of inputs of this model (${this.inputs.length}).`);for(let l=0;l<this.inputs.length;++l)o.add(this.inputs[l],e[l])}else for(const l of this.inputs){const c=e[l.name];if(c==null)throw new O(`No value is provided for the model's input ${l.name}`);o.add(l,c)}const a=kc(i,o);return s?a:a[0]}retrieveSymbolicTensors(e){const n=na(null,e.length);let s=e.length;for(const r of this.layers){const i=Array.isArray(r.output)?r.output:[r.output],o=i.map(a=>a.name);for(let a=0;a<e.length;++a){const l=o.indexOf(e[a]);if(l!==-1&&(n[a]=i[l],s--),s===0)break}if(s===0)break}if(s>0){const r=[];throw n.forEach((i,o)=>{i==null&&r.push(e[o])}),new O(`Cannot find SymbolicTensors for output name(s): ${JSON.stringify(r)}`)}return n}predictLoop(e,n=32,s=!1){return K(()=>{const r=this.checkNumSamples(e);if(s)throw new Ie("Verbose predictLoop() is not implemented yet.");const i=ey(r,n),o=this.outputs.map(a=>[]);for(let a=0;a<i.length;++a)K(()=>{const c=i[a][0],u=i[a][1],d=hc(e,c,u),h=[];if(Array.isArray(d))for(let f=0;f<d.length;++f)h.push({key:this.inputs[f],value:d[f]});else h.push({key:this.inputs[0],value:d});const p=new $i(h);return kc(this.outputs,p)}).forEach((c,u)=>o[u].push(c));return Sn(o.map(a=>$n(a,0)))})}predict(e,n={}){const s=CN(e);Jk(s,this.inputNames,this.feedInputShapes,!1);try{const r=n.batchSize==null?32:n.batchSize;return Zg(r),this.predictLoop(s,r)}finally{_s(s,e)}}predictOnBatch(e){Jk(e,this.inputNames,this.feedInputShapes,!0);const n=(Array.isArray(e)?e[0]:e).shape[0];return this.predictLoop(e,n)}standardizeUserDataXY(e,n,s=!0,r){if(this.optimizer_==null)throw new vs("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");const i=[];for(let o=0;o<this.feedOutputShapes.length;++o){const a=this.feedOutputShapes[o];this.feedLossFns[o]===qp?i.push(a.slice(0,a.length-1).concat([1])):i.push(a)}if(e=Qk(e,this.feedInputNames,this.feedInputShapes,!1,"input"),n=Qk(n,this.feedOutputNames,i,!1,"target"),S7(e,n),I7(n,this.feedLossFns,this.feedOutputShapes),this.stateful&&r!=null&&r>0&&e[0].shape[0]%r!==0)throw new O(`In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size ${r}. Found: ${e[0].shape[0]} sample(s).`);return[e,n]}async standardizeUserData(e,n,s,r,i=!0,o){const[a,l]=this.standardizeUserDataXY(e,n,i,o);if(s!=null)throw new Error("sample weight is not supported yet.");let c=null;if(r!=null){const u=bN(r,this.outputNames);c=[];for(let d=0;d<u.length;++d)c.push(await wN(l[d],null,u[d]))}return[a,l,c]}testLoop(e,n,s,r=0,i){return K(()=>{const o=this.checkNumSamples(n,s,i,"steps"),a=[];if(r>0)throw new Ie("Verbose mode is not implemented yet.");if(i!=null)throw new Ie("steps mode in testLoop() is not implemented yet");{const l=ey(o,s),c=Ln(Js(0,o));for(let u=0;u<l.length;++u){const d=l[u][0],h=l[u][1],p=Mo(c,d,h-d),f=H0(n,p),g=e(f);if(u===0)for(let x=0;x<g.length;++x)a.push(ze(0));for(let x=0;x<g.length;++x){const y=g[x];a[x]=re(a[x],L(h-d,y))}}for(let u=0;u<a.length;++u)a[u]=ye(a[u],o)}return a})}getDedupedMetricsNames(){const e=this.metricsNames,n=[];for(let s=0;s<e.length;++s){const r=e[s];let i=r;if(Pk(e,r)>1){const o=Pk(e.slice(0,s),r);i+=`_${o}`}n.push(i)}return n}makeTrainFunction(){return e=>{const n=[],s=e.slice(0,this.inputs.length),r=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),i=e.slice(this.inputs.length+this.outputs.length,this.inputs.length+this.outputs.length*2),o=[],a=()=>{const d=[];for(let g=0;g<this.inputs.length;++g)d.push({key:this.inputs[g],value:s[g]});const h=new $i(d),p=kc(this.outputs,h,{training:!0});let f;for(let g=0;g<this.lossFunctions.length;++g){const x=this.lossFunctions[g];let y=x(r[g],p[g]);i[g]!=null&&(y=g7(y,i[g]));const v=It(y);n.push(v),g===0?f=y:f=re(f,y)}for(let g=0;g<this.metricsTensors.length;++g){let x;if(this.outputs.length>1&&g<this.outputs.length)x=n[g];else{const y=this.metricsTensors[g][0],v=this.metricsTensors[g][1];x=It(y(r[v],p[v]))}yr(x),o.push(x)}return f=It(f),this.calculateLosses().forEach(g=>{f=re(f,g)}),f},l=this.collectedTrainableWeights.map(d=>d.read());return[this.optimizer_.minimize(a,!0,l)].concat(o)}}makeTestFunction(){this.testFunction=e=>K(()=>{const n=[];let s;const r=e.slice(0,this.inputs.length),i=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),o=[];for(let c=0;c<this.inputs.length;++c)o.push({key:this.inputs[c],value:r[c]});const a=new $i(o),l=kc(this.outputs,a);for(let c=0;c<this.lossFunctions.length;++c){const u=this.lossFunctions[c],d=It(u(i[c],l[c]));c===0?s=d:s=re(s,d),n.push(s)}for(let c=0;c<this.metricsTensors.length;++c){const u=this.metricsTensors[c][0],d=this.metricsTensors[c][1],h=It(u(i[d],l[d]));n.push(h)}return n})}async fit(e,n,s={}){if(this.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");this.isTraining=!0;let r,i,o,a,l,c,u,d,h;try{const p=s.batchSize==null?32:s.batchSize;Zg(p);const g=await this.standardizeUserData(e,n,s.sampleWeight,s.classWeight,!1,p);r=g[0],i=g[1],h=g[2];let x=!1,y;if(s.validationData!=null&&s.validationData.length>0){if(x=!0,s.validationData.length===2)l=s.validationData[0],c=s.validationData[1];else throw s.validationData.length===3?new Ie("validationData including sample weights is not supported yet."):new O(`When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; ${s.validationData} is invalid.`);const R=await this.standardizeUserData(l,c,null,null,!0,p);u=R[0],d=R[1],y=u.concat(d)}else if(s.validationSplit!=null&&s.validationSplit>0&&s.validationSplit<1){x=!0;const $=Math.floor(r[0].shape[0]*(1-s.validationSplit)),R=r[0].shape[0];u=hc(r,$,R),o=r,r=hc(r,0,$),d=hc(i,$,R),a=i,i=hc(i,0,$),y=u.concat(d)}else s.validationSteps!=null&&(x=!0);const v=r.concat(i).concat(h);this.checkTrainableWeightsConsistency();const b=this.makeTrainFunction(),w=this.getDedupedMetricsNames();let k,S;x?(this.makeTestFunction(),k=this.testFunction,S=w.slice().concat(w.map($=>"val_"+$))):(k=null,y=[],S=w.slice());const I=dN(s.callbacks,s.yieldEvery);return await this.fitLoop(b,v,w,p,s.epochs,s.verbose,I,k,y,s.shuffle,S,s.initialEpoch,null,null)}finally{this.isTraining=!1,_s(r,e),_s(i,n),_s(o,e),_s(a,n),_s(u,l),_s(d,c),h!=null&&Re(h)}}async fitLoop(e,n,s,r,i,o,a,l,c,u,d,h,p,f){r==null&&(r=32),i==null&&(i=1),u==null&&(u=!0),h==null&&(h=0);let g=!1;if(l!=null&&c!=null&&(g=!0),f!=null&&(g=!0,p==null))throw new O("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");const x=this.checkNumSamples(n,r,p,"steps_per_epoch");let y;x!=null&&(y=Js(0,x)),o==null&&(o=1);const{callbackList:v,history:b}=hN(a,o,i,h,x,p,r,g,d);v.setModel(this),this.history=b,await v.onTrainBegin(),this.stopTraining_=!1;for(let w=h;w<i;++w){await v.onEpochBegin(w);const k={};if(p!=null)throw new Ie("stepsPerEpoch mode is not implemented yet.");{if(u==="batch")throw new Ie("batch shuffling is not implemneted yet");u&&uj(y);const S=Ln(y),I=ey(x,r);for(let C=0;C<I.length;++C){const $={};if(await v.onBatchBegin(C,$),K(()=>{const R=I[C][0],_=I[C][1],M=Mo(S,R,_-R);$.batch=C,$.size=_-R;const B=H0(n,M),A=e(B);for(let F=0;F<s.length;++F){const P=s[F],H=A[F];$[P]=H,yr(H)}if(C===I.length-1&&g){const F=this.testLoop(l,c,r);for(let P=0;P<s.length;++P){const H=s[P],E=F[P];yr(E),k["val_"+H]=E}}}),await v.onBatchEnd(C,$),uN($),this.stopTraining_)break}S.dispose()}if(await v.onEpochEnd(w,k),this.stopTraining_)break}return await v.onTrainEnd(),await this.history.syncData(),this.history}async fitDataset(e,n){return v7(this,e,n)}async trainOnBatch(e,n){const s=await this.standardizeUserData(e,n),r=s[0],i=s[1],a=this.makeTrainFunction()(r.concat(i)),l=[];for(const c of a){const u=await c.data();l.push(u[0])}return Re(a),_s(s[0],e),_s(s[1],n),Sn(l)}getNamedWeights(e){const n=[],s=e!=null&&e.trainableOnly,r=s?this.trainableWeights:this.weights,i=this.getWeights(s);for(let o=0;o<r.length;++o)s&&!r[o].trainable||n.push({name:r[o].originalName,tensor:i[o]});return n}set stopTraining(e){this.stopTraining_=e}get stopTraining(){return this.stopTraining_}get optimizer(){return this.optimizer_}set optimizer(e){this.optimizer_!==e&&(this.optimizer_=e,this.isOptimizerOwned=!1)}dispose(){const e=super.dispose();if(e.refCountAfterDispose===0&&this.optimizer!=null&&this.isOptimizerOwned){const n=xk().numTensors;this.optimizer_.dispose(),e.numDisposedVariables+=n-xk().numTensors}return e}getLossIdentifiers(){let e;if(typeof this.loss=="string")e=_r(this.loss);else if(Array.isArray(this.loss)){for(const n of this.loss)if(typeof n!="string")throw new Error("Serialization of non-string loss is not supported.");e=this.loss.map(n=>_r(n))}else{const n=Object.keys(this.loss);e={};const s=this.loss;for(const r of n)if(typeof s[r]=="string")e[r]=_r(s[r]);else throw new Error("Serialization of non-string loss is not supported.")}return e}getMetricIdentifiers(){if(typeof this.metrics=="string"||typeof this.metrics=="function")return[_r(Sh(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map(e=>_r(Sh(e)));{const e={};for(const n in this.metrics)e[n]=_r(Sh(this.metrics[n]));return e}}getTrainingConfig(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}}loadTrainingConfig(e){if(e.weighted_metrics!=null)throw new Error("Loading weight_metrics is not supported yet.");if(e.loss_weights!=null)throw new Error("Loading loss_weights is not supported yet.");if(e.sample_weight_mode!=null)throw new Error("Loading sample_weight_mode is not supported yet.");const n=U0(e.optimizer_config),s=Br(n);let r;if(typeof e.loss=="string")r=Co(e.loss);else if(Array.isArray(e.loss))r=e.loss.map(o=>Co(o));else if(e.loss!=null){r={};for(const o in e.loss)r[o]=Co(e.loss[o])}let i;if(Array.isArray(e.metrics))i=e.metrics.map(o=>Co(o));else if(e.metrics!=null){i={};for(const o in e.metrics)i[o]=Co(e.metrics[o])}this.compile({loss:r,metrics:i,optimizer:s})}async save(e,n){if(typeof e=="string"){const c=oB(e);if(c.length===0)throw new O(`Cannot find any save handlers for URL '${e}'`);if(c.length>1)throw new O(`Found more than one (${c.length}) save handlers for URL '${e}'`);e=c[0]}if(e.save==null)throw new O("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");const s=await bk(this.getNamedWeights(n)),a={modelTopology:this.toJSON(null,!1),format:T7,generatedBy:`TensorFlow.js tfjs-layers v${vN}`,convertedBy:null};if((n==null?!1:n.includeOptimizer)&&this.optimizer!=null){a.trainingConfig=this.getTrainingConfig();const c="optimizer",{data:u,specs:d}=await bk(await this.optimizer.getWeights(),c);s.specs.push(...d),s.data=iB([s.data,u])}return this.userDefinedMetadata!=null&&(Kk(this.userDefinedMetadata,this.name,!0),a.userDefinedMetadata=this.userDefinedMetadata),a.weightData=s.data,a.weightSpecs=s.specs,e.save(a)}setUserDefinedMetadata(e){Kk(e,this.name),this.userDefinedMetadata=e}getUserDefinedMetadata(){return this.userDefinedMetadata}}Lo.className="Model";te(Lo);class SN extends Lo{}SN.className="Functional";te(SN);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Cl extends Lo{constructor(e){if(super({inputs:[],outputs:[]}),e=e||{},this.trainable=!0,this.built=!1,this.name=e.name!=null?e.name:Gm("sequential_"),e.layers!=null)for(const n of e.layers)this.add(n)}checkShape(e){if(e.inboundNodes[0].outputTensors[0].shape.some(s=>s<0))throw new O(`Negative dimension size caused by adding layer ${e.name} with input shape [${e.inboundNodes[0].inputTensors[0].shape}]`)}add(e){const n=e instanceof Cl||e instanceof Lo;let s;if(n){if(s=e,s.outputs.length!==1)throw new O("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(s.inputs.length!==1)throw new O("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(this.outputs.length===0){if(e.inboundNodes.length===0){if(e.batchInputShape==null)throw new O("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");const r=iN({batchShape:e.batchInputShape,dtype:e.dtype,name:e.name+"_input"});e.apply(r)}if(n)this.outputs=s.outputs,this.inputs=s.inputs;else{if(e.inboundNodes.length!==1)throw new O(`A layer added to a Sequential model must not already be connected somewhere else. LayersModel received layer ${e.name} which has ${e.inboundNodes.length} pre-existing inbound connections.`);if(e.inboundNodes[0].outputTensors.length!==1)throw new O("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[e.inboundNodes[0].outputTensors[0]],this.inputs=rN(this.outputs[0])}this.inboundNodes=[],new Km({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:na(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map(r=>r.shape),outputShapes:this.outputs[0].shape})}else{const r=e.apply(this.outputs[0]);if(Array.isArray(r))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[r],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(e),this.built=!1}pop(){if(this.layers.length===0)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),this.layers.length===0)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{const e=this.layers.length-1;this.layers[e].outboundNodes=[],this.outputs=[this.layers[e].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}}call(e,n){return this.model==null&&this.build(),this.model.call(e,n)}build(e){if(Pe(e),this.inputs.length===0||this.outputs.length===0)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new Lo({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0}countParams(){return this.built||this.build(),super.countParams()}summary(e,n,s=console.log){this.built||this.build(),super.summary(e,n,s)}setWeights(e){this.model==null&&this.build(),this.model.setWeights(e)}evaluate(e,n,s={}){if(!this.built)throw new vs("The model needs to be compiled before being used.");return this.model.evaluate(e,n,s)}async evaluateDataset(e,n){if(!this.built)throw new vs("The model needs to be compiled before being used.");return this.model.evaluateDataset(e,n)}predict(e,n={}){return this.model==null&&this.build(),this.model.predict(e,n)}predictOnBatch(e){return this.model==null&&this.build(),this.model.predictOnBatch(e)}compile(e){this.build(),this.model.compile(e),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames}get optimizer(){return this.model==null?void 0:this.model.optimizer}set optimizer(e){this.model.optimizer=e}async fit(e,n,s={}){if(!this.built)throw new vs("The model needs to be compiled before being used.");return this.model.fit(e,n,s)}async fitDataset(e,n){if(!this.built)throw new vs("The model needs to be compiled before being used.");return this.model.fitDataset(e,n)}async trainOnBatch(e,n){return this.model.trainOnBatch(e,n)}static fromConfig(e,n,s={},r=!1){let i,o={};if(n instanceof Array){if(n[0].className==null||n[0].className==="Merge")throw new O("Legacy serialization format not supported yet.");i=n}else T(n.layers!=null,()=>"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."),i=n.layers,delete n.layers,o=n;const a=new e(o);if(!(a instanceof Cl))throw new Ie(`Sequential.fromConfig called on non-Sequential input: ${a}`);for(const l of i){const u=Br(l,void 0,r);r&&u.setFastWeightInitDuringBuild(!0),a.add(u)}return a}set stopTraining(e){if(this.model==null)throw new O("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=e}get stopTraining(){if(this.model==null)throw new O("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining}getConfig(){const e=[];for(const n of this.layers){const s={};s.className=n.getClassName(),s.config=n.getConfig(),e.push(s)}return{name:this.name,layers:e}}}Cl.className="Sequential";te(Cl);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Ul(t){return new Lo(t)}function E7(t){return new Cl(t)}function sa(t){return iN(t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let on=class extends Vl{getConfig(){return{}}};class IN extends on{apply(e,n=1){return fH(e,n)}}IN.className="elu";te(IN);class $N extends on{apply(e){return WE(e)}}$N.className="selu";te($N);class TN extends on{apply(e){return ga(e)}}TN.className="relu";te(TN);class EN extends on{apply(e){return K(()=>du(6,ga(e)))}}EN.className="relu6";te(EN);class RN extends on{apply(e){return e}}RN.className="linear";te(RN);class NN extends on{apply(e){return jl(e)}}NN.className="sigmoid";te(NN);class AN extends on{apply(e){return gH(e)}}AN.className="hardSigmoid";te(AN);class _N extends on{apply(e){return _d(e)}}_N.className="softplus";te(_N);class DN extends on{apply(e){return mH(e)}}DN.className="softsign";te(DN);class FN extends on{apply(e){return Om(e)}}FN.className="tanh";te(FN);let Ab=class extends on{apply(e,n=-1){return Dv(e,n)}};Ab.className="softmax";te(Ab);class ON extends on{apply(e,n=-1){return DE(e,n)}}ON.className="logSoftmax";te(ON);class PN extends on{apply(e){return K(()=>K(()=>{const n=Math.sqrt(2),s=L(.5,re(1,EE(ye(e,n))));return L(e,s)}))}}PN.className="gelu";te(PN);class MN extends on{apply(e){return K(()=>L(.5,L(e,re(1,Om(L(sn(ye(2,Math.PI)),re(e,L(.044715,Zo(e,3)))))))))}}MN.className="gelu_new";te(MN);class LN extends on{apply(e){return K(()=>L(e,Om(_d(e))))}}LN.className="mish";te(LN);class zN extends on{apply(e,n=1){return K(()=>L(jl(L(e,n)),e))}}zN.className="swish";te(zN);function Ki(t){return t.getClassName()}function ty(t,e={}){return zd(t,fs.getMap().classNameMap,e,"activation")}function qi(t){if(t==null){const e={};return e.className="linear",e.config={},ty(e)}if(typeof t=="string"){const e={};return e.className=t,e.config={},ty(e)}else return t instanceof on?t:ty(t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function R7(t){if(t!=null&&typeof t!="object")throw new Error(`Argument to L1L2 regularizer's constructor is expected to be an object, but received: ${t}`)}class jN extends Vl{}class BN extends jN{constructor(e){super(),R7(e),this.l1=e==null||e.l1==null?.01:e.l1,this.l2=e==null||e.l2==null?.01:e.l2,this.hasL1=this.l1!==0,this.hasL2=this.l2!==0}apply(e){return K(()=>{let n=zt([1]);return this.hasL1&&(n=re(n,ge(L(this.l1,hn(e))))),this.hasL2&&(n=re(n,ge(L(this.l2,Bd(e))))),U(n,[])})}getConfig(){return{l1:this.l1,l2:this.l2}}static fromConfig(e,n){return new e({l1:n.l1,l2:n.l2})}}BN.className="L1L2";te(BN);const Zk={l1l2:"L1L2"};function He(t){return yb(t)}function eC(t,e={}){return zd(t,fs.getMap().classNameMap,e,"regularizer")}function at(t){if(t==null)return null;if(typeof t=="string"){const n={className:t in Zk?Zk[t]:t,config:{}};return eC(n)}else return t instanceof jN?t:eC(t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class WN extends Ee{constructor(e){super(e??{}),this.supportsMasking=!0,e!=null&&(this.maxValue=e.maxValue)}call(e,n){e=be(e);let s=ga(e);return this.maxValue!=null&&(s=ss(s,0,this.maxValue)),s}computeOutputShape(e){return e}getConfig(){const e={maxValue:this.maxValue},n=super.getConfig();return Object.assign(e,n),e}}WN.className="ReLU";te(WN);class VN extends Ee{constructor(e){super(e??{}),this.DEFAULT_ALPHA=.3,e==null&&(e={}),this.alpha=e.alpha==null?this.DEFAULT_ALPHA:e.alpha}call(e,n){const s=be(e);return yv(s,this.alpha)}computeOutputShape(e){return e}getConfig(){const e={alpha:this.alpha},n=super.getConfig();return Object.assign(e,n),e}}VN.className="LeakyReLU";te(VN);class UN extends Ee{constructor(e){if(super(e??{}),this.DEFAULT_ALPHA_INITIALIZER="zeros",e==null&&(e={}),this.supportsMasking=!0,this.alphaInitializer=ot(e.alphaInitializer||this.DEFAULT_ALPHA_INITIALIZER),this.alphaRegularizer=at(e.alphaRegularizer),this.alphaConstraint=Dt(e.alphaConstraint),e.sharedAxes==null)this.sharedAxes=null;else if(Array.isArray(e.sharedAxes))this.sharedAxes=e.sharedAxes;else if(typeof e.sharedAxes=="number")this.sharedAxes=[e.sharedAxes];else throw new O(`Expected sharedAxes to be a number or an array of numbers, but got ${e.sharedAxes}`)}build(e){e=Pe(e);const n=e.slice(1);if(this.sharedAxes!=null)for(const r of this.sharedAxes)n[r-1]=1;this.alpha=this.addWeight("alpha",n,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);const s={};if(this.sharedAxes!=null)for(let r=1;r<e.length;++r)s[r]=e[r];this.inputSpec=[new At({ndim:e.length,axes:s})],this.built=!0}call(e,n){return e=be(e),Cv(e,this.alpha.read())}getConfig(){const e={alphaInitializer:ut(this.alphaInitializer),alphaRegularizer:He(this.alphaRegularizer),alphaConstraint:_t(this.alphaConstraint),sharedAxes:this.sharedAxes},n=super.getConfig();return Object.assign(e,n),e}}UN.className="PReLU";te(UN);let GN=class extends Ee{constructor(e){if(super(e??{}),this.DEFAULT_ALPHA=1,e==null&&(e={}),e.alpha!=null&&e.alpha!==this.DEFAULT_ALPHA)throw new Ie(`Non-default alpha value (${e.alpha}) is not supported by the ELU layer yet.`);this.alpha=e.alpha==null?this.DEFAULT_ALPHA:e.alpha}call(e,n){const s=be(e);return Lm(s)}computeOutputShape(e){return e}getConfig(){const e={alpha:this.alpha},n=super.getConfig();return Object.assign(e,n),e}};GN.className="ELU";te(GN);class HN extends Ee{constructor(e){super(e??{}),this.DEFAULT_THETA=1,e==null&&(e={}),this.theta=e.theta==null?this.DEFAULT_THETA:e.theta}call(e,n){const s=be(e);return L(s,de(os(s,this.theta),"float32"))}computeOutputShape(e){return e}getConfig(){const e={theta:this.theta},n=super.getConfig();return Object.assign(e,n),e}}HN.className="ThresholdedReLU";te(HN);class KN extends Ee{constructor(e){super(e??{}),this.DEFAULT_AXIS=1,e==null&&(e={}),this.softmax=new Ab().apply,this.axis=e.axis==null?this.DEFAULT_AXIS:e.axis}call(e,n){return K(()=>{let s=be(e);const r=n.mask;if(r!=null){const i=L(ve(lo(s.shape),de(r,s.dtype)),ze(-1e9));s=re(s,i)}return this.axis instanceof Array?this.axis.length>1?kr(ve(s,FE(s,this.axis,!0))):this.softmax(s,this.axis[0]):this.softmax(s,this.axis)})}computeOutputShape(e){return e}getConfig(){const e={axis:this.axis},n=super.getConfig();return Object.assign(e,n),e}}KN.className="Softmax";te(KN);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function sl(t,e,n){if(typeof t=="number")return na(t,e);if(t.length!==e)throw new O(`The ${n} argument must be an integer or tuple of ${e} integers. Received: ${t.length} elements.`);for(let s=0;s<e;++s){const r=t[s];if(!uH(r))throw new O(`The ${n} argument must be an integer or tuple of ${e} integers. Received: ${JSON.stringify(t)} including a non-integer number ${r}`)}return t}function Xs(t,e,n,s,r=1){if(t==null)return t;const i=e+(e-1)*(r-1);let o;return n==="same"?o=t:o=t-i+1,Math.floor((o+s-1)/s)}function cr(t,e,n,s){if(t==null)return null;if(s==="valid")t=t*e+Hi([n-e,0]);else if(s==="same")t=t*e;else throw new O(`Unsupport padding mode: ${s}.`);return t}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function _b(t,e){return K(()=>(kt(e),e==="channelsFirst"?De(t,[0,2,3,1]):t))}function qN(t,e){return K(()=>(kt(e),e==="channelsFirst"?De(t,[0,2,3,4,1]):t))}function N7(t,e,n,s=1,r="valid",i,o=1){return K(()=>{if(i==null&&(i=Zs()),kt(i),t.shape.length!==3)throw new O(`The input of a conv1dWithBias operation should be 3, but is ${t.shape.length} instead.`);if(e.shape.length!==3)throw new O(`The kernel for a conv1dWithBias operation should be 3, but is ${e.shape.length} instead`);if(n!=null&&n.shape.length!==1)throw new O(`The bias for a conv1dWithBias operation should be 1, but is ${n.shape.length} instead`);if(i==="channelsFirst"&&(t=De(t,[0,2,1])),r==="causal")throw new Ie("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");let a=CE(t,e,s,r==="same"?"same":"valid","NWC",o);return n!=null&&(a=nr(a,n)),a})}function tC(t,e,n,s=[1,1],r="valid",i,o,a=null){return K(()=>{if(i==null&&(i=Zs()),kt(i),t.rank!==3&&t.rank!==4)throw new O(`conv2dWithBiasActivation expects input to be of rank 3 or 4, but received ${t.rank}.`);if(e.rank!==3&&e.rank!==4)throw new O(`conv2dWithBiasActivation expects kernel to be of rank 3 or 4, but received ${t.rank}.`);let l=_b(t,i);if(r==="causal")throw new Ie("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return l=MV({x:l,filter:e,strides:s,pad:r==="same"?"same":"valid",dilations:o,dataFormat:"NHWC",bias:n,activation:a}),i==="channelsFirst"&&(l=De(l,[0,3,1,2])),l})}function A7(t,e,n,s=[1,1,1],r="valid",i,o){return K(()=>{if(i==null&&(i=Zs()),kt(i),t.rank!==4&&t.rank!==5)throw new O(`conv3dWithBias expects input to be of rank 4 or 5, but received ${t.rank}.`);if(e.rank!==4&&e.rank!==5)throw new O(`conv3dWithBias expects kernel to be of rank 4 or 5, but received ${t.rank}.`);let a=qN(t,i);if(r==="causal")throw new Ie("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return a=P6(a,e,s,r==="same"?"same":"valid","NDHWC",o),n!=null&&(a=nr(a,n)),i==="channelsFirst"&&(a=De(a,[0,4,1,2,3])),a})}class Ym extends Ee{constructor(e,n){if(super(n),this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",Ym.verifyArgs(n),this.rank=e,Bt(this.rank,"rank"),this.rank!==1&&this.rank!==2&&this.rank!==3)throw new Ie(`Convolution layer for rank other than 1, 2, or 3 (${this.rank}) is not implemented yet.`);if(this.kernelSize=sl(n.kernelSize,e,"kernelSize"),this.strides=sl(n.strides==null?1:n.strides,e,"strides"),this.padding=n.padding==null?"valid":n.padding,as(this.padding),this.dataFormat=n.dataFormat==null?"channelsLast":n.dataFormat,kt(this.dataFormat),this.activation=qi(n.activation),this.useBias=n.useBias==null?!0:n.useBias,this.biasInitializer=ot(n.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.biasConstraint=Dt(n.biasConstraint),this.biasRegularizer=at(n.biasRegularizer),this.activityRegularizer=at(n.activityRegularizer),this.dilationRate=sl(n.dilationRate==null?1:n.dilationRate,e,"dilationRate"),this.rank===1&&Array.isArray(this.dilationRate)&&this.dilationRate.length!==1)throw new O(`dilationRate must be a number or an array of a single number for 1D convolution, but received ${JSON.stringify(this.dilationRate)}`);if(this.rank===2){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==2)throw new O(`dilationRate must be a number or array of two numbers for 2D convolution, but received ${JSON.stringify(this.dilationRate)}`)}else if(this.rank===3){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==3)throw new O(`dilationRate must be a number or array of three numbers for 3D convolution, but received ${JSON.stringify(this.dilationRate)}`)}}static verifyArgs(e){if(lr("kernelSize"in e,"required key 'kernelSize' not in config"),typeof e.kernelSize!="number"&&!xb(e.kernelSize,"number",1,3))throw new O(`BaseConv expects config.kernelSize to be number or number[] with length 1, 2, or 3, but received ${JSON.stringify(e.kernelSize)}.`)}getConfig(){const e={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:Ki(this.activation),useBias:this.useBias,biasInitializer:ut(this.biasInitializer),biasRegularizer:He(this.biasRegularizer),activityRegularizer:He(this.activityRegularizer),biasConstraint:_t(this.biasConstraint)},n=super.getConfig();return Object.assign(e,n),e}}class Gl extends Ym{constructor(e,n){super(e,n),this.kernel=null,Gl.verifyArgs(n),this.filters=n.filters,Bt(this.filters,"filters"),this.kernelInitializer=ot(n.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.kernelConstraint=Dt(n.kernelConstraint),this.kernelRegularizer=at(n.kernelRegularizer)}build(e){e=Pe(e);const n=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[n]==null)throw new O(`The channel dimension of the input should be defined. Found ${e[n]}`);const s=e[n],r=this.kernelSize.concat([s,this.filters]);this.kernel=this.addWeight("kernel",r,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:{[n]:s}}],this.built=!0}call(e,n){return K(()=>{e=be(e);let s;const r=this.bias==null?null:this.bias.read(),i=VR(this.activation.getClassName());if(i!=null&&this.rank===2)s=tC(e,this.kernel.read(),r,this.strides,this.padding,this.dataFormat,this.dilationRate,i);else{if(this.rank===1)s=N7(e,this.kernel.read(),r,this.strides[0],this.padding,this.dataFormat,this.dilationRate[0]);else if(this.rank===2)s=tC(e,this.kernel.read(),r,this.strides,this.padding,this.dataFormat,this.dilationRate);else if(this.rank===3)s=A7(e,this.kernel.read(),r,this.strides,this.padding,this.dataFormat,this.dilationRate);else throw new Ie("convolutions greater than 3D are not implemented yet.");this.activation!=null&&(s=this.activation.apply(s))}return s})}computeOutputShape(e){e=Pe(e);const n=[],s=this.dataFormat==="channelsLast"?e.slice(1,e.length-1):e.slice(2);for(let i=0;i<s.length;++i){const o=Xs(s[i],this.kernelSize[i],this.padding,this.strides[i],typeof this.dilationRate=="number"?this.dilationRate:this.dilationRate[i]);n.push(o)}let r=[e[0]];return this.dataFormat==="channelsLast"?(r=r.concat(n),r.push(this.filters)):(r.push(this.filters),r=r.concat(n)),r}getConfig(){const e={filters:this.filters,kernelInitializer:ut(this.kernelInitializer),kernelRegularizer:He(this.kernelRegularizer),kernelConstraint:_t(this.kernelConstraint)},n=super.getConfig();return Object.assign(e,n),e}static verifyArgs(e){if(!("filters"in e)||typeof e.filters!="number"||e.filters<1)throw new O(`Convolution layer expected config.filters to be a 'number' > 0 but got ${JSON.stringify(e.filters)}`)}}class Hl extends Gl{constructor(e){super(2,e),Hl.verifyArgs(e)}getConfig(){const e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!xb(e.kernelSize,"number",1,2))throw new O(`Conv2D expects config.kernelSize to be number or number[] with length 1 or 2, but received ${JSON.stringify(e.kernelSize)}.`)}}Hl.className="Conv2D";te(Hl);class Gd extends Gl{constructor(e){super(3,e),Gd.verifyArgs(e)}getConfig(){const e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!(Array.isArray(e.kernelSize)&&(e.kernelSize.length===1||e.kernelSize.length===3)))throw new O(`Conv3D expects config.kernelSize to be number or [number, number, number], but received ${JSON.stringify(e.kernelSize)}.`)}}Gd.className="Conv3D";te(Gd);class XN extends Hl{constructor(e){if(super(e),this.inputSpec=[new At({ndim:4})],this.padding!=="same"&&this.padding!=="valid")throw new O(`Conv2DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(e=Pe(e),e.length!==4)throw new O("Input should have rank 4; Received input shape: "+JSON.stringify(e));const n=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[n]==null)throw new O("The channel dimension of the inputs should be defined. Found `None`.");const s=e[n],r=this.kernelSize.concat([this.filters,s]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new At({ndim:4,axes:{[n]:s}})],this.built=!0}call(e,n){return K(()=>{let s=be(e);if(s.shape.length!==4)throw new O(`Conv2DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${s.shape.length}`);const r=s.shape,i=r[0];let o,a;this.dataFormat==="channelsFirst"?(o=2,a=3):(o=1,a=2);const l=r[o],c=r[a],u=this.kernelSize[0],d=this.kernelSize[1],h=this.strides[0],p=this.strides[1],f=cr(l,h,u,this.padding),g=cr(c,p,d,this.padding),x=[i,f,g,this.filters];this.dataFormat!=="channelsLast"&&(s=De(s,[0,2,3,1]));let y=SE(s,this.kernel.read(),x,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(y=De(y,[0,3,1,2])),this.bias!=null&&(y=nr(y,this.bias.read(),this.dataFormat)),this.activation!=null&&(y=this.activation.apply(y)),y})}computeOutputShape(e){e=Pe(e);const n=e.slice();let s,r,i;this.dataFormat==="channelsFirst"?(s=1,r=2,i=3):(s=3,r=1,i=2);const o=this.kernelSize[0],a=this.kernelSize[1],l=this.strides[0],c=this.strides[1];return n[s]=this.filters,n[r]=cr(n[r],l,o,this.padding),n[i]=cr(n[i],c,a,this.padding),n}getConfig(){const e=super.getConfig();return delete e.dilationRate,e}}XN.className="Conv2DTranspose";te(XN);class YN extends Gd{constructor(e){if(super(e),this.inputSpec=[new At({ndim:5})],this.padding!=="same"&&this.padding!=="valid")throw new O(`Conv3DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(e=Pe(e),e.length!==5)throw new O("Input should have rank 5; Received input shape: "+JSON.stringify(e));const n=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[n]==null)throw new O("The channel dimension of the inputs should be defined. Found `None`.");const s=e[n],r=this.kernelSize.concat([this.filters,s]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new At({ndim:5,axes:{[n]:s}})],this.built=!0}call(e,n){return K(()=>{let s=be(e);if(s.shape.length!==5)throw new O(`Conv3DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${s.shape.length}`);const r=s.shape,i=r[0];let o,a,l;this.dataFormat==="channelsFirst"?(l=2,o=3,a=4):(l=1,o=2,a=3);const c=r[l],u=r[o],d=r[a],h=this.kernelSize[0],p=this.kernelSize[1],f=this.kernelSize[2],g=this.strides[0],x=this.strides[1],y=this.strides[2],v=cr(c,g,h,this.padding),b=cr(u,x,p,this.padding),w=cr(d,y,f,this.padding),k=[i,v,b,w,this.filters];this.dataFormat!=="channelsLast"&&(s=De(s,[0,2,3,4,1]));let S=z6(s,this.kernel.read(),k,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(S=De(S,[0,4,1,2,3])),this.bias!==null&&(S=nr(S,this.bias.read(),this.dataFormat)),this.activation!==null&&(S=this.activation.apply(S)),S})}computeOutputShape(e){e=Pe(e);const n=e.slice();let s,r,i,o;this.dataFormat==="channelsFirst"?(s=1,r=2,i=3,o=4):(s=4,r=1,i=2,o=3);const a=this.kernelSize[0],l=this.kernelSize[1],c=this.kernelSize[2],u=this.strides[0],d=this.strides[1],h=this.strides[2];return n[s]=this.filters,n[r]=cr(n[r],u,a,this.padding),n[i]=cr(n[i],d,l,this.padding),n[o]=cr(n[o],h,c,this.padding),n}getConfig(){const e=super.getConfig();return delete e.dilationRate,e}}YN.className="Conv3DTranspose";te(YN);class QN extends Gl{constructor(e,n){if(super(e,n),this.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",this.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",this.depthwiseKernel=null,this.pointwiseKernel=null,n.filters==null)throw new O("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(n.kernelInitializer!=null||n.kernelRegularizer!=null||n.kernelConstraint!=null)throw new O("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(n.padding!=null&&n.padding!=="same"&&n.padding!=="valid")throw new O(`SeparableConv${this.rank}D supports only padding modes: 'same' and 'valid', but received ${JSON.stringify(n.padding)}`);this.depthMultiplier=n.depthMultiplier==null?1:n.depthMultiplier,this.depthwiseInitializer=ot(n.depthwiseInitializer||this.DEFAULT_DEPTHWISE_INITIALIZER),this.depthwiseRegularizer=at(n.depthwiseRegularizer),this.depthwiseConstraint=Dt(n.depthwiseConstraint),this.pointwiseInitializer=ot(n.depthwiseInitializer||this.DEFAULT_POINTWISE_INITIALIZER),this.pointwiseRegularizer=at(n.pointwiseRegularizer),this.pointwiseConstraint=Dt(n.pointwiseConstraint)}build(e){if(e=Pe(e),e.length<this.rank+2)throw new O(`Inputs to SeparableConv${this.rank}D should have rank ${this.rank+2}, but received input shape: ${JSON.stringify(e)}`);const n=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[n]==null||e[n]<0)throw new O(`The channel dimension of the inputs should be defined, but found ${JSON.stringify(e[n])}`);const s=e[n],r=this.kernelSize.concat([s,this.depthMultiplier]),i=[];for(let a=0;a<this.rank;++a)i.push(1);i.push(s*this.depthMultiplier,this.filters);const o=!0;this.depthwiseKernel=this.addWeight("depthwise_kernel",r,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,o,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",i,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,o,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,o,this.biasConstraint):this.bias=null,this.inputSpec=[new At({ndim:this.rank+2,axes:{[n]:s}})],this.built=!0}call(e,n){return K(()=>{e=be(e);let s;if(this.rank===1)throw new Ie("1D separable convolution is not implemented yet.");return this.rank===2&&(this.dataFormat==="channelsFirst"&&(e=De(e,[0,2,3,1])),s=VE(e,this.depthwiseKernel.read(),this.pointwiseKernel.read(),this.strides,this.padding,this.dilationRate,"NHWC")),this.useBias&&(s=nr(s,this.bias.read(),this.dataFormat)),this.activation!=null&&(s=this.activation.apply(s)),this.dataFormat==="channelsFirst"&&(s=De(s,[0,3,1,2])),s})}getConfig(){const e=super.getConfig();return delete e.rank,delete e.kernelInitializer,delete e.kernelRegularizer,delete e.kernelConstraint,e.depthwiseInitializer=ut(this.depthwiseInitializer),e.pointwiseInitializer=ut(this.pointwiseInitializer),e.depthwiseRegularizer=He(this.depthwiseRegularizer),e.pointwiseRegularizer=He(this.pointwiseRegularizer),e.depthwiseConstraint=_t(this.depthwiseConstraint),e.pointwiseConstraint=_t(this.pointwiseConstraint),e}}QN.className="SeparableConv";class JN extends QN{constructor(e){super(2,e)}}JN.className="SeparableConv2D";te(JN);class Hd extends Gl{constructor(e){super(1,e),Hd.verifyArgs(e),this.inputSpec=[{ndim:3}]}getConfig(){const e=super.getConfig();return delete e.rank,delete e.dataFormat,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!xb(e.kernelSize,"number",1,1))throw new O(`Conv1D expects config.kernelSize to be number or number[] with length 1, but received ${JSON.stringify(e.kernelSize)}.`)}}Hd.className="Conv1D";te(Hd);class ZN extends Ee{constructor(e){super(e),typeof e.cropping=="number"?this.cropping=[[e.cropping,e.cropping],[e.cropping,e.cropping]]:typeof e.cropping[0]=="number"?this.cropping=[[e.cropping[0],e.cropping[0]],[e.cropping[1],e.cropping[1]]]:this.cropping=e.cropping,this.dataFormat=e.dataFormat===void 0?"channelsLast":e.dataFormat,this.inputSpec=[{ndim:4}]}computeOutputShape(e){return this.dataFormat==="channelsFirst"?[e[0],e[1],e[2]-this.cropping[0][0]-this.cropping[0][1],e[3]-this.cropping[1][0]-this.cropping[1][1]]:[e[0],e[1]-this.cropping[0][0]-this.cropping[0][1],e[2]-this.cropping[1][0]-this.cropping[1][1],e[3]]}call(e,n){return K(()=>{if(e=be(e),this.dataFormat==="channelsLast"){const s=Ch(e,this.cropping[0][0],e.shape[1]-this.cropping[0][0]-this.cropping[0][1],2);return Ch(s,this.cropping[1][0],e.shape[2]-this.cropping[1][1]-this.cropping[1][0],3)}else{const s=Ch(e,this.cropping[0][0],e.shape[2]-this.cropping[0][0]-this.cropping[0][1],3);return Ch(s,this.cropping[1][0],e.shape[3]-this.cropping[1][1]-this.cropping[1][0],4)}})}getConfig(){const e={cropping:this.cropping,dataFormat:this.dataFormat},n=super.getConfig();return Object.assign(e,n),e}}ZN.className="Cropping2D";te(ZN);class eA extends Ee{constructor(e){super(e),this.DEFAULT_SIZE=[2,2],this.inputSpec=[{ndim:4}],this.size=e.size==null?this.DEFAULT_SIZE:e.size,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,kt(this.dataFormat),this.interpolation=e.interpolation==null?"nearest":e.interpolation,aH(this.interpolation)}computeOutputShape(e){if(this.dataFormat==="channelsFirst"){const n=e[2]==null?null:this.size[0]*e[2],s=e[3]==null?null:this.size[1]*e[3];return[e[0],e[1],n,s]}else{const n=e[1]==null?null:this.size[0]*e[1],s=e[2]==null?null:this.size[1]*e[2];return[e[0],n,s,e[3]]}}call(e,n){return K(()=>{let s=be(e);const r=s.shape;if(this.dataFormat==="channelsFirst"){s=De(s,[0,2,3,1]);const i=this.size[0]*r[2],o=this.size[1]*r[3],a=this.interpolation==="nearest"?Lr.resizeNearestNeighbor(s,[i,o]):Lr.resizeBilinear(s,[i,o]);return De(a,[0,3,1,2])}else{const i=this.size[0]*r[1],o=this.size[1]*r[2];return this.interpolation==="nearest"?Lr.resizeNearestNeighbor(s,[i,o]):Lr.resizeBilinear(s,[i,o])}})}getConfig(){const e={size:this.size,dataFormat:this.dataFormat,interpolation:this.interpolation},n=super.getConfig();return Object.assign(e,n),e}}eA.className="UpSampling2D";te(eA);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function _7(t,e,n=[1,1],s="valid",r,i){return K(()=>{r==null&&(r=Zs()),kt(r);let o=_b(t,r);if(t.rank!==4)throw new O(`Input for depthwiseConv2d is required to be 4-D, but is instead ${t.rank}-D`);if(e.rank!==4)throw new O(`depthwiseKernel is required to be 4-D, but is instead ${e.rank}-D`);return o=pv(o,e,n,s==="same"?"same":"valid","NHWC",i),r==="channelsFirst"&&(o=De(o,[0,3,1,2])),o})}class tA extends Ym{constructor(e){super(2,e),this.depthwiseKernel=null,this.depthMultiplier=e.depthMultiplier==null?1:e.depthMultiplier,this.depthwiseInitializer=ot(e.depthwiseInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.depthwiseConstraint=Dt(e.depthwiseConstraint),this.depthwiseRegularizer=at(e.depthwiseRegularizer)}build(e){if(e=Pe(e),e.length<4)throw new O(`Inputs to DepthwiseConv2D should have rank 4. Received input shape: ${JSON.stringify(e)}.`);const n=this.dataFormat==="channelsFirst"?1:3;if(e[n]==null||e[n]<0)throw new O(`The channel dimension of the inputs to DepthwiseConv2D should be defined, but is not (${e[n]}).`);const s=e[n],r=[this.kernelSize[0],this.kernelSize[1],s,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",r,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[s*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,n){return K(()=>{e=be(e);let s=_7(e,this.depthwiseKernel.read(),this.strides,this.padding,this.dataFormat,null);return this.useBias&&(s=nr(s,this.bias.read(),this.dataFormat)),this.activation!=null&&(s=this.activation.apply(s)),s})}computeOutputShape(e){e=Pe(e);const n=this.dataFormat==="channelsFirst"?e[2]:e[1],s=this.dataFormat==="channelsFirst"?e[3]:e[2],r=this.dataFormat==="channelsFirst"?e[1]*this.depthMultiplier:e[3]*this.depthMultiplier,i=Xs(n,this.kernelSize[0],this.padding,this.strides[0]),o=Xs(s,this.kernelSize[1],this.padding,this.strides[1]);return this.dataFormat==="channelsFirst"?[e[0],r,i,o]:[e[0],i,o,r]}getConfig(){const e=super.getConfig();return e.depthMultiplier=this.depthMultiplier,e.depthwiseInitializer=ut(this.depthwiseInitializer),e.depthwiseRegularizer=He(this.depthwiseRegularizer),e.depthwiseConstraint=_t(this.depthwiseRegularizer),e}}tA.className="DepthwiseConv2D";te(tA);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function nA(t,e,n,s){if(Array.isArray(t)){if(e!=null||n!=null)throw new O("When inputs is an array, neither initialState or constants should be provided");s!=null&&(n=t.slice(t.length-s,t.length),t=t.slice(0,t.length-s)),t.length>1&&(e=t.slice(1,t.length)),t=t[0]}function r(i){return i==null||Array.isArray(i)?i:[i]}return e=r(e),n=r(n),{inputs:t,initialState:e,constants:n}}function sA(t,e,n,s=!1,r,i,o=!1,a=!1){return K(()=>{const l=e.shape.length;if(l<3)throw new O(`Input should be at least 3D, but is ${l}D.`);const c=[1,0].concat(Js(2,l));e=De(e,c),o&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),r!=null&&(r=de(de(r,"bool"),"float32"),r.rank===l-1&&(r=Cn(r,-1)),r=De(r,c)),s&&(e=ea(e,0),r!=null&&(r=ea(r,0)));const u=[];let d,h=n;const p=e.shape[0],f=ta(e);let g;r!=null&&(g=ta(r));for(let y=0;y<p;++y){const v=f[y],b=K(()=>t(v,h));if(r==null)d=b[0],h=b[1];else{const w=K(()=>{const k=g[y],S=ve($s(k),k),I=re(L(b[0],k),L(h[0],S)),C=h.map(($,R)=>re(L(b[1][R],k),L($,S)));return{output:I,newStates:C}});d=w.output,h=w.newStates}a&&u.push(d)}let x;return a&&(x=Yr(u,1)),[d,x,h]})}class uo extends Ee{constructor(e){super(e);let n;if(e.cell==null)throw new O("cell property is missing for the constructor of RNN.");if(Array.isArray(e.cell)?n=new Pb({cells:e.cell}):n=e.cell,n.stateSize==null)throw new O("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");this.cell=n,this.returnSequences=e.returnSequences==null?!1:e.returnSequences,this.returnState=e.returnState==null?!1:e.returnState,this.goBackwards=e.goBackwards==null?!1:e.goBackwards,this._stateful=e.stateful==null?!1:e.stateful,this.unroll=e.unroll==null?!1:e.unroll,this.supportsMasking=!0,this.inputSpec=[new At({ndim:3})],this.stateSpec=null,this.states_=null,this.numConstants=null,this.keptStates=[]}getStates(){if(this.states_==null){const e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;return Js(0,e).map(n=>null)}else return this.states_}setStates(e){this.states_=e}computeOutputShape(e){B0(e)&&(e=e[0]),e=e;let n=this.cell.stateSize;Array.isArray(n)||(n=[n]);const s=n[0];let r;if(this.returnSequences?r=[e[0],e[1],s]:r=[e[0],s],this.returnState){const i=[];for(const o of n)i.push([e[0],o]);return[r].concat(i)}else return r}computeMask(e,n){return K(()=>{Array.isArray(n)&&(n=n[0]);const s=this.returnSequences?n:null;if(this.returnState){const r=this.states.map(i=>null);return[s].concat(r)}else return s})}get states(){if(this.states_==null){const e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,n=[];for(let s=0;s<e;++s)n.push(null);return n}else return this.states_}set states(e){this.states_=e}build(e){if(this.numConstants!=null)throw new Ie("Constants support is not implemented in RNN yet.");B0(e)&&(e=e[0]),e=e;const n=this.stateful?e[0]:null,s=e.slice(2);this.inputSpec[0]=new At({shape:[n,null,...s]});const r=[e[0]].concat(e.slice(2));this.cell.build(r);let i;if(Array.isArray(this.cell.stateSize)?i=this.cell.stateSize:i=[this.cell.stateSize],this.stateSpec!=null){if(!je(this.stateSpec.map(o=>o.shape[o.shape.length-1]),i))throw new O(`An initialState was passed that is not compatible with cell.stateSize. Received stateSpec=${this.stateSpec}; However cell.stateSize is ${this.cell.stateSize}`)}else this.stateSpec=i.map(o=>new At({shape:[null,o]}));this.stateful&&this.resetStates()}resetStates(e,n=!1){K(()=>{if(!this.stateful)throw new ar("Cannot call resetStates() on an RNN Layer that is not stateful.");const s=this.inputSpec[0].shape[0];if(s==null)throw new O("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.states_==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(r=>zt([s,r])):this.states_=[zt([s,this.cell.stateSize])];else if(e==null)Re(this.states_),this.keptStates!=null&&(Re(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(r=>zt([s,r])):this.states_[0]=zt([s,this.cell.stateSize]);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new O(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: ${e}`);n===!0?this.keptStates.push(this.states_.slice()):Re(this.states_);for(let r=0;r<this.states_.length;++r){const i=e[r],o=Array.isArray(this.cell.stateSize)?this.cell.stateSize[r]:this.cell.stateSize,a=[s,o];if(!je(i.shape,a))throw new O(`State ${r} is incompatible with layer ${this.name}: expected shape=${a}, received shape=${i.shape}`);this.states_[r]=i}}this.states_=this.states_.map(r=>yr(r.clone()))})}apply(e,n){let s=n==null?null:n.initialState,r=n==null?null:n.constants;n==null&&(n={});const i=nA(e,s,r,this.numConstants);e=i.inputs,s=i.initialState,r=i.constants;let o=[],a=[];if(s!=null){n.initialState=s,o=o.concat(s),this.stateSpec=[];for(const c of s)this.stateSpec.push(new At({shape:c.shape}));a=a.concat(this.stateSpec)}if(r!=null&&(n.constants=r,o=o.concat(r),this.numConstants=r.length),o[0]instanceof Sr){const c=[e].concat(o),u=this.inputSpec.concat(a),d=this.inputSpec;this.inputSpec=u;const h=super.apply(c,n);return this.inputSpec=d,h}else return super.apply(e,n)}call(e,n){return K(()=>{const s=n==null?null:n.mask,r=n==null?null:n.training;let i=n==null?null:n.initialState;e=be(e),i==null&&(this.stateful?i=this.states_:i=this.getInitialState(e));const o=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;if(i.length!==o)throw new O(`RNN Layer has ${o} state(s) but was passed ${i.length} initial state(s).`);this.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");const a={training:r},c=sA((f,g)=>{const x=this.cell.call([f].concat(g),a);return[x[0],x.slice(1)]},e,i,this.goBackwards,s,null,this.unroll,this.returnSequences),u=c[0],d=c[1],h=c[2];this.stateful&&this.resetStates(h,r);const p=this.returnSequences?d:u;return this.returnState?[p].concat(h):p})}getInitialState(e){return K(()=>{let n=zt(e.shape);return n=ge(n,[1,2]),n=jd(n),Array.isArray(this.cell.stateSize)?this.cell.stateSize.map(s=>s>1?z0(n,[1,s]):n):this.cell.stateSize>1?[z0(n,[1,this.cell.stateSize])]:[n]})}get trainableWeights(){return this.trainable?this.cell.trainableWeights:[]}get nonTrainableWeights(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.cell!=null&&this.cell.setFastWeightInitDuringBuild(e)}getConfig(){const e=super.getConfig(),n={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};this.numConstants!=null&&(n.numConstants=this.numConstants);const s=this.cell.getConfig();return this.getClassName()===uo.className&&(n.cell={className:this.cell.getClassName(),config:s}),Object.assign(Object.assign(Object.assign({},s),e),n)}static fromConfig(e,n,s={}){const r=n.cell,i=Br(r,s);return new e(Object.assign(n,{cell:i}))}}uo.className="RNN";te(uo);class Qm extends Ee{}class Db extends Qm{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,Bt(this.units,"units"),this.activation=qi(e.activation==null?this.DEFAULT_ACTIVATION:e.activation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=ot(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=ot(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=ot(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=at(e.kernelRegularizer),this.recurrentRegularizer=at(e.recurrentRegularizer),this.biasRegularizer=at(e.biasRegularizer),this.kernelConstraint=Dt(e.kernelConstraint),this.recurrentConstraint=Dt(e.recurrentConstraint),this.biasConstraint=Dt(e.biasConstraint),this.dropout=kl([1,Hi([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=kl([1,Hi([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=Pe(e),this.kernel=this.addWeight("kernel",[e[e.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,n){return K(()=>{if(e=e,e.length!==2)throw new O(`SimpleRNNCell expects 2 input Tensors, got ${e.length}.`);let s=e[1];e=e[0];const r=n.training==null?!1:n.training;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Xi({ones:()=>$s(e),rate:this.dropout,training:r,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Xi({ones:()=>$s(s),rate:this.recurrentDropout,training:r,dropoutFunc:this.dropoutFunc}));let i;const o=this.dropoutMask,a=this.recurrentDropoutMask;o!=null?i=br(L(e,o),this.kernel.read()):i=br(e,this.kernel.read()),this.bias!=null&&(i=nr(i,this.bias.read())),a!=null&&(s=L(s,a));let l=re(i,br(s,this.recurrentKernel.read()));return this.activation!=null&&(l=this.activation.apply(l)),[l,l]})}getConfig(){const e=super.getConfig(),n={units:this.units,activation:Ki(this.activation),useBias:this.useBias,kernelInitializer:ut(this.kernelInitializer),recurrentInitializer:ut(this.recurrentInitializer),biasInitializer:ut(this.biasInitializer),kernelRegularizer:He(this.kernelRegularizer),recurrentRegularizer:He(this.recurrentRegularizer),biasRegularizer:He(this.biasRegularizer),activityRegularizer:He(this.activityRegularizer),kernelConstraint:_t(this.kernelConstraint),recurrentConstraint:_t(this.recurrentConstraint),biasConstraint:_t(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout};return Object.assign(Object.assign({},e),n)}}Db.className="SimpleRNNCell";te(Db);class rA extends uo{constructor(e){e.cell=new Db(e),super(e)}call(e,n){return K(()=>{this.cell.dropoutMask!=null&&(Re(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(Re(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const s=n==null?null:n.mask,r=n==null?null:n.training,i=n==null?null:n.initialState;return super.call(e,{mask:s,training:r,initialState:i})})}static fromConfig(e,n){return new e(n)}}rA.className="SimpleRNN";te(rA);class Fb extends Qm{constructor(e){if(super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.resetAfter)throw new O("GRUCell does not support reset_after parameter set to true.");this.units=e.units,Bt(this.units,"units"),this.activation=qi(e.activation===void 0?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=qi(e.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=ot(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=ot(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=ot(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=at(e.kernelRegularizer),this.recurrentRegularizer=at(e.recurrentRegularizer),this.biasRegularizer=at(e.biasRegularizer),this.kernelConstraint=Dt(e.kernelConstraint),this.recurrentConstraint=Dt(e.recurrentConstraint),this.biasConstraint=Dt(e.biasConstraint),this.dropout=kl([1,Hi([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=kl([1,Hi([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=Pe(e);const n=e[e.length-1];this.kernel=this.addWeight("kernel",[n,this.units*3],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*3],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units*3],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,n){return K(()=>{if(e=e,e.length!==2)throw new O(`GRUCell expects 2 input Tensors (inputs, h, c), got ${e.length}.`);const s=n.training==null?!1:n.training;let r=e[1];e=e[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Xi({ones:()=>$s(e),rate:this.dropout,training:s,count:3,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Xi({ones:()=>$s(r),rate:this.recurrentDropout,training:s,count:3,dropoutFunc:this.dropoutFunc}));const i=this.dropoutMask,o=this.recurrentDropoutMask;let a,l,c;0<this.dropout&&this.dropout<1&&(e=L(e,i[0]));let u=br(e,this.kernel.read());this.useBias&&(u=nr(u,this.bias.read())),0<this.recurrentDropout&&this.recurrentDropout<1&&(r=L(r,o[0]));const d=this.recurrentKernel.read(),[h,p]=es(d,[2*this.units,this.units],d.rank-1),f=br(r,h),[g,x,y]=es(u,3,u.rank-1),[v,b]=es(f,2,f.rank-1);a=this.recurrentActivation.apply(re(g,v)),l=this.recurrentActivation.apply(re(x,b));const w=br(L(l,r),p);c=this.activation.apply(re(y,w));const k=re(L(a,r),L(re(1,vt(a)),c));return[k,k]})}getConfig(){const e=super.getConfig(),n={units:this.units,activation:Ki(this.activation),recurrentActivation:Ki(this.recurrentActivation),useBias:this.useBias,kernelInitializer:ut(this.kernelInitializer),recurrentInitializer:ut(this.recurrentInitializer),biasInitializer:ut(this.biasInitializer),kernelRegularizer:He(this.kernelRegularizer),recurrentRegularizer:He(this.recurrentRegularizer),biasRegularizer:He(this.biasRegularizer),activityRegularizer:He(this.activityRegularizer),kernelConstraint:_t(this.kernelConstraint),recurrentConstraint:_t(this.recurrentConstraint),biasConstraint:_t(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation,resetAfter:!1};return Object.assign(Object.assign({},e),n)}}Fb.className="GRUCell";te(Fb);class iA extends uo{constructor(e){e.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new Fb(e),super(e)}call(e,n){return K(()=>{this.cell.dropoutMask!=null&&(Re(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(Re(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const s=n==null?null:n.mask,r=n==null?null:n.training,i=n==null?null:n.initialState;return super.call(e,{mask:s,training:r,initialState:i})})}static fromConfig(e,n){return n.implmentation===0&&(n.implementation=1),new e(n)}}iA.className="GRU";te(iA);class Jm extends Qm{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,Bt(this.units,"units"),this.activation=qi(e.activation===void 0?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=qi(e.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=ot(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=ot(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=ot(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.unitForgetBias=e.unitForgetBias,this.kernelRegularizer=at(e.kernelRegularizer),this.recurrentRegularizer=at(e.recurrentRegularizer),this.biasRegularizer=at(e.biasRegularizer),this.kernelConstraint=Dt(e.kernelConstraint),this.recurrentConstraint=Dt(e.recurrentConstraint),this.biasConstraint=Dt(e.biasConstraint),this.dropout=kl([1,Hi([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=kl([1,Hi([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=[this.units,this.units],this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){var n;e=Pe(e);const s=e[e.length-1];this.kernel=this.addWeight("kernel",[s,this.units*4],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*4],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint);let r;if(this.useBias){if(this.unitForgetBias){const i=this.biasInitializer,o=this.units;r=new(n=class extends Es{apply(l,c){const u=i.apply([o]),d=new bb().apply([o]),h=i.apply([o*2]);return Lk(Lk(u,d),h)}},n.className="CustomInit",n)}else r=this.biasInitializer;this.bias=this.addWeight("bias",[this.units*4],null,r,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0}call(e,n){return K(()=>{const s=n.training==null?!1:n.training;if(e=e,e.length!==3)throw new O(`LSTMCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);let r=e[1];const i=e[2];e=e[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Xi({ones:()=>$s(e),rate:this.dropout,training:s,count:4,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Xi({ones:()=>$s(r),rate:this.recurrentDropout,training:s,count:4,dropoutFunc:this.dropoutFunc}));const o=this.dropoutMask,a=this.recurrentDropoutMask;let l,c,u,d;0<this.dropout&&this.dropout<1&&(e=L(e,o[0]));let h=br(e,this.kernel.read());0<this.recurrentDropout&&this.recurrentDropout<1&&(r=L(r,a[0])),h=re(h,br(r,this.recurrentKernel.read())),this.useBias&&(h=nr(h,this.bias.read()));const[p,f,g,x]=es(h,4,h.rank-1);l=this.recurrentActivation.apply(p),c=this.recurrentActivation.apply(f),u=re(L(c,i),L(l,this.activation.apply(g))),d=this.recurrentActivation.apply(x);const y=L(d,this.activation.apply(u));return[y,y,u]})}getConfig(){const e=super.getConfig(),n={units:this.units,activation:Ki(this.activation),recurrentActivation:Ki(this.recurrentActivation),useBias:this.useBias,kernelInitializer:ut(this.kernelInitializer),recurrentInitializer:ut(this.recurrentInitializer),biasInitializer:ut(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:He(this.kernelRegularizer),recurrentRegularizer:He(this.recurrentRegularizer),biasRegularizer:He(this.biasRegularizer),activityRegularizer:He(this.activityRegularizer),kernelConstraint:_t(this.kernelConstraint),recurrentConstraint:_t(this.recurrentConstraint),biasConstraint:_t(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation};return Object.assign(Object.assign({},e),n)}}Jm.className="LSTMCell";te(Jm);class Ob extends uo{constructor(e){e.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new Jm(e),super(e)}call(e,n){return K(()=>{this.cell.dropoutMask!=null&&(Re(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(Re(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const s=n==null?null:n.mask,r=n==null?null:n.training,i=n==null?null:n.initialState;return super.call(e,{mask:s,training:r,initialState:i})})}static fromConfig(e,n){return n.implmentation===0&&(n.implementation=1),new e(n)}}Ob.className="LSTM";te(Ob);class Pb extends Qm{constructor(e){super(e),this.cells=e.cells}get stateSize(){const e=[];for(const n of this.cells.slice().reverse())Array.isArray(n.stateSize)?e.push(...n.stateSize):e.push(n.stateSize);return e}call(e,n){return K(()=>{e=e;let s=e.slice(1);const r=[];for(const a of this.cells.slice().reverse())Array.isArray(a.stateSize)?r.push(s.splice(0,a.stateSize.length)):r.push(s.splice(0,1));r.reverse();const i=[];let o;for(let a=0;a<this.cells.length;++a){const l=this.cells[a];s=r[a],a===0?o=[e[0]].concat(s):o=[o[0]].concat(s),o=l.call(o,n),i.push(o.slice(1))}s=[];for(const a of i.slice().reverse())s.push(...a);return[o[0]].concat(s)})}build(e){B0(e)&&(e=e[0]),e=e;let n;this.cells.forEach((s,r)=>{Po(`RNNCell_${r}`,()=>{s.build(e),Array.isArray(s.stateSize)?n=s.stateSize[0]:n=s.stateSize,e=[e[0],n]})}),this.built=!0}getConfig(){const e=super.getConfig(),n=i=>({className:i.getClassName(),config:i.getConfig()}),r={cells:this.cells.map(n)};return Object.assign(Object.assign({},e),r)}static fromConfig(e,n,s={}){const r=[];for(const i of n.cells)r.push(Br(i,s));return new e({cells:r})}get trainableWeights(){if(!this.trainable)return[];const e=[];for(const n of this.cells)e.push(...n.trainableWeights);return e}get nonTrainableWeights(){const e=[];for(const n of this.cells)e.push(...n.nonTrainableWeights);if(!this.trainable){const n=[];for(const s of this.cells)n.push(...s.trainableWeights);return n.concat(e)}return e}getWeights(){const e=[];for(const n of this.cells)e.push(...n.weights);return W0(e)}setWeights(e){const n=[];for(const s of this.cells){const r=s.weights.length,i=e.splice(r);for(let o=0;o<s.weights.length;++o)n.push([s.weights[o],i[o]])}Tb(n)}}Pb.className="StackedRNNCells";te(Pb);function Xi(t){const{ones:e,rate:n,training:s=!1,count:r=1,dropoutFunc:i}=t,o=()=>i!=null?i(e(),n):YR(e(),n),a=()=>Wd(o,e,s);return!r||r<=1?yr(a().clone()):Array(r).fill(void 0).map(a).map(c=>yr(c.clone()))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */var D7=function(t,e){var n={};for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&e.indexOf(s)<0&&(n[s]=t[s]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,s=Object.getOwnPropertySymbols(t);r<s.length;r++)e.indexOf(s[r])<0&&Object.prototype.propertyIsEnumerable.call(t,s[r])&&(n[s[r]]=t[s[r]]);return n};class oA extends uo{constructor(e){if(e.unroll)throw new Ie("Unrolling is not possible with convolutional RNNs.");if(Array.isArray(e.cell))throw new Ie("It is not possible at the moment to stack convolutional cells.");super(e),this.inputSpec=[new At({ndim:5})]}call(e,n){return K(()=>{if(this.cell.dropoutMask!=null&&(Re(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(Re(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null),n&&n.constants)throw new O("ConvRNN2D cell does not support constants");const s=n==null?null:n.mask,r=n==null?null:n.training,i=n==null?null:n.initialState;return super.call(e,{mask:s,training:r,initialState:i})})}computeOutputShape(e){let n=this.computeSingleOutputShape(e);return this.returnSequences||(n=[n[0],...n.slice(2)]),this.returnState&&(n=[n,...Array(2).fill([e[0],...n.slice(-3)])]),n}getInitialState(e){return K(()=>{const{stateSize:n}=this.cell,s=e.shape,r=this.computeSingleOutputShape(s),i=[r[0],...r.slice(2)],o=zt(i);return Array.isArray(n)?Array(n.length).fill(o):[o]})}resetStates(e,n=!1){K(()=>{if(!this.stateful)throw new ar("Cannot call resetStates() on an RNN Layer that is not stateful.");const s=this.inputSpec[0].shape,r=this.computeSingleOutputShape(s),i=[r[0],...r.slice(2)];if(s[0]==null)throw new O("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.getStates()==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>zt(i)):this.states_=[zt(i)];else if(e==null)Re(this.states_),this.keptStates!=null&&(Re(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>zt(i)):this.states_[0]=zt(i);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new O(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: ${e}`);n?this.keptStates.push(this.states_.slice()):Re(this.states_);for(let a=0;a<this.states_.length;++a){const l=e[a],c=i;if(!je(l.shape,c))throw new O(`State ${a} is incompatible with layer ${this.name}: expected shape=${c}, received shape=${l.shape}`);this.states_[a]=l}}this.states_=this.states_.map(a=>yr(a.clone()))})}computeSingleOutputShape(e){const{dataFormat:n,filters:s,kernelSize:r,padding:i,strides:o,dilationRate:a}=this.cell,l=n==="channelsFirst",c=e[l?3:2],u=e[l?4:3],d=Xs(c,r[0],i,o[0],a[0]),h=Xs(u,r[1],i,o[1],a[1]);return[...e.slice(0,2),...l?[s,d,h]:[d,h,s]]}}oA.className="ConvRNN2D";class Mb extends Jm{constructor(e){const{filters:n,kernelSize:s,strides:r,padding:i,dataFormat:o,dilationRate:a}=e;super(Object.assign(Object.assign({},e),{units:n})),this.filters=n,Bt(this.filters,"filters"),this.kernelSize=sl(s,2,"kernelSize"),this.kernelSize.forEach(l=>Bt(l,"kernelSize")),this.strides=sl(r||1,2,"strides"),this.strides.forEach(l=>Bt(l,"strides")),this.padding=i||"valid",as(this.padding),this.dataFormat=o||"channelsLast",kt(this.dataFormat),this.dilationRate=sl(a||1,2,"dilationRate"),this.dilationRate.forEach(l=>Bt(l,"dilationRate"))}build(e){var n;e=Pe(e);const s=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[s]==null)throw new O(`The channel dimension of the input should be defined. Found ${e[s]}`);const r=e[s],i=4,o=this.kernelSize.concat([r,this.filters*i]);this.kernel=this.addWeight("kernel",o,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint);const a=this.kernelSize.concat([this.filters,this.filters*i]);if(this.recurrentKernel=this.addWeight("recurrent_kernel",a,null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){let l;if(this.unitForgetBias){const c=this.biasInitializer,u=this.filters;l=new(n=class extends Es{apply(h,p){const f=c.apply([u]),g=lo([u]),x=c.apply([u*2]);return vb([f,g,x])}},n.className="CustomInit",n)}else l=this.biasInitializer;this.bias=this.addWeight("bias",[this.filters*i],null,l,this.biasRegularizer,!0,this.biasConstraint)}this.built=!0}call(e,n){return K(()=>{if(e.length!==3)throw new O(`ConvLSTM2DCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);const s=n.training||!1,r=e[0],i=e[1],o=e[2],a=4;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Xi({ones:()=>$s(r),rate:this.dropout,training:s,count:a,dropoutFunc:this.dropoutFunc}));const l=this.dropoutMask,c=(V,X,Z)=>!X||!X[Z]?V:L(X[Z],V);let u=c(r,l,0),d=c(r,l,1),h=c(r,l,2),p=c(r,l,3);0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Xi({ones:()=>$s(i),rate:this.recurrentDropout,training:s,count:a,dropoutFunc:this.dropoutFunc}));const f=this.recurrentDropoutMask;let g=c(i,f,0),x=c(i,f,1),y=c(i,f,2),v=c(i,f,3);const b=3,[w,k,S,I]=es(this.kernel.read(),a,b),[C,$,R,_]=this.useBias?es(this.bias.read(),a):[null,null,null,null];u=this.inputConv(u,w,C,this.padding),d=this.inputConv(d,k,$,this.padding),h=this.inputConv(h,S,R,this.padding),p=this.inputConv(p,I,_,this.padding);const[M,B,A,F]=es(this.recurrentKernel.read(),a,b);g=this.recurrentConv(g,M),x=this.recurrentConv(x,B),y=this.recurrentConv(y,A),v=this.recurrentConv(v,F);const P=this.recurrentActivation.apply(re(u,g)),H=this.recurrentActivation.apply(re(d,x)),E=re(L(H,o),L(P,this.activation.apply(re(h,y)))),D=L(this.recurrentActivation.apply(re(p,v)),this.activation.apply(E));return[D,D,E]})}getConfig(){const e=super.getConfig(),{units:n}=e,s=D7(e,["units"]),r={filters:this.filters,kernelSize:this.kernelSize,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,strides:this.strides};return Object.assign(Object.assign({},s),r)}inputConv(e,n,s,r){const i=Jo(e,n,this.strides,r||"valid",this.dataFormat==="channelsFirst"?"NCHW":"NHWC",this.dilationRate);return s?nr(i,s,this.dataFormat):i}recurrentConv(e,n){return Jo(e,n,1,"same",this.dataFormat==="channelsFirst"?"NCHW":"NHWC")}}Mb.className="ConvLSTM2DCell";te(Mb);class aA extends oA{constructor(e){const n=new Mb(e);super(Object.assign(Object.assign({},e),{cell:n}))}static fromConfig(e,n){return new e(n)}}aA.className="ConvLSTM2D";te(aA);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Zm extends Ee{constructor(e){super(e),this.rate=Math.max(Math.min(e.rate,1),0),this.noiseShape=e.noiseShape,this.seed=e.seed,this.supportsMasking=!0}getNoiseShape(e){if(this.noiseShape==null)return this.noiseShape;const n=e.shape,s=[];for(let r=0;r<this.noiseShape.length;++r)s.push(this.noiseShape[r]==null?n[r]:this.noiseShape[r]);return s}call(e,n){return K(()=>{this.invokeCallHook(e,n);const s=be(e);if(0<this.rate&&this.rate<1){const r=n.training==null?!1:n.training,i=this.getNoiseShape(s);return Wd(()=>YR(s,this.rate,i,this.seed),()=>s,r)}return e})}getConfig(){const e={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},n=super.getConfig();return Object.assign(e,n),e}dispose(){return super.dispose()}}Zm.className="Dropout";te(Zm);class lA extends Zm{constructor(e){super(e),this.inputSpec=[{ndim:3}]}getNoiseShape(e){const n=e.shape;return[n[0],1,n[2]]}}lA.className="SpatialDropout1D";te(lA);class Lb extends Ee{constructor(e){if(super(e),this.activation=null,this.useBias=!0,this.kernel=null,this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.batchInputShape==null&&e.inputShape==null&&e.inputDim!=null){let n=null;e.batchSize!=null&&(n=e.batchSize),this.batchInputShape=[n,e.inputDim]}this.units=e.units,Bt(this.units,"units"),this.activation=qi(e.activation),e.useBias!=null&&(this.useBias=e.useBias),this.kernelInitializer=ot(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.biasInitializer=ot(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelConstraint=Dt(e.kernelConstraint),this.biasConstraint=Dt(e.biasConstraint),this.kernelRegularizer=at(e.kernelRegularizer),this.biasRegularizer=at(e.biasRegularizer),this.activityRegularizer=at(e.activityRegularizer),this.supportsMasking=!0,this.inputSpec=[{minNDim:2}]}build(e){e=Pe(e);const n=e[e.length-1];this.kernel==null&&(this.kernel=this.addWeight("kernel",[n,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:{[-1]:n}}],this.built=!0}computeOutputShape(e){e=Pe(e);const n=e.slice();return n[n.length-1]=this.units,n}call(e,n){return K(()=>{this.invokeCallHook(e,n);const s=be(e),r=VR(this.activation.getClassName());let i;return r!=null?i=br(s,this.kernel.read(),r,this.bias?this.bias.read():null):(i=br(s,this.kernel.read()),this.bias!=null&&(i=nr(i,this.bias.read())),this.activation!=null&&(i=this.activation.apply(i))),i})}getConfig(){const e={units:this.units,activation:Ki(this.activation),useBias:this.useBias,kernelInitializer:ut(this.kernelInitializer),biasInitializer:ut(this.biasInitializer),kernelRegularizer:He(this.kernelRegularizer),biasRegularizer:He(this.biasRegularizer),activityRegularizer:He(this.activityRegularizer),kernelConstraint:_t(this.kernelConstraint),biasConstraint:_t(this.biasConstraint)},n=super.getConfig();return Object.assign(e,n),e}}Lb.className="Dense";te(Lb);class zb extends Ee{constructor(e){e=e||{},super(e),this.inputSpec=[{minNDim:3}],this.dataFormat=e.dataFormat}computeOutputShape(e){e=Pe(e);for(const n of e.slice(1))if(n==null)throw new O(`The shape of the input to "Flatten" is not fully defined (got ${e.slice(1)}). Make sure to pass a complete "input_shape" or "batch_input_shape" argument to the first layer in your model.`);return[e[0],Wi(e,1)]}call(e,n){return K(()=>{this.invokeCallHook(e,n);let s=be(e);if(this.dataFormat==="channelsFirst"&&s.rank>1){const r=[0];for(let i=2;i<s.rank;++i)r.push(i);r.push(1),s=De(s,r)}return pH(s)})}getConfig(){const e={};this.dataFormat!=null&&(e.dataFormat=this.dataFormat);const n=super.getConfig();return Object.assign(e,n),e}}zb.className="Flatten";te(zb);class cA extends Ee{constructor(e){super(e),this.supportsMasking=!0,this.activation=qi(e.activation)}call(e,n){return K(()=>{this.invokeCallHook(e,n);const s=be(e);return this.activation.apply(s)})}getConfig(){const e={activation:Ki(this.activation)},n=super.getConfig();return Object.assign(e,n),e}}cA.className="Activation";te(cA);class uA extends Ee{constructor(e){super(e),this.n=e.n,this.inputSpec=[{ndim:2}]}computeOutputShape(e){return[e[0],this.n,e[1]]}call(e,n){return K(()=>(e=be(e),dH(e,this.n)))}getConfig(){const e={n:this.n},n=super.getConfig();return Object.assign(e,n),e}}uA.className="RepeatVector";te(uA);class dA extends Ee{constructor(e){super(e),this.targetShape=e.targetShape;for(let n=0;n<this.targetShape.length;++n)this.isUnknown(this.targetShape[n])&&(this.targetShape[n]=null)}isUnknown(e){return e<0||e==null}fixUnknownDimension(e,n){const s="Total size of new array must be unchanged.",r=n.slice();let i=1,o=null;for(let l=0;l<r.length;++l){const c=r[l];if(this.isUnknown(c))if(o===null)o=l;else throw new O("Can only specifiy one unknown dimension.");else i*=c}const a=Wi(e);if(o!==null){if(i===0||a%i!==0)throw new O(s);r[o]=a/i}else if(a!==i)throw new O(s);return r}computeOutputShape(e){let n=!1;for(let s=0;s<e.length;++s)if(this.isUnknown(e[s])){n=!0;break}return n?e.slice(0,1).concat(this.targetShape):e.slice(0,1).concat(this.fixUnknownDimension(e.slice(1),this.targetShape))}call(e,n){return K(()=>{this.invokeCallHook(e,n);const s=be(e),r=s.shape,i=r.slice(0,1).concat(this.fixUnknownDimension(r.slice(1),this.targetShape));return U(s,i)})}getConfig(){const e={targetShape:this.targetShape},n=super.getConfig();return Object.assign(e,n),e}}dA.className="Reshape";te(dA);class hA extends Ee{constructor(e){if(super(e),e.dims==null)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(e.dims))throw new Error(`Permute constructor requires \`dims\` to be an Array, but received ${e.dims} instead.`);const n=Js(1,e.dims.length+1);if(!je(e.dims.slice().sort(),n))throw new Error("Invalid permutation `dims`: "+JSON.stringify(e.dims)+" `dims` must contain consecutive integers starting from 1.");this.dims=e.dims,this.dimsIncludingBatch=[0].concat(this.dims),this.inputSpec=[new At({ndim:this.dims.length+1})]}computeOutputShape(e){e=Pe(e);const n=e.slice();return this.dims.forEach((s,r)=>{n[r+1]=e[s]}),n}call(e,n){return De(be(e),this.dimsIncludingBatch)}getConfig(){const e={dims:this.dims},n=super.getConfig();return Object.assign(e,n),e}}hA.className="Permute";te(hA);class pA extends Ee{constructor(e){super(e??{}),this.supportsMasking=!0,e!=null?this.maskValue=e.maskValue==null?0:e.maskValue:this.maskValue=0}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),n={maskValue:this.maskValue};return Object.assign(n,e),n}computeMask(e,n){const s=be(e);return _0(jp(s,this.maskValue),-1)}call(e,n){return K(()=>{this.invokeCallHook(e,n);const s=be(e),o=_0(jp(s,this.maskValue),-1,!0);return L(s,de(o,s.dtype))})}}pA.className="Masking";te(pA);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class fA extends Ee{constructor(e){if(super(e),this.embeddings=null,this.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",e.batchInputShape==null&&e.inputShape==null){let n=null;e.batchSize!=null&&(n=e.batchSize),e.inputLength==null?this.batchInputShape=[n,null]:this.batchInputShape=[n].concat(Be(e.inputLength))}this.inputDim=e.inputDim,Bt(this.inputDim,"inputDim"),this.outputDim=e.outputDim,Bt(this.outputDim,"outputDim"),this.embeddingsInitializer=ot(e.embeddingsInitializer||this.DEFAULT_EMBEDDINGS_INITIALIZER),this.embeddingsRegularizer=at(e.embeddingsRegularizer),this.activityRegularizer=at(e.activityRegularizer),this.embeddingsConstraint=Dt(e.embeddingsConstraint),this.maskZero=e.maskZero,this.supportsMasking=e.maskZero,this.inputLength=e.inputLength}build(e){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0}warnOnIncompatibleInputShape(e){}computeMask(e,n){return K(()=>this.maskZero?(e=be(e),jp(e,Fe(e))):null)}computeOutputShape(e){if(e=Pe(e),this.inputLength==null)return[...e,this.outputDim];const n=Be(this.inputLength);if(n.length!==e.length-1)throw new O(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);{let s=0;for(let r=0;r<n.length;++r){const i=n[r],o=e[r+1];if(i!=null&&o!=null&&i!==o)throw new O(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);i==null&&(n[s]=o),s++}}return[e[0],...n,this.outputDim]}call(e,n){return K(()=>{this.invokeCallHook(e,n);let s=be(e);s.dtype!=="int32"&&(s=vr(s,"int32"));const r=XR(this.embeddings.read(),U(s,[s.size]));return U(r,Pe(this.computeOutputShape(s.shape)))})}getConfig(){const e={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:ut(this.embeddingsInitializer),embeddingsRegularizer:He(this.embeddingsRegularizer),activityRegularizer:He(this.activityRegularizer),embeddingsConstraint:_t(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},n=super.getConfig();return Object.assign(e,n),e}}fA.className="Embedding";te(fA);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class va extends Ee{constructor(e){super(e||{}),this.supportsMasking=!0}mergeFunction(e){throw new Ie}computeElementwiseOpOutputShape(e,n){if(e==null||n==null)return null;if(e.length<n.length)return this.computeElementwiseOpOutputShape(n,e);if(n.length===0)return e;const s=e.slice(0,e.length-n.length);for(let r=0;r<n.length;++r){const i=e[e.length-n.length+r],o=n[r];if(i==null||o==null||i<0||o<0)s.push(null);else if(i===1)s.push(o);else if(o===1)s.push(i);else{if(i!==o)throw new O("Operands could not be broadcast together with shapes "+JSON.stringify(e)+" "+JSON.stringify(n));s.push(i)}}return s}build(e){if(Array.isArray(e)&&!Array.isArray(e[0])&&(e=[Pe(e)]),e=e,e.length<2)throw new O(`A merge layer should be called on an Array of at least 2 inputs. Got ${e.length} input(s).`);let n=[];for(const i of e)i!=null&&i[0]!==null&&n.push(i[0]);if(n=Bi(n),n.length>1)throw new O(`Can not merge tensors with different batch sizes. Got tensors with shapes: ${JSON.stringify(e)}.`);let s=e[0]==null?null:e[0].slice(1);for(let i=1;i<e.length;++i){const o=e[i]==null?null:e[i].slice(1);s=this.computeElementwiseOpOutputShape(s,o)}const r=e.map(i=>i.length);e.indexOf(null)===-1&&Bi(r).length===1?this.reshapeRequired=!1:this.reshapeRequired=!0}call(e,n){return K(()=>{if(e=e,this.reshapeRequired){const s=[],r=e.map(i=>i.rank);if(r.indexOf(null)===-1){const i=Hi(r);for(let o of e){const a=o.rank;for(let l=0;l<i-a;++l)o=jd(o,1);s.push(o)}return this.mergeFunction(s)}else{let i=!1;for(const l of e){const c=l.rank;if(c==null){const u=l.shape,d=u[0],h=u.slice(1).concat([d]);let p=U(l,[d].concat(Wi(u.slice(1))));p=De(p,[1,0]),p=U(p,h),s.push(p),i=!0}else if(c>1){const u=Js(1,c).concat([0]);s.push(De(l,u)),i=!0}else s.push(l)}let o=this.mergeFunction(s);const a=o.rank;if(i){if(a==null){const l=o.shape,c=l.length,u=l[c-1],d=[u].concat(l.slice(0,l.length-1));o=U(De(U(o,[-1,u]),[1,0]),d)}else if(a>1){const l=[a-1].concat(Js(0,a-1));o=De(o,l)}}return o}}else return this.mergeFunction(e)})}computeOutputShape(e){e=e;let n;e[0]==null?n=null:n=e[0].slice(1);for(let r=1;r<e.length;++r){const i=e[r]==null?null:e[r].slice(1);n=this.computeElementwiseOpOutputShape(n,i)}let s=[];for(const r of e)r!=null&&r[0]!==null&&s.push(r[0]);return s=Bi(s),s.length===1?n=s.concat(n):n=[null].concat(n),n}computeMask(e,n){return K(()=>{if(n==null)return null;if(!Array.isArray(n))throw new O("`mask` should be an Array");if(!Array.isArray(e))throw new O("`inputs` should be an Array");if(n.length!==e.length)throw new O(`The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths (${e.length} vs ${n.length})`);if(n.every(r=>r==null))return null;n=n.map(r=>r==null?r:Cn(r,0));let s=n[0];for(let r=1;r<n.length-1;++r)s=Xr(s,n[r]);return s})}}class mA extends va{constructor(e){super(e)}mergeFunction(e){return K(()=>{let n=e[0].clone();for(let s=1;s<e.length;++s)n=re(n,e[s]);return n})}}mA.className="Add";te(mA);class jb extends va{constructor(e){super(e)}mergeFunction(e){return K(()=>{let n=e[0].clone();for(let s=1;s<e.length;++s)n=L(n,e[s]);return n})}}jb.className="Multiply";te(jb);class gA extends va{constructor(e){super(e)}mergeFunction(e){return K(()=>{let n=e[0].clone();for(let s=1;s<e.length;++s)n=re(n,e[s]);return L(1/e.length,n)})}}gA.className="Average";te(gA);class yA extends va{constructor(e){super(e)}mergeFunction(e){return K(()=>{let n=e[0];for(let s=1;s<e.length;++s)n=ao(n,e[s]);return n})}}yA.className="Maximum";te(yA);class xA extends va{constructor(e){super(e)}mergeFunction(e){return K(()=>{let n=e[0];for(let s=1;s<e.length;++s)n=du(n,e[s]);return n})}}xA.className="Minimum";te(xA);class Bb extends va{constructor(e){super(e),this.DEFAULT_AXIS=-1,e==null&&(e={}),this.axis=e.axis==null?this.DEFAULT_AXIS:e.axis,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){if(!(Array.isArray(e)&&Array.isArray(e[0]))||e.length===1)throw new O("A `Concatenate` layer should be called on a list of at least 2 inputs");e=e;let n=!0;for(const r of e)if(r!=null){n=!1;break}if(n)return;const s=[];for(let r=0;r<e.length;++r){const i=e[r].slice();i.splice(this.axis,1);let o=!1;for(const a of s)if(je(a,i)){o=!0;break}o||s.push(i)}if(s.length>1)throw new O("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(e))}mergeFunction(e){return K(()=>vb(e,this.axis))}computeOutputShape(e){if(!(Array.isArray(e)&&Array.isArray(e[0])))throw new O("A `Concatenate` layer should be called on a list of inputs.");const n=e,s=n[0].slice(),r=this.axis<0?s.length+this.axis:this.axis;for(const i of n.slice(1)){if(s[r]==null||i[r]==null){s[r]=null;break}s[r]+=i[r]}return s}computeMask(e,n){if(n==null)return null;if(!Array.isArray(n))throw new O("`mask` should be an array for Concatenate");if(!Array.isArray(e))throw new O("`inputs` should be an array for Concatenate");if(n.length!==e.length)throw new O(`Mismatch in the length of mask (${n.length}) and the legnth of inputs (${e.length})`);return K(()=>{let s=!0;if(n.forEach(o=>{if(o!=null){s=!1;return}}),s)return null;const r=[];for(let o=0;o<e.length;++o)n[o]==null?r.push(de($s(e[o]),"bool")):n[o].rank<e[o].rank?r.push(Cn(n[o],-1)):r.push(n[o]);const i=$n(r,this.axis);return kE(i,-1,!1)})}getConfig(){const e={axis:this.axis},n=super.getConfig();return Object.assign(e,n),e}}Bb.className="Concatenate";te(Bb);function pc(t,e){for(;t<0;)t+=e;return t}function F7(t,e,n){if(t.shape.length>3||e.shape.length>3)throw new Ie("batchDot is not implemented for tensors of 4D or higher rank yet");if(T(t.shape.length>=2,()=>`batchDot requires the rank of x to be >= 2, but got ${t.shape.length}`),T(t.shape.length>=2,()=>`batchDot requires the rank of y to be >= 2, but got ${e.shape.length}`),typeof n=="number"&&(n=[n,n]),t.dtype==="complex64"||e.dtype==="complex64")throw new Ie("batchDot is not implemented for complex64-type Tensors yet.");const s=t.shape.length,r=e.shape.length;n==null&&(n=[s-1,r-2]);const i=n;return K(()=>{let o;if(s>r){o=s-r;const l=[];for(let c=0;c<o;++c)l.push(1);e=U(e,e.shape.concat(l))}else if(r>s){o=r-s;const l=[];for(let c=0;c<o;++c)l.push(1);t=U(t,t.shape.concat(l))}else o=0;let a;if(t.shape.length===2&&e.shape.length===2)i[0]===i[1]?a=ge(L(t,e),i[0]):a=ge(L(De(t,[1,0]),e),i[1]);else{const l=i[0]!==t.shape.length-1,c=i[1]===e.shape.length-1;a=Le(t,e,l,c)}if(o>0){let l;s>r?l=s+r-3:l=s-1;const c=[];for(let u=l;u<l+o;++u)c.push(u);a=Fd(a,c)}return a.shape.length===1&&(a=Cn(a,1)),a})}class vA extends va{constructor(e){super(e),this.axes=e.axes,this.normalize=e.normalize==null?!1:e.normalize,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){T(Array.isArray(e)&&e.length===2&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const n=e[0],s=e[1];if(n.length>3||s.length>3)throw new Ie("Dot layer does not support tensors of 4D or higher rank yet.");const r=this.interpretAxes(n,s);if(n[r[0]]!==s[r[1]])throw new O(`Dimension incompatibility: ${n[r[0]]} !== ${s[r[1]]}`)}mergeFunction(e){if(e.length!==2)throw new O(`A \`Dot\` layer must be called on exactly 2 inputs, but received ${e.length} input(s).`);let n=e[0],s=e[1],r;return Array.isArray(this.axes)?r=this.axes.map((i,o)=>pc(i,e[o].shape.length)):r=[pc(this.axes,n.shape.length),pc(this.axes,s.shape.length)],this.normalize&&(n=Kp(n,r[0]),s=Kp(s,r[1])),F7(n,s,r)}interpretAxes(e,n){let s;return Array.isArray(this.axes)?s=this.axes:s=[pc(this.axes,e.length),pc(this.axes,n.length)],s}computeOutputShape(e){T(Array.isArray(e)&&e.length===2&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const n=e[0].slice(),s=e[1].slice();if(n.length>3||s.length>3)throw new Ie("Dot layer does not support tensors of 4D or higher rank yet.");const r=this.interpretAxes(n,s);n.splice(r[0],1),s.splice(r[1],1),s.splice(0,1);const i=n.concat(s);return i.length===1&&i.push(1),i}computeMask(e,n){return null}getConfig(){const e={axes:this.axes,normalize:this.normalize},n=super.getConfig();return Object.assign(e,n),e}}vA.className="Dot";te(vA);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class bA extends Ee{constructor(e){super(e),this.supportsMasking=!0,this.stddev=e.stddev}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),n={stddev:this.stddev};return Object.assign(n,e),n}call(e,n){return K(()=>{this.invokeCallHook(e,n);const s=be(e);return Wd(()=>re(Hm(s.shape,0,this.stddev),s),()=>s,n.training||!1)})}}bA.className="GaussianNoise";te(bA);class wA extends Ee{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),n={rate:this.rate};return Object.assign(n,e),n}call(e,n){return K(()=>{this.invokeCallHook(e,n);const s=be(e);return this.rate>0&&this.rate<1?Wd(()=>{const i=Math.sqrt(this.rate/(1-this.rate));return L(s,Hm(s.shape,1,i))},()=>s,n.training||!1):s})}}wA.className="GaussianDropout";te(wA);class kA extends Ee{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate,this.noiseShape=e.noiseShape}_getNoiseShape(e){return this.noiseShape||be(e).shape}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),n={rate:this.rate};return Object.assign(n,e),n}call(e,n){return K(()=>{if(this.rate<1&&this.rate>0){const s=this._getNoiseShape(e);return Wd(()=>{const i=be(e),a=-1.6732632423543772*1.0507009873554805;let l=fa(Dd(s),this.rate);l=vr(l,"float32");const c=((1-this.rate)*(1+this.rate*a**2))**-.5,u=-c*a*this.rate,d=re(L(i,l),L(re(l,-1),a));return re(L(d,c),u)},()=>be(e),n.training||!1)}return e})}}kA.className="AlphaDropout";te(kA);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function mu(t,e,n,s,r,i=.001){let o;if(t.rank===2)o=h6(t,e,n,s,r,i);else if(t.rank===3)o=f6(t,e,n,s,r,i);else if(t.rank===4)o=g6(t,e,n,s,r,i);else throw new Ie(`batchNormalization is not implemented for array of rank ${t.rank} yet`);return o}function O7(t,e,n,s,r=.001){return K(()=>{const i=bv(t,s),o=i.mean,a=i.variance;return[mu(t,o,a,n,e,r),o,a]})}function P7(t,e,n,s,r=.001){return K(()=>{const i=bv(t,s),o=i.mean,a=i.variance,l=[];for(const f of Js(0,t.rank))s.indexOf(f)!==-1?l.push(1):l.push(t.shape[f]);const c=U(o,l),u=U(a,l),d=e==null?null:U(e,l),h=n==null?null:U(n,l);return[mu(t,c,u,h,d,r),o,a]})}function M7(t,e,n,s,r=.001){return je(s.slice().sort(),Js(0,t.rank-1))?O7(t,e,n,s,r):P7(t,e,n,s,r)}class CA extends Ee{constructor(e){e==null&&(e={}),super(e),this.supportsMasking=!0,this.axis=e.axis==null?-1:e.axis,this.momentum=e.momentum==null?.99:e.momentum,this.epsilon=e.epsilon==null?.001:e.epsilon,this.center=e.center==null?!0:e.center,this.scale=e.scale==null?!0:e.scale,this.betaInitializer=ot(e.betaInitializer||"zeros"),this.gammaInitializer=ot(e.gammaInitializer||"ones"),this.movingMeanInitializer=ot(e.movingMeanInitializer||"zeros"),this.movingVarianceInitializer=ot(e.movingVarianceInitializer||"ones"),this.betaConstraint=Dt(e.betaConstraint),this.gammaConstraint=Dt(e.gammaConstraint),this.betaRegularizer=at(e.betaRegularizer),this.gammaRegularizer=at(e.gammaRegularizer)}build(e){e=Pe(e);const n=this.axis>=0?this.axis:this.axis+e.length,s=e[n];if(s==null)throw new O(`Axis ${n} of input tensor should have a defined dimension but the layer received an input with shape ${JSON.stringify(e)}.`);this.inputSpec=[new At({ndim:e.length,axes:{[n]:s}})];const r=[s];this.scale&&(this.gamma=this.addWeight("gamma",r,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",r,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",r,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",r,null,this.movingVarianceInitializer,null,!1),this.built=!0}call(e,n){return K(()=>{const s=n.training==null?!1:n.training,r=be(e),i=r.shape,o=i.length,a=Js(0,o),l=this.axis>=0?this.axis:this.axis+o;a.splice(l,1);const c=na(1,o);c[l]=i[l];const u=a.slice();u.sort();const d=!je(u,Js(0,o).slice(0,o-1)),h=()=>{if(d){const v=U(this.movingMean.read(),c),b=U(this.movingVariance.read(),c),w=this.center?U(this.beta.read(),c):null,k=this.scale?U(this.gamma.read(),c):null;return mu(r,v,b,w,k,this.epsilon)}else return mu(r,this.movingMean.read(),this.movingVariance.read(),this.beta==null?null:this.beta.read(),this.gamma==null?null:this.gamma.read(),this.epsilon)};if(!s)return h();const[p,f,g]=M7(r,this.gamma.read(),this.beta.read(),a,this.epsilon),x=(v,b,w)=>{K(()=>{const k=1-w,S=v.read(),I=L(ve(S,b),k);v.write(ve(S,I))})};return(()=>{x(this.movingMean,f,this.momentum),x(this.movingVariance,g,this.momentum)})(),p})}getConfig(){const e={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:ut(this.betaInitializer),gammaInitializer:ut(this.gammaInitializer),movingMeanInitializer:ut(this.movingMeanInitializer),movingVarianceInitializer:ut(this.movingVarianceInitializer),betaRegularizer:He(this.betaRegularizer),gammaRegularizer:He(this.gammaRegularizer),betaConstraint:_t(this.betaConstraint),gammaConstraint:_t(this.gammaConstraint)},n=super.getConfig();return Object.assign(e,n),e}}CA.className="BatchNormalization";te(CA);class SA extends Ee{constructor(e){if(e==null&&(e={}),super(e),this.axis=e.axis==null?-1:e.axis,typeof this.axis=="number"){if(!Number.isInteger(this.axis))throw new Error(`Expected axis to be an integer, but received ${this.axis}`)}else if(Array.isArray(this.axis)){for(const n of this.axis)if(!Number.isInteger(n))throw new Error(`Expected axis to be an array of integers, but received ${JSON.stringify(this.axis)}`)}else throw new Error(`Expected axis to be an integer or an array of integers, but received ${JSON.stringify(this.axis)}`);this.epsilon=e.epsilon==null?.001:e.epsilon,this.center=e.center==null?!0:e.center,this.scale=e.scale==null?!0:e.scale,this.betaInitializer=ot(e.betaInitializer||"zeros"),this.gammaInitializer=ot(e.gammaInitializer||"ones"),this.betaRegularizer=at(e.betaRegularizer),this.gammaRegularizer=at(e.gammaRegularizer),this.supportsMasking=!0}build(e){e=Pe(e);const n=e.length;typeof this.axis=="number"&&(this.axis=[this.axis]);for(let i=0;i<this.axis.length;++i)this.axis[i]<0&&(this.axis[i]+=n);for(const i of this.axis)if(i<0||i>=n)throw new Error(`Invalid axis: ${i}`);if(this.axis.length!==Bi(this.axis).length)throw new Error(`Found duplicate axes in: ${this.axis}`);const s=this.axis.map(i=>e[i]),r=!0;this.scale?this.gamma=this.addWeight("gamma",s,"float32",this.gammaInitializer,this.gammaRegularizer,r):this.gamma=null,this.center?this.beta=this.addWeight("beta",s,"float32",this.betaInitializer,this.betaRegularizer,r):this.beta=null,this.built=!0}call(e,n){const s=be(e),r=s.shape,i=r.length;return K(()=>{let{mean:a,variance:l}=bv(s,this.axis,!0);const c=na(1,i);for(const g of this.axis)c[g]=r[g];const u=g=>g!=null&&g.shape.length!==i?U(g,c):g;let d=this.scale?u(this.gamma.read()):null,h=this.center?u(this.beta.read()):null;const p=[],f=[];for(let g=0;g<i;++g)this.axis.indexOf(g)!==-1?(p.push(r[g]),f.push(1)):(p.push(1),f.push(r[g]));return a=Us(a,p),l=Us(l,p),d!=null&&(d=Us(d,f)),h!=null&&(h=Us(h,f)),mu(s,a,l,h,d,this.epsilon)})}getConfig(){const e={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:ut(this.betaInitializer),gammaInitializer:ut(this.gammaInitializer),betaRegularizer:He(this.betaRegularizer),gammaRegularizer:He(this.gammaRegularizer)},n=super.getConfig();return Object.assign(e,n),e}}SA.className="LayerNormalization";te(SA);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function L7(t,e,n){return K(()=>{if(t.rank!==4)throw new O(`temporalPadding expects input tensor to be 4-D, but received a ${t.rank}-D tensor.`);if(e==null&&(e=[[1,1],[1,1]]),e.length!==2||e[0].length!==2||e[1].length!==2)throw new O("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(n==null&&(n=Zs()),n!=="channelsLast"&&n!=="channelsFirst")throw new O(`Unknown data format: ${n}. Supported data formats are 'channelsLast' and 'channelsFirst.`);let s;return n==="channelsFirst"?s=[[0,0],[0,0],e[0],e[1]]:s=[[0,0],e[0],e[1],[0,0]],wv(t,s)})}class IA extends Ee{constructor(e){if(e==null&&(e={}),super(e),this.dataFormat=e.dataFormat==null?Zs():e.dataFormat,e.padding==null)this.padding=[[1,1],[1,1]];else if(typeof e.padding=="number")this.padding=[[e.padding,e.padding],[e.padding,e.padding]];else{if(e.padding=e.padding,e.padding.length!==2)throw new O(`ZeroPadding2D expects padding to be a length-2 array, but received a length-${e.padding.length} array.`);let n,s;if(typeof e.padding[0]=="number")n=[e.padding[0],e.padding[0]],s=[e.padding[1],e.padding[1]];else{if(e.padding=e.padding,e.padding[0].length!==2)throw new O(`ZeroPadding2D expects height padding to be a length-2 array, but received a length-${e.padding[0].length} array.`);if(n=e.padding[0],e.padding[1].length!==2)throw new O(`ZeroPadding2D expects width padding to be a length-2 array, but received a length-${e.padding[1].length} array.`);s=e.padding[1]}this.padding=[n,s]}this.inputSpec=[new At({ndim:4})]}computeOutputShape(e){e=Pe(e);let n,s;return this.dataFormat==="channelsFirst"?(e[2]!=null&&e[2]>=0?n=e[2]+this.padding[0][0]+this.padding[0][1]:n=null,e[3]!=null&&e[3]>=0?s=e[3]+this.padding[1][0]+this.padding[1][1]:s=null,[e[0],e[1],n,s]):(e[1]!=null&&e[1]>=0?n=e[1]+this.padding[0][0]+this.padding[0][1]:n=null,e[2]!=null&&e[2]>=0?s=e[2]+this.padding[1][0]+this.padding[1][1]:s=null,[e[0],n,s,e[3]])}call(e,n){return K(()=>L7(be(e),this.padding,this.dataFormat))}getConfig(){const e={padding:this.padding,dataFormat:this.dataFormat},n=super.getConfig();return Object.assign(e,n),e}}IA.className="ZeroPadding2D";te(IA);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function eg(t,e,n,s,r,i){return K(()=>{kt(r),GR(i),as(s),n==null&&(n=[1,1]),s==null&&(s="valid"),r==null&&(r=Zs()),i==null&&(i="max"),t=_b(t,r);let o;const a=s==="same"?"same":"valid";return i==="max"?o=vv(t,e,n,a):o=cv(t,e,n,a),r==="channelsFirst"&&(o=De(o,[0,3,1,2])),o})}function $A(t,e,n,s,r,i){return K(()=>{kt(r),GR(i),as(s),n==null&&(n=[1,1,1]),s==null&&(s="valid"),r==null&&(r=Zs()),i==null&&(i="max"),t=qN(t,r);let o;const a=s==="same"?"same":"valid";return i==="max"?o=e5(t,e,n,a):o=n6(t,e,n,a),r==="channelsFirst"&&(o=De(o,[0,4,1,2,3])),o})}class TA extends Ee{constructor(e){if(e.poolSize==null&&(e.poolSize=2),super(e),typeof e.poolSize=="number")this.poolSize=[e.poolSize];else if(Array.isArray(e.poolSize)&&e.poolSize.length===1&&typeof e.poolSize[0]=="number")this.poolSize=e.poolSize;else throw new O(`poolSize for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(e.poolSize)}`);if(Bt(this.poolSize,"poolSize"),e.strides==null)this.strides=this.poolSize;else if(typeof e.strides=="number")this.strides=[e.strides];else if(Array.isArray(e.strides)&&e.strides.length===1&&typeof e.strides[0]=="number")this.strides=e.strides;else throw new O(`strides for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(e.strides)}`);Bt(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,as(this.padding),this.inputSpec=[new At({ndim:3})]}computeOutputShape(e){e=Pe(e);const n=Xs(e[1],this.poolSize[0],this.padding,this.strides[0]);return[e[0],n,e[2]]}call(e,n){return K(()=>{this.invokeCallHook(e,n),e=jd(be(e),2);const s=this.poolingFunction(be(e),[this.poolSize[0],1],[this.strides[0],1],this.padding,"channelsLast");return Fd(s,[2])})}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides},n=super.getConfig();return Object.assign(e,n),e}}class Wb extends TA{constructor(e){super(e)}poolingFunction(e,n,s,r,i){return kt(i),as(r),eg(e,n,s,r,i,"max")}}Wb.className="MaxPooling1D";te(Wb);class EA extends TA{constructor(e){super(e)}poolingFunction(e,n,s,r,i){return kt(i),as(r),eg(e,n,s,r,i,"avg")}}EA.className="AveragePooling1D";te(EA);class RA extends Ee{constructor(e){if(e.poolSize==null&&(e.poolSize=[2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize],e.strides==null)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(e.strides.length!==2)throw new O(`If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length ${e.strides.length}.`);this.strides=e.strides}else this.strides=[e.strides,e.strides];Bt(this.poolSize,"poolSize"),Bt(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,kt(this.dataFormat),as(this.padding),this.inputSpec=[new At({ndim:4})]}computeOutputShape(e){e=Pe(e);let n=this.dataFormat==="channelsFirst"?e[2]:e[1],s=this.dataFormat==="channelsFirst"?e[3]:e[2];return n=Xs(n,this.poolSize[0],this.padding,this.strides[0]),s=Xs(s,this.poolSize[1],this.padding,this.strides[1]),this.dataFormat==="channelsFirst"?[e[0],e[1],n,s]:[e[0],n,s,e[3]]}call(e,n){return K(()=>(this.invokeCallHook(e,n),this.poolingFunction(be(e),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},n=super.getConfig();return Object.assign(e,n),e}}class Vb extends RA{constructor(e){super(e)}poolingFunction(e,n,s,r,i){return kt(i),as(r),eg(e,n,s,r,i,"max")}}Vb.className="MaxPooling2D";te(Vb);class NA extends RA{constructor(e){super(e)}poolingFunction(e,n,s,r,i){return kt(i),as(r),eg(e,n,s,r,i,"avg")}}NA.className="AveragePooling2D";te(NA);class AA extends Ee{constructor(e){if(e.poolSize==null&&(e.poolSize=[2,2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize,e.poolSize],e.strides==null)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(e.strides.length!==3)throw new O(`If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length ${e.strides.length}.`);this.strides=e.strides}else this.strides=[e.strides,e.strides,e.strides];Bt(this.poolSize,"poolSize"),Bt(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,kt(this.dataFormat),as(this.padding),this.inputSpec=[new At({ndim:5})]}computeOutputShape(e){e=Pe(e);let n=this.dataFormat==="channelsFirst"?e[2]:e[1],s=this.dataFormat==="channelsFirst"?e[3]:e[2],r=this.dataFormat==="channelsFirst"?e[4]:e[3];return n=Xs(n,this.poolSize[0],this.padding,this.strides[0]),s=Xs(s,this.poolSize[1],this.padding,this.strides[1]),r=Xs(r,this.poolSize[2],this.padding,this.strides[2]),this.dataFormat==="channelsFirst"?[e[0],e[1],n,s,r]:[e[0],n,s,r,e[4]]}call(e,n){return K(()=>(this.invokeCallHook(e,n),this.poolingFunction(be(e),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},n=super.getConfig();return Object.assign(e,n),e}}class _A extends AA{constructor(e){super(e)}poolingFunction(e,n,s,r,i){return kt(i),as(r),$A(e,n,s,r,i,"max")}}_A.className="MaxPooling3D";te(_A);class DA extends AA{constructor(e){super(e)}poolingFunction(e,n,s,r,i){return kt(i),as(r),$A(e,n,s,r,i,"avg")}}DA.className="AveragePooling3D";te(DA);class FA extends Ee{constructor(e){super(e),this.inputSpec=[new At({ndim:3})]}computeOutputShape(e){return[e[0],e[2]]}call(e,n){throw new Ie}}class OA extends FA{constructor(e){super(e||{})}call(e,n){return K(()=>{const s=be(e);return It(s,1)})}}OA.className="GlobalAveragePooling1D";te(OA);class PA extends FA{constructor(e){super(e||{})}call(e,n){return K(()=>{const s=be(e);return qs(s,1)})}}PA.className="GlobalMaxPooling1D";te(PA);class MA extends Ee{constructor(e){super(e),this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,kt(this.dataFormat),this.inputSpec=[new At({ndim:4})]}computeOutputShape(e){return e=e,this.dataFormat==="channelsLast"?[e[0],e[3]]:[e[0],e[1]]}call(e,n){throw new Ie}getConfig(){const e={dataFormat:this.dataFormat},n=super.getConfig();return Object.assign(e,n),e}}class Ub extends MA{call(e,n){return K(()=>{const s=be(e);return this.dataFormat==="channelsLast"?It(s,[1,2]):It(s,[2,3])})}}Ub.className="GlobalAveragePooling2D";te(Ub);class LA extends MA{call(e,n){return K(()=>{const s=be(e);return this.dataFormat==="channelsLast"?qs(s,[1,2]):qs(s,[2,3])})}}LA.className="GlobalMaxPooling2D";te(LA);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class zA extends Ee{constructor(e){super(e),this.layer=e.layer}build(e){this.built=!0}get trainable(){return this.layer!=null?this.layer.trainable:!1}set trainable(e){this.layer!=null&&(this.layer.trainable=e)}get trainableWeights(){return this.layer.trainableWeights}get nonTrainableWeights(){return this.layer.nonTrainableWeights}get updates(){return this.layer._updates}get losses(){return this.layer.losses}getWeights(){return this.layer.getWeights()}setWeights(e){this.layer.setWeights(e)}getConfig(){const e={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},n=super.getConfig();return Object.assign(e,n),e}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.layer!=null&&this.layer.setFastWeightInitDuringBuild(e)}static fromConfig(e,n,s={}){const r=n.layer,i=Br(r,s);delete n.layer;const o={layer:i};return Object.assign(o,n),new e(o)}}class jA extends zA{constructor(e){super(e),this.supportsMasking=!0}build(e){if(e=Pe(e),e.length<3)throw new O(`TimeDistributed layer expects an input shape >= 3D, but received input shape ${JSON.stringify(e)}`);this.inputSpec=[{shape:e}];const n=[e[0]].concat(e.slice(2));this.layer.built||(this.layer.build(n),this.layer.built=!0),super.build(e)}computeOutputShape(e){e=Pe(e);const n=[e[0]].concat(e.slice(2)),s=this.layer.computeOutputShape(n),r=e[1];return[s[0],r].concat(s.slice(1))}call(e,n){return K(()=>(e=be(e),sA((o,a)=>[be(this.layer.call(o,n)),[]],e,[],!1,null,null,!1,!0)[1]))}}jA.className="TimeDistributed";te(jA);function z7(t){xa(oH,"BidirectionalMergeMode",t)}const j7="concat";class BA extends zA{constructor(e){super(e);const n=e.layer.getConfig(),s={};s.className=e.layer.getClassName(),s.config=n,this.forwardLayer=Br(s),n.goBackwards=n.goBackwards!==!0;const r={};if(r.className=e.layer.getClassName(),r.config=n,this.backwardLayer=Br(r),this.forwardLayer.name="forward_"+this.forwardLayer.name,this.backwardLayer.name="backward_"+this.backwardLayer.name,this.mergeMode=e.mergeMode===void 0?j7:e.mergeMode,z7(this.mergeMode),e.weights)throw new Ie("weights support is not implemented for Bidirectional layer yet.");this._stateful=e.layer.stateful,this.returnSequences=e.layer.returnSequences,this.returnState=e.layer.returnState,this.supportsMasking=!0,this._trainable=!0,this.inputSpec=e.layer.inputSpec,this.numConstants=null}get trainable(){return this._trainable}set trainable(e){this._trainable=e,this.forwardLayer!=null&&(this.forwardLayer.trainable=e),this.backwardLayer!=null&&(this.backwardLayer.trainable=e)}getWeights(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())}setWeights(e){const n=e.length,s=Math.floor(n/2);this.forwardLayer.setWeights(e.slice(0,s)),this.backwardLayer.setWeights(e.slice(s))}computeOutputShape(e){let n=this.forwardLayer.computeOutputShape(e);Array.isArray(n)&&Array.isArray(n[0])||(n=[n]),n=n;let s,r,i;return this.returnState&&(i=n.slice(1)),s=n[0],s=s,this.mergeMode==="concat"?(s[s.length-1]*=2,r=[s]):this.mergeMode==null?r=[s,s.slice()]:r=[s],this.returnState?this.mergeMode==null?r.concat(i).concat(i.slice()):[s].concat(i).concat(i.slice()):Sn(r)}apply(e,n){let s=n==null?null:n.initialState,r=n==null?null:n.constants;n==null&&(n={});const i=nA(e,s,r,this.numConstants);if(e=i.inputs,s=i.initialState,r=i.constants,Array.isArray(e)&&(s=e.slice(1),e=e[0]),(s==null||s.length===0)&&r==null)return super.apply(e,n);const o=[],a=[];if(s!=null){const c=s.length;if(c%2>0)throw new O("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");n.initialState=s,o.push(...s);const u=s.map(d=>new At({shape:d.shape}));this.forwardLayer.stateSpec=u.slice(0,c/2),this.backwardLayer.stateSpec=u.slice(c/2),a.push(...u)}if(r!=null)throw new Ie("Support for constants in Bidirectional layers is not implemented yet.");const l=o[0]instanceof Sr;for(const c of o)if(c instanceof Sr!==l)throw new O("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors");if(l){const c=[e].concat(o),u=this.inputSpec.concat(a),d=this.inputSpec;this.inputSpec=u;const h=super.apply(c,n);return this.inputSpec=d,h}else return super.apply(e,n)}call(e,n){return K(()=>{const s=n.initialState;let r,i;if(s==null)r=this.forwardLayer.call(e,n),i=this.backwardLayer.call(e,n);else{const l=s.slice(0,s.length/2),c=s.slice(s.length/2);r=this.forwardLayer.call(e,Object.assign(n,{initialState:l})),i=this.backwardLayer.call(e,Object.assign(n,{initialState:c}))}let o;this.returnState&&(Array.isArray(r)&&(o=r.slice(1).concat(i.slice(1))),r=r[0],i=i[0]),this.returnSequences&&(i=ea(i,1));let a;return this.mergeMode==="concat"?a=vb([r,i]):this.mergeMode==="sum"?a=re(r,i):this.mergeMode==="ave"?a=L(.5,re(r,i)):this.mergeMode==="mul"?a=L(r,i):this.mergeMode==null&&(a=[r,i]),this.returnState?this.mergeMode==null?a.concat(o):[a].concat(o):a})}resetStates(e){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()}build(e){Po(this.forwardLayer.name,()=>{this.forwardLayer.build(e)}),Po(this.backwardLayer.name,()=>{this.backwardLayer.build(e)}),this.built=!0}computeMask(e,n){Array.isArray(n)&&(n=n[0]);let s;if(this.returnSequences?this.mergeMode==null?s=[n,n]:s=n:this.mergeMode==null?s=[null,null]:s=null,this.returnState){const i=this.forwardLayer.states.map(o=>null);return Array.isArray(s)?s.concat(i).concat(i):[s].concat(i).concat(i)}else return s}get trainableWeights(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)}get nonTrainableWeights(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.forwardLayer!=null&&this.forwardLayer.setFastWeightInitDuringBuild(e),this.backwardLayer!=null&&this.backwardLayer.setFastWeightInitDuringBuild(e)}getConfig(){const e={mergeMode:this.mergeMode},n=super.getConfig();return Object.assign(e,n),e}static fromConfig(e,n){const s=Br(n.layer);if(delete n.layer,n.numConstants!=null)throw new Ie("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");const r=n;return r.layer=s,new e(r)}}BA.className="Bidirectional";te(BA);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class WA extends Ee{constructor(e){super(e),this.scale=e.scale,e.offset?this.offset=e.offset:this.offset=0}getConfig(){const e={scale:this.scale,offset:this.offset},n=super.getConfig();return Object.assign(e,n),e}call(e,n){return K(()=>(e=be(e),e.dtype!=="float32"&&(e=vr(e,"float32")),re(L(e,this.scale),this.offset)))}}WA.className="Rescaling";te(WA);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const{resizeBilinear:B7,cropAndResize:W7}=Lr;class VA extends Ee{constructor(e){super(e),this.height=e.height,this.width=e.width}centerCrop(e,n,s,r,i,o,a,l){return K(()=>{let c,u=!1;const d=n/o,h=s/a,p=(r+n)/o,f=(i+s)/a,g=[d,h,p,f],x=[];e.rank===3?(u=!0,c=Yr([e])):c=e;for(let k=0;k<c.shape[0];k++)x.push(g);const y=hE(x,[x.length,4]),v=hu(0,x.length,1,"int32"),w=W7(c,y,v,[r,i],"nearest");return vr(u?be(ta(w)):w,l)})}upsize(e,n,s,r){return K(()=>{const i=B7(e,[n,s]);return vr(i,r)})}call(e,n){return K(()=>{const s=be(e),r=s.dtype,i=s.shape,o=i[i.length-3],a=i[i.length-2];let l=0;o!==this.height&&(l=Math.floor((o-this.height)/2));let c=0;return a!==this.width&&(c=Math.floor((a-this.width)/2),c===0&&(c=1)),l>=0&&c>=0?this.centerCrop(s,l,c,this.height,this.width,o,a,r):this.upsize(e,this.height,this.width,r)})}getConfig(){const e={height:this.height,width:this.width},n=super.getConfig();return Object.assign(e,n),e}computeOutputShape(e){e=Pe(e);const n=e.length-3,s=e.length-2;return e[n]=this.height,e[s]=this.width,e}}VA.className="CenterCrop";te(VA);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function V7(t,e,n,s){let r=be(t);if(r.dtype!=="int32"&&(r=vr(r,"int32")),e==="int")return r;const i=r.shape;if(r.rank===0&&(r=Cn(r,-1)),e==="oneHot"&&r.shape[r.shape.length-1]!==1&&(r=Cn(r,-1)),r.rank>2)throw new O(`When outputMode is not int, maximum output rank is 2 Received outputMode ${e} and input shape ${i} which would result in output rank ${r.rank}.`);const o=["multiHot","oneHot"].includes(e),a=r;let l;if(typeof s<"u"&&e==="count"?l=Ck(a,s,n,o):l=Ck(a,[],n,o),e!=="tfIdf")return l;if(s)return L(l,s);throw new O("When outputMode is 'tfIdf', weights must be provided.")}/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class UA extends Ee{constructor(e){super(e),this.numTokens=e.numTokens,e.outputMode?this.outputMode=e.outputMode:this.outputMode="multiHot"}getConfig(){const e={numTokens:this.numTokens,outputMode:this.outputMode},n=super.getConfig();return Object.assign(e,n),e}computeOutputShape(e){return e=Pe(e),e==null?[this.numTokens]:this.outputMode==="oneHot"&&e[e.length-1]!==1?(e.push(this.numTokens),e):(e[e.length-1]=this.numTokens,e)}call(e,n){return K(()=>{e=be(e),e.dtype!=="int32"&&(e=vr(e,"int32"));let s;if(typeof n.countWeights<"u"){if(this.outputMode!=="count")throw new O(`countWeights is not used when outputMode !== count.
              Received countWeights=${n.countWeights}`);s=be(n.countWeights)}const r=qs(e),i=Lp(e),o=os(this.numTokens,r).bufferSync().get(0),a=fa(i,0).bufferSync().get(0);if(!(o&&a))throw new O(`Input values must be between 0 < values <= numTokens with numTokens=${this.numTokens}`);return V7(e,this.outputMode,this.numTokens,s)})}}UA.className="CategoryEncoding";te(UA);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const U7=["bilinear","nearest"],nC=new Set(U7);class GA extends Ee{constructor(e){if(super(e),this.height=e.height,this.width=e.width,e.interpolation)if(nC.has(e.interpolation))this.interpolation=e.interpolation;else throw new O(`Invalid interpolation parameter: ${e.interpolation} is not implemented`);else this.interpolation="bilinear";this.cropToAspectRatio=!!e.cropToAspectRatio}computeOutputShape(e){e=Pe(e);const n=e[2];return[this.height,this.width,n]}getConfig(){const e={height:this.height,width:this.width,interpolation:this.interpolation,cropToAspectRatio:this.cropToAspectRatio},n=super.getConfig();return Object.assign(e,n),e}call(e,n){return K(()=>{const s=[this.height,this.width];if(this.interpolation==="bilinear")return Lr.resizeBilinear(e,s,!this.cropToAspectRatio);if(this.interpolation==="nearest")return Lr.resizeNearestNeighbor(e,s,!this.cropToAspectRatio);throw new Error(`Interpolation is ${this.interpolation} but only ${[...nC]} are supported`)})}}GA.className="Resizing";te(GA);/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class HA{constructor(e){this.seed=e}next(){if(this.seed!==void 0)return this.seed++}}HA.className="RandomSeed";/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class KA extends Ee{constructor(e){super(e),this.randomGenerator=new HA(e.seed)}getConfig(){const e={seed:this.randomGenerator.seed},n=super.getConfig();return Object.assign(e,n),e}}KA.className="BaseRandomLayer";/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const G7=["bilinear","nearest"],sC=new Set(G7);class qA extends KA{constructor(e){super(e);const{factor:n,interpolation:s="bilinear"}=e;if(this.factor=n,Array.isArray(this.factor)&&this.factor.length===2)this.widthLower=this.factor[0],this.widthUpper=this.factor[1];else if(!Array.isArray(this.factor)&&this.factor>0)this.widthLower=-this.factor,this.widthUpper=this.factor;else throw new O(`Invalid factor: ${this.factor}. Must be positive number or tuple of 2 numbers`);if(this.widthLower<-1||this.widthUpper<-1)throw new O(`factor must have values larger than -1. Got: ${this.factor}`);if(this.widthUpper<this.widthLower)throw new O(`factor cannot have upper bound less than lower bound.
        Got upper bound: ${this.widthUpper}.
        Got lower bound: ${this.widthLower}
      `);if(s)if(sC.has(s))this.interpolation=s;else throw new O(`Invalid interpolation parameter: ${s} is not implemented`)}getConfig(){const e={factor:this.factor,interpolation:this.interpolation},n=super.getConfig();return Object.assign(e,n),e}computeOutputShape(e){e=Pe(e);const n=e[2];return[this.imgHeight,-1,n]}call(e,n){return K(()=>{const s=be(e);this.imgHeight=s.shape[s.shape.length-3];const r=s.shape[s.shape.length-2];this.widthFactor=Dd([1],1+this.widthLower,1+this.widthUpper,"float32",this.randomGenerator.next());let i=this.widthFactor.dataSync()[0]*r;i=Math.round(i);const o=[this.imgHeight,i];switch(this.interpolation){case"bilinear":return Lr.resizeBilinear(e,o);case"nearest":return Lr.resizeNearestNeighbor(e,o);default:throw new Error(`Interpolation is ${this.interpolation}
          but only ${[...sC]} are supported`)}})}}qA.className="RandomWidth";te(qA);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function rC(t){return new Hd(t)}function zc(t){return new Hl(t)}function Ae(t){return new Lb(t)}function ts(t){return new Zm(t)}function H7(t){return new zb(t)}function K7(t){return new Bb(t)}function XA(t){return new jb(t)}function q7(t){return new Ub(t)}function iC(t){return new Wb(t)}function Jp(t){return new Vb(t)}function oC(t){return new Ob(t)}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const X7=q();X7.registerFlag("KEEP_INTERMEDIATE_TENSORS",()=>!1,t=>{t&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */var aC;(function(t){t[t.DT_INVALID=0]="DT_INVALID",t[t.DT_FLOAT=1]="DT_FLOAT",t[t.DT_DOUBLE=2]="DT_DOUBLE",t[t.DT_INT32=3]="DT_INT32",t[t.DT_UINT8=4]="DT_UINT8",t[t.DT_INT16=5]="DT_INT16",t[t.DT_INT8=6]="DT_INT8",t[t.DT_STRING=7]="DT_STRING",t[t.DT_COMPLEX64=8]="DT_COMPLEX64",t[t.DT_INT64=9]="DT_INT64",t[t.DT_BOOL=10]="DT_BOOL",t[t.DT_QINT8=11]="DT_QINT8",t[t.DT_QUINT8=12]="DT_QUINT8",t[t.DT_QINT32=13]="DT_QINT32",t[t.DT_BFLOAT16=14]="DT_BFLOAT16",t[t.DT_QINT16=15]="DT_QINT16",t[t.DT_QUINT16=16]="DT_QUINT16",t[t.DT_UINT16=17]="DT_UINT16",t[t.DT_COMPLEX128=18]="DT_COMPLEX128",t[t.DT_HALF=19]="DT_HALF",t[t.DT_RESOURCE=20]="DT_RESOURCE",t[t.DT_VARIANT=21]="DT_VARIANT",t[t.DT_UINT32=22]="DT_UINT32",t[t.DT_UINT64=23]="DT_UINT64",t[t.DT_FLOAT_REF=101]="DT_FLOAT_REF",t[t.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",t[t.DT_INT32_REF=103]="DT_INT32_REF",t[t.DT_UINT8_REF=104]="DT_UINT8_REF",t[t.DT_INT16_REF=105]="DT_INT16_REF",t[t.DT_INT8_REF=106]="DT_INT8_REF",t[t.DT_STRING_REF=107]="DT_STRING_REF",t[t.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",t[t.DT_INT64_REF=109]="DT_INT64_REF",t[t.DT_BOOL_REF=110]="DT_BOOL_REF",t[t.DT_QINT8_REF=111]="DT_QINT8_REF",t[t.DT_QUINT8_REF=112]="DT_QUINT8_REF",t[t.DT_QINT32_REF=113]="DT_QINT32_REF",t[t.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",t[t.DT_QINT16_REF=115]="DT_QINT16_REF",t[t.DT_QUINT16_REF=116]="DT_QUINT16_REF",t[t.DT_UINT16_REF=117]="DT_UINT16_REF",t[t.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",t[t.DT_HALF_REF=119]="DT_HALF_REF",t[t.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",t[t.DT_VARIANT_REF=121]="DT_VARIANT_REF",t[t.DT_UINT32_REF=122]="DT_UINT32_REF",t[t.DT_UINT64_REF=123]="DT_UINT64_REF"})(aC||(aC={}));var lC;(function(t){(function(e){e[e.LEGACY=0]="LEGACY",e[e.V1=1]="V1",e[e.V2=2]="V2"})(t.CheckpointFormatVersion||(t.CheckpointFormatVersion={}))})(lC||(lC={}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */var cC;(function(t){t[t.FAIL=0]="FAIL",t[t.SHORTEST=1]="SHORTEST",t[t.LONGEST=2]="LONGEST"})(cC||(cC={}));/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pe(t,e){Array.isArray(t)||(t=[t]),t.forEach(n=>{n!=null&&T(n.dtype!=="complex64",()=>`${e} does not support complex64 tensors in the CPU backend.`)})}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Y7=QE;class tg extends d1{nextDataId(){return tg.nextDataId++}constructor(){super(),this.blockSize=48,this.firstUse=!0,this.data=new yT(this,ir())}write(e,n,s){this.firstUse&&(this.firstUse=!1,q().get("IS_NODE")&&Xn(`
============================
Hi, looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, visit https://github.com/tensorflow/tfjs-node for more details. 
============================`));const r={id:this.nextDataId()};return this.data.set(r,{values:e,dtype:s,refCount:1}),r}makeTensorInfo(e,n,s){let r;if(n==="string"&&s!=null&&s.length>0&&Du(s[0])){const i=s.map(o=>ji(o));r=this.write(i,e,n)}else r=this.write(s,e,n);return{dataId:r,shape:e,dtype:n}}refCount(e){return this.data.has(e)?this.data.get(e).refCount:0}incRef(e){const n=this.data.get(e);n.refCount++}decRef(e){if(this.data.has(e)){const n=this.data.get(e);n.refCount--}}move(e,n,s,r,i){this.data.set(e,{values:n,dtype:r,refCount:i})}numDataIds(){return this.data.numDataIds()}async read(e){return this.readSync(e)}readSync(e){const{dtype:n,complexTensorInfos:s}=this.data.get(e);if(n==="complex64"){const r=this.readSync(s.real.dataId),i=this.readSync(s.imag.dataId);return Qr(r,i)}return gj(this.data.get(e).values,n)}bufferSync(e){const n=this.readSync(e.dataId);if(e.dtype==="string")try{const s=n.map(r=>Gi(r));return $e(e.shape,e.dtype,s)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return $e(e.shape,e.dtype,n)}makeOutput(e,n,s){return ir().makeTensorFromTensorInfo(this.makeTensorInfo(n,s,e),this)}disposeData(e,n=!1){if(this.data.has(e)){if(this.data.get(e).refCount--,!n&&this.data.get(e).refCount>0)return!1;const{complexTensorInfos:s}=this.data.get(e);s!=null&&(this.disposeData(s.real.dataId,!0),this.disposeData(s.imag.dataId,!0)),this.data.delete(e)}return!0}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}async time(e){const n=kn();return e(),{kernelMs:kn()-n}}memory(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}}where(e){pe([e],"where");const n=this.readSync(e.dataId);return Y7(e.shape,n)}dispose(){}floatPrecision(){return 32}epsilon(){return super.epsilon()}}tg.nextDataId=0;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YA(t){const e=new Float32Array(t.length);for(let n=0;n<t.length;++n)e[n]=Math.abs(t[n]);return e}const Q7=t=>{const{x:e}=t.inputs,n=t.backend;pe(e,"abs");let s=new Float32Array(J(e.shape));const r=n.data.get(e.dataId).values;return s=YA(r),n.makeOutput(s,e.shape,e.dtype)},J7={kernelName:Ff,backendName:"cpu",kernelFunc:Q7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ct(t){return(e,n,s,r,i)=>{const o=Se(e,n),a=o.length,l=me(o),c=J(o),u=tn(i,c),d=e.length,h=n.length,p=me(e),f=me(n),g=bl(e,o),x=bl(n,o);if(g.length+x.length===0)for(let y=0;y<u.length;++y)u[y]=t(s[y%s.length],r[y%r.length]);else for(let y=0;y<u.length;++y){const v=Ml(y,a,l),b=v.slice(-d);g.forEach(I=>b[I]=0);const w=gr(b,d,p),k=v.slice(-h);x.forEach(I=>k[I]=0);const S=gr(k,h,f);u[y]=t(s[w],r[S])}return[u,o]}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function On(t){const{inputs:e,backend:n}=t,{real:s,imag:r}=e,i=n.data.get(s.dataId).values,o=n.data.get(r.dataId).values,a=n.makeTensorInfo(s.shape,"complex64"),l=n.data.get(a.dataId);return l.complexTensorInfos={real:n.makeTensorInfo(s.shape,"float32",i),imag:n.makeTensorInfo(r.shape,"float32",o)},a}const Z7={kernelName:I1,backendName:"cpu",kernelFunc:On};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zp(t,e,n="float32"){if(n==="complex64"){const r=Zp(t,e,"float32"),i=Zp(t,e,"float32");return On({inputs:{real:r,imag:i},backend:t})}const s=nn(J(e),n);return t.makeTensorInfo(e,n,s)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ir(t){const{inputs:e,backend:n}=t,{x:s}=e;return n.incRef(s.dataId),{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}const e9={kernelName:ed,backendName:"cpu",kernelFunc:Ir};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ra(t){const{inputs:e,backend:n}=t,{input:s}=e,r=n.data.get(s.dataId).complexTensorInfos.real,i=n.data.get(r.dataId).values;return n.makeTensorInfo(r.shape,r.dtype,i)}const t9={kernelName:X1,backendName:"cpu",kernelFunc:ra};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QA(t,e,n,s){if(s==="int32"){const r=Int32Array.from(t);return[e,"int32",r]}if(s==="bool"){const r=pa([0],n),[i,o]=Ct((a,l)=>a!==l?1:0)(e,[],t,r,"bool");return[o,"bool",i]}throw new Error(`Error in Cast: failed to cast ${n} to ${s}`)}function Yi(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{dtype:i}=s;if(i==="complex64"){if(r.dtype==="complex64")return Ir({inputs:{x:r},backend:n});const u=Zp(n,r.shape,r.dtype),d=Yi({inputs:{x:r},backend:n,attrs:{dtype:"float32"}}),h=On({inputs:{real:d,imag:u},backend:n});return n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(d),h}if(r.dtype==="complex64"){const u=ra({inputs:{input:r},backend:n}),d=Yi({inputs:{x:u},backend:n,attrs:{dtype:i}});return n.disposeIntermediateTensorInfo(u),d}if(!vT(r.dtype,i)){const u=Ir({inputs:{x:r},backend:n});return{dataId:u.dataId,shape:u.shape,dtype:i}}const o=n.data.get(r.dataId).values,[a,l,c]=QA(o,r.shape,r.dtype,i);return n.makeTensorInfo(a,l,c)}const n9={kernelName:Bu,backendName:"cpu",kernelFunc:Yi};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ot(t,e,n,s){return n==null?({inputs:r,backend:i})=>{const{a:o,b:a}=r,l=i;pe([o,a],t);const c=l.data.get(o.dataId).values,u=l.data.get(a.dataId).values,d=o.dtype==="string"?Jr(c):c,h=o.dtype==="string"?Jr(u):u,p=s||o.dtype,[f,g]=e(o.shape,a.shape,d,h,p);return l.makeTensorInfo(g,p,f)}:({inputs:r,backend:i})=>{const{a:o,b:a}=r,l=i;if(o.dtype==="complex64"||a.dtype==="complex64"){const c=Yi({inputs:{x:o},backend:l,attrs:{dtype:"complex64"}}),u=l.data.get(c.dataId),d=u.complexTensorInfos.real,h=u.complexTensorInfos.imag,p=l.data.get(d.dataId).values,f=l.data.get(h.dataId).values,g=Yi({inputs:{x:a},backend:l,attrs:{dtype:"complex64"}}),x=l.data.get(g.dataId),y=x.complexTensorInfos.real,v=x.complexTensorInfos.imag,b=l.data.get(y.dataId).values,w=l.data.get(v.dataId).values,[k,S,I]=n(o.shape,a.shape,p,f,b,w),C=l.makeTensorInfo(I,"float32",k),$=l.makeTensorInfo(I,"float32",S),R=On({inputs:{real:C,imag:$},backend:l});return l.disposeIntermediateTensorInfo(c),l.disposeIntermediateTensorInfo(g),l.disposeIntermediateTensorInfo(C),l.disposeIntermediateTensorInfo($),R}else{const c=l.data.get(o.dataId).values,u=l.data.get(a.dataId).values,d=s||o.dtype,[h,p]=e(o.shape,a.shape,c,u,d);return l.makeTensorInfo(p,d,h)}}}function Gb(t){return(e,n,s,r,i,o)=>{const a=Se(e,n),l=J(a),c=a.length,u=me(a),d=tn("float32",l),h=tn("float32",l),p=bl(e,a),f=bl(n,a),g=Qr(s,r),x=Qr(i,o),y=e.length,v=me(e),b=n.length,w=me(n);if(p.length+f.length===0)for(let k=0;k<d.length;k++){const S=k%g.length,I=k%x.length,C=t(g[S*2],g[S*2+1],x[I*2],x[I*2+1]);d[k]=C.real,h[k]=C.imag}else for(let k=0;k<d.length;k++){const S=Ml(k,c,u),I=S.slice(-y);p.forEach(M=>I[M]=0);const C=gr(I,y,v),$=S.slice(-b);f.forEach(M=>$[M]=0);const R=gr($,b,w),_=t(g[C*2],g[C*2+1],x[R*2],x[R*2+1]);d[k]=_.real,h[k]=_.imag}return[d,h,a]}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JA=Ct((t,e)=>t+e),s9=Gb((t,e,n,s)=>({real:t+n,imag:e+s})),Sl=Ot(Ll,JA,s9),r9={kernelName:Ll,backendName:"cpu",kernelFunc:Sl};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hb(t,e,n,s,r){const i=J(s),o=nn(r,n);for(let a=0;a<t.length;a++){const l=t[a];if(l<0)throw new Error("Input x must be non-negative!");l>=r||(i>0?o[l]+=e[a]:o[l]+=1)}return o}function ZA(t,e,n,s=!1){const r=t.shape[0],i=t.shape[1],o=$e([r,n],e.dtype);for(let a=0;a<r;a++)for(let l=0;l<i;l++){const c=t.get(a,l);if(c<0)throw new Error("Input x must be non-negative!");c>=n||(s?o.set(1,a,c):e.size>0?o.set(o.get(a,c)+e.get(a,l),a,c):o.set(o.get(a,c)+1,a,c))}return o}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const e_=Ct((t,e)=>t&e),i9=Ot(S1,e_),o9={kernelName:S1,backendName:"cpu",kernelFunc:i9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tr(t){return(e,n,s)=>{const r=xt(n,e.length);for(let i=0;i<e.length;++i)r[i]=t(e[i],s);return r}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function We(t,e,n){const s=Tr(e);return ho(t,s,n)}function ho(t,e,n){return({inputs:s,attrs:r,backend:i})=>{const{x:o}=s;pe(o,t);const a=i,l=a.data.get(o.dataId).values;let c;if(o.dtype==="string"){if(!Array.isArray(l))throw new Error("String tensor's value was not an instance of Array");c=Jr(l)}else c=l;const u=n||o.dtype,d=e(c,u,r);return a.makeTensorInfo(o.shape,u,d)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const t_=Tr(t=>Math.ceil(t)),a9=ho(Wu,t_),l9={kernelName:Wu,backendName:"cpu",kernelFunc:a9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function n_(t,e,n,s){const r=xt(n,J(e));if(s&&n!=="string"){let i=0;t.forEach(o=>{const a=J(o.shape);r.set(o.vals,i),i+=a})}else{let i=0;t.forEach(o=>{const a=n==="string"?Jr(o.vals):o.vals;let l=0;for(let c=0;c<o.shape[0];++c){const u=c*e[1]+i;for(let d=0;d<o.shape[1];++d)r[u+d]=a[l++]}i+=o.shape[1]})}return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const s_=Ct((t,e)=>t===e?1:0),r_=Ot(Xf,s_,null,"bool"),c9={kernelName:Xf,backendName:"cpu",kernelFunc:r_};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const i_=Tr(t=>Math.exp(t)),o_=ho(Xu,i_,"float32"),u9={kernelName:Xu,backendName:"cpu",kernelFunc:o_};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const a_=Tr(t=>Math.expm1(t)),d9=ho(Yu,a_),h9={kernelName:Yu,backendName:"cpu",kernelFunc:d9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const l_=Tr(t=>Math.floor(t)),p9=ho(Qu,l_),f9={kernelName:Qu,backendName:"cpu",kernelFunc:p9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const c_=Ct((t,e)=>Math.floor(t/e)),m9=Ot(Ju,c_,null,"int32"),g9={kernelName:Ju,backendName:"cpu",kernelFunc:m9};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function u_(t,e,n,s,r,i,o,a,l){const c=$e([s,i],n);for(let u=0;u<s;u++){const d=[];let h=0;for(let p=0;p<r;p++){const f=t[u*r+p];h+=f*o[p],d.push(f)}if(h<0||h>=l/i)throw new Error(`Invalid indices: ${d} does not index into ${a}`);for(let p=0;p<i;p++)c.values[u*i+p]=e.get(...e.indexToLoc(h*i+p))}return c}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function d_(t,e,n){const s=$e(n,t.dtype);for(let r=0;r<s.size;++r){const o=s.indexToLoc(r).slice(),a=o[0],l=o[2],c=e.locToIndex([a,l]);o[2]=e.values[c];const u=t.locToIndex(o);0<=u&&u<t.values.length&&(s.values[r]=t.values[u])}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const h_=Ct((t,e)=>t>e?1:0),y9=Ot(Zf,h_,null,"bool"),x9={kernelName:Zf,backendName:"cpu",kernelFunc:y9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const p_=Ct((t,e)=>t>=e?1:0),v9=Ot(Zu,p_,null,"bool"),b9={kernelName:Zu,backendName:"cpu",kernelFunc:v9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const f_=Ct((t,e)=>t<e?1:0),w9=Ot(tm,f_,null,"bool"),k9={kernelName:tm,backendName:"cpu",kernelFunc:w9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const m_=Ct((t,e)=>t<=e?1:0),C9=Ot(nm,m_,null,"bool"),S9={kernelName:nm,backendName:"cpu",kernelFunc:C9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function g_(t,e,n){const s=(e-t)/(n-1),r=nn(n,"float32");r[0]=t;for(let i=1;i<r.length;i++)r[i]=r[i-1]+s;return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const y_=Tr(t=>Math.log(t)),I9=ho(rd,y_),$9={kernelName:rd,backendName:"cpu",kernelFunc:I9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function x_(t,e,n,s){const r=tn(s,J(n));for(let i=0;i<r.length;++i){const o=i*e;let a=t[o];for(let l=0;l<e;++l){const c=t[o+l];(Number.isNaN(c)||c>a)&&(a=c)}r[i]=a}return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const v_=Ct((t,e)=>Math.max(t,e)),T9=Ot(od,v_),E9={kernelName:od,backendName:"cpu",kernelFunc:T9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const b_=Ct((t,e)=>Math.min(t,e)),R9=Ot(ad,b_),N9={kernelName:ad,backendName:"cpu",kernelFunc:R9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kb=Ct((t,e)=>t*e),A9=Gb((t,e,n,s)=>({real:t*n-e*s,imag:t*s+e*n})),ng=Ot(cd,Kb,A9),_9={kernelName:cd,backendName:"cpu",kernelFunc:ng};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function w_(t,e,n){const s=ro(-1,n);return Kb([],e,s,t,n)}function D9(t){const{inputs:e,backend:n}=t,{x:s}=e;pe(s,"neg");const r=n.data.get(s.dataId).values,[i,o]=w_(r,s.shape,s.dtype);return n.makeTensorInfo(o,s.dtype,i)}const F9={kernelName:pm,backendName:"cpu",kernelFunc:D9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const k_=Ct((t,e)=>t!==e?1:0),O9=Ot(fm,k_,null,"bool"),P9={kernelName:fm,backendName:"cpu",kernelFunc:O9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qb(t,e,n,s,r){const i=e.length,o=J(e),a=me(e),l=me(r),c=tn(n,J(r));for(let u=0;u<o;++u){const d=Ml(u,i,a),h=new Array(d.length);for(let f=0;f<h.length;f++)h[f]=d[s[f]];const p=gr(h,i,l);c[p]=t[u]}return c}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rn(t){const{inputs:e,attrs:n,backend:s}=t,{x:r}=e,{perm:i}=n;pe(r,"transpose");const o=r.shape.length,a=new Array(o);for(let d=0;d<a.length;d++)a[d]=r.shape[i[d]];const l=s.data.get(r.dataId).values,c=qb(l,r.shape,r.dtype,i,a);return{dataId:s.write(c,a,r.dtype),shape:a,dtype:r.dtype}}const M9={kernelName:tl,backendName:"cpu",kernelFunc:Rn};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function C_(t,e,n,s){const[r,i]=Wt(t,s),o=Vn(e,"int32"),a=nn(J(r),o),l=J(i);for(let c=0;c<a.length;++c){const u=c*l;let d=1;for(let h=0;h<l;++h)d*=n[u+h];a[c]=d}return{outVals:a,outShape:r,outDtype:o}}function L9(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:i,keepDims:o}=s;pe(r,"prod");const a=r.shape.length,l=Te(i,r.shape),c=dt(l,a);let u=l,d=r;const h=[];c!=null&&(d=Rn({inputs:{x:r},backend:n,attrs:{perm:c}}),h.push(d),u=wt(u.length,a));const p=n.data.get(d.dataId).values,{outVals:f,outShape:g,outDtype:x}=C_(d.shape,d.dtype,p,u);let y=g;return o&&(y=Tt(g,l)),h.forEach(v=>n.disposeIntermediateTensorInfo(v)),n.makeTensorInfo(y,x,f)}const z9={kernelName:bm,backendName:"cpu",kernelFunc:L9};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function j9(t,e,n){t.forEach((s,r)=>{if(s<0||s>=n){const i=Ml(r,e.length,me(e)).join(",");throw new Error(`indices[${i}] = ${s} is not in [0, ${n})`)}})}function B9(t,e){for(let n=0;n<t.length;++n){const s=t[n],r=n===t.length-1?e:t[n+1].length;if(s.length===0)throw new Error("Ragged splits may not be empty");if(s[0]<0)throw new Error("Ragged splits must be non-negative");if(s[s.length-1]>r)throw new Error("Ragged splits must not point past values");for(let i=1;i<s.length;++i)if(s[i-1]>s[i])throw new Error("Ragged splits must be sorted in ascending order")}}function W9(t,e,n,s){const r=[];let i=0;const o=e.length-1+n.length,a=new Array(o).fill(null).map(()=>[0]);B9(n,s);let l=1;for(let c=0;c<e.length-1;++c){l*=e[c];const u=e[c+1];for(let d=1;d<l+1;++d)a[c].push(d*u)}for(let c=0;c<t.length;++c){let u=t[c],d=t[c]+1;for(let h=0;h<n.length;++h){const p=n[h],f=h+e.length-1;if(f>=0){const g=a[f],x=g[g.length-1]-p[u];for(let y=u;y<d;++y)a[f].push(p[y+1]+x)}u=p[u],d=p[d]}d!==u&&(r.push([u,d]),i+=d-u)}return{outSplits:a,valueSlices:r,numValues:i}}function V9(t){const e=[];for(let n=0;n<t.length;++n){const s=t[n].length,r=xt("int32",s);e.push(r),t[n].forEach((i,o)=>r[o]=i)}return e}function uC(t,e){const n=t.slice(0,e);for(;n.length<e;)n.push(1);for(let s=e;s<t.length;s++)n[e-1]*=t[s];return n}function U9(t,e,n,s,r,i){const o=uC(e,2)[1],a=uC(i,2)[1];let l=0;for(const c of n)for(let u=c[0];u<c[1];++u){for(let d=0;d<s;++d)r[l*a+d]=t[u*o+d];++l}}function G9(t,e,n,s,r){const i=e.slice();i[0]=r;const o=xt(n,J(i)),a=t.length,l=a===0?0:a/e[0];return U9(t,e,s,l,o,i),[o,i]}function S_(t,e,n,s,r,i,o,a){if(t.length===0)throw new Error("paramsNestedSplits must be non empty");if(e[0].length===0)throw new Error("Split tensors must not be scalars");const l=e[0][0]-1;if(j9(i,o,l),s.length===0)throw new Error("params.rank must be nonzero");const c=s[0],{outSplits:u,valueSlices:d,numValues:h}=W9(i,o,t,c),p=V9(u),f=G9(n,s,r,d,h);return[p,f[0],f[1]]}/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dC=2147483647;function I_(t,e,n,s,r,i,o){if(e.length>1)throw new Error("starts must be a scalar or vector");if(r.length>1)throw new Error("limits must be a scalar or vector");if(o.length>1)throw new Error("deltas must be a scalar or vector");const a=e.length===0,l=r.length===0,c=o.length===0,u=[];a||u.push(e[0]),l||u.push(r[0]),c||u.push(o[0]);for(let x=1;x<u.length;++x)if(u[x]!==u[x-1])throw new Error("starts, limits, and deltas must have the same shape");const d=u.length===0?1:u[0],h=xt("int32",d+1);h[0]=0;for(let x=0;x<d;++x){const y=a?t[0]:t[x],v=l?s[0]:s[x],b=c?i[0]:i[x];if(b===0)throw new Error("Requires delta != 0");let w;if(b>0&&v<y||b<0&&v>y)w=0;else if(w=Math.ceil(Math.abs((v-y)/b)),w>dC)throw new Error(`Requires ((limit - start) / delta) <= ${dC}`);h[x+1]=h[x]+w}const p=h[d],f=xt(n,p);let g=0;for(let x=0;x<d;++x){const y=h[x+1]-h[x];let v=a?t[0]:t[x];const b=c?i[0]:i[x];for(let w=0;w<y;++w)f[g++]=v,v+=b}return[h,f]}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var cs=js;class ef{constructor(e,n,s,r,i,o,a,l,c,u){this.shape=e,this.shapeShape=n,this.values=s,this.valuesShape=r,this.valuesDType=i,this.defaultValue=o,this.defaultValueShape=a,this.rowPartitionValues=l,this.rowPartitionValuesShapes=c,this.rowPartitionTypes=gR(u),this.raggedRank=yR(this.rowPartitionTypes)}getRowPartitionTypeByDimension(e){return this.rowPartitionTypes[0]===cs.FIRST_DIM_SIZE?this.rowPartitionTypes[e+1]:this.rowPartitionTypes[e]}getRowPartitionTensor(e){return this.rowPartitionTypes[0]===cs.FIRST_DIM_SIZE?this.rowPartitionValues[e+1]:this.rowPartitionValues[e]}getMaxWidth(e){const n=this.getRowPartitionTensor(e-1);switch(this.getRowPartitionTypeByDimension(e-1)){case cs.VALUE_ROWIDS:return ef.getMaxWidthValueRowID(n);case cs.ROW_SPLITS:return ef.getMaxWidthRowSplit(n);default:throw new Error(`Cannot handle partition type ${cs[this.getRowPartitionTypeByDimension(e-1)]}`)}}static getMaxWidthRowSplit(e){const n=e.length;if(n===0||n===1)return 0;let s=0;for(let r=0;r<n-1;++r){const i=e[r+1]-e[r];i>s&&(s=i)}return s}static getMaxWidthValueRowID(e){const n=e.length;if(n===0)return 0;let s=0,r=e[0],i=0;for(let o=1;o<n;++o){const a=e[o];a!==r&&(r=a,i=Math.max(o-s,i),s=o)}return Math.max(n-s,i)}tensorShapeFromTensor(e,n,s=!0){if(n.length===0){if(e[0]===-1)return[];throw new Error("The only valid scalar shape tensor is the fully unknown shape specified as -1.")}return pC(e,s)}calculateOutputSize(e){const n=this.valuesShape,s=this.defaultValueShape;xR(s,n);const r=this.tensorShapeFromTensor(this.shape,this.shapeShape),o=mR(this.raggedRank,r,n);o[0]<0&&(o[0]=e);for(let a=1;a<=this.raggedRank;++a)o[a]<0&&(o[a]=this.getMaxWidth(a));return o}calculateFirstParentOutputIndex(e,n,s){const r=Math.min(e,s),i=[];let o=0;for(let a=0;a<r;++a,o+=n)i.push(o);for(let a=r;a<e;++a)i.push(-1);return T(i.length===e,()=>"Final length of result must be equal to firstDimension."),i}calculateOutputIndexRowSplit(e,n,s,r){const i=e.length,o=[];for(let a=0;a<i-1;++a){const l=e[a+1]-e[a];let c=Math.min(r,l),u=n[a];u===-1&&(c=0);for(let d=0;d<c;++d)o.push(u),u+=s;for(let d=0;d<l-c;++d)o.push(-1)}if(i>0&&o.length!==e[i-1])throw new Error("Invalid row split size.");return o}calculateOutputIndexValueRowID(e,n,s,r){const i=e.length,o=[];if(i===0)return[];let a=0,l=e[0];if(l>=n.length)throw new Error(`Got currentValueRowId=${l}, which is not less than ${n.length}`);let c=n[l];o.push(c);for(let u=1;u<i;++u){const d=e[u];if(d===l)c>=0&&(++a,a<r?c+=s:c=-1);else{if(a=0,l=d,d>=n.length)throw new Error(`Got nextValueRowId=${d} which is not less than ${n.length}`);c=n[d]}o.push(c)}if(o.length!==e.length)throw new Error("Invalid row ids.");return o}calculateOutputIndex(e,n,s,r){const i=this.getRowPartitionTensor(e),o=this.getRowPartitionTypeByDimension(e);switch(o){case cs.VALUE_ROWIDS:return this.calculateOutputIndexValueRowID(i,n,s,r);case cs.ROW_SPLITS:if(i.length-1>n.length)throw new Error(`Row partition size is greater than output size: ${i.length-1} > ${n.length}`);return this.calculateOutputIndexRowSplit(i,n,s,r);default:throw new Error(`Unsupported partition type: ${cs[o]}`)}}getFirstDimensionSize(){const e=this.rowPartitionValues[0];if(this.rowPartitionTypes.length===0)throw new Error("No row_partition_types given.");const n=this.rowPartitionTypes[0];switch(n){case cs.FIRST_DIM_SIZE:return e[0];case cs.VALUE_ROWIDS:throw new Error("Cannot handle VALUE_ROWIDS in first dimension.");case cs.ROW_SPLITS:return this.rowPartitionValuesShapes[0][0]-1;default:throw new Error(`Cannot handle type ${cs[n]}`)}}compute(){if(this.rowPartitionValues[0].length<=0)throw new Error("Invalid first partition input. Tensor requires at least one element.");const n=this.getFirstDimensionSize(),s=this.calculateOutputSize(n),r=new Array(this.raggedRank+1);r[r.length-1]=1;for(let l=r.length-2;l>=0;--l)r[l]=r[l+1]*s[l+1];const i=pC(s,!1),o=xt(this.valuesDType,J(i));if(r[0]*s[0]>0){let l=this.calculateFirstParentOutputIndex(n,r[0],s[0]);for(let c=1;c<=this.raggedRank;++c)l=this.calculateOutputIndex(c-1,l,r[c],s[c]);this.setOutput(this.raggedRank,l,o,i)}return[i,o]}setOutput(e,n,s,r){if(s.length===0)return;const i=this.values,o=s;let a=r.slice();a=a.slice(e+1);const l=J(a),c=n.length;let u=this.defaultValue;if(u.length!==l&&u.length!==1){const f=this.defaultValueShape;K(()=>{const g=U(u,f);u=Mc(g,a).dataSync()})}let d=0,h=0,p=0;for(let f=0;f<=c;++f){let g=f<c?n[f]:-1;if(g===p){++p;continue}if(h<p){const x=i.subarray(d*l),y=o.subarray(h*l),v=(p-h)*l;hC(y,x,v)}if(f>=c){const x=s.length;g=Math.floor(x/l)}if(g>p)if(this.defaultValue.length===1)o.subarray(p*l,g*l).fill(this.defaultValue[0]),p=g;else for(;g>p;){const x=o.slice(p*l);hC(x,u,l),++p}g<0?(d=f+1,h=p):(d=f,h=p,p=h+1)}}}function hC(t,e,n){for(let s=0;s<n;s++)t[s]=e[s]}function pC(t,e){const n=[];for(let s of t){if(s<0){if(!e)throw new Error(`Dimension ${s} must be >= 0`);if(s<-1)throw new Error(`Dimension ${s} must be >= -1`);s=-1}n.push(s)}return n}function $_(t,e,n,s,r,i,o,a,l,c){return new ef(t,e,n,s,r,i,o,a,l,c).compute()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function T_(t,e,n,s){const r=t===e,i=t<e&&n<0,o=e<t&&n>1;if(r||i||o)return nn(0,s);const a=Math.abs(Math.ceil((e-t)/n)),l=nn(a,s);e<t&&n===1&&(n=-1),l[0]=t;for(let c=1;c<l.length;c++)l[c]=l[c-1]+n;return l}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const E_=Tr(t=>1/Math.sqrt(t)),H9=ho(md,E_),K9={kernelName:md,backendName:"cpu",kernelFunc:H9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ao(t,e,n,s,r,i,o,a,l,c){const u=[s/r,r],d=t.values,h=e.values;if(s===0)return $e(n,e.dtype);const p=l instanceof Kt?l:$e(u,e.dtype);typeof l=="string"||typeof l=="number"?p.values.fill(l):typeof l=="boolean"&&p.values.fill(+l);for(let f=0;f<i;f++){const g=[];let x=0;for(let y=0;y<o;y++){const v=d[f*o+y];g.push(v),x+=v*a[y]}if(x<0||x>=s/r)throw new Error(`Invalid indices: ${g} does not index into ${n}`);for(let y=0;y<r;y++)c?p.values[x*r+y]+=h[f*r+y]:p.values[x*r+y]=e.rank===0?h[0]:h[f*r+y]}return p}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const q9=Tr(t=>1/(1+Math.exp(-t))),R_=We(bd,t=>1/(1+Math.exp(-t))),X9={kernelName:bd,backendName:"cpu",kernelFunc:R_};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function N_(t,e,n,s,r){const i=qv(s,e,n),o=J(n),a=me(s);if(i){const d=Xv(e,a);return r==="string"?t.slice(d,d+o):t.subarray(d,d+o)}const l=r==="string"?Jr(t):t,c=$e(s,r,l),u=$e(n,r);for(let d=0;d<u.size;++d){const h=u.indexToLoc(d),p=h.map((f,g)=>f+e[g]);u.set(c.get(...p),...h)}return r==="string"?LR(u.values):u.values}function ia(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{begin:i,size:o}=s;pe(r,"slice");const[a,l]=Bm(r,i,o);Hv(r,a,l);const c=n.data.get(r.dataId).values,u=N_(c,a,l,r.shape,r.dtype);return n.makeTensorInfo(l,r.dtype,u)}const Y9={kernelName:$m,backendName:"cpu",kernelFunc:ia};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function A_(t,e,n,s,r,i,o){const a=e[0],l=i[0],c=new Array(l),u=new Array(a),d=e[1];if(l===0){if(a!==0)throw new Error(IR(a));const x=xt(n,0),y=xt(r,0);return[x,[0,d],y,c,u]}let h=!0,p=0;const f=new Array(l).fill(0);for(let x=0;x<a;++x){const y=t[x*d];if(y<0)throw new Error($R(x,y));if(y>=l)throw new Error(TR(x,y,l));++f[y],h=h&&y>=p,p=y}let g=!0;for(let x=0;x<l;++x){const y=f[x]===0;c[x]=y,g=g&&!y,f[x]=Math.max(f[x],1),x>0&&(f[x]+=f[x-1])}if(g&&h){const x=t,y=s;for(let v=0;v<a;++v)u[v]=v;return[x,[a,d],y,c,u]}else{const x=f[l-1],y=xt(n,x*d),v=xt(r,x),b=new Array(l).fill(0);for(let w=0;w<a;++w){const k=t[w*d],S=b[k],I=(k===0?0:f[k-1])+S;b[k]++;for(let C=0;C<d;++C)y[I*d+C]=t[w*d+C];v[I]=s[w],u[w]=I}for(let w=0;w<l;++w)if(b[w]===0){const S=w===0?0:f[w-1];y[S*d+0]=w;for(let I=1;I<d;++I)y[S*d+I]=0;v[S]=o}return[y,[x,d],v,c,u]}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function __(t,e,n,s,r){const i=J(s),o=e[0],a=r.length,l=[];let c=1,u=-1;for(let x=0;x<a;++x){const y=r[x];if(y===-1){if(u!==-1)throw new Error(ER(u,x));u=x,l.push(1)}else{if(y<0)throw new Error(RR(x,y));c*=y,l.push(y)}}if(u!==-1){if(c<=0)throw new Error(NR());const x=Math.trunc(i/c);if(c*x!==i)throw new Error(AR(s,l));l[u]=x}if(J(l)!==i)throw new Error(_R(s,l));const h=s.length,p=[];if(h>0){p[h-1]=1;for(let x=h-2;x>=0;--x)p[x]=p[x+1]*s[x+1]}const f=[];if(a>0){f[a-1]=1;for(let x=a-2;x>=0;--x)f[x]=f[x+1]*l[x+1]}const g=xt(n,o*a);for(let x=0;x<o;++x){let y=0;for(let v=0;v<h;++v)y+=t[x*h+v]*p[v];for(let v=0;v<a;++v)g[x*a+v]=Math.trunc(y/f[v]),y%=f[v]}return[g,[o,a],l]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xb(t,e,n,s,r,i=!1,o=0){const a=s.length,l=[e[0],t.length/e[0]],c=l[1],d=a>0?r[a-1]+1:0;if(d<0)throw new Error(M0());const h=e.slice();h[0]=d;const p=h.reduce((b,w)=>b*w,1),f=xt(n,p);if(a===0)return d>0&&f.fill(o),[f,h];if(d<=0)throw new Error(M0());let g=0,x=1,y=0,v=r[g];for(;;){let b=0;if(x<a){if(b=r[x],v===b){++x;continue}if(v>=b)throw new Error(DR())}if(v<0||v>=d)throw new Error(FR(v,d));v>y&&f.fill(o,y*c,v*c);for(let w=g;w<x;++w){const k=s[w];if(k<0||k>=l[0])throw new Error(OR(w,s[w],l[0]));for(let S=0;S<c;S++)f[v*c+S]+=t[k*c+S]}if(i)for(let w=0;w<c;w++)f[v*c+w]/=x-g;if(g=x,++x,y=v+1,v=b,x>a)break}return y<d&&f.fill(o,y*c,d*c),[f,h]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Q9=Tr(t=>Math.sqrt(t)),J9=We(kd,t=>Math.sqrt(t)),Z9={kernelName:kd,backendName:"cpu",kernelFunc:J9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const D_=Ct((t,e)=>{const n=t-e;return n*n}),eK=Ot(Cd,D_),tK={kernelName:Cd,backendName:"cpu",kernelFunc:eK};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const F_=Tr((t,e)=>{const{pattern:n,replaceGlobal:s,rewrite:r}=e;return t.replace(new RegExp(n,s?"g":""),r)}),nK=ho(Z1,F_),sK={kernelName:Z1,backendName:"cpu",kernelFunc:nK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function O_(t,e,n,s){const r=$e(t,e.dtype);for(let i=0;i<r.size;i++){const o=r.indexToLoc(i),a=new Array(o.length);for(let l=0;l<a.length;l++)a[l]=o[l]*n[l]+s[l];r.set(e.get(...a),...o)}return r}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class rK{constructor(e,n,s,r,i,o){this.separator=ji(e),this.nGramWidths=n,this.leftPad=ji(s),this.rightPad=ji(r),this.padWidth=i,this.preserveShort=o}getPadWidth(e){return Math.min(this.padWidth<0?e-1:this.padWidth,e-1)}getNumNGrams(e,n){const s=this.getPadWidth(n);return Math.max(0,e+2*s-n+1)}createNGrams(e,n,s,r,i,o){for(let a=0;a<i;++a){const l=this.getPadWidth(o),c=Math.max(0,l-a),u=Math.max(0,l-(i-(a+1))),d=o-(c+u),h=n+(c>0?0:a-l);let p=0;p+=c*this.leftPad.length;for(let v=0;v<d;++v)p+=e[h+v].length;p+=u*this.rightPad.length;const f=c+u+d-1;p+=f*this.separator.length,s[r+a]=new Uint8Array(p);const g=s[r+a];let x=0;const y=v=>v.forEach(b=>g[x++]=b);for(let v=0;v<c;++v)y(this.leftPad),y(this.separator);for(let v=0;v<d-1;++v)y(e[h+v]),y(this.separator);if(d>0){y(e[h+d-1]);for(let v=0;v<u;++v)y(this.separator),y(this.rightPad)}else{for(let v=0;v<u-1;++v)y(this.rightPad),y(this.separator);y(this.rightPad)}}}compute(e,n){const s=e.length,r=n.length;if(r>0){let l=n[0];if(l!==0)throw new Error(`First split value must be 0, got ${l}`);for(let c=1;c<r;++c){let u=n[c]>=l;if(u=u&&n[c]<=s,!u)throw new Error(`Invalid split value ${n[c]}, must be in [${l}, ${s}]`);l=n[c]}if(l!==s)throw new Error(`Last split value must be data size. Expected ${s}, got ${l}`)}const i=r-1,o=xt("int32",r);if(s===0||r===0){const l=new Array(s);for(let c=0;c<=i;++c)o[c]=0;return[l,o]}o[0]=0;for(let l=1;l<=i;++l){const c=n[l]-n[l-1];let u=0;this.nGramWidths.forEach(d=>{u+=this.getNumNGrams(c,d)}),this.preserveShort&&c>0&&u===0&&(u=1),o[l]=o[l-1]+u}const a=new Array(o[i]);for(let l=0;l<i;++l){const c=n[l];let u=o[l];if(this.nGramWidths.forEach(d=>{const h=n[l+1]-n[l],p=this.getNumNGrams(h,d);this.createNGrams(e,c,a,u,p,d),u+=p}),this.preserveShort&&u===o[l]){const d=n[l+1]-n[l];if(d===0)continue;const h=d+2*this.padWidth;this.createNGrams(e,c,a,u,1,h)}}return[a,o]}}function P_(t,e,n,s,r,i,o,a){return new rK(n,s,r,i,o,a).compute(t,e)}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iK(t,e,n,s){if(!t.length)return;if(e.length===0){for(let i=0;i<t.length;++i)s.push(t.subarray(i,i+1));return}if(e.length===1){const i=e[0];let o=t.indexOf(i);for(;o!==-1;){const a=t.subarray(0,o);(!n||a.length!==0)&&s.push(a),t=t.subarray(o+1),o=t.indexOf(i)}(!n||t.length!==0)&&s.push(t);return}let r=0;for(let i=0;i<t.length+1;i++)if(i===t.length||e.indexOf(t[i])!==-1){const o=t.subarray(r,i);(!n||o.length!==0)&&s.push(o),r=i+1}}function M_(t,e,n){const s=t.length,r=[];let i=0,o=0;const a=new Array(s);for(let h=0;h<s;++h){const p=r.length;iK(t[h],e,n,r);const f=r.length-p;a[h]=f,i+=f,o=Math.max(o,f)}const l=xt("int32",i*2),c=new Array(i),u=[s,o];let d=0;for(let h=0;h<s;++h)for(let p=0;p<a[h];++p)l[d*2]=h,l[d*2+1]=p,c[d]=r[d],++d;return[l,c,u]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function L_(t,e){const n=xt("int32",t.length);for(let s=0;s<t.length;++s)n[s]=Fj(t[s]).modulo(e).getLowBitsUnsigned();return n}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const z_=Ct((t,e)=>t-e),oK=Gb((t,e,n,s)=>({real:t-n,imag:e-s})),Yb=Ot(Sd,z_,oK),aK={kernelName:Sd,backendName:"cpu",kernelFunc:Yb};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function j_(t,e){const n=new Array(t.rank);for(let r=0;r<n.length;r++)n[r]=t.shape[r]*e[r];const s=$e(n,t.dtype);for(let r=0;r<s.values.length;++r){const i=s.indexToLoc(r),o=new Array(t.rank);for(let l=0;l<o.length;l++)o[l]=i[l]%t.shape[l];const a=t.locToIndex(o);s.values[r]=t.values[a]}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cc=(t,e)=>{const n=e.value-t.value;return n===0?t.index-e.index:n};function B_(t,e,n=0,s=t.length-1){for(;s>n;){if(s-n>600){const a=s-n+1,l=e-n+1,c=Math.log(a),u=.5*Math.exp(2*c/3),d=.5*Math.sqrt(c*u*(a-u)/a)*Math.sign(l-a/2),h=Math.max(n,Math.floor(e-l*u/a+d)),p=Math.min(s,Math.floor(e+(a-l)*u/a+d));B_(t,e,h,p)}const r=t[e];let i=n,o=s;for(Ta(t,n,e),Cc(t[s],r)>0&&Ta(t,n,s);i<o;){for(Ta(t,i,o),i++,o--;Cc(t[i],r)<0;)i=i+1;for(;Cc(t[o],r)>0;)o=o-1}Cc(t[n],r)===0?Ta(t,n,o):(o=o+1,Ta(t,o,s)),o<=e&&(n=o+1),e<=o&&(s=o-1)}}function W_(t,e,n,s,r){const i=e[e.length-1],[o,a]=[t.length/i,i],l=tn(n,o*s),c=tn("int32",o*s);for(let d=0;d<o;d++){const h=d*a,p=t.subarray(h,h+a);let f=new Array(p.length);p.forEach((v,b)=>f[b]={value:v,index:b}),s<f.length&&(B_(f,s),f=f.slice(0,s)),r&&f.sort(Cc);const g=d*s,x=l.subarray(g,g+s),y=c.subarray(g,g+s);for(let v=0;v<s;v++)x[v]=f[v].value,y[v]=f[v].index}const u=e.slice();return u[u.length-1]=s,[$e(u,n,l),$e(u,"int32",c)]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function V_(t,e,n,s){const r=Te(e,n)[0],i=[1,n[0],1];for(let f=0;f<r;f++)i[0]*=n[f];i[1]=n[r];for(let f=r+1;f<n.length;f++)i[2]*=n[f];const o=new Map,a=new Int32Array(n[r]),l=new Kt(i,s,t),c=[],u=i[0]===1&&i[2]===1;for(let f=0;f<n[r];f++){let g;if(u)g=t[f].toString();else{const y=[];for(let v=0;v<i[0];v++)for(let b=0;b<i[2];b++)y.push(l.get(v,f,b));g=y.join(",")}const x=o.get(g);if(x!=null)a[f]=x;else{const y=o.size;o.set(g,y),a[f]=y,c.push(f)}}const d=i.slice();d[1]=o.size;const h=new Kt(d,s);c.forEach((f,g)=>{for(let x=0;x<i[0];x++)for(let y=0;y<i[2];y++)h.set(l.get(x,f,y),x,g,y)});const p=n.slice();return p[r]=d[1],{outputValues:h.values,outputShape:p,indices:a}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lK=Object.freeze(Object.defineProperty({__proto__:null,addImpl:JA,bincountImpl:Hb,bincountReduceImpl:ZA,bitwiseAndImpl:e_,castImpl:QA,ceilImpl:t_,concatImpl:n_,equalImpl:s_,expImpl:i_,expm1Impl:a_,floorDivImpl:c_,floorImpl:l_,gatherNdImpl:u_,gatherV2Impl:d_,greaterEqualImpl:p_,greaterImpl:h_,lessEqualImpl:m_,lessImpl:f_,linSpaceImpl:g_,logImpl:y_,maxImpl:x_,maximumImpl:v_,minimumImpl:b_,multiplyImpl:Kb,negImpl:w_,notEqualImpl:k_,prodImpl:C_,raggedGatherImpl:S_,raggedRangeImpl:I_,raggedTensorToTensorImpl:$_,rangeImpl:T_,rsqrtImpl:E_,scatterImpl:Ao,sigmoidImpl:q9,simpleAbsImpl:YA,sliceImpl:N_,sparseFillEmptyRowsImpl:A_,sparseReshapeImpl:__,sparseSegmentReductionImpl:Xb,sqrtImpl:Q9,squaredDifferenceImpl:D_,staticRegexReplaceImpl:F_,stridedSliceImpl:O_,stringNGramsImpl:P_,stringSplitImpl:M_,stringToHashBucketFastImpl:L_,subImpl:z_,tileImpl:j_,topKImpl:W_,transposeImpl:qb,uniqueImpl:V_},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pE("cpu",()=>new tg,1);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const U_=We(Ku,t=>t>=0?t:Math.exp(t)-1),cK={kernelName:Ku,backendName:"cpu",kernelFunc:U_};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function G_(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{alpha:i}=s;pe([r],"leakyRelu");const o=J(r.shape),a=n.data.get(r.dataId).values,l=tn("float32",o);for(let c=0;c<a.length;c++)l[c]=a[c]<0?i*a[c]:a[c];return n.makeTensorInfo(r.shape,"float32",l)}const uK={kernelName:em,backendName:"cpu",kernelFunc:G_};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dK=Ct((t,e)=>t<0?e*t:t);function H_(t){const{inputs:e,backend:n}=t,{x:s,alpha:r}=e;pe([s,r],"prelu");const i=n.data.get(s.dataId).values,o=n.data.get(r.dataId).values,[a,l]=dK(s.shape,r.shape,i,o,"float32");return n.makeTensorInfo(l,"float32",a)}const hK={kernelName:vm,backendName:"cpu",kernelFunc:H_};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const K_=We(hd,t=>Math.max(0,t)),pK={kernelName:hd,backendName:"cpu",kernelFunc:K_};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const q_=We(pd,t=>Math.min(Math.max(0,t),6)),fK={kernelName:pd,backendName:"cpu",kernelFunc:q_};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tf(t,e,n,s,r){if(n==="linear")return Ir({inputs:{x:e},backend:t});if(n==="relu")return K_({inputs:{x:e},backend:t});if(n==="elu")return U_({inputs:{x:e},backend:t});if(n==="relu6")return q_({inputs:{x:e},backend:t});if(n==="prelu")return H_({inputs:{x:e,alpha:s},backend:t});if(n==="leakyrelu")return G_({inputs:{x:e},backend:t,attrs:{alpha:r}});if(n==="sigmoid")return R_({inputs:{x:e},backend:t});throw new Error(`Activation ${n} has not been implemented for the CPU backend.`)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Je(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{shape:i}=s,o=J(r.shape),a=xT(i,o),l=J(a);T(o===l,()=>`The new shape (${a}) has ${l} elements and the old shape (${r.shape}) has ${o} elements. The new shape and old shape must have the same number of elements.`),n.incRef(r.dataId);const c=n.data.get(r.dataId);if(c.complexTensorInfos!=null){const u=c.complexTensorInfos.real,d=c.complexTensorInfos.imag;u.shape=a,d.shape=a}return{dataId:r.dataId,shape:a,dtype:r.dtype}}const mK={kernelName:wm,backendName:"cpu",kernelFunc:Je};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function X_(t){const{inputs:e,backend:n,attrs:s}=t,{a:r,b:i}=e,{transposeA:o,transposeB:a}=s;pe([r,i],"matMul");const l=r.shape.length,c=i.shape.length,u=o?r.shape[l-2]:r.shape[l-1],d=a?i.shape[c-1]:i.shape[c-2],h=o?r.shape[l-1]:r.shape[l-2],p=a?i.shape[c-2]:i.shape[c-1],f=r.shape.slice(0,-2),g=i.shape.slice(0,-2),x=J(f),y=J(g),b=Se(r.shape.slice(0,-2),i.shape.slice(0,-2)).concat([h,p]);T(u===d,()=>`Error in matMul: inner shapes (${u}) and (${d}) of Tensors with shapes ${r.shape} and ${i.shape} and transposeA=${o} and transposeB=${a} must match.`);const w=o?[x,u,h]:[x,h,u],k=a?[y,p,d]:[y,d,p],S=Je({inputs:{x:r},backend:n,attrs:{shape:w}}),I=Je({inputs:{x:i},backend:n,attrs:{shape:k}}),C=o?S.shape[1]:S.shape[2],$=o?S.shape[2]:S.shape[1],R=a?I.shape[1]:I.shape[2],_=Math.max(x,y),M=n.data.get(S.dataId).values,B=n.data.get(I.dataId).values,A=me(S.shape),F=me(I.shape),[P,H,E]=o?[A[0],1,A[1]]:[A[0],A[1],1],[D,V,X]=a?[1,F[1],F[0]]:[F[1],1,F[0]],Z=$*R,ee=$e([_,$,R],S.dtype),ie=ee.values,j=n.blockSize;for(let Q=0;Q<_;Q++){const ne=Q%x,se=Q%y;for(let le=0;le<$;le+=j){const xe=Math.min(le+j,$);for(let Ce=0;Ce<R;Ce+=j){const _e=Math.min(Ce+j,R);for(let Ke=0;Ke<C;Ke+=j){const ht=Math.min(Ke+j,C);for(let qe=le;qe<xe;qe++)for(let Ve=Ce;Ve<_e;Ve++){let lt=0;for(let st=Ke;st<ht;st++){const Er=M[ne*P+qe*H+st*E],Vt=B[st*D+Ve*V+se*X];lt+=Er*Vt}ie[Q*Z+(qe*R+Ve)]+=lt}}}}}return n.disposeIntermediateTensorInfo(S),n.disposeIntermediateTensorInfo(I),n.makeTensorInfo(b,ee.dtype,ee.values)}const gK={kernelName:zf,backendName:"cpu",kernelFunc:X_};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yK(t){const{inputs:e,backend:n,attrs:s}=t,{a:r,b:i,bias:o,preluActivationWeights:a}=e,{transposeA:l,transposeB:c,activation:u,leakyreluAlpha:d}=s;let h,p,f;const g=[];h=X_({inputs:{a:r,b:i},attrs:{transposeA:l,transposeB:c},backend:n}),o&&(p=Sl({inputs:{a:h,b:o},backend:n}),g.push(h),h=p),u&&(f=tf(n,h,u,a,d),g.push(h),h=f);for(const y of g)n.disposeIntermediateTensorInfo(y);return h}const xK={kernelName:Dp,backendName:"cpu",kernelFunc:yK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vK=We(Fu,t=>Math.acos(t)),bK={kernelName:Fu,backendName:"cpu",kernelFunc:vK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wK=We(Ou,t=>Math.acosh(t)),kK={kernelName:Ou,backendName:"cpu",kernelFunc:wK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CK(t){const{inputs:e,backend:n}=t,s=e;pe(e,"addN");const r=s.map(a=>n.data.get(a.dataId).values),i=$e(s[0].shape,s[0].dtype),o=i.values;for(let a=0;a<s.length;a++){const l=r[a];for(let c=0;c<o.length;c++)o[c]+=l[c]}return n.makeTensorInfo(i.shape,i.dtype,i.values)}const SK={kernelName:x1,backendName:"cpu",kernelFunc:CK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IK(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:i,keepDims:o}=s;pe(r,"all");const a=Te(i,r.shape);let l=a;const c=dt(l,r.shape.length);let u=r;c!=null&&(u=Rn({inputs:{x:r},backend:n,attrs:{perm:c}}),l=wt(l.length,r.shape.length)),Xt("all",l,u.shape.length);const[d,h]=Wt(u.shape,l),p=J(h),f=nn(J(d),u.dtype),g=n.data.get(u.dataId).values;for(let y=0;y<f.length;++y){const v=y*p;let b=g[v];for(let w=0;w<p;++w){const k=g[v+w];b=b&&k}f[y]=b}c!=null&&n.disposeIntermediateTensorInfo(u);const x=n.makeTensorInfo(d,u.dtype,f);if(o){const y=Tt(d,a),v=Je({inputs:{x},backend:n,attrs:{shape:y}});return n.disposeIntermediateTensorInfo(x),v}return x}const $K={kernelName:v1,backendName:"cpu",kernelFunc:IK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TK(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:i,keepDims:o}=s;pe(r,"any");const a=Te(i,r.shape);let l=a;const c=dt(l,r.shape.length);let u=r;c!=null&&(u=Rn({inputs:{x:r},backend:n,attrs:{perm:c}}),l=wt(l.length,r.shape.length)),Xt("any",l,u.shape.length);const[d,h]=Wt(u.shape,l),p=J(h),f=nn(J(d),u.dtype),g=n.data.get(u.dataId).values;for(let y=0;y<f.length;++y){const v=y*p;let b=g[v];for(let w=0;w<p;++w){const k=g[v+w];b=b||k}f[y]=b}c!=null&&n.disposeIntermediateTensorInfo(u);const x=n.makeTensorInfo(d,u.dtype,f);if(o){const y=Tt(d,a),v=Je({inputs:{x},backend:n,attrs:{shape:y}});return n.disposeIntermediateTensorInfo(x),v}return x}const EK={kernelName:b1,backendName:"cpu",kernelFunc:TK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RK(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:i}=s;pe(r,"argMax");let o=Te(i,r.shape);const a=dt(o,r.shape.length);let l=r;const c=[];a!=null&&(l=Rn({inputs:{x:r},backend:n,attrs:{perm:a}}),c.push(l),o=wt(o.length,l.shape.length)),o=[o[0]],Xt("argMax",o,l.shape.length);const[u,d]=Wt(l.shape,o),h=J(u),p=nn(h,"int32"),f=J(d),g=n.data.get(l.dataId).values;for(let x=0;x<p.length;++x){const y=x*f;let v=g[y],b=0;for(let w=0;w<f;++w){const k=g[y+w];k>v&&(v=k,b=w)}p[x]=b}return c.forEach(x=>n.disposeIntermediateTensorInfo(x)),n.makeTensorInfo(u,"int32",p)}const NK={kernelName:Of,backendName:"cpu",kernelFunc:RK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AK(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:i}=s;pe(r,"argMin");let o=Te(i,r.shape);const a=dt(o,r.shape.length);let l=r;const c=[];a!=null&&(l=Rn({inputs:{x:r},backend:n,attrs:{perm:a}}),c.push(l),o=wt(o.length,l.shape.length)),o=[o[0]],Xt("argMin",o,l.shape.length);const[u,d]=Wt(l.shape,o),h=J(u),p=nn(h,"int32"),f=J(d),g=n.data.get(l.dataId).values;for(let x=0;x<p.length;++x){const y=x*f;let v=g[y],b=0;for(let w=0;w<f;++w){const k=g[y+w];k<v&&(v=k,b=w)}p[x]=b}return c.forEach(x=>n.disposeIntermediateTensorInfo(x)),n.makeTensorInfo(u,"int32",p)}const _K={kernelName:Pf,backendName:"cpu",kernelFunc:AK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DK=We(Pu,t=>Math.asin(t)),FK={kernelName:Pu,backendName:"cpu",kernelFunc:DK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OK=We(Mu,t=>Math.asinh(t)),PK={kernelName:Mu,backendName:"cpu",kernelFunc:OK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MK=We(Lu,t=>Math.atan(t)),LK={kernelName:Lu,backendName:"cpu",kernelFunc:MK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zK=Ct((t,e)=>Math.atan2(t,e)),jK=Ot(ju,zK),BK={kernelName:ju,backendName:"cpu",kernelFunc:jK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WK=We(zu,t=>Math.atanh(t)),VK={kernelName:zu,backendName:"cpu",kernelFunc:WK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qb(t,e,n,s,r,i){const o=r.strideHeight,a=r.strideWidth,l=r.dilationHeight,c=r.dilationWidth,u=r.effectiveFilterHeight,d=r.effectiveFilterWidth,h=r.padInfo.top,p=r.padInfo.left,f=i==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,g=$e(r.outShape,n),x=g.values,y=r.outShape[1]*r.outShape[2]*r.outShape[3],v=r.outShape[2]*r.outShape[3],b=r.outShape[3];for(let w=0;w<r.batchSize;++w){const k=w*y,S=w*s[0];for(let I=0;I<r.inChannels;++I)for(let C=0;C<r.outHeight;++C){const $=C*o-h,R=Math.max(0,$),_=Math.min(r.inHeight,u+$),M=k+C*v;for(let B=0;B<r.outWidth;++B){const A=B*a-p,F=Math.max(0,A),P=Math.min(r.inWidth,d+A);let H=f,E=0,D=0;for(let X=R;X<_;X+=l){const Z=S+X*s[1];for(let ee=F;ee<P;ee+=c){const ie=Z+ee*s[2],j=t[ie+I];i==="max"&&j>H?H=j:i==="avg"&&(E+=j,D++)}if(isNaN(H))break}const V=M+B*b+I;x[V]=i==="avg"?E/D:H}}}return g}function Y_(t,e,n,s,r=!1,i=!1){const o=$e(s.outShape,"int32"),a=s.strideHeight,l=s.strideWidth,c=s.dilationHeight,u=s.dilationWidth,d=s.effectiveFilterHeight,h=s.effectiveFilterWidth,p=s.padInfo.top,f=s.padInfo.left,g=$e(e,n,t);for(let x=0;x<s.batchSize;++x)for(let y=0;y<s.inChannels;++y)for(let v=0;v<s.outHeight;++v){const b=v*a-p;let w=b;for(;w<0;)w+=c;const k=Math.min(s.inHeight,d+b);for(let S=0;S<s.outWidth;++S){const I=S*l-f;let C=I;for(;C<0;)C+=u;const $=Math.min(s.inWidth,h+I);let R=Number.NEGATIVE_INFINITY,_=-1;for(let M=w;M<k;M+=c){const B=M-b;for(let A=C;A<$;A+=u){const F=A-I,P=g.get(x,M,A,y);P>R&&(R=P,r?_=i?((x*s.inHeight+M)*s.inWidth+A)*s.inChannels+y:(M*s.inWidth+A)*s.inChannels+y:_=B*h+F)}}o.set(_,x,v,S,y)}}return o}function Q_(t,e,n,s,r,i){const o=r.strideDepth,a=r.strideHeight,l=r.strideWidth,c=r.dilationDepth,u=r.dilationHeight,d=r.dilationWidth,h=r.effectiveFilterDepth,p=r.effectiveFilterHeight,f=r.effectiveFilterWidth,g=r.padInfo.front,x=r.padInfo.top,y=r.padInfo.left,v=i==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,b=$e(r.outShape,n),w=b.values,k=r.outShape[1]*r.outShape[2]*r.outShape[3]*r.outShape[4],S=r.outShape[2]*r.outShape[3]*r.outShape[4],I=r.outShape[3]*r.outShape[4],C=r.outShape[4];for(let $=0;$<r.batchSize;++$){const R=$*k,_=$*s[0];for(let M=0;M<r.inChannels;++M)for(let B=0;B<r.outDepth;++B){const A=B*o-g;let F=A;for(;F<0;)F+=c;const P=Math.min(r.inDepth,h+A),H=R+B*S;for(let E=0;E<r.outHeight;++E){const D=E*a-x;let V=D;for(;V<0;)V+=u;const X=Math.min(r.inHeight,p+D),Z=H+E*I;for(let ee=0;ee<r.outWidth;++ee){const ie=ee*l-y;let j=ie;for(;j<0;)j+=d;const Q=Math.min(r.inWidth,f+ie),ne=Z+ee*C;let se=v,le=0,xe=0;for(let _e=F;_e<P;_e+=c){const Ke=_+_e*s[1];for(let ht=V;ht<X;ht+=u){const qe=Ke+ht*s[2];for(let Ve=j;Ve<Q;Ve+=d){const lt=qe+Ve*s[3],st=t[lt+M];if(i==="max"&&st>se?se=st:i==="avg"&&(le+=st,xe++),isNaN(se))break}if(isNaN(se))break}if(isNaN(se))break}const Ce=ne+M;w[Ce]=i==="avg"?le/Math.max(xe,1):se}}}}return b}function UK(t,e){const n=$e(e.outShape,"int32"),s=e.strideDepth,r=e.strideHeight,i=e.strideWidth,o=e.dilationDepth,a=e.dilationHeight,l=e.dilationWidth,c=e.effectiveFilterDepth,u=e.effectiveFilterHeight,d=e.effectiveFilterWidth,h=e.padInfo.front,p=e.padInfo.top,f=e.padInfo.left;for(let g=0;g<e.batchSize;++g)for(let x=0;x<e.inChannels;++x)for(let y=0;y<e.outDepth;++y){const v=y*s-h;let b=v;for(;b<0;)b+=o;const w=Math.min(e.inDepth,c+v);for(let k=0;k<e.outHeight;++k){const S=k*r-p;let I=S;for(;I<0;)I+=a;const C=Math.min(e.inHeight,u+S);for(let $=0;$<e.outWidth;++$){const R=$*i-f;let _=R;for(;_<0;)_+=l;const M=Math.min(e.inWidth,d+R);let B=Number.NEGATIVE_INFINITY,A=-1;for(let F=b;F<w;F+=o){const P=F-v;for(let H=I;H<C;H+=a){const E=H-S;for(let D=_;D<M;D+=l){const V=D-R,X=t.get(g,F,H,D,x);X>=B&&(B=X,A=P*u*d+E*u+V)}}}n.set(A,g,y,k,$,x)}}}return n}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GK(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e;pe(r,"avgPool");const{filterSize:i,strides:o,pad:a,dimRoundingMode:l}=s,c=1;T(rn(o,c),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${c}'`);const u=Ts(r.shape,i,o,c,a,l);let d;if(u.filterWidth===1&&u.filterHeight===1&&je(u.inShape,u.outShape))d=Ir({inputs:{x:r},backend:n});else{const h=n.data.get(r.dataId).values,p=me(r.shape),f=Qb(h,r.shape,r.dtype,p,u,"avg");d=n.makeTensorInfo(u.outShape,r.dtype,f.values)}return d}const HK={kernelName:Mf,backendName:"cpu",kernelFunc:GK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KK(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{filterSize:i,strides:o,pad:a,dimRoundingMode:l,dataFormat:c}=s;pe(r,"avgPool3d");const u=ri(r.shape,i,o,1,a,l,c),d=n.data.get(r.dataId).values,h=Q_(d,r.shape,r.dtype,me(r.shape),u,"avg");return n.makeTensorInfo(h.shape,"float32",h.values)}const qK={kernelName:Lf,backendName:"cpu",kernelFunc:KK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XK(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,input:i}=e,{filterSize:o,strides:a,pad:l,dimRoundingMode:c}=s;pe([r,i],"avgPool3DGrad");const u=ri(i.shape,o,a,1,l,c),d=u.strideDepth,h=u.strideHeight,p=u.strideWidth,f=u.filterDepth,g=u.filterHeight,x=u.filterWidth,y=u.dilationDepth,v=u.dilationHeight,b=u.dilationWidth,w=u.effectiveFilterDepth,k=u.effectiveFilterHeight,S=u.effectiveFilterWidth,I=w-1-u.padInfo.front,C=S-1-u.padInfo.left,$=k-1-u.padInfo.top,R=$e(i.shape,"float32"),_=1/(f*g*x),M=n.bufferSync(r);for(let B=0;B<u.batchSize;++B)for(let A=0;A<u.inChannels;++A)for(let F=0;F<u.inDepth;++F)for(let P=0;P<u.inHeight;++P)for(let H=0;H<u.inWidth;++H){const E=F-I,D=P-$,V=H-C;let X=0;for(let Z=0;Z<w;Z+=y){const ee=(E+Z)/d;if(!(ee<0||ee>=u.outDepth||Math.floor(ee)!==ee))for(let ie=0;ie<k;ie+=v){const j=(D+ie)/h;if(!(j<0||j>=u.outHeight||Math.floor(j)!==j))for(let Q=0;Q<S;Q+=b){const ne=(V+Q)/p;if(ne<0||ne>=u.outWidth||Math.floor(ne)!==ne)continue;const se=M.get(B,ee,j,ne,A);X+=se}}}R.set(X*_,B,F,P,H,A)}return n.makeTensorInfo(R.shape,R.dtype,R.values)}const YK={kernelName:k1,backendName:"cpu",kernelFunc:XK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QK(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,input:i}=e,o=i;pe([r,i],"avgPoolGrad");const{filterSize:a,strides:l,pad:c}=s,u=Ts(o.shape,a,l,1,c),d=u.strideHeight,h=u.strideWidth,p=u.filterHeight,f=u.filterWidth,g=u.dilationHeight,x=u.dilationWidth,y=u.effectiveFilterHeight,v=u.effectiveFilterWidth,b=v-1-u.padInfo.left,w=y-1-u.padInfo.top,k=$e(o.shape,"float32"),S=1/(p*f),I=n.data.get(r.dataId).values,C=$e(r.shape,"float32",I);for(let $=0;$<u.batchSize;++$)for(let R=0;R<u.inChannels;++R)for(let _=0;_<u.inHeight;++_)for(let M=0;M<u.inWidth;++M){const B=_-w,A=M-b;let F=0;for(let P=0;P<y;P+=g){const H=(B+P)/d;if(!(H<0||H>=u.outHeight||Math.floor(H)!==H))for(let E=0;E<v;E+=x){const D=(A+E)/h;if(D<0||D>=u.outWidth||Math.floor(D)!==D)continue;const V=C.get($,H,D,R);F+=V}}k.set(F*S,$,_,M,R)}return n.makeTensorInfo(k.shape,k.dtype,k.values)}const JK={kernelName:w1,backendName:"cpu",kernelFunc:QK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZK(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,scale:i,offset:o,mean:a,variance:l}=e;T(a.shape.length===l.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),T(o==null||a.shape.length===o.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),T(i==null||a.shape.length===i.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks."),pe([r,a,l,i,o],"batchNorm");let{varianceEpsilon:c}=s;c==null&&(c=.001);const u=n.data.get(r.dataId).values,d=n.data.get(a.dataId).values,h=n.data.get(l.dataId).values,p=i?n.data.get(i.dataId).values:new Float32Array([1]),f=o?n.data.get(o.dataId).values:new Float32Array([0]),g=new Float32Array(u.length),x=f.length,y=p.length,v=h.length,b=d.length;let w=0,k=0,S=0,I=0;for(let C=0;C<u.length;++C)g[C]=f[w++]+(u[C]-d[k++])*p[S++]/Math.sqrt(h[I++]+c),w>=x&&(w=0),k>=b&&(k=0),S>=y&&(S=0),I>=v&&(I=0);return n.makeTensorInfo(r.shape,r.dtype,g)}const eq={kernelName:Qf,backendName:"cpu",kernelFunc:ZK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tq(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{blockShape:i,crops:o}=s;pe([r],"batchToSpaceND");const a=i.reduce((y,v)=>y*v),l=Pd(r.shape,i,a),c=Md(l.length,i.length),u=Ld(r.shape,i,a),d=eb(o,i.length),h=tb(u,o,i.length),p=Je({inputs:{x:r},backend:n,attrs:{shape:l}}),f=Rn({inputs:{x:p},backend:n,attrs:{perm:c}}),g=Je({inputs:{x:f},backend:n,attrs:{shape:u}}),x=ia({inputs:{x:g},backend:n,attrs:{begin:d,size:h}});return n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(g),x}const nq={kernelName:jf,backendName:"cpu",kernelFunc:tq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sq(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,weights:i}=e,{size:o}=s,a=n.data.get(r.dataId).values,l=n.data.get(i.dataId).values,c=Hb(a,l,i.dtype,i.shape,o);return n.makeTensorInfo([o],i.dtype,c)}const rq={kernelName:C1,backendName:"cpu",kernelFunc:sq};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iq(t){const{inputs:e,backend:n}=t,{s0:s,s1:r}=e,i=n.data.get(s.dataId).values,o=n.data.get(r.dataId).values,a=Se(Array.from(i),Array.from(o));return n.makeTensorInfo([a.length],"int32",Int32Array.from(a))}const oq={kernelName:ST,backendName:"cpu",kernelFunc:iq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aq=We(Vu,(t,e)=>{const n=e;return t>n.clipValueMax?n.clipValueMax:t<n.clipValueMin?n.clipValueMin:t}),lq={kernelName:Vu,backendName:"cpu",kernelFunc:aq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cq=t=>{const{x:e}=t.inputs,n=t.backend,s=new Float32Array(J(e.shape)),r=n.data.get(e.dataId),i=r.complexTensorInfos.real,o=r.complexTensorInfos.imag,a=n.data.get(i.dataId).values,l=n.data.get(o.dataId).values;for(let c=0;c<a.length;c++){const u=a[c],d=l[c];s[c]=Math.hypot(u,d)}return n.makeOutput(s,e.shape,"float32")},uq={kernelName:Bf,backendName:"cpu",kernelFunc:cq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Il(t){const{inputs:e,backend:n}=t,{input:s}=e,r=n.data.get(s.dataId).complexTensorInfos.imag,i=n.data.get(r.dataId).values;return n.makeTensorInfo(r.shape,r.dtype,i)}const dq={kernelName:B1,backendName:"cpu",kernelFunc:Il};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $l(t){const{inputs:e,backend:n,attrs:s}=t,{axis:r}=s,i=Te(r,e[0].shape)[0],o=e.map(g=>g.shape);Qv(o,i);let a=xr(e.map(g=>g.shape),i);if(J(a)===0)return n.makeTensorInfo(a,e[0].dtype,[]);const l=e.filter(g=>J(g.shape)>0);if(l.length===1)return Ir({inputs:{x:l[0]},backend:n});if(l[0].dtype==="complex64"){const g=l.map(w=>ra({inputs:{input:w},backend:n})),x=l.map(w=>Il({inputs:{input:w},backend:n})),y=$l({inputs:g,backend:n,attrs:{axis:i}}),v=$l({inputs:x,backend:n,attrs:{axis:i}}),b=On({inputs:{real:y,imag:v},backend:n});return g.forEach(w=>n.disposeIntermediateTensorInfo(w)),x.forEach(w=>n.disposeIntermediateTensorInfo(w)),n.disposeIntermediateTensorInfo(y),n.disposeIntermediateTensorInfo(v),b}const c=l.map(g=>{const y=[-1,J(g.shape.slice(i))];return Je({inputs:{x:g},backend:n,attrs:{shape:y}})}),u=c.map(g=>({vals:n.data.get(g.dataId).values,shape:g.shape}));a=xr(c.map(g=>g.shape),1);const d=c[0].shape[0]===1,h=n_(u,a,e[0].dtype,d),p=xr(l.map(g=>g.shape),i),f=n.makeTensorInfo(p,e[0].dtype,h);return c.forEach(g=>n.disposeIntermediateTensorInfo(g)),f}const hq={kernelName:Wf,backendName:"cpu",kernelFunc:$l};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function J_(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,filter:i}=e,{strides:o,pad:a,dataFormat:l,dilations:c,dimRoundingMode:u}=s;pe([r,i],"conv2d");const d=ii(l),h=qt(r.shape,i.shape,o,c,a,u,!1,d),p=h.filterHeight,f=h.filterWidth,g=h.dilationHeight,x=h.dilationWidth,y=h.padInfo.left,v=h.padInfo.top,b=h.dataFormat==="channelsLast",w=new Kt(h.outShape,r.dtype),k=me(r.shape),S=me(i.shape),I=k[0],C=b?k[1]:k[2],$=b?k[2]:1,R=b?1:k[1],_=w.strides[0],M=b?w.strides[1]:w.strides[2],B=b?w.strides[2]:1,A=b?1:w.strides[1],F=n.data.get(r.dataId).values,P=n.data.get(i.dataId).values,H=w.values;for(let E=0;E<h.batchSize;++E){const D=E*I,V=E*_;for(let X=0;X<h.outHeight;++X){const Z=V+X*M,ee=X*h.strideHeight-v;for(let ie=0;ie<p;++ie){const j=ee+ie*g;if(j<0||j>=h.inHeight)continue;const Q=ie*S[0],ne=D+j*C;for(let se=0;se<h.outWidth;++se){const le=Z+se*B,xe=se*h.strideWidth-y;for(let Ce=0;Ce<f;++Ce){const _e=xe+Ce*x;if(_e<0||_e>=h.inWidth)continue;const Ke=Q+Ce*S[1],ht=ne+_e*$;let qe=Ke;for(let Ve=0;Ve<h.inChannels;++Ve){const lt=F[ht+Ve*R];for(let st=0;st<h.outChannels;++st)H[le+st*A]+=lt*P[qe+st];qe+=h.outChannels}}}}}}return n.makeTensorInfo(w.shape,w.dtype,H)}const pq={kernelName:Vf,backendName:"cpu",kernelFunc:J_};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fq(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,dy:i}=e,{strides:o,pad:a,dataFormat:l,dimRoundingMode:c,filterShape:u}=s;pe([r,i],"conv2dBackpropFilter");const d=ii(l),h=qt(r.shape,u,o,1,a,c,!1,d),{strideHeight:p,strideWidth:f,filterHeight:g,filterWidth:x}=h,y=h.dataFormat==="channelsLast",v=new Kt(h.filterShape,"float32"),b=h.padInfo.left,w=h.padInfo.top,k=n.data.get(r.dataId).values,S=n.data.get(i.dataId).values,I=new Kt(r.shape,r.dtype,k),C=new Kt(i.shape,i.dtype,S);for(let $=0;$<g;++$){const R=Math.max(0,Math.ceil((w-$)/p)),_=Math.min(h.outHeight,(h.inHeight+w-$)/p);for(let M=0;M<x;++M){const B=Math.max(0,Math.ceil((b-M)/f)),A=Math.min(h.outWidth,(h.inWidth+b-M)/f);for(let F=0;F<h.inChannels;++F)for(let P=0;P<h.outChannels;++P){let H=0;for(let E=0;E<h.batchSize;++E)for(let D=R;D<_;++D){const V=$+D*p-w;for(let X=B;X<A;++X){const Z=M+X*f-b;y?H+=I.get(E,V,Z,F)*C.get(E,D,X,P):H+=I.get(E,F,V,Z)*C.get(E,P,D,X)}}v.set(H,$,M,F,P)}}}return n.makeTensorInfo(v.shape,v.dtype,v.values)}const mq={kernelName:$1,backendName:"cpu",kernelFunc:fq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gq(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,filter:i}=e,{inputShape:o,strides:a,pad:l,dataFormat:c,dimRoundingMode:u}=s;pe([r,i],"conv2dBackpropInput");const d=me(i.shape),h=me(r.shape);let p=ii(c);const f=qt(o,i.shape,a,1,l,u,!1,p),g=new Kt(f.inShape,"float32"),x=g.values,y=n.data.get(r.dataId).values,v=n.data.get(i.dataId).values,[b,w,k]=d,{batchSize:S,filterHeight:I,filterWidth:C,inChannels:$,inHeight:R,inWidth:_,outChannels:M,outHeight:B,outWidth:A,strideHeight:F,strideWidth:P}=f;p=f.dataFormat;const H=I-1-f.padInfo.top,E=C-1-f.padInfo.left,D=p==="channelsLast",V=g.strides[0],X=D?g.strides[1]:g.strides[2],Z=D?g.strides[2]:1,ee=D?1:g.strides[1],ie=h[0],j=D?h[1]:h[2],Q=D?h[2]:1,ne=D?1:h[1];for(let se=0;se<S;++se)for(let le=0;le<$;++le)for(let xe=0;xe<R;++xe){const Ce=xe-H,_e=Math.max(0,Math.ceil(Ce/F)),Ke=Math.min(B,(I+Ce)/F);for(let ht=0;ht<_;++ht){const qe=ht-E,Ve=Math.max(0,Math.ceil(qe/P)),lt=Math.min(A,(C+qe)/P);let st=0;for(let Vt=_e;Vt<Ke;++Vt){const ai=Vt*F-Ce;for(let Kn=Ve;Kn<lt;++Kn){const fo=Kn*P-qe,Ns=ie*se+j*Vt+Q*Kn,Rr=b*(I-1-ai)+w*(C-1-fo)+k*le;for(let li=0;li<M;++li){const ci=y[Ns+ne*li],ui=v[Rr+li];st+=ci*ui}}}const Er=V*se+X*xe+Z*ht+ee*le;x[Er]=st}}return n.makeTensorInfo(g.shape,g.dtype,g.values)}const yq={kernelName:Uf,backendName:"cpu",kernelFunc:gq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xq(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,filter:i}=e,{strides:o,pad:a,dilations:l}=s;pe([r,i],"conv3d");const c=io(r.shape,i.shape,o,l,a),{filterDepth:u,filterHeight:d,filterWidth:h,dilationDepth:p,dilationHeight:f,dilationWidth:g,padInfo:x}=c,y=x.front,v=x.left,b=x.top,w=new Kt(c.outShape,r.dtype),k=n.data.get(r.dataId).values,S=n.data.get(i.dataId).values,I=w.values,C=me(r.shape),$=me(i.shape);for(let R=0;R<c.batchSize;++R){const _=R*C[0],M=R*w.strides[0];for(let B=0;B<c.outDepth;++B){const A=M+B*w.strides[1],F=B*c.strideDepth-y;for(let P=0;P<u;++P){const H=F+P*p;if(H<0||H>=c.inDepth)continue;const E=P*$[0],D=_+H*C[1];for(let V=0;V<c.outHeight;++V){const X=A+V*w.strides[2],Z=V*c.strideHeight-b;for(let ee=0;ee<d;++ee){const ie=Z+ee*f;if(ie<0||ie>=c.inHeight)continue;const j=E+ee*$[1],Q=D+ie*C[2];for(let ne=0;ne<c.outWidth;++ne){const se=X+ne*c.outChannels,le=ne*c.strideWidth-v;for(let xe=0;xe<h;++xe){const Ce=le+xe*g;if(Ce<0||Ce>=c.inWidth)continue;const _e=j+xe*$[2],Ke=Q+Ce*c.inChannels;let ht=_e;for(let qe=0;qe<c.inChannels;++qe){const Ve=k[Ke+qe];for(let lt=0;lt<c.outChannels;++lt)I[se+lt]+=Ve*S[ht+lt];ht+=c.outChannels}}}}}}}}return n.makeTensorInfo(w.shape,w.dtype,w.values)}const vq={kernelName:Gf,backendName:"cpu",kernelFunc:xq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bq(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,dy:i}=e,{strides:o,pad:a,filterShape:l}=s;pe([r,i],"conv3dBackpropFilterV2");const c=me(r.shape),u=me(i.shape),d=io(r.shape,l,o,1,a),h=d.strideDepth,p=d.strideHeight,f=d.strideWidth,g=d.filterDepth,x=d.filterHeight,y=d.filterWidth,v=new Kt(d.filterShape,"float32"),b=v.values,[w,k,S,I]=v.strides,C=n.data.get(i.dataId).values,[$,R,_,M]=u,B=n.data.get(r.dataId).values,[A,F,P,H]=c,E=d.padInfo.front,D=d.padInfo.left,V=d.padInfo.top;for(let X=0;X<g;++X){const Z=Math.max(0,Math.ceil((E-X)/h)),ee=Math.min(d.outDepth,(d.inDepth+E-X)/h),ie=X*w;for(let j=0;j<x;++j){const Q=Math.max(0,Math.ceil((V-j)/p)),ne=Math.min(d.outHeight,(d.inHeight+V-j)/p),se=j*k+ie;for(let le=0;le<y;++le){const xe=Math.max(0,Math.ceil((D-le)/f)),Ce=Math.min(d.outWidth,(d.inWidth+D-le)/f),_e=le*S+se;for(let Ke=0;Ke<d.inChannels;++Ke){const ht=Ke*I+_e;for(let qe=0;qe<d.outChannels;++qe){let Ve=0;for(let lt=0;lt<d.batchSize;++lt){const st=lt*A,Er=lt*$;for(let Vt=Z;Vt<ee;++Vt){const Kn=(X+Vt*h-E)*F+st,fo=Vt*R+Er;for(let Ns=Q;Ns<ne;++Ns){const li=(j+Ns*p-V)*P+Kn,ci=Ns*_+fo;for(let ui=xe;ui<Ce;++ui){const lg=(le+ui*f-D)*H+li,cg=ui*M+ci;Ve+=B[lg+Ke]*C[cg+qe]}}}}b[ht+qe]=Ve}}}}}return n.makeTensorInfo(v.shape,v.dtype,v.values)}const wq={kernelName:T1,backendName:"cpu",kernelFunc:bq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kq(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,filter:i}=e,{pad:o,strides:a,inputShape:l}=s;pe([r],"conv3dBackpropInputV2");const c=me(r.shape),u=me(i.shape),d=io(l,i.shape,a,1,o),h=new Kt(d.inShape,"float32"),p=h.values,[f,g,x,y]=h.strides,v=n.data.get(r.dataId).values,[b,w,k,S]=c,I=n.data.get(i.dataId).values,[C,$,R,_]=u,{batchSize:M,filterDepth:B,filterHeight:A,filterWidth:F,inChannels:P,inDepth:H,inHeight:E,inWidth:D,outChannels:V,outDepth:X,outHeight:Z,outWidth:ee,strideDepth:ie,strideHeight:j,strideWidth:Q}=d,ne=B-1-d.padInfo.front,se=A-1-d.padInfo.top,le=F-1-d.padInfo.left;for(let xe=0;xe<M;++xe)for(let Ce=0;Ce<P;++Ce)for(let _e=0;_e<H;++_e){const Ke=_e-ne,ht=Math.max(0,Math.ceil(Ke/ie)),qe=Math.min(X,(B+Ke)/ie);for(let Ve=0;Ve<E;++Ve){const lt=Ve-se,st=Math.max(0,Math.ceil(lt/j)),Er=Math.min(Z,(A+lt)/j);for(let Vt=0;Vt<D;++Vt){const ai=Vt-le,Kn=Math.max(0,Math.ceil(ai/Q)),fo=Math.min(ee,(F+ai)/Q);let Ns=0;for(let Rr=ht;Rr<qe;++Rr){const li=Rr*ie-Ke;for(let ci=st;ci<Er;++ci){const ui=ci*j-lt;for(let tc=Kn;tc<fo;++tc){const lg=tc*Q-ai,cg=b*xe+w*Rr+k*ci+S*tc,JD=C*(B-1-li)+$*(A-1-ui)+R*(F-1-lg)+_*Ce;for(let Zd=0;Zd<V;++Zd){const ZD=v[cg+Zd],e3=I[JD+Zd];Ns+=ZD*e3}}}}p[f*xe+g*_e+x*Ve+y*Vt+Ce]=Ns}}}return n.makeTensorInfo(h.shape,h.dtype,h.values)}const Cq={kernelName:E1,backendName:"cpu",kernelFunc:kq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Sq=We(Uu,t=>Math.cos(t)),Iq={kernelName:Uu,backendName:"cpu",kernelFunc:Sq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $q=We(Gu,t=>Math.cosh(t)),Tq={kernelName:Gu,backendName:"cpu",kernelFunc:$q};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Eq(t){const{inputs:e,backend:n,attrs:s}=t,{image:r,boxes:i,boxInd:o}=e,{cropSize:a,method:l,extrapolationValue:c}=s,[u,d,h,p]=r.shape,f=i.shape[0],[g,x]=a,y=$e([f,g,x,p],"float32"),v=n.data.get(i.dataId).values,b=n.data.get(o.dataId).values,w=n.data.get(r.dataId).values,k=me(r.shape),S=me(y.shape);for(let I=0;I<f;I++){const C=I*4,$=v[C],R=v[C+1],_=v[C+2],M=v[C+3],B=b[I];if(B>=u)continue;const A=g>1?(_-$)*(d-1)/(g-1):0,F=x>1?(M-R)*(h-1)/(x-1):0;for(let P=0;P<g;P++){const H=g>1?$*(d-1)+P*A:.5*($+_)*(d-1);if(H<0||H>d-1){for(let E=0;E<x;E++)for(let D=0;D<p;D++){const V=D+E*S[2]+P*S[1]+I*S[0];y.values[V]=c}continue}if(l==="bilinear"){const E=Math.floor(H),D=Math.ceil(H),V=H-E;for(let X=0;X<x;X++){const Z=x>1?R*(h-1)+X*F:.5*(R+M)*(h-1);if(Z<0||Z>h-1){for(let Q=0;Q<p;Q++){const ne=Q+X*S[2]+P*S[1]+I*S[0];y.values[ne]=c}continue}const ee=Math.floor(Z),ie=Math.ceil(Z),j=Z-ee;for(let Q=0;Q<p;Q++){let ne=Q+ee*k[2]+E*k[1]+B*k[0];const se=w[ne];ne=Q+ie*k[2]+E*k[1]+B*k[0];const le=w[ne];ne=Q+ee*k[2]+D*k[1]+B*k[0];const xe=w[ne];ne=Q+ie*k[2]+D*k[1]+B*k[0];const Ce=w[ne],_e=se+(le-se)*j,Ke=xe+(Ce-xe)*j;ne=Q+X*S[2]+P*S[1]+I*S[0],y.values[ne]=_e+(Ke-_e)*V}}}else for(let E=0;E<x;++E){const D=x>1?R*(h-1)+E*F:.5*(R+M)*(h-1);if(D<0||D>h-1){for(let Z=0;Z<p;Z++){const ee=Z+E*S[2]+P*S[1]+I*S[0];y.values[ee]=c}continue}const V=Math.round(D),X=Math.round(H);for(let Z=0;Z<p;Z++){const ee=Z+V*k[2]+X*k[1]+B*k[0],ie=Z+E*S[2]+P*S[1]+I*S[0];y.values[ie]=w[ee]}}}}return n.makeTensorInfo(y.shape,y.dtype,y.values)}const Rq={kernelName:N1,backendName:"cpu",kernelFunc:Eq};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nq(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:i,exclusive:o,reverse:a}=s;pe(r,"cumprod");const l=dt([i],r.shape.length);let c=r;l!=null&&(c=Rn({inputs:{x:r},backend:n,attrs:{perm:l}}));const u=wt(1,r.shape.length)[0];if(u!==c.shape.length-1)throw new Error(`backend.cumprod in CPU expects an inner-most axis=${c.shape.length-1} but got axis=${u}`);const d=Vn(c.dtype,"int32"),h=m1(J(c.shape),d),p=n.data.get(c.dataId).values,f=c.shape[c.shape.length-1],g=a?(y,v)=>y+f-v-1:(y,v)=>y+v;for(let y=0;y<p.length;y+=f)for(let v=0;v<f;v++){const b=g(y,v);if(v===0)h[b]=o?1:p[b];else{const w=g(y,v-1);h[b]=o?p[w]*h[w]:p[b]*h[w]}}const x=n.makeTensorInfo(c.shape,d,h);if(l!=null){const y=oo(l),v=Rn({inputs:{x},backend:n,attrs:{perm:y}});return n.disposeIntermediateTensorInfo(x),n.disposeIntermediateTensorInfo(c),v}return x}const Aq={kernelName:R1,backendName:"cpu",kernelFunc:Nq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _q(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:i,exclusive:o,reverse:a}=s;pe(r,"cumsum");const l=dt([i],r.shape.length);let c=r;l!=null&&(c=Rn({inputs:{x:r},backend:n,attrs:{perm:l}}));const u=wt(1,r.shape.length)[0];if(u!==c.shape.length-1)throw new Error(`backend.cumsum in CPU expects an inner-most axis=${c.shape.length-1} but got axis=${u}`);const d=Vn(c.dtype,"int32"),h=nn(J(c.shape),d),p=n.data.get(c.dataId).values,f=c.shape[c.shape.length-1],g=a?(y,v)=>y+f-v-1:(y,v)=>y+v;for(let y=0;y<p.length;y+=f)for(let v=0;v<f;v++){const b=g(y,v);if(v===0)h[b]=o?0:p[b];else{const w=g(y,v-1);h[b]=o?p[w]+h[w]:p[b]+h[w]}}const x=n.makeTensorInfo(c.shape,d,h);if(l!=null){const y=oo(l),v=Rn({inputs:{x},backend:n,attrs:{perm:y}});return n.disposeIntermediateTensorInfo(x),n.disposeIntermediateTensorInfo(c),v}return x}const Dq={kernelName:Hf,backendName:"cpu",kernelFunc:_q};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fq(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,weights:i}=e,{size:o,binaryOutput:a}=s;if(r.shape.length===1){const l=n.data.get(r.dataId).values,c=n.data.get(i.dataId).values,u=Hb(l,c,i.dtype,i.shape,o);return n.makeTensorInfo([o],i.dtype,u)}else if(r.shape.length===2){const l=n.bufferSync(r),c=n.bufferSync(i),u=ZA(l,c,o,a);return n.makeTensorInfo(u.shape,i.dtype,u.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${r.shape.length}.`)}const Oq={kernelName:A1,backendName:"cpu",kernelFunc:Fq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pq(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{blockSize:i,dataFormat:o}=s;T(o==="NHWC",()=>`Only NHWC dataFormat supported on CPU for depthToSpace. Got ${o}`);const a=r.shape[0],l=r.shape[1],c=r.shape[2],u=r.shape[3],d=l*i,h=c*i,p=u/(i*i),f=n.data.get(r.dataId).values,g=new Float32Array(a*d*h*p);let x=0;for(let y=0;y<a;++y)for(let v=0;v<d;++v){const b=Math.floor(v/i),w=v%i;for(let k=0;k<h;++k){const S=Math.floor(k/i),I=k%i,C=(w*i+I)*p;for(let $=0;$<p;++$){const _=$+C+u*(S+c*(b+l*y));g[x++]=f[_]}}}return n.makeTensorInfo([a,d,h,p],r.dtype,g)}const Mq={kernelName:_1,backendName:"cpu",kernelFunc:Pq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Z_(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,filter:i}=e,{strides:o,pad:a,dilations:l,dimRoundingMode:c}=s;pe([r,i],"depthwiseConv2DNative");const u=me(r.shape),d=me(i.shape);let h=l;h==null&&(h=[1,1]),T(rn(o,h),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${o} and dilations '${h}'`);const p=qt(r.shape,i.shape,o,h,a,c,!0),{filterHeight:f,filterWidth:g,dilationHeight:x,dilationWidth:y,padInfo:v}=p,b=v.left,w=v.top,k=p.outChannels/p.inChannels,S=new Kt(p.outShape,r.dtype),I=n.data.get(r.dataId).values,C=n.data.get(i.dataId).values,$=S.values;for(let R=0;R<p.batchSize;++R){const _=R*u[0],M=R*S.strides[0];for(let B=0;B<p.outHeight;++B){const A=M+B*S.strides[1],F=B*p.strideHeight-w;for(let P=0;P<f;++P){const H=F+P*x;if(H<0||H>=p.inHeight)continue;const E=P*d[0],D=_+H*u[1];for(let V=0;V<p.outWidth;++V){const X=A+V*S.strides[2],Z=V*p.strideWidth-b;for(let ee=0;ee<g;++ee){const ie=Z+ee*y;if(ie<0||ie>=p.inWidth)continue;const j=E+ee*d[1],Q=D+ie*p.inChannels;let ne=X,se=j;for(let le=0;le<p.inChannels;++le){const xe=I[Q+le];for(let Ce=0;Ce<k;++Ce)$[ne+Ce]+=xe*C[se+Ce];ne+=k,se+=k}}}}}}return n.makeTensorInfo(S.shape,S.dtype,S.values)}const Lq={kernelName:Kf,backendName:"cpu",kernelFunc:Z_};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zq(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,dy:i}=e,{strides:o,dilations:a,pad:l,dimRoundingMode:c,filterShape:u}=s;pe([r,i],"depthwiseConv2dNativeBackpropFilter");const d=qt(r.shape,u,o,a,l,c,!0),{strideHeight:h,strideWidth:p,filterHeight:f,filterWidth:g}=d,x=new Kt(d.filterShape,"float32"),y=d.padInfo.left,v=d.padInfo.top,b=d.outChannels/d.inChannels,w=n.data.get(r.dataId).values,k=new Kt(r.shape,r.dtype,w),S=n.data.get(i.dataId).values,I=new Kt(i.shape,i.dtype,S);for(let C=0;C<f;++C){const $=Math.max(0,Math.ceil((v-C)/h)),R=Math.min(d.outHeight,(d.inHeight+v-C)/h);for(let _=0;_<g;++_){const M=Math.max(0,Math.ceil((y-_)/p)),B=Math.min(d.outWidth,(d.inWidth+y-_)/p);for(let A=0;A<d.outChannels;++A){const F=Math.trunc(A/b),P=A%b;let H=0;for(let E=0;E<d.batchSize;++E)for(let D=$;D<R;++D){const V=C+D*h-v;for(let X=M;X<B;++X){const Z=_+X*p-y;H+=k.get(E,V,Z,F)*I.get(E,D,X,A)}}x.set(H,C,_,F,P)}}}return n.makeTensorInfo(x.shape,x.dtype,x.values)}const jq={kernelName:D1,backendName:"cpu",kernelFunc:zq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bq(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,filter:i}=e,{strides:o,dilations:a,pad:l,dimRoundingMode:c,inputShape:u}=s;pe([r,i],"depthwiseConv2DNativeBackpropInput");const d=me(r.shape),h=me(i.shape),p=qt(u,i.shape,o,a,l,c,!0),f=new Kt(p.inShape,"float32"),g=f.values,[x,y,v]=f.strides,b=n.data.get(r.dataId).values,[w,k,S]=d,I=n.data.get(i.dataId).values,[C,$,R]=h,{batchSize:_,filterHeight:M,filterWidth:B,inChannels:A,inHeight:F,inWidth:P,outChannels:H,outHeight:E,outWidth:D,strideHeight:V,strideWidth:X}=p,Z=M-1-p.padInfo.top,ee=B-1-p.padInfo.left,ie=H/A;for(let j=0;j<_;++j)for(let Q=0;Q<A;++Q)for(let ne=0;ne<F;++ne){const se=ne-Z,le=Math.max(0,Math.ceil(se/V)),xe=Math.min(E,(M+se)/V);for(let Ce=0;Ce<P;++Ce){const _e=Ce-ee,Ke=Math.max(0,Math.ceil(_e/X)),ht=Math.min(D,(B+_e)/X);let qe=0;for(let Ve=le;Ve<xe;++Ve){const lt=Ve*V-se;for(let st=Ke;st<ht;++st){const Er=st*X-_e,Vt=w*j+k*Ve+S*st,ai=C*(M-1-lt)+$*(B-1-Er)+R*Q;for(let Kn=0;Kn<ie;++Kn){const fo=Q*ie+Kn,Ns=b[Vt+fo],Rr=I[ai+Kn];qe+=Ns*Rr}}}g[x*j+y*ne+v*Ce+Q]=qe}}return n.makeTensorInfo(f.shape,f.dtype,f.values)}const Wq={kernelName:F1,backendName:"cpu",kernelFunc:Bq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vq(t){const{inputs:e,backend:n}=t,{x:s}=e,r=J(s.shape),i=n.data.get(s.dataId).values,o=$e([r,r],s.dtype),a=o.values;for(let c=0;c<i.length;c++)a[c*r+c]=i[c];const l=[...s.shape,...s.shape];return n.makeTensorInfo(l,o.dtype,o.values)}const Uq={kernelName:IT,backendName:"cpu",kernelFunc:Vq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gq={kernelName:qf,backendName:"cpu",kernelFunc:({inputs:t,backend:e,attrs:n})=>{const{x:s,filter:r}=t,{strides:i,pad:o,dilations:a}=n,l=e,c=l.data.get(s.dataId).values,u=s.shape.length,d=l.data.get(r.dataId).values,h=r.shape.length,{batchSize:p,inHeight:f,inWidth:g,inChannels:x,outHeight:y,outWidth:v,padInfo:b,strideHeight:w,strideWidth:k,filterHeight:S,filterWidth:I,dilationHeight:C,dilationWidth:$,outShape:R}=Ad(s.shape,r.shape,i,o,"NHWC",a),_=J(R),M=R.length,B=xt(s.dtype,_);for(let F=0;F<p;++F)for(let P=0;P<y;++P){const H=P*w-b.top;for(let E=0;E<v;++E){const D=E*k-b.left;for(let V=0;V<x;++V){let X=Number.MIN_SAFE_INTEGER;for(let ee=0;ee<S;++ee){const ie=H+ee*C;if(ie>=0&&ie<f)for(let j=0;j<I;++j){const Q=D+j*$;if(Q>=0&&Q<g){const ne=gr([F,ie,Q,V],u,me(s.shape)),se=gr([ee,j,V],h,me(r.shape)),le=c[ne]+d[se];le>X&&(X=le)}}}const Z=gr([F,P,E,V],M,me(R));B[Z]=X}}}return{dataId:l.write(pa(B,s.dtype),R,s.dtype),shape:R,dtype:s.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hq={kernelName:v0,backendName:"cpu",kernelFunc:({inputs:t,backend:e,attrs:n})=>{const{x:s,filter:r,dy:i}=t,{strides:o,pad:a,dilations:l}=n,c=e,u=Ks(s.shape,c.data.get(s.dataId).values),d=Ks(r.shape,c.data.get(r.dataId).values),{batchSize:h,inHeight:p,inWidth:f,inChannels:g,outHeight:x,outWidth:y,padInfo:v,strideHeight:b,strideWidth:w,filterHeight:k,filterWidth:S,dilationHeight:I,dilationWidth:C,outShape:$}=Ad(s.shape,r.shape,o,a,"NHWC",l);T(i.rank===$.length,()=>`Error in ${v0}, dy must have the same rank as output ${$.length}, but got ${i.rank}`);const R=Ks($,c.data.get(i.dataId).values),_=wT(r.shape,r.dtype);for(let B=0;B<h;++B)for(let A=0;A<x;++A){const F=A*b-v.top;for(let P=0;P<y;++P){const H=P*w-v.left;for(let E=0;E<g;++E){let D=Number.MIN_SAFE_INTEGER,V=0,X=0;for(let Z=0;Z<k;++Z){const ee=F+Z*I;if(ee>=0&&ee<p)for(let ie=0;ie<S;++ie){const j=H+ie*C;if(j>=0&&j<f){const Q=u[B][ee][j][E]+d[Z][ie][E];Q>D&&(D=Q,V=Z,X=ie)}}}_[V][X][E]+=R[B][A][P][E]}}}return{dataId:c.write(pa(_,s.dtype),r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kq={kernelName:x0,backendName:"cpu",kernelFunc:({inputs:t,backend:e,attrs:n})=>{const{x:s,filter:r,dy:i}=t,{strides:o,pad:a,dilations:l}=n,c=e,u=Ks(s.shape,c.data.get(s.dataId).values),d=Ks(r.shape,c.data.get(r.dataId).values),{batchSize:h,inHeight:p,inWidth:f,inChannels:g,outHeight:x,outWidth:y,padInfo:v,strideHeight:b,strideWidth:w,filterHeight:k,filterWidth:S,dilationHeight:I,dilationWidth:C,outShape:$}=Ad(s.shape,r.shape,o,a,"NHWC",l);T(i.rank===$.length,()=>`Error in ${x0}, dy must have the same rank as output ${$.length}, but got ${i.rank}`);const R=Ks($,c.data.get(i.dataId).values),_=wT(s.shape,s.dtype);for(let B=0;B<h;++B)for(let A=0;A<x;++A){const F=A*b-v.top;for(let P=0;P<y;++P){const H=P*w-v.left;for(let E=0;E<g;++E){let D=Number.MIN_SAFE_INTEGER,V=F<0?0:F,X=H<0?0:H;for(let Z=0;Z<k;++Z){const ee=F+Z*I;if(ee>=0&&ee<p)for(let ie=0;ie<S;++ie){const j=H+ie*C;if(j>=0&&j<f){const Q=u[B][ee][j][E]+d[Z][ie][E];Q>D&&(D=Q,V=ee,X=j)}}}_[B][V][X][E]+=R[B][A][P][E]}}}return{dataId:c.write(pa(_,s.dtype),s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qq(t){const{inputs:e,backend:n,attrs:s}=t,{image:r}=e,{canvas:i,options:o}=s,{contextOptions:a,imageOptions:l}=o||{},c=(l==null?void 0:l.alpha)||1,u=(a==null?void 0:a.contextType)||"2d";if(u!=="2d")throw new Error(`Context type ${a.contextType} is not supported by the CPU backend.`);const d=i.getContext(u,(a==null?void 0:a.contextAttributes)||{});if(d==null)throw new Error(`Could not get the context with ${u} type.`);const[h,p]=r.shape.slice(0,2),f=r.shape.length===2?1:r.shape[2],g=n.data.get(r.dataId).values,x=r.dtype==="float32"?255:1,y=new Uint8ClampedArray(p*h*4);for(let b=0;b<h*p;++b){const w=[0,0,0,255*c];for(let S=0;S<f;S++){const I=g[b*f+S];if(r.dtype==="float32"){if(I<0||I>1)throw new Error(`Tensor values for a float32 Tensor must be in the range [0 - 1] but encountered ${I}.`)}else if(r.dtype==="int32"&&(I<0||I>255))throw new Error(`Tensor values for a int32 Tensor must be in the range [0 - 255] but encountered ${I}.`);f===1?(w[0]=I*x,w[1]=I*x,w[2]=I*x):w[S]=I*x}const k=b*4;y[k+0]=Math.round(w[0]),y[k+1]=Math.round(w[1]),y[k+2]=Math.round(w[2]),y[k+3]=Math.round(w[3])}i.width=p,i.height=h;const v=new ImageData(y,p,h);return d.putImageData(v,0,0),r}const Xq={kernelName:Sj,backendName:"cpu",kernelFunc:qq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kd(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:i,keepDims:o}=s;pe(r,"sum");let a;r.dtype==="bool"?a=Yi({inputs:{x:r},backend:n,attrs:{dtype:"int32"}}):a=Ir({inputs:{x:r},backend:n});const l=a.shape.length,c=Te(i,a.shape),u=dt(c,l);let d=c,h=a;u!=null&&(h=Rn({inputs:{x:a},backend:n,attrs:{perm:u}}),d=wt(d.length,l)),Xt("sum",d,h.shape.length);const[p,f]=Wt(h.shape,d),g=Vn(h.dtype,"int32");let x=Zp(n,p,g);const y=J(f),v=n.data.get(x.dataId).values,b=n.data.get(h.dataId).values;for(let w=0;w<v.length;++w){const k=w*y;let S=0;for(let I=0;I<y;++I)S+=b[k+I];v[w]=S}if(o){const w=Tt(x.shape,c),k=x;x=Je({inputs:{x},backend:n,attrs:{shape:w}}),n.disposeIntermediateTensorInfo(k)}return n.disposeIntermediateTensorInfo(a),u!=null&&n.disposeIntermediateTensorInfo(h),x}const Yq={kernelName:Tm,backendName:"cpu",kernelFunc:Kd};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qq(t){const{inputs:e,backend:n,attrs:s}=t,{equation:r}=s,i=e,{allDims:o,summedDims:a,idDims:l}=cb(r,i.length);db(o.length,l,i);const{path:c,steps:u}=hb(a,l),d=u.length;let h=null,p=o.length;const f=[];for(let g=0;g<d;++g){for(const x of u[g]){const{permutationIndices:y,expandDims:v}=ub(p,l[x]);let b;pb(y)?b=i[x]:(b=Rn({inputs:{x:i[x]},backend:n,attrs:{perm:y}}),f.push(b));const w=b.shape.slice();for(let k=0;k<v.length;++k)w.splice(v[k],0,1);je(b.shape,w)||(b=Je({inputs:{x:b},backend:n,attrs:{shape:w}}),f.push(b)),h===null?h=b:(h=ng({inputs:{a:b,b:h},backend:n}),f.push(h))}g<d-1&&(c[g]>=0&&(h=Kd({inputs:{x:h},backend:n,attrs:{axis:c[g]-(o.length-p),keepDims:!1}}),f.push(h)),p--)}for(const g of f)g!==h&&n.disposeIntermediateTensorInfo(g);return h}const Jq={kernelName:O1,backendName:"cpu",kernelFunc:Qq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zq(t){const{inputs:e,backend:n}=t,{dy:s,y:r}=e;pe([s,r],"eluGrad");const i=new Float32Array(J(r.shape)),o=n.data.get(r.dataId).values,a=n.data.get(s.dataId).values;for(let l=0;l<o.length;++l){const c=o[l];c>=0?i[l]=a[l]:i[l]=a[l]*(c+1)}return n.makeTensorInfo(r.shape,"float32",i)}const eX={kernelName:P1,backendName:"cpu",kernelFunc:Zq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tX=nb,nX=sb,sX=rb,rX=ib,iX=ob,oX=ab,aX=We(qu,t=>{const e=Math.sign(t),n=Math.abs(t),s=1/(1+tX*n);return e*(1-((((oX*s+iX)*s+rX)*s+sX)*s+nX)*s*Math.exp(-n*n))}),lX={kernelName:qu,backendName:"cpu",kernelFunc:aX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nf(t){const{inputs:e,backend:n,attrs:s}=t,{input:r}=e,{dim:i}=s,o=r.shape.length,a=r.shape.slice();let l=i;return i<0&&(T(-(o+1)<=i,()=>`Axis must be in the interval [${-(o+1)}, ${o}]`),l=o+i+1),a.splice(l,0,1),Je({inputs:{x:r},backend:n,attrs:{shape:a}})}const cX={kernelName:Yf,backendName:"cpu",kernelFunc:nf};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uX=Ct((t,e)=>t/e),Jb=Ot(Hu,uX),q0={kernelName:Hu,backendName:"cpu",kernelFunc:Jb};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eD(t,e,n){const s=t.shape,r=s[0],i=s[1],o=n.data.get(t.dataId),a=o.complexTensorInfos.real,l=o.complexTensorInfos.imag,c=[r,i],u=J(c),d=tn("float32",u),h=tn("float32",u);for(let x=0;x<r;x++){const y=ia({inputs:{x:a},backend:n,attrs:{begin:[x,0],size:[1,i]}}),v=ia({inputs:{x:l},backend:n,attrs:{begin:[x,0],size:[1,i]}}),b=On({inputs:{real:y,imag:v},backend:n}),{real:w,imag:k}=dX(b,e,n),S=Qr(w,k);for(let I=0;I<i;I++){const C=lb(S,I);d[x*i+I]=C.real,h[x*i+I]=C.imag}n.disposeIntermediateTensorInfo(y),n.disposeIntermediateTensorInfo(v),n.disposeIntermediateTensorInfo(b)}const p=n.makeTensorInfo(c,"float32",d),f=n.makeTensorInfo(c,"float32",h),g=On({inputs:{real:p,imag:f},backend:n});return n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(f),g}function dX(t,e,n){const s=J(t.shape),r=n.data.get(t.dataId),i=n.data.get(r.complexTensorInfos.real.dataId).values,o=n.data.get(r.complexTensorInfos.imag.dataId).values;if(hX(s)){const a=X0(i,o,s,e,n),l=[t.shape[0],t.shape[1]];if(e){const c=n.makeTensorInfo(l,"float32",a.real),u=n.makeTensorInfo(l,"float32",a.imag),d=n.makeTensorInfo([],"float32",ro(s,"float32")),h=Ir({inputs:{x:d},backend:n}),p=q0.kernelFunc({inputs:{a:c,b:d},backend:n}),f=q0.kernelFunc({inputs:{a:u,b:h},backend:n}),g=n.data.get(p.dataId).values,x=n.data.get(f.dataId).values;return n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(f),{real:g,imag:x}}return a}else{const a=Qr(i,o),l=pX(a,s,e);return vR(l)}}function hX(t){return(t&t-1)===0}function X0(t,e,n,s,r){if(n===1)return{real:t,imag:e};const i=Qr(t,e),o=n/2,a=bR(i),l=a.real,c=a.imag,u=[l.length],d=r.makeTensorInfo(u,"float32",l),h=r.makeTensorInfo(u,"float32",c),p=On({inputs:{real:d,imag:h},backend:r}),f=wR(i),g=f.real,x=f.imag,y=[g.length],v=r.makeTensorInfo(y,"float32",g),b=r.makeTensorInfo(y,"float32",x),w=On({inputs:{real:v,imag:b},backend:r}),k=X0(l,c,o,s,r),S=k.real,I=k.imag,C=[S.length],$=r.makeTensorInfo(C,"float32",S),R=r.makeTensorInfo(C,"float32",I),_=On({inputs:{real:$,imag:R},backend:r}),M=X0(g,x,o,s,r),B=M.real,A=M.imag,F=[B.length],P=r.makeTensorInfo(F,"float32",B),H=r.makeTensorInfo(F,"float32",A),E=On({inputs:{real:P,imag:H},backend:r}),D=CR(n,s),V=[D.real.length],X=r.makeTensorInfo(V,"float32",D.real),Z=r.makeTensorInfo(V,"float32",D.imag),ee=On({inputs:{real:X,imag:Z},backend:r}),ie=ng({inputs:{a:ee,b:E},backend:r}),j=Sl({inputs:{a:_,b:ie},backend:r}),Q=Yb({inputs:{a:_,b:ie},backend:r}),ne=ra({inputs:{input:j},backend:r}),se=ra({inputs:{input:Q},backend:r}),le=Il({inputs:{input:j},backend:r}),xe=Il({inputs:{input:Q},backend:r}),Ce=$l({inputs:[ne,se],backend:r,attrs:{axis:0}}),_e=$l({inputs:[le,xe],backend:r,attrs:{axis:0}}),Ke=r.data.get(Ce.dataId).values,ht=r.data.get(_e.dataId).values;return r.disposeIntermediateTensorInfo(d),r.disposeIntermediateTensorInfo(h),r.disposeIntermediateTensorInfo(p),r.disposeIntermediateTensorInfo(v),r.disposeIntermediateTensorInfo(b),r.disposeIntermediateTensorInfo(w),r.disposeIntermediateTensorInfo($),r.disposeIntermediateTensorInfo(R),r.disposeIntermediateTensorInfo(_),r.disposeIntermediateTensorInfo(P),r.disposeIntermediateTensorInfo(H),r.disposeIntermediateTensorInfo(E),r.disposeIntermediateTensorInfo(X),r.disposeIntermediateTensorInfo(Z),r.disposeIntermediateTensorInfo(ee),r.disposeIntermediateTensorInfo(ie),r.disposeIntermediateTensorInfo(j),r.disposeIntermediateTensorInfo(Q),r.disposeIntermediateTensorInfo(ne),r.disposeIntermediateTensorInfo(le),r.disposeIntermediateTensorInfo(se),r.disposeIntermediateTensorInfo(xe),r.disposeIntermediateTensorInfo(Ce),r.disposeIntermediateTensorInfo(_e),{real:Ke,imag:ht}}function pX(t,e,n){const s=new Float32Array(e*2);for(let r=0;r<e;r++){let i=0,o=0;for(let a=0;a<e;a++){const l=SR(r*a,e,n),c=lb(t,a);i+=c.real*l.real-c.imag*l.imag,o+=c.real*l.imag+c.imag*l.real}n&&(i/=e,o/=e),kR(s,i,o,r)}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fX(t){const{inputs:e,backend:n}=t,{input:s}=e,r=J(s.shape),i=s.shape[s.shape.length-1],o=r/i,a=Je({inputs:{x:s},backend:n,attrs:{shape:[o,i]}}),l=eD(a,!1,n),c=Je({inputs:{x:l},backend:n,attrs:{shape:s.shape}});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(l),c}const mX={kernelName:M1,backendName:"cpu",kernelFunc:fX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zb(t){const{backend:e,attrs:n}=t,{shape:s,value:r,dtype:i}=n,o=i||Pl(r),a=xt(o,J(s));return yX(a,r,o),e.makeTensorInfo(s,o,a)}const gX={kernelName:L1,backendName:"cpu",kernelFunc:Zb};function yX(t,e,n){t.fill(e)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xX={kernelName:z1,backendName:"cpu",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{image:s}=t,r=n,i=tn(s.dtype,J(s.shape)),[o,a,l,c]=s.shape,u=r.data.get(s.dataId).values;for(let h=0;h<o;h++){const p=h*l*a*c;for(let f=0;f<a;f++){const g=f*(l*c);for(let x=0;x<l;x++){const y=x*c;for(let v=0;v<c;v++){const b=Math.round(l-x-1),w=p+g+y+v;let k=u[w];if(b>=0&&b<l){const S=b*c,I=p+g+S+v;k=u[I]}i[w]=k}}}}return{dataId:r.write(i,s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vX(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,filter:i,bias:o,preluActivationWeights:a}=e,{strides:l,pad:c,dataFormat:u,dilations:d,dimRoundingMode:h,activation:p,leakyreluAlpha:f}=s;let g=J_({inputs:{x:r,filter:i},backend:n,attrs:{strides:l,pad:c,dataFormat:u,dilations:d,dimRoundingMode:h}});if(o){const x=g;if(u==="NCHW"&&o.shape.length===1&&o.shape[0]!==1){const y=Je({inputs:{x:o},backend:n,attrs:{shape:[o.shape[0],1,1]}});g=Sl({inputs:{a:g,b:y},backend:n}),n.disposeIntermediateTensorInfo(y)}else g=Sl({inputs:{a:g,b:o},backend:n});n.disposeIntermediateTensorInfo(x)}if(p){const x=g;if(u==="NCHW"&&p==="prelu"&&a.shape.length===1&&a.shape[0]!==1){const y=Je({inputs:{x:a},backend:n,attrs:{shape:[a.shape[0],1,1]}});g=tf(n,g,p,y,f),n.disposeIntermediateTensorInfo(y)}else g=tf(n,g,p,a,f);n.disposeIntermediateTensorInfo(x)}return g}const bX={kernelName:Fp,backendName:"cpu",kernelFunc:vX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wX(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,filter:i,bias:o,preluActivationWeights:a}=e,{strides:l,pad:c,dataFormat:u,dilations:d,dimRoundingMode:h,activation:p,leakyreluAlpha:f}=s;let g=Z_({inputs:{x:r,filter:i},backend:n,attrs:{strides:l,pad:c,dataFormat:u,dilations:d,dimRoundingMode:h}});if(o){const x=g;g=Sl({inputs:{a:g,b:o},backend:n}),n.disposeIntermediateTensorInfo(x)}if(p){const x=g;g=tf(n,g,p,a,f),n.disposeIntermediateTensorInfo(x)}return g}const kX={kernelName:UT,backendName:"cpu",kernelFunc:wX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CX(t){const{inputs:e,backend:n}=t,{params:s,indices:r}=e,i=J(s.shape),o=r.shape,a=o[o.length-1],[l,c,u,d]=Gv(s,r);if(c===0)return n.makeTensorInfo(l,s.dtype,[]);const h=n.data.get(r.dataId).values,p=n.bufferSync(s),f=u_(h,p,s.dtype,c,a,u,d,s.shape,i);return n.makeTensorInfo(l,s.dtype,f.values)}const SX={kernelName:$T,backendName:"cpu",kernelFunc:CX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IX(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,indices:i}=e,{axis:o,batchDims:a}=s;pe([r,i],"gatherV2");const l=Te(o,r.shape)[0],c=n.data.get(i.dataId).values,u=r.shape[l];for(let w=0;w<c.length;++w){const k=c[w];T(k<=u-1&&k>=0,()=>`GatherV2: the index value ${k} is not in [0, ${u-1}]`)}let d=a;a==null&&(d=0);const h=J(i.shape),p=mb(r,i,l,d),f=Je({inputs:{x:r},backend:n,attrs:{shape:[p.batchSize,p.outerSize,p.dimSize,p.sliceSize]}}),g=Je({inputs:{x:i},backend:n,attrs:{shape:[p.batchSize,h/p.batchSize]}}),x=[p.batchSize,p.outerSize,h/p.batchSize,p.sliceSize],y=n.bufferSync(g),v=n.bufferSync(f),b=d_(v,y,x);return n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(g),n.makeTensorInfo(p.outputShape,b.dtype,b.values)}const $X={kernelName:Jf,backendName:"cpu",kernelFunc:IX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TX(t){const{inputs:e,backend:n}=t,{input:s}=e,r=J(s.shape),i=s.shape[s.shape.length-1],o=r/i,a=Je({inputs:{x:s},backend:n,attrs:{shape:[o,i]}}),l=eD(a,!0,n),c=Je({inputs:{x:l},backend:n,attrs:{shape:s.shape}});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(l),c}const EX={kernelName:j1,backendName:"cpu",kernelFunc:TX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RX=We(td,t=>Number.isFinite(t)?1:0,"bool"),NX={kernelName:td,backendName:"cpu",kernelFunc:RX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AX=We(nd,t=>Math.abs(t)===1/0?1:0,"bool"),_X={kernelName:nd,backendName:"cpu",kernelFunc:AX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DX=We(sd,t=>Number.isNaN(t)?1:0,"bool"),FX={kernelName:sd,backendName:"cpu",kernelFunc:DX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OX(t){const{backend:e,attrs:n}=t,{start:s,stop:r,num:i}=n,o=g_(s,r,i);return e.makeTensorInfo([o.length],"float32",o)}const PX={kernelName:TT,backendName:"cpu",kernelFunc:OX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MX=We(id,t=>Math.log1p(t)),LX={kernelName:id,backendName:"cpu",kernelFunc:MX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zX=Ct((t,e)=>t&&e),jX=Ot(sm,zX,null,"bool"),BX={kernelName:sm,backendName:"cpu",kernelFunc:jX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WX=We(rm,t=>t?0:1,"bool"),VX={kernelName:rm,backendName:"cpu",kernelFunc:WX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UX=Ct((t,e)=>t||e),GX=Ot(im,UX,null,"bool"),HX={kernelName:im,backendName:"cpu",kernelFunc:GX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KX(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{depthRadius:i,bias:o,alpha:a,beta:l}=s;pe(r,"LRN");const c=r.shape[3],u=c-1,d=n.data.get(r.dataId).values,h=J(r.shape),p=new Float32Array(h);function f(g){const x=g%c;let y=g-x+Math.max(0,x-i);const v=g-x+Math.min(x+i,u);let b=0;for(;y<=v;y++){const w=d[y];b+=w*w}return b}for(let g=0;g<h;g++){const x=f(g),y=d[g]*Math.pow(o+a*x,-l);p[g]=y}return n.makeTensorInfo(r.shape,r.dtype,p)}const qX={kernelName:om,backendName:"cpu",kernelFunc:KX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XX(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,y:i,dy:o}=e,{depthRadius:a,bias:l,alpha:c,beta:u}=s;pe(o,"LRNGrad");const d=J(o.shape),h=o.shape[3],p=n.data.get(o.dataId).values,f=n.data.get(r.dataId).values,g=n.data.get(i.dataId).values,x=new Float32Array(d),y=d;for(let v=0;v<y;v++){const b=v%h,w=v-b+Math.max(0,b-a),k=v-b+Math.min(h,b+a+1);let S=0;for(let I=w;I<k;I++)S+=Math.pow(f[I],2);S=c*S+l;for(let I=w;I<k;I++){let C=-2*c*u*f[I]*g[v]/S;v===I&&(C+=Math.pow(S,-u)),C*=p[v],x[I]+=C}}return n.makeTensorInfo(o.shape,r.dtype,x)}const YX={kernelName:W1,backendName:"cpu",kernelFunc:XX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tD(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{reductionIndices:i,keepDims:o}=s,a=n;let l=r.shape;const c=l.length,u=Te(i,l);let d=u;const h=dt(d,c);let p=a.data.get(r.dataId).values;if(h!=null){const w=new Array(c);for(let k=0;k<w.length;k++)w[k]=l[h[k]];p=qb(p,l,r.dtype,h,w),d=wt(d.length,c),l=w}pe(r,"max"),Xt("max",d,c);const[f,g]=Wt(l,d),x=J(g),y=x_(p,x,f,r.dtype),v=a.write(y,f,r.dtype);let b=f;return o&&(b=Tt(f,u)),{dataId:v,shape:b,dtype:r.dtype}}const QX={kernelName:am,backendName:"cpu",kernelFunc:tD};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JX(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e;pe(r,"maxPool");const{filterSize:i,strides:o,pad:a,dimRoundingMode:l}=s,c=1;T(rn(o,c),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${c}'`);const u=Ts(r.shape,i,o,c,a,l);let d;if(u.filterWidth===1&&u.filterHeight===1&&je(u.inShape,u.outShape))d=Ir({inputs:{x:r},backend:n});else{const h=n.data.get(r.dataId).values,p=me(r.shape),f=Qb(h,r.shape,r.dtype,p,u,"max");d=n.makeTensorInfo(u.outShape,r.dtype,f.values)}return d}const ZX={kernelName:lm,backendName:"cpu",kernelFunc:JX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eY(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{filterSize:i,strides:o,pad:a,dimRoundingMode:l,dataFormat:c}=s;pe(r,"maxPool3d");const u=ri(r.shape,i,o,1,a,l,c),d=n.data.get(r.dataId).values,h=Q_(d,r.shape,r.dtype,me(r.shape),u,"max");return n.makeTensorInfo(h.shape,"float32",h.values)}const tY={kernelName:cm,backendName:"cpu",kernelFunc:eY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nY(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,input:i}=e,{filterSize:o,strides:a,pad:l,dimRoundingMode:c}=s;pe([r,i],"maxPool3DGrad");const u=ri(i.shape,o,a,1,l,c),d=n.bufferSync(i),h=UK(d,u),p=u.strideDepth,f=u.strideHeight,g=u.strideWidth,x=u.dilationDepth,y=u.dilationHeight,v=u.dilationWidth,b=u.effectiveFilterDepth,w=u.effectiveFilterHeight,k=u.effectiveFilterWidth,S=b-1-u.padInfo.front,I=k-1-u.padInfo.left,C=w-1-u.padInfo.top,$=$e(i.shape,"float32"),R=n.bufferSync(r);for(let _=0;_<u.batchSize;++_)for(let M=0;M<u.inChannels;++M)for(let B=0;B<u.inDepth;++B)for(let A=0;A<u.inHeight;++A)for(let F=0;F<u.inWidth;++F){const P=B-S,H=A-C,E=F-I;let D=0;for(let V=0;V<b;V+=x){const X=(P+V)/p;if(!(X<0||X>=u.outDepth||Math.floor(X)!==X))for(let Z=0;Z<w;Z+=y){const ee=(H+Z)/f;if(!(ee<0||ee>=u.outHeight||Math.floor(ee)!==ee))for(let ie=0;ie<k;ie+=v){const j=(E+ie)/g;if(j<0||j>=u.outWidth||Math.floor(j)!==j)continue;const Q=b*w*k-1-h.get(_,X,ee,j,M),ne=V*w*k+Z*k+ie,se=Q===ne?1:0;if(se===0)continue;const le=R.get(_,X,ee,j,M);D+=le*se}}}$.set(D,_,B,A,F,M)}return n.makeTensorInfo($.shape,$.dtype,$.values)}const sY={kernelName:U1,backendName:"cpu",kernelFunc:nY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rY(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,input:i,output:o}=e,a=i;pe([i,o],"maxPoolGrad");const{filterSize:l,strides:c,pad:u,dimRoundingMode:d}=s,h=Ts(a.shape,l,c,1,u,d),p=n.data.get(a.dataId).values,f=$e(h.outShape,a.dtype,Y_(p,a.shape,a.dtype,h).values),g=h.strideHeight,x=h.strideWidth,y=h.dilationHeight,v=h.dilationWidth,b=h.effectiveFilterHeight,w=h.effectiveFilterWidth,k=w-1-h.padInfo.left,S=b-1-h.padInfo.top,I=$e(a.shape,"float32"),C=n.data.get(r.dataId).values,$=$e(r.shape,"float32",C);for(let R=0;R<h.batchSize;++R)for(let _=0;_<h.inChannels;++_)for(let M=0;M<h.inHeight;++M)for(let B=0;B<h.inWidth;++B){const A=M-S,F=B-k;let P=0;for(let H=0;H<b;H+=y){const E=(A+H)/g;if(!(E<0||E>=h.outHeight||Math.floor(E)!==E))for(let D=0;D<w;D+=v){const V=(F+D)/x;if(V<0||V>=h.outWidth||Math.floor(V)!==V)continue;const X=b*w-1-f.get(R,E,V,_),Z=H*w+D,ee=X===Z?1:0;if(ee===0)continue;const ie=$.get(R,E,V,_);P+=ie*ee}}I.set(P,R,M,B,_)}return n.makeTensorInfo(I.shape,I.dtype,I.values)}const iY={kernelName:V1,backendName:"cpu",kernelFunc:rY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oY(t,e,n,s,r){const i=me(e),o=Qb(t,e,n,i,r,"max"),a=Y_(t,e,n,r,!0,s);return[o.values,a.values]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aY={kernelName:ET,backendName:"cpu",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{x:s}=t,{filterSize:r,strides:i,pad:o,includeBatchInIndex:a}=e,l=n;pe(s,"MaxPoolWithArgmax");const c=l.data.get(s.dataId).values,u=Ts(s.shape,r,i,[1,1],o),[d,h]=oY(c,s.shape,s.dtype,a,u),p=l.write(d,u.outShape,s.dtype),f=l.write(h,u.outShape,s.dtype);return[{dataId:p,shape:u.outShape,dtype:s.dtype},{dataId:f,shape:u.outShape,dtype:"int32"}]}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lY(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:i,keepDims:o}=s,a=Te(i,r.shape),c=Wt(r.shape,a)[1],u=J(c),d=[],h=n.makeTensorInfo([],"float32",new Float32Array([u]));d.push(h);const p=Yi({inputs:{x:r},backend:n,attrs:{dtype:"float32"}});d.push(p);const f=Jb({inputs:{a:p,b:h},backend:n});d.push(f);const g=Kd({inputs:{x:f},backend:n,attrs:{axis:i,keepDims:o}});return d.forEach(x=>n.disposeIntermediateTensorInfo(x)),g}const cY={kernelName:um,backendName:"cpu",kernelFunc:lY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uY(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:i,keepDims:o}=s;pe(r,"min");const a=Te(i,r.shape);let l=a;const c=dt(l,r.shape.length);let u=r;c!=null&&(u=Rn({inputs:{x:r},backend:n,attrs:{perm:c}}),l=wt(l.length,r.shape.length)),Xt("min",l,u.shape.length);const[d,h]=Wt(u.shape,l),p=J(h),f=nn(J(d),u.dtype),g=n.data.get(u.dataId).values;for(let y=0;y<f.length;++y){const v=y*p;let b=g[v];for(let w=0;w<p;++w){const k=g[v+w];(Number.isNaN(k)||k<b)&&(b=k)}f[y]=b}c!=null&&n.disposeIntermediateTensorInfo(u);const x=n.makeTensorInfo(d,u.dtype,f);if(o){const y=Tt(d,a),v=Je({inputs:{x},backend:n,attrs:{shape:y}});return n.disposeIntermediateTensorInfo(x),v}return x}const dY={kernelName:dm,backendName:"cpu",kernelFunc:uY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hY(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{paddings:i,mode:o}=s;pe(r,"mirrorPad");const a=i.map((b,w)=>b[0]+r.shape[w]+b[1]),l=i.map(b=>b[0]),c=i.map((b,w)=>b[0]+r.shape[w]),u=o==="reflect"?0:1,d=n.data.get(r.dataId).values,h=r.shape.length,p=me(r.shape),f=J(a),g=a.length,x=me(a),y=tn(r.dtype,f);for(let b=0;b<f;b++){let w=Ml(b,g,x);for(let S=0;S<g;S++)w[S]<l[S]?w[S]=l[S]*2-w[S]-u:w[S]>=c[S]&&(w[S]=(c[S]-1)*2-w[S]+u);w=w.map((S,I)=>S-l[I]);const k=gr(w,h,p);y[b]=d[k]}return{dataId:n.write(y,a,r.dtype),shape:a,dtype:r.dtype}}const pY={kernelName:hm,backendName:"cpu",kernelFunc:hY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fY=Ct((t,e)=>{const n=t%e;return t<0&&e<0||t>=0&&e>=0?n:(n+e)%e}),mY=Ot(ld,fY),gY={kernelName:ld,backendName:"cpu",kernelFunc:mY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nD(t){const{inputs:e,backend:n,attrs:s}=t,{logits:r}=e,{dim:i}=s,o=r.shape.length;let a=i;if(a===-1&&(a=o-1),a!==o-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${o} and dim was ${a}`);const l=Te([a],r.shape),c=tD({inputs:{x:r},backend:n,attrs:{reductionIndices:l,keepDims:!1}}),u=Tt(c.shape,l),d=Je({inputs:{x:c},backend:n,attrs:{shape:u}}),h=Yb({inputs:{a:r,b:d},backend:n}),p=o_({inputs:{x:h},backend:n}),f=Kd({inputs:{x:p},backend:n,attrs:{axis:l,keepDims:!1}}),g=Je({inputs:{x:f},backend:n,attrs:{shape:u}}),x=Jb({inputs:{a:p,b:g},backend:n});return n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(g),x}const yY={kernelName:Nm,backendName:"cpu",kernelFunc:nD};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xY(t){const{inputs:e,backend:n,attrs:s}=t,{logits:r}=e,{numSamples:i,seed:o,normalized:a}=s;pe(r,"multinomial");const l=a?r:nD({inputs:{logits:r},backend:n,attrs:{dim:-1}}),c=l.shape[0],u=l.shape[1],d=n.data.get(l.dataId).values,h=[c,i],p=nn(J(h),"int32");for(let f=0;f<c;++f){const g=f*u,x=new Float32Array(u-1);x[0]=d[g];for(let b=1;b<x.length;++b)x[b]=x[b-1]+d[g+b];const y=Nv.alea(o.toString()),v=f*i;for(let b=0;b<i;++b){const w=y();p[v+b]=x.length;for(let k=0;k<x.length;k++)if(w<x[k]){p[v+b]=k;break}}}return a||n.disposeIntermediateTensorInfo(l),n.makeTensorInfo(h,"int32",p)}const vY={kernelName:RT,backendName:"cpu",kernelFunc:xY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bY=jv;function wY(t){const{inputs:e,backend:n,attrs:s}=t,{boxes:r,scores:i}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l}=s;pe(r,"NonMaxSuppression");const c=n.data.get(r.dataId).values,u=n.data.get(i.dataId).values,{selectedIndices:d}=bY(c,u,o,a,l);return n.makeTensorInfo([d.length],"int32",new Int32Array(d))}const kY={kernelName:G1,backendName:"cpu",kernelFunc:wY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CY=Bv;function SY(t){const{inputs:e,backend:n,attrs:s}=t,{boxes:r,scores:i}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l,padToMaxOutputSize:c}=s;pe(r,"NonMaxSuppressionPadded");const u=n.data.get(r.dataId).values,d=n.data.get(i.dataId).values,{selectedIndices:h,validOutputs:p}=CY(u,d,o,a,l,c);return[n.makeTensorInfo([h.length],"int32",new Int32Array(h)),n.makeTensorInfo([],"int32",new Int32Array([p]))]}const IY={kernelName:H1,backendName:"cpu",kernelFunc:SY};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $Y=Wv;function TY(t){const{inputs:e,backend:n,attrs:s}=t,{boxes:r,scores:i}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l,softNmsSigma:c}=s;pe(r,"NonMaxSuppressionWithScore");const u=n.data.get(r.dataId).values,d=n.data.get(i.dataId).values,h=o,p=a,f=l,g=c,{selectedIndices:x,selectedScores:y}=$Y(u,d,h,p,f,g);return[n.makeTensorInfo([x.length],"int32",new Int32Array(x)),n.makeTensorInfo([y.length],"float32",new Float32Array(y))]}const EY={kernelName:K1,backendName:"cpu",kernelFunc:TY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RY(t){const{inputs:e,backend:n,attrs:s}=t,{indices:r}=e,{dtype:i,depth:o,onValue:a,offValue:l}=s;pe(r,"oneHot");const c=J(r.shape),u=new Float32Array(c*o);u.fill(l);const d=n.data.get(r.dataId).values;for(let h=0;h<c;++h)d[h]>=0&&d[h]<o&&(u[h*o+d[h]]=a);return n.makeTensorInfo([...r.shape,o],i,u)}const NY={kernelName:gm,backendName:"cpu",kernelFunc:RY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sf(t){const{inputs:e,backend:n}=t,{x:s}=e;if(s.dtype==="string")throw new Error("zerosLike is not supported for string tensors");if(s.dtype==="complex64"){const r=ra({inputs:{input:s},backend:n}),i=sf({inputs:{x:r},backend:n}),o=Il({inputs:{input:s},backend:n}),a=sf({inputs:{x:o},backend:n}),l=On({inputs:{real:i,imag:a},backend:n});return n.disposeIntermediateTensorInfo(r),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(a),l}else return Zb({backend:n,attrs:{shape:s.shape,value:0,dtype:s.dtype}})}const AY={kernelName:Dm,backendName:"cpu",kernelFunc:sf};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sD(t){const{inputs:e,backend:n}=t,{x:s}=e;if(s.dtype==="string")throw new Error("onesLike is not supported for string tensors");if(s.dtype==="complex64"){const r=ra({inputs:{input:s},backend:n}),i=sD({inputs:{x:r},backend:n}),o=Il({inputs:{input:s},backend:n}),a=sf({inputs:{x:o},backend:n}),l=On({inputs:{real:i,imag:a},backend:n});return n.disposeIntermediateTensorInfo(r),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(a),l}else return Zb({backend:n,attrs:{shape:s.shape,value:1,dtype:s.dtype}})}const _Y={kernelName:mm,backendName:"cpu",kernelFunc:sD};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rD(t){const{inputs:e,backend:n,attrs:s}=t,{axis:r}=s;if(e.length===1)return nf({inputs:{input:e[0]},backend:n,attrs:{dim:r}});const i=e[0].shape,o=e[0].dtype;e.forEach(u=>{p1(i,u.shape,"All tensors passed to stack must have matching shapes"),T(o===u.dtype,()=>"All tensors passed to stack must have matching dtypes")});const a=[],l=e.map(u=>{const d=nf({inputs:{input:u},backend:n,attrs:{dim:r}});return a.push(d),d}),c=$l({inputs:l,backend:n,attrs:{axis:r}});return a.forEach(u=>n.disposeIntermediateTensorInfo(u)),c}const DY={kernelName:ym,backendName:"cpu",kernelFunc:rD};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FY(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{paddings:i,constantValue:o}=s;pe(r,"pad");const a=i.map((v,b)=>v[0]+r.shape[b]+v[1]),l=i.map(v=>v[0]),c=n.data.get(r.dataId).values,u=J(r.shape),d=r.shape.length,h=me(r.shape),p=J(a),f=a.length,g=me(a),x=tn(r.dtype,p);o!==0&&x.fill(o);for(let v=0;v<u;v++){const w=Ml(v,d,h).map((S,I)=>S+l[I]),k=gr(w,f,g);x[k]=c[v]}return{dataId:n.write(x,a,r.dtype),shape:a,dtype:r.dtype}}const iD={kernelName:xm,backendName:"cpu",kernelFunc:FY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OY=Ct((t,e)=>Math.pow(t,e)),PY=Ot(ud,OY),MY={kernelName:ud,backendName:"cpu",kernelFunc:PY};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LY(t){const{inputs:e,backend:n,attrs:s}=t,{paramsNestedSplits:r,paramsDenseValues:i,indices:o}=e,{outputRaggedRank:a}=s,l=r.map(y=>n.data.get(y.dataId).values),c=r.map(y=>y.shape),u=n.data.get(i.dataId).values,d=n.data.get(o.dataId).values,[h,p,f]=S_(l,c,u,i.shape,i.dtype,d,o.shape),g=h.map(y=>n.makeTensorInfo([y.length],"int32",y)),x=n.makeTensorInfo(f,i.dtype,p);return g.concat([x])}const zY={kernelName:NT,backendName:"cpu",kernelFunc:LY};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jY(t){const{inputs:e,backend:n}=t,{starts:s,limits:r,deltas:i}=e,o=n.data.get(s.dataId).values,a=n.data.get(r.dataId).values,l=n.data.get(i.dataId).values,[c,u]=I_(o,s.shape,s.dtype,a,r.shape,l,i.shape),d=n.makeTensorInfo([c.length],"int32",c),h=n.makeTensorInfo([u.length],s.dtype,u);return[d,h]}const BY={kernelName:AT,backendName:"cpu",kernelFunc:jY};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WY(t){const{inputs:e,backend:n,attrs:s}=t,{shape:r,values:i,defaultValue:o,rowPartitionTensors:a}=e,{rowPartitionTypes:l}=s,c=n.data.get(r.dataId).values,u=n.data.get(i.dataId).values,d=n.data.get(o.dataId).values,h=a.map(x=>n.data.get(x.dataId).values),p=a.map(x=>x.shape),[f,g]=$_(c,r.shape,u,i.shape,i.dtype,d,o.shape,h,p,l);return n.makeTensorInfo(f,i.dtype,g)}const VY={kernelName:_T,backendName:"cpu",kernelFunc:WY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UY(t){const{backend:e,attrs:n}=t,{start:s,stop:r,dtype:i,step:o}=n,a=T_(s,r,o,i);return e.makeTensorInfo([a.length],i,a)}const GY={kernelName:q1,backendName:"cpu",kernelFunc:UY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HY=We(dd,t=>1/t),KY={kernelName:dd,backendName:"cpu",kernelFunc:HY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qY(t){const{inputs:e,backend:n,attrs:s}=t,{images:r}=e,{alignCorners:i,halfPixelCenters:o,size:a}=s;pe(r,"resizeBilinear");const l=me(r.shape),[c,u]=a,[d,h,p,f]=r.shape,g=n.data.get(r.dataId).values,x=new Float32Array(J([d,c,u,f])),y=[i&&c>1?h-1:h,i&&u>1?p-1:p],v=[i&&c>1?c-1:c,i&&u>1?u-1:u];let b=0;const w=y[0]/v[0],k=y[1]/v[1];for(let S=0;S<d;S++)for(let I=0;I<c;I++){let C;o?C=w*(I+.5)-.5:C=w*I;const $=Math.max(0,Math.floor(C)),R=C-$,_=Math.min(h-1,Math.ceil(C)),M=S*l[0]+$*l[1],B=S*l[0]+_*l[1];for(let A=0;A<u;A++){let F;o?F=k*(A+.5)-.5:F=k*A;const P=Math.max(0,Math.floor(F)),H=F-P,E=Math.min(p-1,Math.ceil(F)),D=M+P*l[2],V=B+P*l[2],X=M+E*l[2],Z=B+E*l[2];for(let ee=0;ee<f;ee++){const ie=g[D+ee],j=g[V+ee],Q=g[X+ee],ne=g[Z+ee],se=ie+(Q-ie)*H,le=j+(ne-j)*H,xe=se+(le-se)*R;x[b++]=xe}}}return n.makeTensorInfo([d,c,u,f],"float32",x)}const XY={kernelName:Cm,backendName:"cpu",kernelFunc:qY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YY(t){const{inputs:e,backend:n,attrs:s}=t,{images:r,dy:i}=e,{alignCorners:o}=s;pe([i,r],"resizeBilinearGrad");const a=me(r.shape),[l,c,u,d]=r.shape,[,h,p]=i.shape,f=new Float32Array(l*c*u*d),g=[o&&h>1?c-1:c,o&&p>1?u-1:u],x=[o&&h>1?h-1:h,o&&p>1?p-1:p],y=g[0]/x[0],v=g[1]/x[1],b=n.data.get(i.dataId).values;let w=0;for(let k=0;k<l;k++){const S=k*a[0];for(let I=0;I<h;I++){const C=I*y,$=Math.floor(C),R=Math.min(Math.ceil(C),c-1),_=S+$*a[1],M=S+R*a[1],B=C-$,A=1-B;for(let F=0;F<p;F++){const P=F*v,H=Math.floor(P),E=Math.min(Math.ceil(P),u-1),D=P-H,V=1-D,X=_+H*a[2],Z=_+E*a[2],ee=M+H*a[2],ie=M+E*a[2],j=A*V,Q=A*D,ne=B*V,se=B*D;for(let le=0;le<d;le++){const xe=b[w++];f[X+le]+=xe*j,f[Z+le]+=xe*Q,f[ee+le]+=xe*ne,f[ie+le]+=xe*se}}}}return n.makeTensorInfo([l,u,c,d],"float32",f)}const QY={kernelName:Q1,backendName:"cpu",kernelFunc:YY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JY(t){const{inputs:e,backend:n,attrs:s}=t,{images:r}=e,{alignCorners:i,halfPixelCenters:o,size:a}=s;pe(r,"resizeNearestNeighbor");const l=me(r.shape),[c,u]=a,[d,h,p,f]=r.shape,g=n.data.get(r.dataId).values,x=new Float32Array(d*c*u*f),y=[i&&c>1?h-1:h,i&&u>1?p-1:p],v=[i&&c>1?c-1:c,i&&u>1?u-1:u],b=y[0]/v[0],w=y[1]/v[1];let k=0;for(let S=0;S<d;S++){const I=S*l[0];for(let C=0;C<c;C++){const $=o?b*(C+.5):b*C;let R=Math.min(h-1,i?Math.round($):Math.floor($));o&&(R=Math.max(0,R));const _=I+R*l[1];for(let M=0;M<u;M++){const B=o?w*(M+.5):w*M;let A=Math.min(p-1,i?Math.round(B):Math.floor(B));o&&(A=Math.max(0,A));const F=_+A*l[2];for(let P=0;P<f;P++){const H=g[F+P];x[k++]=H}}}}return n.makeTensorInfo([d,c,u,f],r.dtype,x)}const ZY={kernelName:km,backendName:"cpu",kernelFunc:JY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eQ(t){const{inputs:e,backend:n,attrs:s}=t,{images:r,dy:i}=e,{alignCorners:o}=s;pe([i,r],"resizeNearestNeighborGrad");const a=me(r.shape),l=me(i.shape),[c,u,d,h]=r.shape,[,p,f]=i.shape,g=new Float32Array(c*u*d*h),x=n.data.get(i.dataId).values,y=[o&&p>1?u-1:u,o&&f>1?d-1:d],v=[o&&p>1?p-1:p,o&&f>1?f-1:f],b=y[0]/v[0],w=y[1]/v[1],k=1/b,S=1/w,I=Math.ceil(k)*2+2,C=Math.ceil(S)*2+2;for(let $=0;$<c;$++){const R=$*a[0];for(let _=0;_<u;_++){const M=R+_*a[1],B=Math.floor(_*k),A=Math.floor(B-I/2);for(let F=0;F<d;F++){const P=M+F*a[2],H=Math.floor(F*S),E=Math.floor(H-C/2);for(let D=0;D<h;D++){let V=0;for(let X=0;X<I;X++){const Z=X+A;if(Z<0||Z>=p)continue;const ee=R+Z*l[1],ie=Z*b,j=Math.min(u-1,o?Math.round(ie):Math.floor(ie));if(_===j)for(let Q=0;Q<C;Q++){const ne=Q+E;if(ne<0||ne>=f)continue;const se=ee+ne*l[2],le=ne*w,xe=Math.min(d-1,o?Math.round(le):Math.floor(le));F===xe&&(V+=x[se+D])}}g[P+D]=V}}}}return n.makeTensorInfo(r.shape,r.dtype,g)}const tQ={kernelName:Y1,backendName:"cpu",kernelFunc:eQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nQ(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{dims:i}=s;pe(r,"reverse");const o=r.shape.length,a=Te(i,r.shape);if(o===0)return Ir({inputs:{x:r},backend:n});const l=new Kt(r.shape,r.dtype),c=n.bufferSync(r);for(let u=0;u<l.size;u++){const d=l.indexToLoc(u),h=d.slice();a.forEach(p=>h[p]=r.shape[p]-1-h[p]),l.set(c.get(...h),...d)}return n.makeTensorInfo(l.shape,l.dtype,l.values)}const sQ={kernelName:Sm,backendName:"cpu",kernelFunc:nQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rQ={kernelName:rv,backendName:"cpu",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{image:s}=t,{radians:r,fillValue:i,center:o}=e,a=n,l=tn(s.dtype,J(s.shape)),[c,u,d,h]=s.shape,[p,f]=Zv(o,u,d),g=255,x=Math.sin(r),y=Math.cos(r),v=a.data.get(s.dataId).values;for(let w=0;w<c;w++){const k=w*d*u*h;for(let S=0;S<u;S++){const I=S*(d*h);for(let C=0;C<d;C++){const $=C*h;for(let R=0;R<h;R++){const _=[c,S,C,R],M=_[2],B=_[1];let A=(M-p)*y-(B-f)*x,F=(M-p)*x+(B-f)*y;A=Math.round(A+p),F=Math.round(F+f);let P=i;if(typeof i!="number"&&(R===3?P=g:P=i[R]),A>=0&&A<d&&F>=0&&F<u){const E=F*(d*h),D=A*h,V=k+E+D+R;P=v[V]}const H=k+I+$+R;l[H]=P}}}}return{dataId:a.write(l,s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iQ=We(fd,t=>{const e=Math.floor(t);return t-e<.5?Math.floor(t):t-e>.5?Math.ceil(t):e%2===0?e:e+1}),oQ={kernelName:fd,backendName:"cpu",kernelFunc:iQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aQ(t){const{inputs:e,backend:n,attrs:s}=t,{indices:r,updates:i}=e,{shape:o}=s,{sliceRank:a,numUpdates:l,sliceSize:c,strides:u,outputSize:d}=ya(i,r,o),h=!0,p=n.bufferSync(r),f=n.bufferSync(i),g=Ao(p,f,o,d,c,l,a,u,0,h);return n.makeTensorInfo(o,g.dtype,g.values)}const lQ={kernelName:DT,backendName:"cpu",kernelFunc:aQ};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cQ(t,e){let n=0,s=t.length,r=0;for(;n<s;)r=Math.floor((n+s)/2),t[r]<e?n=r+1:s=r;return s}function uQ(t,e){let n=0,s=t.length,r=0;for(;n<s;)r=Math.floor((n+s)/2),t[r]<=e?n=r+1:s=r;return s}function dQ(t,e,n,s,r,i){const o=xt("int32",n*r);for(let a=0;a<n;++a){const l=t.slice(a*s,(a+1)*s),c=a*r;for(let u=0;u<r;++u)o[c+u]=i==="left"?cQ(l,e[u+c]):uQ(l,e[u+c])}return o}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hQ(t){const{inputs:e,backend:n,attrs:s}=t,{sortedSequence:r,values:i}=e,{side:o}=s,a=n.data.get(r.dataId).values,l=n.data.get(i.dataId).values,c=dQ(a,l,r.shape[0],r.shape[1],i.shape[1],o);return n.makeTensorInfo(i.shape,"int32",c)}const pQ={kernelName:OT,backendName:"cpu",kernelFunc:hQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fQ(t){const{inputs:e,backend:n}=t,{condition:s,t:r,e:i}=e;pe([s,r,i],"select");const o=s.shape.length,a=n.data.get(s.dataId).values,l=n.data.get(r.dataId).values,c=n.data.get(i.dataId).values,u=Vn(r.dtype,i.dtype),d=nn(J(r.shape),u);let h=0;const p=o===0||o>1||r.shape.length===1?1:J(r.shape.slice(1));for(let f=0;f<a.length;f++)for(let g=0;g<p;g++)a[f]===1?d[h++]=l[f]:d[h++]=c[f];return n.makeTensorInfo(r.shape,u,d)}const mQ={kernelName:Im,backendName:"cpu",kernelFunc:fQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gQ=Vm,yQ=Um,xQ=We(gd,t=>t>=0?yQ*t:gQ*(Math.exp(t)-1)),vQ={kernelName:gd,backendName:"cpu",kernelFunc:xQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bQ=We(vd,t=>t<0?-1:t>0?1:0),wQ={kernelName:vd,backendName:"cpu",kernelFunc:bQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kQ=We(yd,t=>Math.sin(t)),CQ={kernelName:yd,backendName:"cpu",kernelFunc:kQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SQ=We(xd,t=>Math.sinh(t)),IQ={kernelName:xd,backendName:"cpu",kernelFunc:SQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $Q=11920928955078125e-23,fC=Math.log($Q)+2,TQ=We(wd,t=>{const e=t>-fC,n=t<fC,s=Math.exp(t);let r;return n?r=s:e?r=t:r=Math.log(1+s),r}),EQ={kernelName:wd,backendName:"cpu",kernelFunc:TQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RQ(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{blockShape:i,paddings:o}=s;pe([r],"spaceToBatchND");const a=J(i),l=[[0,0]];l.push(...o);for(let S=1+i.length;S<r.shape.length;++S)l.push([0,0]);const c=iD.kernelFunc({inputs:{x:r},backend:n,attrs:{paddings:l,constantValue:0}}),u=Pd(c.shape,i,a,!1),d=Md(u.length,i.length,!1),h=Ld(c.shape,i,a,!1),g=Je({inputs:{x:c},backend:n,attrs:{shape:u}}),v=Rn({inputs:{x:g},backend:n,attrs:{perm:d}}),k=Je({inputs:{x:v},backend:n,attrs:{shape:h}});return n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(v),k}const NQ={kernelName:Em,backendName:"cpu",kernelFunc:RQ};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AQ(t){const{inputs:e,backend:n}=t,{indices:s,values:r,denseShape:i,defaultValue:o}=e;if(i.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
        ${i.shape}`);if(s.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
        ${s.shape}`);if(r.shape.length!==1)throw new Error(`Values must be a vector, saw:
        ${r.shape}`);if(o.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${o.shape}`);const a=n.data.get(s.dataId).values,l=n.data.get(r.dataId).values,c=n.data.get(i.dataId).values,u=n.data.get(o.dataId).values[0],[d,h,p,f,g]=A_(a,s.shape,s.dtype,l,r.dtype,c,u);return[n.makeTensorInfo(h,s.dtype,d),n.makeTensorInfo([h[0]],r.dtype,p),n.makeTensorInfo([f.length],"bool",new Uint8Array(f.map(x=>Number(x)))),n.makeTensorInfo([g.length],s.dtype,new Int32Array(g))]}const _Q={kernelName:PT,backendName:"cpu",kernelFunc:AQ};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DQ(t){const{inputs:e,backend:n}=t,{inputIndices:s,inputShape:r,newShape:i}=e;if(s.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape
        ${s.shape}`);if(r.shape.length!==1)throw new Error(`Input shape should be a vector but received shape
        ${r.shape}`);if(i.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${i.shape}`);const o=Array.from(n.data.get(r.dataId).values),a=n.data.get(s.dataId).values,l=Array.from(n.data.get(i.dataId).values),[c,u,d]=__(a,s.shape,s.dtype,o,l);return[n.makeTensorInfo(u,s.dtype,c),n.makeTensorInfo([d.length],i.dtype,new Int32Array(d))]}const FQ={kernelName:MT,backendName:"cpu",kernelFunc:DQ};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OQ(t){const{inputs:e,backend:n}=t,{data:s,indices:r,segmentIds:i}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
          ${r.shape}`);if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
          ${i.shape}`);if(r.shape[0]!==i.shape[0])throw new Error("segmentIds and indices should have same size.");const o=n.data.get(s.dataId).values,a=n.data.get(r.dataId).values,l=n.data.get(i.dataId).values,[c,u]=Xb(o,s.shape,s.dtype,a,l,!0);return n.makeTensorInfo(u,s.dtype,c)}const PQ={kernelName:LT,backendName:"cpu",kernelFunc:OQ};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MQ(t){const{inputs:e,backend:n}=t,{data:s,indices:r,segmentIds:i}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
         ${r.shape}`);if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
         ${i.shape}`);if(r.shape[0]!==i.shape[0])throw new Error("segmentIds and indices should have same size.");const o=n.data.get(s.dataId).values,a=n.data.get(r.dataId).values,l=n.data.get(i.dataId).values,[c,u]=Xb(o,s.shape,s.dtype,a,l);return n.makeTensorInfo(u,s.dtype,c)}const LQ={kernelName:zT,backendName:"cpu",kernelFunc:MQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zQ(t){const{inputs:e,backend:n,attrs:s}=t,{sparseIndices:r,sparseValues:i,defaultValue:o}=e,{outputShape:a}=s,{sliceRank:l,numUpdates:c,sliceSize:u,strides:d,outputSize:h}=ya(i,r,a),p=!1,f=n.bufferSync(r);let g;switch(i.dtype){case"bool":{const x=n.bufferSync(i),y=!!n.data.get(o.dataId).values[0];g=Ao(f,x,a,h,u,c,l,d,y,p);break}case"float32":{const x=n.bufferSync(i),y=n.data.get(o.dataId).values[0];g=Ao(f,x,a,h,u,c,l,d,y,p);break}case"int32":{const x=n.bufferSync(i),y=n.data.get(o.dataId).values[0];g=Ao(f,x,a,h,u,c,l,d,y,p);break}case"string":{const x=n.bufferSync(i),y=Gi(n.data.get(o.dataId).values[0]);g=Ao(f,x,a,h,u,c,l,d,y,p);break}default:throw new Error(`Unsupported type ${i.dtype}`)}return n.makeTensorInfo(a,g.dtype,g.values)}const jQ={kernelName:jT,backendName:"cpu",kernelFunc:zQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BQ(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{numOrSizeSplits:i,axis:o}=s,a=Te(o,r.shape)[0],l=fb(r,i,a),c=new Array(r.shape.length).fill(0),u=r.shape.slice();return l.map(d=>{const h=[...u];h[a]=d;const p=ia({inputs:{x:r},backend:n,attrs:{begin:c,size:h}});return c[a]+=d,p})}const WQ={kernelName:Rm,backendName:"cpu",kernelFunc:BQ};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VQ={kernelName:J1,backendName:"cpu",kernelFunc:({inputs:t,backend:e})=>{const{x:n}=t,s=e;pe(n,"square");const r=s.data.get(n.dataId).values,i=new Float32Array(r.length);for(let a=0;a<r.length;++a){const l=r[a];i[a]=l*l}return{dataId:s.write(i,n.shape,n.dtype),shape:n.shape,dtype:n.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UQ=We(Ed,(t,e)=>{const n=e;return isNaN(t)?NaN:t>0?1:n.alpha}),GQ={kernelName:Ed,backendName:"cpu",kernelFunc:UQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HQ(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{begin:i,end:o,strides:a,beginMask:l,endMask:c,ellipsisMask:u,newAxisMask:d,shrinkAxisMask:h}=s;pe(r,"stridedSlice");const{finalShapeSparse:p,finalShape:f,isIdentity:g,sliceDim0:x,isSimpleSlice:y,begin:v,end:b,strides:w}=Yv(r.shape,i,o,a,l,c,u,d,h);let k;if(g)k=Je({inputs:{x:r},backend:n,attrs:{shape:f}});else if(x||y){T(r.shape.length>=1,()=>`Input must have rank at least 1, got: ${r.shape.length}`);const S=Kv(v,b,w),I=ia({inputs:{x:r},backend:n,attrs:{begin:v,size:S}});k=Je({inputs:{x:I},backend:n,attrs:{shape:f}}),n.disposeIntermediateTensorInfo(I)}else{const S=n.bufferSync(r),I=O_(p,S,w,v);k=n.makeTensorInfo(f,I.dtype,I.values)}return k}const KQ={kernelName:ev,backendName:"cpu",kernelFunc:HQ};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qQ(t){const{inputs:e,backend:n,attrs:s}=t,{separator:r,nGramWidths:i,leftPad:o,rightPad:a,padWidth:l,preserveShortSequences:c}=s,{data:u,dataSplits:d}=e,h=n.data.get(u.dataId).values,p=n.data.get(d.dataId).values,[f,g]=P_(h,p,r,i,o,a,l,c);return[n.makeTensorInfo([f.length],"string",f),n.makeTensorInfo(d.shape,"int32",g)]}const XQ={kernelName:BT,backendName:"cpu",kernelFunc:qQ};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YQ(t){const{inputs:e,backend:n,attrs:s}=t,{skipEmpty:r}=s,{input:i,delimiter:o}=e;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(i.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${i.shape}`);if(o.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${o.shape}`);const a=n.data.get(i.dataId).values,l=n.data.get(o.dataId).values[0],[c,u,d]=M_(a,l,r),h=u.length;return[n.makeTensorInfo([h,2],"int32",c),n.makeTensorInfo([h],"string",u),n.makeTensorInfo([2],"int32",new Int32Array(d))]}const QQ={kernelName:WT,backendName:"cpu",kernelFunc:YQ};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JQ(t){const{inputs:e,backend:n,attrs:s}=t,{numBuckets:r}=s,{input:i}=e;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(r<=0)throw new Error("Number of buckets must be at least 1");const o=n.data.get(i.dataId).values,a=L_(o,r);return n.makeTensorInfo(i.shape,"int32",a)}const ZQ={kernelName:VT,backendName:"cpu",kernelFunc:JQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eJ=We(Id,t=>Math.tan(t)),tJ={kernelName:Id,backendName:"cpu",kernelFunc:eJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nJ=We($d,t=>Math.tanh(t)),sJ={kernelName:$d,backendName:"cpu",kernelFunc:nJ};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rJ(t){const{inputs:e,backend:n}=t,{tensor:s,indices:r,updates:i}=e,{sliceRank:o,numUpdates:a,sliceSize:l,strides:c,outputSize:u}=ya(i,r,s.shape),d=!1,h=n.bufferSync(r),p=n.bufferSync(i),f=n.bufferSync(s),g=Ao(h,p,s.shape,u,l,a,o,c,f,d);return n.makeTensorInfo(s.shape,g.dtype,g.values)}const iJ={kernelName:FT,backendName:"cpu",kernelFunc:rJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oJ(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{reps:i}=s;pe(r,"tile");const o=j_(n.bufferSync(r),i);return n.makeTensorInfo(o.shape,o.dtype,o.values)}const aJ={kernelName:Td,backendName:"cpu",kernelFunc:oJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lJ(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{k:i,sorted:o}=s;pe(r,"topk");const a=n.data.get(r.dataId).values,[l,c]=W_(a,r.shape,r.dtype,i,o);return[n.makeTensorInfo(l.shape,l.dtype,l.values),n.makeTensorInfo(c.shape,c.dtype,c.values)]}const cJ={kernelName:tv,backendName:"cpu",kernelFunc:lJ};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uJ(t){const{inputs:e,attrs:n,backend:s}=t,{image:r,transforms:i}=e,{interpolation:o,fillMode:a,fillValue:l,outputShape:c}=n,[u,d,h,p]=r.shape,[f,g]=c??[d,h],x=[u,f,g,p],y=me(r.shape),v=y[0],b=y[1],w=y[2],k=me(x),S=k[0],I=k[1],C=k[2],$=tn(r.dtype,J(x));$.fill(l);const R=s.data.get(r.dataId).values,_=s.data.get(i.dataId).values;for(let B=0;B<u;++B){const A=i.shape[0]===1?_:_.subarray(B*8,B*8+8);for(let F=0;F<f;++F)for(let P=0;P<g;++P)for(let H=0;H<p;++H){let E;const D=A[6]*P+A[7]*F+1;if(D===0)continue;const V=(A[0]*P+A[1]*F+A[2])/D,X=(A[3]*P+A[4]*F+A[5])/D,Z=mC(V,h,a),ee=mC(X,d,a);switch(o){case"nearest":E=gJ(R,d,h,v,b,w,B,ee,Z,H,l);break;case"bilinear":E=yJ(R,d,h,v,b,w,B,ee,Z,H,l);break;default:throw new Error(`Error in Transform: Expect 'nearest' or 'bilinear', but got ${o}`)}const ie=B*S+F*I+P*C+H;$[ie]=E}return s.makeTensorInfo(x,r.dtype,$)}return{dataId:s.write($,x,r.dtype),shape:r.shape,dtype:r.dtype}}const dJ={kernelName:nv,backendName:"cpu",kernelFunc:uJ};function mC(t,e,n){switch(n){case"reflect":return hJ(t,e);case"wrap":return pJ(t,e);case"nearest":return mJ(t,e);case"constant":default:return fJ(t)}}function hJ(t,e){let n=t;if(n<0)if(e<=1)n=0;else{const s=2*e;n<s&&(n=s*Math.trunc(-n/s)+n),n=n<-e?n+s:-n-1}else if(n>e-1)if(e<=1)n=0;else{const s=2*e;n-=s*Math.trunc(n/s),n>=e&&(n=s-n-1)}return Ho(0,n,e-1)}function pJ(t,e){let n=t;if(n<0)if(e<=1)n=0;else{const s=e-1;n+=e*(Math.trunc(-n/s)+1)}else if(n>e-1)if(e<=1)n=0;else{const s=e-1;n-=e*Math.trunc(n/s)}return Ho(0,n,e-1)}function fJ(t,e){return t}function mJ(t,e){return Ho(0,t,e-1)}function Sc(t,e,n,s,r,i,o,a,l,c,u){const d=o*s+a*r+l*i+c;return 0<=a&&a<e&&0<=l&&l<n?t[d]:u}function gJ(t,e,n,s,r,i,o,a,l,c,u){const d=Math.round(a),h=Math.round(l);return Sc(t,e,n,s,r,i,o,d,h,c,u)}function yJ(t,e,n,s,r,i,o,a,l,c,u){const d=Math.floor(a),h=Math.floor(l),p=d+1,f=h+1,g=(f-l)*Sc(t,e,n,s,r,i,o,d,h,c,u)+(l-h)*Sc(t,e,n,s,r,i,o,d,f,c,u),x=(f-l)*Sc(t,e,n,s,r,i,o,p,h,c,u)+(l-h)*Sc(t,e,n,s,r,i,o,p,f,c,u);return(p-a)*g+(a-d)*x}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xJ(t){const{inputs:e,attrs:n,backend:s}=t,{axis:r}=n,{x:i}=e;pe(i,"unique");const o=s.data.get(i.dataId).values,{outputValues:a,outputShape:l,indices:c}=V_(o,r,i.shape,i.dtype);return[s.makeTensorInfo(l,i.dtype,a),s.makeTensorInfo([c.length],"int32",c)]}const vJ={kernelName:sv,backendName:"cpu",kernelFunc:xJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bJ(t){const{inputs:e,backend:n,attrs:s}=t,{value:r}=e;let{axis:i}=s;i<0&&(i+=r.shape.length);const o=r.shape.length,a=r.shape[i],l=new Array(o-1);let c=0;for(let p=0;p<o;p++)p!==i&&(l[c++]=r.shape[p]);const u=new Array(o).fill(0),d=r.shape.slice();d[i]=1;const h=new Array(a);for(let p=0;p<h.length;p++){u[i]=p;const f=ia({inputs:{x:r},backend:n,attrs:{begin:u,size:d}});h[p]=Je({inputs:{x:f},backend:n,attrs:{shape:l}}),n.disposeIntermediateTensorInfo(f)}return h}const wJ={kernelName:Am,backendName:"cpu",kernelFunc:bJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kJ(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,segmentIds:i}=e,{numSegments:o}=s;pe(r,"unsortedSegmentSum");const a=r.shape.length,l=i.shape.length,c=[],u=[],d=a-l;let h=i;for(let f=0;f<d;++f){const g=nf({inputs:{input:h},backend:n,attrs:{dim:f+1}});h=g,u.push(g)}for(let f=0;f<o;++f){const g=ro(f,"int32"),x=n.makeTensorInfo([],"int32",g),y=r_({inputs:{a:x,b:h},backend:n}),v=Yi({inputs:{x:y},backend:n,attrs:{dtype:"float32"}}),b=ng({inputs:{a:v,b:r},backend:n}),w=Kd({inputs:{x:b},backend:n,attrs:{axis:0,keepDims:!1}});c.push(w),u.push(x),u.push(y),u.push(v),u.push(b),u.push(w)}const p=rD({inputs:c,backend:n,attrs:{axis:0}});return u.forEach(f=>n.disposeIntermediateTensorInfo(f)),p}const CJ={kernelName:_m,backendName:"cpu",kernelFunc:kJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SJ=[xK,J7,bK,kK,r9,SK,$K,EK,NK,_K,FK,PK,LK,BK,VK,HK,qK,YK,JK,gK,eq,nq,rq,o9,oq,n9,l9,lq,Z7,uq,hq,pq,mq,yq,vq,wq,Cq,Iq,Tq,Rq,Aq,Dq,Oq,Mq,Lq,jq,Wq,Uq,Gq,Hq,Kq,Xq,Jq,cK,eX,c9,lX,u9,cX,h9,mX,gX,xX,f9,g9,bX,kX,SX,$X,x9,b9,e9,EX,dq,NX,_X,FX,uK,k9,S9,PX,$9,LX,BX,VX,HX,qX,YX,QX,E9,ZX,tY,sY,iY,aY,cY,dY,N9,pY,gY,vY,_9,F9,kY,IY,EY,P9,NY,_Y,DY,iD,MY,hK,z9,zY,BY,VY,GY,t9,q0,KY,pK,fK,mK,XY,QY,ZY,tQ,sQ,rQ,oQ,K9,lQ,pQ,mQ,vQ,X9,wQ,CQ,IQ,Y9,yY,EQ,NQ,_Q,FQ,PQ,LQ,jQ,WQ,Z9,VQ,tK,sK,GQ,KQ,XQ,QQ,ZQ,aK,Yq,tJ,sJ,iJ,aJ,cJ,dJ,M9,vJ,wJ,CJ,AY];for(const t of SJ)GT(t);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const So={},Ih={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function IJ(t,e){So[t]=e}function er(t,e){if(!(t in So)||e!=null){const s=TJ(t,e);if(s!==null)So[t]=s;else return console.log("Could not get context for WebGL version",t),null}const n=So[t];return n==null||n.isContextLost()?(delete So[t],er(t)):(n.disable(n.DEPTH_TEST),n.disable(n.STENCIL_TEST),n.disable(n.BLEND),n.disable(n.DITHER),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SAMPLE_COVERAGE),n.enable(n.SCISSOR_TEST),n.enable(n.CULL_FACE),n.cullFace(n.BACK),So[t])}function $J(t){if(!q().getBool("IS_SAFARI")&&typeof OffscreenCanvas<"u"&&t===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}function TJ(t,e){if(t!==1&&t!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");const n=e??$J(t);return n.addEventListener("webglcontextlost",s=>{s.preventDefault(),delete So[t]},!1),q().getBool("SOFTWARE_WEBGL_ENABLED")&&(Ih.failIfMajorPerformanceCaveat=!1),t===1?n.getContext("webgl",Ih)||n.getContext("experimental-webgl",Ih):n.getContext("webgl2",Ih)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var gu;(function(t){t[t.DENSE=0]="DENSE",t[t.SHARED_BATCH=1]="SHARED_BATCH"})(gu||(gu={}));var Qn;(function(t){t[t.RENDER=0]="RENDER",t[t.UPLOAD=1]="UPLOAD",t[t.PIXELS=2]="PIXELS",t[t.DOWNLOAD=3]="DOWNLOAD"})(Qn||(Qn={}));var Gt;(function(t){t[t.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",t[t.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",t[t.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",t[t.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",t[t.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"})(Gt||(Gt={}));function qd(t,e){return[e,t]}function EJ(t,e){return t*e}function $h(t){const e=J(t),n=Math.ceil(e/4);return f0(n)}function Kl(t,e){return[Math.max(1,Math.ceil(e/2)),Math.max(1,Math.ceil(t/2))]}function RJ(t,e){const[n,s]=Kl(t,e);return n*s*4}function ew(t,e){const n=t;let s,r,i,o,a,l,c,u,d,h;return q().getNumber("WEBGL_VERSION")===2?(s=n.R32F,r=n.R16F,i=n.RGBA16F,o=n.RGBA32F,a=n.RED,c=4,u=1,d=n.HALF_FLOAT,h=n.FLOAT,l=n.RGBA8):(s=t.RGBA,r=t.RGBA,i=t.RGBA,o=n.RGBA,a=t.RGBA,c=4,u=4,d=e!=null?e.HALF_FLOAT_OES:null,h=t.FLOAT,l=t.RGBA),{internalFormatFloat:s,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:i,internalFormatPackedFloat:o,textureFormatFloat:a,downloadTextureFormat:l,downloadUnpackNumChannels:c,defaultNumChannels:u,textureTypeHalfFloat:d,textureTypeFloat:h}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ue(t,e){const n=e();return q().getBool("DEBUG")&&NJ(t),n}function NJ(t){const e=t.getError();if(e!==t.NO_ERROR)throw new Error("WebGL Error: "+FJ(t,e))}const AJ=596e-10,_J=65504;function DJ(t){return!!(q().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||t===0||AJ<Math.abs(t)&&Math.abs(t)<_J)}function FJ(t,e){switch(e){case t.NO_ERROR:return"NO_ERROR";case t.INVALID_ENUM:return"INVALID_ENUM";case t.INVALID_VALUE:return"INVALID_VALUE";case t.INVALID_OPERATION:return"INVALID_OPERATION";case t.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case t.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case t.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return`Unknown error code ${e}`}}function Th(t,e){return oi(t,()=>t.getExtension(e),'Extension "'+e+'" not supported on this browser.')}function OJ(t,e){const n=oi(t,()=>t.createShader(t.VERTEX_SHADER),"Unable to create vertex WebGLShader.");if(ue(t,()=>t.shaderSource(n,e)),ue(t,()=>t.compileShader(n)),t.getShaderParameter(n,t.COMPILE_STATUS)===!1)throw console.log(t.getShaderInfoLog(n)),new Error("Failed to compile vertex shader.");return n}function PJ(t,e){const n=oi(t,()=>t.createShader(t.FRAGMENT_SHADER),"Unable to create fragment WebGLShader.");if(ue(t,()=>t.shaderSource(n,e)),ue(t,()=>t.compileShader(n)),q().get("ENGINE_COMPILE_ONLY"))return n;if(t.getShaderParameter(n,t.COMPILE_STATUS)===!1)throw oD(e,t.getShaderInfoLog(n)),new Error("Failed to compile fragment shader.");return n}const MJ=/ERROR: [0-9]+:([0-9]+):/g;function oD(t,e){const n=MJ.exec(e);if(n==null){console.log(`Couldn't parse line number in error: ${e}`),console.log(t);return}const s=+n[1],r=t.split(`
`),i=r.length.toString().length+2,o=r.map((d,h)=>el((h+1).toString(),i)+d);let a=0;for(let d=0;d<o.length;d++)a=Math.max(o[d].length,a);const l=o.slice(0,s-1),c=o.slice(s-1,s),u=o.slice(s);console.log(l.join(`
`)),console.log(e.split(`
`)[0]),console.log(`%c ${el(c[0],a)}`,"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(u.join(`
`))}function LJ(t){return oi(t,()=>t.createProgram(),"Unable to create WebGLProgram.")}function zJ(t,e){if(ue(t,()=>t.linkProgram(e)),!q().get("ENGINE_COMPILE_ONLY")&&t.getProgramParameter(e,t.LINK_STATUS)===!1)throw console.log(t.getProgramInfoLog(e)),new Error("Failed to link vertex and fragment shaders.")}function ny(t,e){if(ue(t,()=>t.validateProgram(e)),t.getProgramParameter(e,t.VALIDATE_STATUS)===!1)throw console.log(t.getProgramInfoLog(e)),new Error("Shader program validation failed.")}function jJ(t,e){const n=oi(t,()=>t.createBuffer(),"Unable to create WebGLBuffer");return ue(t,()=>t.bindBuffer(t.ARRAY_BUFFER,n)),ue(t,()=>t.bufferData(t.ARRAY_BUFFER,e,t.STATIC_DRAW)),n}function BJ(t,e){const n=oi(t,()=>t.createBuffer(),"Unable to create WebGLBuffer");return ue(t,()=>t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,n)),ue(t,()=>t.bufferData(t.ELEMENT_ARRAY_BUFFER,e,t.STATIC_DRAW)),n}function WJ(t){return oi(t,()=>t.createTexture(),"Unable to create WebGLTexture.")}function VJ(t,e){const n=q().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(t<=0||e<=0){const s=`[${t}x${e}]`;throw new Error("Requested texture size "+s+" is invalid.")}if(t>n||e>n){const s=`[${t}x${e}]`,r=`[${n}x${n}]`;throw new Error("Requested texture size "+s+" greater than WebGL maximum on this browser / GPU "+r+".")}}function UJ(t){return oi(t,()=>t.createFramebuffer(),"Unable to create WebGLFramebuffer.")}function gC(t,e,n,s,r,i,o){const a=t.getAttribLocation(e,n);return a===-1?!1:(ue(t,()=>t.bindBuffer(t.ARRAY_BUFFER,s)),ue(t,()=>t.vertexAttribPointer(a,r,t.FLOAT,!1,i,o)),ue(t,()=>t.enableVertexAttribArray(a)),!0)}function GJ(t,e,n){YJ(t,n),ue(t,()=>t.activeTexture(t.TEXTURE0+n)),ue(t,()=>t.bindTexture(t.TEXTURE_2D,e))}function HJ(t,e,n){return oi(t,()=>t.getUniformLocation(e,n),'uniform "'+n+'" not present in program.')}function KJ(t,e,n){return t.getUniformLocation(e,n)}function qJ(t,e,n,s){ue(t,()=>GJ(t,e,s)),ue(t,()=>t.uniform1i(n,s))}function sy(t,e,n){ue(t,()=>t.bindFramebuffer(t.FRAMEBUFFER,n)),ue(t,()=>t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0))}function yC(t,e){ue(t,()=>t.bindFramebuffer(t.FRAMEBUFFER,e)),ue(t,()=>t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,null,0))}function Eh(t){const e=t.checkFramebufferStatus(t.FRAMEBUFFER);if(e!==t.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+XJ(t,e))}function XJ(t,e){switch(e){case t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case t.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return`unknown error ${e}`}}function oi(t,e,n){const s=ue(t,()=>e());if(s==null)throw new Error(n);return s}function YJ(t,e){const n=t.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,s=e+t.TEXTURE0;if(s<t.TEXTURE0||s>n){const r=`[gl.TEXTURE0, gl.TEXTURE${n}]`;throw new Error(`textureUnit must be in ${r}.`)}}function Tl(t,e=2){return J(t.slice(0,t.length-e))}function El(t){if(t.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[t.length>1?t[t.length-2]:1,t[t.length-1]]}function Rh(t){let e=[1,1,1];return t.length===0||t.length===1&&t[0]===1||(e=[Tl(t),...El(t)]),e}function QJ(t,e=!1){let n=q().getNumber("WEBGL_MAX_TEXTURE_SIZE"),s=q().getNumber("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE");s===1/0&&q().getBool("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE")&&(s=n/2),e&&(n=n*2,s=s*2,t=t.map((a,l)=>l>=t.length-2?h1(t[l]):t[l]),t.length===1&&(t=[2,t[0]])),t.length!==2&&(t=so(t).newShape);let r=J(t),i=null;t.length<=1&&r<=n?i=[1,r]:t.length===2&&t[0]<=n&&t[1]<=n?i=t:t.length===3&&t[0]*t[1]<=n&&t[2]<=n?i=[t[0]*t[1],t[2]]:t.length===3&&t[0]<=n&&t[1]*t[2]<=n?i=[t[0],t[1]*t[2]]:t.length===4&&t[0]*t[1]*t[2]<=n&&t[3]<=n?i=[t[0]*t[1]*t[2],t[3]]:t.length===4&&t[0]<=n&&t[1]*t[2]*t[3]<=n&&(i=[t[0],t[1]*t[2]*t[3]]);const o=i!=null&&Math.max(...i)>s&&Math.min(...i)<=(e?2:1)&&Math.min(...i)>0;if(i==null||o)if(e){const a=Tl(t);let l=2,c=2;t.length&&([l,c]=El(t)),r=a*(l/2)*(c/2),i=f0(r).map(u=>u*2)}else i=f0(r);return i}function Nh(t){return t%2===0}function rf(t,e){if(t=t.slice(-2),e=e.slice(-2),je(t,e)||!t.length||!e.length||t[0]===0||t[1]===0||e[0]===0||e[1]===0)return!0;if(t.length!==e.length){const n=t[t.length-1],s=e[e.length-1];if(n===s||Nh(n)&&Nh(s)&&(t[0]===1||e[0]===1))return!0}return t[1]===e[1]&&Nh(t[0])&&Nh(e[0])}let ry,iy;function JJ(t){if(ry==null){const e=er(t);ry=e.getParameter(e.MAX_TEXTURE_SIZE)}return ry}function ZJ(t){if(iy==null){const e=er(t);iy=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,iy)}function eZ(t){if(t===0)return 0;let e;const n=er(t);return bs(n,"EXT_disjoint_timer_query_webgl2")&&t===2?e=2:bs(n,"EXT_disjoint_timer_query")?e=1:e=0,e}function bs(t,e){return t.getExtension(e)!=null}function xC(t){try{if(er(t)!=null)return!0}catch(e){return console.log("Error when getting WebGL context: ",e),!1}return!1}function tZ(t){if(t===0)return!1;const e=er(t);if(t===1){if(!bs(e,"OES_texture_float"))return!1}else if(!bs(e,"EXT_color_buffer_float"))return!1;return Y0(e)}function nZ(t){if(t===0)return!1;const e=er(t);if(t===1){if(!bs(e,"OES_texture_float")||!bs(e,"WEBGL_color_buffer_float"))return!1}else{if(bs(e,"EXT_color_buffer_float"))return Y0(e);const s="EXT_color_buffer_half_float";if(bs(e,s)){const r=e.getExtension(s);return sZ(e,r)}return!1}return Y0(e)}function Y0(t){const e=ew(t),n=t.createTexture();t.bindTexture(t.TEXTURE_2D,n),t.texImage2D(t.TEXTURE_2D,0,e.internalFormatFloat,1,1,0,e.textureFormatFloat,e.textureTypeFloat,null);const i=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,i),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,n,0);const o=t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE;return t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.deleteTexture(n),t.deleteFramebuffer(i),o}function sZ(t,e){const n=ew(t,e),s=t.createTexture();t.bindTexture(t.TEXTURE_2D,s),t.texImage2D(t.TEXTURE_2D,0,n.internalFormatHalfFloat,1,1,0,n.textureFormatFloat,n.textureTypeHalfFloat,null);const o=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,o),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,s,0);const a=t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE;return t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.deleteTexture(s),t.deleteFramebuffer(o),a}function rZ(t){return t!==2?!1:er(t).fenceSync!=null}function Xd(t,e){Array.isArray(t)||(t=[t]),t.forEach(n=>{n!=null&&T(n.dtype!=="complex64",()=>`${e} does not support complex64 tensors in the WebGL backend.`)})}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fe=q();fe.registerFlag("HAS_WEBGL",()=>fe.getNumber("WEBGL_VERSION")>0);fe.registerFlag("WEBGL_VERSION",()=>xC(2)?2:xC(1)?1:0);fe.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",()=>!1);fe.registerFlag("WEBGL_BUFFER_SUPPORTED",()=>fe.get("WEBGL_VERSION")===2);fe.registerFlag("WEBGL_CPU_FORWARD",()=>!0);fe.registerFlag("WEBGL_FORCE_F16_TEXTURES",()=>!1);fe.registerFlag("WEBGL_PACK",()=>fe.getBool("HAS_WEBGL"));fe.registerFlag("WEBGL_PACK_NORMALIZATION",()=>fe.getBool("WEBGL_PACK"));fe.registerFlag("WEBGL_PACK_CLIP",()=>fe.getBool("WEBGL_PACK"));fe.registerFlag("WEBGL_PACK_DEPTHWISECONV",()=>fe.getBool("WEBGL_PACK"));fe.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",()=>fe.getBool("WEBGL_PACK"));fe.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",()=>fe.getBool("WEBGL_PACK"));fe.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",()=>fe.getBool("WEBGL_PACK"));fe.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",()=>fe.getBool("WEBGL_PACK"));fe.registerFlag("WEBGL_PACK_REDUCE",()=>fe.getBool("WEBGL_PACK"));fe.registerFlag("WEBGL_LAZILY_UNPACK",()=>fe.getBool("WEBGL_PACK"));fe.registerFlag("WEBGL_CONV_IM2COL",()=>fe.getBool("WEBGL_PACK"));fe.registerFlag("WEBGL_PACK_CONV2DTRANSPOSE",()=>fe.getBool("WEBGL_PACK"));fe.registerFlag("WEBGL_MAX_TEXTURE_SIZE",()=>JJ(fe.getNumber("WEBGL_VERSION")));fe.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",()=>ZJ(fe.getNumber("WEBGL_VERSION")));fe.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",()=>{const t=fe.getNumber("WEBGL_VERSION");return t===0?0:eZ(t)});fe.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",()=>fe.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!lE());fe.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",()=>tZ(fe.getNumber("WEBGL_VERSION")));fe.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",()=>fe.getBool("WEBGL_FORCE_F16_TEXTURES")?!1:fe.getBool("WEBGL_RENDER_FLOAT32_CAPABLE"));fe.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",()=>nZ(fe.getNumber("WEBGL_VERSION")));fe.registerFlag("WEBGL_FENCE_API_ENABLED",()=>rZ(fe.getNumber("WEBGL_VERSION")));fe.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",()=>fe.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0);fe.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",()=>-1,t=>{if(typeof t!="number")throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be a number but got ${t}.`);if(t<0&&t!==-1)throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never delete) or at least 0, but got ${t}.`)});fe.registerFlag("WEBGL_FLUSH_THRESHOLD",()=>lE()?1:-1,t=>{if(typeof t!="number")throw new Error(`WEBGL_FLUSH_THRESHOLD must be a number but got ${t}.`);if(t<0&&t!==-1)throw new Error(`WEBGL_FLUSH_THRESHOLD must be -1 (indicating never manual flush) or at least 0, but got ${t}.`)});fe.registerFlag("CPU_HANDOFF_SIZE_THRESHOLD",()=>128);fe.registerFlag("WEBGL_USE_SHAPES_UNIFORMS",()=>!1);fe.registerFlag("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",()=>1e5);fe.registerFlag("TOPK_K_CPU_HANDOFF_THRESHOLD",()=>128);fe.registerFlag("WEBGL_EXP_CONV",()=>!1);fe.registerFlag("SOFTWARE_WEBGL_ENABLED",()=>fe.getBool("IS_TEST"));fe.registerFlag("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE",()=>1/0);fe.registerFlag("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE",()=>!1);fe.registerFlag("WEBGL2_ISNAN_CUSTOM",()=>!1);fe.registerFlag("ENGINE_COMPILE_ONLY",()=>!1);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bn(){let t,e,n,s,r,i,o,a,l,c;return q().getNumber("WEBGL_VERSION")===2?(t="#version 300 es",e="in",n="out",s="in",r="texture",i="outputColor",o="out vec4 outputColor;",a=q().getBool("WEBGL2_ISNAN_CUSTOM")?`
      bool isnan_custom(float val) {
        uint floatToUint = floatBitsToUint(val);
        return (floatToUint & 0x7fffffffu) > 0x7f800000u;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `:"",l="",c=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(t="",e="attribute",n="varying",s="varying",r="texture2D",i="gl_FragColor",o="",a=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,l=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,c=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:t,attribute:e,varyingVs:n,varyingFs:s,texture2D:r,output:i,defineOutput:o,defineSpecialNaN:a,defineSpecialInf:l,defineRound:c}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ba(t,e,n="index"){const s=me(e);return s.map((r,i)=>{const o=`int ${t[i]} = ${n} / ${r}`,a=i===s.length-1?`int ${t[i+1]} = ${n} - ${t[i]} * ${r}`:`index -= ${t[i]} * ${r}`;return`${o}; ${a};`}).join("")}function sg(t,e,n="index"){const s=me(e);return s.map((r,i)=>{const o=`int ${t[i]} = ${n} / outShapeStrides[${i}]`,a=i===s.length-1?`int ${t[i+1]} = ${n} - ${t[i]} * outShapeStrides[${i}]`:`index -= ${t[i]} * outShapeStrides[${i}]`;return`${o}; ${a};`}).join("")}function iZ(t,e){const n=t.length,s=t.map(i=>`${e}[${i}]`),r=new Array(n-1);r[n-2]=s[n-1];for(let i=n-3;i>=0;--i)r[i]=`(${r[i+1]} * ${s[i+1]})`;return r}function oZ(t,e,n="index"){const s=t.map((i,o)=>o),r=iZ(s,e);return r.map((i,o)=>{const a=`int ${t[o]} = ${n} / ${r[o]}`,l=o===r.length-1?`int ${t[o+1]} = ${n} - ${t[o]} * ${r[o]}`:`index -= ${t[o]} * ${r[o]}`;return`${a}; ${l};`}).join("")}function tw(t){const e=me(t).map(n=>n.toString());return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * ${e[0]} + coords.y * ${e[1]} + coords.z;
  }
`}function nw(){return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;
  }
`}const aD=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const{getBroadcastDims:lD}=KU;function aZ(t,e,n){const s=[];if(t.forEach(p=>{const f=J(p.shapeInfo.logicalShape);if(p.shapeInfo.isUniform?s.push(`uniform float ${p.name}${f>1?`[${f}]`:""};`):(s.push(`uniform sampler2D ${p.name};`),s.push(`uniform int offset${p.name};`)),n.enableShapeUniforms){const{uniformShape:g}=sw(n.packedInputs,p.shapeInfo.logicalShape,p.shapeInfo.texShape);switch(g.length){case 1:s.push(`uniform int ${p.name}Shape;`);break;case 2:s.push(`uniform ivec2 ${p.name}Shape;`);break;case 3:s.push(`uniform ivec3 ${p.name}Shape;`);break;case 4:s.push(`uniform ivec4 ${p.name}Shape;`);break}s.push(`uniform ivec2 ${p.name}TexShape;`)}}),n.enableShapeUniforms){switch(e.logicalShape.length){case 1:s.push("uniform int outShape;");break;case 2:s.push("uniform ivec2 outShape;"),s.push("uniform int outShapeStrides;");break;case 3:s.push("uniform ivec3 outShape;"),s.push("uniform ivec2 outShapeStrides;");break;case 4:s.push("uniform ivec4 outShape;"),s.push("uniform ivec3 outShapeStrides;");break}s.push("uniform ivec2 outTexShape;")}n.customUniforms&&n.customUniforms.forEach(p=>{s.push(`uniform ${p.type} ${p.name}${p.arrayIndex?`[${p.arrayIndex}]`:""};`)});const r=s.join(`
`),i=t.map(p=>lZ(p,e,n.packedInputs,n.enableShapeUniforms)).join(`
`),o=e.texShape,a=bn(),l=dZ(a);let c,u,d=fZ(a);return e.isPacked?(c=cZ(e.logicalShape,o,n.enableShapeUniforms),u=pZ(a)):(c=uZ(e.logicalShape,o,n.enableShapeUniforms),u=hZ(a)),n.packedInputs&&(d+=xZ),[d,l,u,r,c,i,n.userCode].join(`
`)}function ql(t,e=!1){const n=t.shapeInfo.logicalShape;switch(n.length){case 0:return NZ(t,e);case 1:return _Z(t,e);case 2:return FZ(t,e);case 3:return PZ(t,e);case 4:return LZ(t,e);case 5:return zZ(t);case 6:return jZ(t);default:throw new Error(`${n.length}-D input sampling is not yet supported`)}}function cD(t,e){switch(t.shapeInfo.logicalShape.length){case 0:return RZ(t);case 1:return AZ(t,e);case 2:return DZ(t,e);case 3:return OZ(t,e);default:return MZ(t,e)}}function lZ(t,e,n=!1,s){let r="";n?r+=cD(t,s):r+=ql(t,s);const i=t.shapeInfo.logicalShape,o=e.logicalShape;return i.length<=o.length&&(n?r+=BZ(t,e):r+=WZ(t,e)),r}function cZ(t,e,n){switch(t.length){case 0:return uD();case 1:return vZ(t,e,n);case 2:return TZ(t,e,n);case 3:return wZ(t,e,n);default:return CZ(t,e,n)}}function uZ(t,e,n){switch(t.length){case 0:return uD();case 1:return bZ(t,e,n);case 2:return EZ(t,e,n);case 3:return kZ(t,e,n);case 4:return SZ(t,e,n);case 5:return IZ(t,e);case 6:return $Z(t,e);default:throw new Error(`${t.length}-D output sampling is not yet supported`)}}function dZ(t){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return ${t.texture2D}(textureSampler, uv).r;
    }
  `}function hZ(t){return`
    void setOutput(float val) {
      ${t.output} = vec4(val, 0, 0, 0);
    }
  `}function pZ(t){return`
    void setOutput(vec4 val) {
      ${t.output} = val;
    }
  `}function fZ(t){return`${t.version}
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    ${t.varyingFs} vec2 resultUV;
    ${t.defineOutput}
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    ${t.defineSpecialNaN}
    ${t.defineSpecialInf}
    ${t.defineRound}

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    ${mZ}
    ${gZ}
    ${yZ}
  `}const mZ=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,gZ=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,yZ=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,xZ=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function uD(){return`
    int getOutputCoords() {
      return 0;
    }
  `}function vZ(t,e,n){const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];return s[0]===1?n?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ceil(float(outTexShape[1]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ${s[1]}.0);
      }
    `:s[1]===1?n?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ceil(float(outTexShape[0]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ${s[0]}.0);
      }
    `:n?`
    int getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      return 2 * (resTexRC.x * packedTexShape[1] + resTexRC.y);
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));
      return 2 * (resTexRC.x * ${s[1]} + resTexRC.y);
    }
  `}function bZ(t,e,n){return e[0]===1?n?`
      int getOutputCoords() {
        return int(resultUV.x * float(outTexShape[1]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.x * ${e[1]}.0);
      }
    `:e[1]===1?n?`
      int getOutputCoords() {
        return int(resultUV.y * float(outTexShape[0]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.y * ${e[0]}.0);
      }
    `:n?`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      return resTexRC.x * outTexShape[1] + resTexRC.y;
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      return resTexRC.x * ${e[1]} + resTexRC.y;
    }
  `}function wZ(t,e,n){if(n)return`
    ivec3 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec3(b, r, c);
    }
  `;const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],r=Math.ceil(t[2]/2),i=r*Math.ceil(t[1]/2);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));
      int index = resTexRC.x * ${s[1]} + resTexRC.y;

      int b = index / ${i};
      index -= b * ${i};

      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec3(b, r, c);
    }
  `}function kZ(t,e,n){if(n)return`
  ivec3 getOutputCoords() {
    ivec2 resTexRC = ivec2(resultUV.yx *
                           vec2(outTexShape[0], outTexShape[1]));
    int index = resTexRC.x * outTexShape[1] + resTexRC.y;
    ${sg(["r","c","d"],t)}
    return ivec3(r, c, d);
  }
`;const s=ba(["r","c","d"],t);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      ${s}
      return ivec3(r, c, d);
    }
  `}function CZ(t,e,n){if(n)return`
    ivec4 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int texelsInLogicalRow = int(ceil(float(outShape[3]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatchN = texelsInBatch * outShape[1];

      int b2 = index / texelsInBatchN;
      index -= b2 * texelsInBatchN;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec4(b2, b, r, c);
    }
  `;const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],r=Math.ceil(t[t.length-1]/2),i=r*Math.ceil(t[t.length-2]/2);let o=i,a="",l="b, r, c";for(let c=2;c<t.length-1;c++)o*=t[t.length-c-1],a=`
      int b${c} = index / ${o};
      index -= b${c} * ${o};
    `+a,l=`b${c}, `+l;return`
    ivec${t.length} getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));
      int index = resTexRC.x * ${s[1]} + resTexRC.y;

      ${a}

      int b = index / ${i};
      index -= b * ${i};

      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec${t.length}(${l});
    }
  `}function SZ(t,e,n){if(n)return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      ${sg(["r","c","d","d2"],t)}
      return ivec4(r, c, d, d2);
    }
  `;const s=ba(["r","c","d","d2"],t);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      ${s}
      return ivec4(r, c, d, d2);
    }
  `}function IZ(t,e){const n=ba(["r","c","d","d2","d3"],t);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(${e[0]},
                             ${e[1]}));

      int index = resTexRC.x * ${e[1]} + resTexRC.y;

      ${n}

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}function $Z(t,e){const n=ba(["r","c","d","d2","d3","d4"],t);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;

      ${n}

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}function TZ(t,e,n){const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];if(je(t,e))return n?`
      ivec2 getOutputCoords() {
        ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
        return 2 * ivec2(resultUV.yx * vec2(packedTexShape[0], packedTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(${s[0]}, ${s[1]}));
      }
    `;const r=Math.ceil(t[1]/2);return n?`
    ivec2 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));

      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;
      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));

      int index = resTexRC.x * ${s[1]} + resTexRC.y;
      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec2(r, c);
    }
  `}function EZ(t,e,n){return je(t,e)?n?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(outTexShape[0], outTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(${e[0]}, ${e[1]}));
      }
    `:t[1]===1?n?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(index, 0);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${e[0]}, ${e[1]}));
        int index = resTexRC.x * ${e[1]} + resTexRC.y;
        return ivec2(index, 0);
      }
    `:t[0]===1?n?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${e[0]}, ${e[1]}));
        int index = resTexRC.x * ${e[1]} + resTexRC.y;
        return ivec2(0, index);
      }
    `:n?`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      int r = index / outShape[1];
      int c = index - r * outShape[1];
      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      int r = index / ${t[1]};
      int c = index - r * ${t[1]};
      return ivec2(r, c);
    }
  `}function wa(t){return`offset${t}`}function RZ(t){const e=t.name,n="get"+e.charAt(0).toUpperCase()+e.slice(1),s=bn();return`
    vec4 ${n}() {
      return ${s.texture2D}(${e}, halfCR);
    }
  `}function NZ(t,e){const n=t.name,s="get"+n.charAt(0).toUpperCase()+n.slice(1);if(t.shapeInfo.isUniform)return`float ${s}() {return ${n};}`;const[r,i]=t.shapeInfo.texShape;if(r===1&&i===1)return`
      float ${s}() {
        return sampleTexture(${n}, halfCR);
      }
    `;const o=wa(n);if(e)return`
    float ${s}() {
      vec2 uv = uvFromFlat(${n}TexShape[0], ${n}TexShape[1], ${o});
      return sampleTexture(${n}, uv);
    }
  `;const[a,l]=t.shapeInfo.texShape;return`
    float ${s}() {
      vec2 uv = uvFromFlat(${a}, ${l}, ${o});
      return sampleTexture(${n}, uv);
    }
  `}function AZ(t,e){const n=t.name,s="get"+n.charAt(0).toUpperCase()+n.slice(1),r=t.shapeInfo.texShape,i=bn();if(e)return`
    vec4 ${s}(int index) {
      ivec2 packedTexShape = ivec2(ceil(float(${n}TexShape[0]) / 2.0), ceil(float(${n}TexShape[1]) / 2.0));
      vec2 uv = packedUVfrom1D(
        packedTexShape[0], packedTexShape[1], index);
      return ${i.texture2D}(${n}, uv);
    }
  `;const o=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)];return`
    vec4 ${s}(int index) {
      vec2 uv = packedUVfrom1D(
        ${o[0]}, ${o[1]}, index);
      return ${i.texture2D}(${n}, uv);
    }
  `}function _Z(t,e){const n=t.name,s="get"+n.charAt(0).toUpperCase()+n.slice(1);if(t.shapeInfo.isUniform)return`
      float ${s}(int index) {
        ${Xl(t)}
      }
    `;const r=t.shapeInfo.texShape,i=r[0],o=r[1];if(o===1&&i===1)return`
      float ${s}(int index) {
        return sampleTexture(${n}, halfCR);
      }
    `;const a=wa(n);return o===1?e?`
      float ${s}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${a}) + 0.5) / float(${n}TexShape[0]));
        return sampleTexture(${n}, uv);
      }
    `:`
      float ${s}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${a}) + 0.5) / ${i}.0);
        return sampleTexture(${n}, uv);
      }
    `:i===1?e?`
      float ${s}(int index) {
        vec2 uv = vec2((float(index + ${a}) + 0.5) / float(${n}TexShape[1]), 0.5);
        return sampleTexture(${n}, uv);
      }
    `:`
      float ${s}(int index) {
        vec2 uv = vec2((float(index + ${a}) + 0.5) / ${o}.0, 0.5);
        return sampleTexture(${n}, uv);
      }
    `:e?`
    float ${s}(int index) {
      vec2 uv = uvFromFlat(${n}TexShape[0], ${n}TexShape[1], index + ${a});
      return sampleTexture(${n}, uv);
    }
  `:`
    float ${s}(int index) {
      vec2 uv = uvFromFlat(${i}, ${o}, index + ${a});
      return sampleTexture(${n}, uv);
    }
  `}function DZ(t,e){const n=t.shapeInfo.logicalShape,s=t.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),i=t.shapeInfo.texShape,o=i[0],a=i[1],l=bn();if(i!=null&&je(n,i))return e?`
      vec4 ${r}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${s}TexShape[1], ${s}TexShape[0]);

        return ${l.texture2D}(${s}, uv);
      }
    `:`
      vec4 ${r}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${a}.0, ${o}.0);

        return ${l.texture2D}(${s}, uv);
      }
    `;if(e)return`
    vec4 ${r}(int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${s}TexShape[0]) / 2.0), ceil(float(${s}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${s}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom2D(valuesPerRow, packedTexShape[0], packedTexShape[1], row, col);
      return ${l.texture2D}(${s}, uv);
    }
  `;const c=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)],u=Math.ceil(n[1]/2);return`
    vec4 ${r}(int row, int col) {
      vec2 uv = packedUVfrom2D(${u}, ${c[0]}, ${c[1]}, row, col);
      return ${l.texture2D}(${s}, uv);
    }
  `}function FZ(t,e){const n=t.shapeInfo.logicalShape,s=t.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),i=t.shapeInfo.texShape;if(i!=null&&je(n,i)){if(e)return`
      float ${r}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `;const h=i[0],p=i[1];return`
    float ${r}(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(${p}.0, ${h}.0);
      return sampleTexture(${s}, uv);
    }
  `}const{newShape:o,keptDims:a}=so(n),l=o;if(l.length<n.length){const h=Yl(t,l),p=["row","col"];return`
      ${ql(h,e)}
      float ${r}(int row, int col) {
        return ${r}(${Ql(p,a)});
      }
    `}if(t.shapeInfo.isUniform)return`
      float ${r}(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(${n[1]}, 1)));
        ${Xl(t)}
      }
    `;const c=i[0],u=i[1],d=wa(s);return u===1?e?`
      float ${r}(int row, int col) {
        float index = dot(vec3(row, col, ${d}), vec3(${s}Shape[1], 1, 1));
        vec2 uv = vec2(0.5, (index + 0.5) / float(${s}TexShape[0]));
        return sampleTexture(${s}, uv);
      }
    `:`
    float ${r}(int row, int col) {
      float index = dot(vec3(row, col, ${d}), vec3(${n[1]}, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / ${c}.0);
      return sampleTexture(${s}, uv);
    }
  `:c===1?e?`
      float ${r}(int row, int col) {
        float index = dot(vec3(row, col, ${d}), vec3(${s}Shape[1], 1, 1));
        vec2 uv = vec2((index + 0.5) / float(${s}TexShape[1]), 0.5);
        return sampleTexture(${s}, uv);
      }
    `:`
    float ${r}(int row, int col) {
      float index = dot(vec3(row, col, ${d}), vec3(${n[1]}, 1, 1));
      vec2 uv = vec2((index + 0.5) / ${u}.0, 0.5);
      return sampleTexture(${s}, uv);
    }
  `:e?`
      float ${r}(int row, int col) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${s}Shape[1] + col + ${d};
        vec2 uv = uvFromFlat(${s}TexShape[0], ${s}TexShape[1], index);
        return sampleTexture(${s}, uv);
      }
    `:`
  float ${r}(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * ${n[1]} + col + ${d};
    vec2 uv = uvFromFlat(${c}, ${u}, index);
    return sampleTexture(${s}, uv);
  }
`}function OZ(t,e){const n=t.shapeInfo.logicalShape,s=t.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),i=t.shapeInfo.texShape,o=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];if(n[0]===1){const h=n.slice(1),p=[1,2],f=Yl(t,h),g=["b","row","col"];return`
        ${cD(f,e)}
        vec4 ${r}(int b, int row, int col) {
          return ${r}(${Ql(g,p)});
        }
      `}const a=bn();if(e)return`
    vec4 ${r}(int b, int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${s}TexShape[0]) / 2.0), ceil(float(${s}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${s}Shape[2]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${s}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom3D(
        packedTexShape[0], packedTexShape[1], texelsInBatch, valuesPerRow, b, row, col);
      return ${a.texture2D}(${s}, uv);
    }
  `;const l=o[0],c=o[1],u=Math.ceil(n[2]/2),d=u*Math.ceil(n[1]/2);return`
    vec4 ${r}(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        ${l}, ${c}, ${d}, ${u}, b, row, col);
      return ${a.texture2D}(${s}, uv);
    }
  `}function PZ(t,e){const n=t.shapeInfo.logicalShape,s=t.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),i=n[1]*n[2],o=n[2],{newShape:a,keptDims:l}=so(n),c=a;if(c.length<n.length){const g=Yl(t,c),x=["row","col","depth"];return`
        ${ql(g,e)}
        float ${r}(int row, int col, int depth) {
          return ${r}(${Ql(x,l)});
        }
      `}if(t.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(${i}, ${o}, 1)));
        ${Xl(t)}
      }
    `;const u=t.shapeInfo.texShape,d=u[0],h=u[1],p=t.shapeInfo.flatOffset;if(h===i&&p==null)return e?`
      float ${r}(int row, int col, int depth) {
        int stride1 = ${s}Shape[2];
        float texR = float(row);
        float texC = dot(vec2(col, depth), vec2(stride1, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
        float ${r}(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(${o}, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(${h}.0, ${d}.0);
          return sampleTexture(${s}, uv);
        }
      `;if(h===o&&p==null)return e?`
      float ${r}(int row, int col, int depth) {
        float texR = dot(vec2(row, col), vec2(${s}Shape[1], 1));
        float texC = float(depth);
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
    float ${r}(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(${n[1]}, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${h}.0, ${d}.0);
      return sampleTexture(${s}, uv);
    }
  `;const f=wa(s);return e?`
    float ${r}(int row, int col, int depth) {
      // Explicitly use integer operations as dot() only works on floats.
      int stride0 = ${s}Shape[1] * ${s}Shape[2];
      int stride1 = ${s}Shape[2];
      int index = row * stride0 + col * stride1 + depth + ${f};
      vec2 uv = uvFromFlat(${s}TexShape[0], ${s}TexShape[1], index);
      return sampleTexture(${s}, uv);
    }
    `:`
      float ${r}(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${i} + col * ${o} + depth + ${f};
        vec2 uv = uvFromFlat(${d}, ${h}, index);
        return sampleTexture(${s}, uv);
      }
  `}function MZ(t,e){const n=t.name,s="get"+n.charAt(0).toUpperCase()+n.slice(1),r=bn();if(e)return`
    vec4 ${s}(int b2, int b, int row, int col) {
      int valuesPerRow = int(ceil(float(${n}Shape[3]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${n}Shape[2]) / 2.0));
      int index = b * texelsInBatch + (row / 2) * valuesPerRow + (col / 2);
      texelsInBatch *= ${n}Shape[1];
      index = b2 * texelsInBatch + index;
      ivec2 packedTexShape = ivec2(ceil(float(${n}TexShape[0]) / 2.0), ceil(float(${n}TexShape[1]) / 2.0));
      int texR = index / packedTexShape[1];
      int texC = index - texR * packedTexShape[1];
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(packedTexShape[1], packedTexShape[0]); return ${r.texture2D}(${n}, uv);
    }
  `;const i=t.shapeInfo.logicalShape,o=i.length,a=t.shapeInfo.texShape,l=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)],c=l[0],u=l[1],d=Math.ceil(i[o-1]/2);let h=d*Math.ceil(i[o-2]/2),p="int b, int row, int col",f=`b * ${h} + (row / 2) * ${d} + (col / 2)`;for(let g=2;g<o-1;g++)p=`int b${g}, `+p,h*=i[o-g-1],f=`b${g} * ${h} + `+f;return`
    vec4 ${s}(${p}) {
      int index = ${f};
      int texR = index / ${u};
      int texC = index - texR * ${u};
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${u}, ${c});
      return ${r.texture2D}(${n}, uv);
    }
  `}function LZ(t,e){const n=t.shapeInfo.logicalShape,s=t.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),i=n[3],o=n[2]*i,a=n[1]*o,{newShape:l,keptDims:c}=so(n);if(l.length<n.length){const v=Yl(t,l),b=["row","col","depth","depth2"];return`
      ${ql(v,e)}
      float ${r}(int row, int col, int depth, int depth2) {
        return ${r}(${Ql(b,c)});
      }
    `}if(t.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(${a}, ${o}, ${i}, 1)));
        ${Xl(t)}
      }
    `;const u=t.shapeInfo.flatOffset,d=t.shapeInfo.texShape,h=d[0],p=d[1],f=`int stride2 = ${s}Shape[3];`,g=`int stride1 = ${s}Shape[2] * stride2;`,x=`int stride0 = ${s}Shape[1] * stride1;`;if(p===a&&u==null)return e?`
      float ${r}(int row, int col, int depth, int depth2) {
        ${f}
        ${g}
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(stride1, stride2, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
      float ${r}(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(${o}, ${i}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${p}.0, ${h}.0);
        return sampleTexture(${s}, uv);
      }
    `;if(p===i&&u==null)return e?`
      float ${r}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${s}Shape[1] * ${s}Shape[2], ${s}Shape[2], 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
      float ${r}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${n[1]*n[2]}, ${n[2]}, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${p}.0, ${h}.0);
        return sampleTexture(${s}, uv);
      }
    `;const y=wa(s);return e?`
    float ${r}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      ${f}
      ${g}
      ${x}
      int index = row * stride0 + col * stride1 +
          depth * stride2 + depth2;
      vec2 uv = uvFromFlat(${s}TexShape[0], ${s}TexShape[1], index + ${y});
      return sampleTexture(${s}, uv);
    }
  `:`
    float ${r}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${a} + col * ${o} +
          depth * ${i} + depth2;
      vec2 uv = uvFromFlat(${h}, ${p}, index + ${y});
      return sampleTexture(${s}, uv);
    }
  `}function zZ(t){const e=t.shapeInfo.logicalShape,n=t.name,s="get"+n.charAt(0).toUpperCase()+n.slice(1),r=e[4],i=e[3]*r,o=e[2]*i,a=e[1]*o,{newShape:l,keptDims:c}=so(e);if(l.length<e.length){const g=Yl(t,l),x=["row","col","depth","depth2","depth3"];return`
      ${ql(g)}
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        return ${s}(${Ql(x,c)});
      }
    `}if(t.shapeInfo.isUniform)return`
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(${a}, ${o}, ${i}, ${r})) +
          depth3;
        ${Xl(t)}
      }
    `;const u=t.shapeInfo.flatOffset,d=t.shapeInfo.texShape,h=d[0],p=d[1];if(p===a&&u==null)return`
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(${o}, ${i}, ${r}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${p}.0, ${h}.0);
        return sampleTexture(${n}, uv);
      }
    `;if(p===r&&u==null)return`
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(${e[1]*e[2]*e[3]},
               ${e[2]*e[3]}, ${e[3]}, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${p}.0, ${h}.0);
        return sampleTexture(${n}, uv);
      }
    `;const f=wa(n);return`
    float ${s}(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${a} + col * ${o} + depth * ${i} +
          depth2 * ${r} + depth3 + ${f};
      vec2 uv = uvFromFlat(${h}, ${p}, index);
      return sampleTexture(${n}, uv);
    }
  `}function jZ(t){const e=t.shapeInfo.logicalShape,n=t.name,s="get"+n.charAt(0).toUpperCase()+n.slice(1),{newShape:r,keptDims:i}=so(e);if(r.length<e.length){const x=Yl(t,r),y=["row","col","depth","depth2","depth3","depth4"];return`
      ${ql(x)}
      float ${s}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return ${s}(${Ql(y,i)});
      }
    `}const o=e[5],a=e[4]*o,l=e[3]*a,c=e[2]*l,u=e[1]*c;if(t.shapeInfo.isUniform)return`
      float ${s}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(${u}, ${c}, ${l}, ${a})) +
          dot(
            vec2(depth3, depth4),
            vec2(${o}, 1)));
        ${Xl(t)}
      }
    `;const d=t.shapeInfo.flatOffset,h=t.shapeInfo.texShape,p=h[0],f=h[1];if(f===u&&d==null)return`
      float ${s}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(${c}, ${l}, ${a}, ${o})) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${f}.0, ${p}.0);
        return sampleTexture(${n}, uv);
      }
    `;if(f===o&&d==null)return`
      float ${s}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(${e[1]*e[2]*e[3]*e[4]},
               ${e[2]*e[3]*e[4]},
               ${e[3]*e[4]},
               ${e[4]})) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${f}.0, ${p}.0);
        return sampleTexture(${n}, uv);
      }
    `;const g=wa(n);return`
    float ${s}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${u} + col * ${c} + depth * ${l} +
          depth2 * ${a} + depth3 * ${o} + depth4 + ${g};
      vec2 uv = uvFromFlat(${p}, ${f}, index);
      return sampleTexture(${n}, uv);
    }
  `}function Xl(t){const e=t.name,n=J(t.shapeInfo.logicalShape);return n<2?`return ${e};`:`
    for (int i = 0; i < ${n}; i++) {
      if (i == index) {
        return ${e}[i];
      }
    }
  `}function BZ(t,e){const n=t.name,s=n.charAt(0).toUpperCase()+n.slice(1),r="get"+s+"AtOutCoords",i=t.shapeInfo.logicalShape.length,o=e.logicalShape.length,a=lD(t.shapeInfo.logicalShape,e.logicalShape),l=Ge(o),c=o-i;let u;const d=["x","y","z","w","u","v"];i===0?u="":o<2&&a.length>=1?u="coords = 0;":u=a.map(v=>`coords.${d[v+c]} = 0;`).join(`
`);let h="";o<2&&i>0?h="coords":h=t.shapeInfo.logicalShape.map((v,b)=>`coords.${d[b+c]}`).join(", ");let p="return outputValue;";const g=J(t.shapeInfo.logicalShape)===1,y=J(e.logicalShape)===1;if(i===1&&!g&&!y)p=`
      return vec4(outputValue.xy, outputValue.xy);
    `;else if(g&&!y)o===1?p=`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:p=`
        return vec4(outputValue.x);
      `;else if(a.length){const v=i-2,b=i-1;a.indexOf(v)>-1&&a.indexOf(b)>-1?p="return vec4(outputValue.x);":a.indexOf(v)>-1?p="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":a.indexOf(b)>-1&&(p="return vec4(outputValue.xx, outputValue.zz);")}return`
    vec4 ${r}() {
      ${l} coords = getOutputCoords();
      ${u}
      vec4 outputValue = get${s}(${h});
      ${p}
    }
  `}function WZ(t,e){const n=t.name,s=n.charAt(0).toUpperCase()+n.slice(1),r="get"+s+"AtOutCoords",i=e.texShape,o=t.shapeInfo.texShape,a=t.shapeInfo.logicalShape.length,l=e.logicalShape.length;if(!t.shapeInfo.isUniform&&a===l&&t.shapeInfo.flatOffset==null&&je(o,i))return`
      float ${r}() {
        return sampleTexture(${n}, resultUV);
      }
    `;const c=Ge(l),u=lD(t.shapeInfo.logicalShape,e.logicalShape),d=l-a;let h;const p=["x","y","z","w","u","v"];a===0?h="":l<2&&u.length>=1?h="coords = 0;":h=u.map(g=>`coords.${p[g+d]} = 0;`).join(`
`);let f="";return l<2&&a>0?f="coords":f=t.shapeInfo.logicalShape.map((g,x)=>`coords.${p[x+d]}`).join(", "),`
    float ${r}() {
      ${c} coords = getOutputCoords();
      ${h}
      return get${s}(${f});
    }
  `}function Ge(t){if(t<=1)return"int";if(t===2)return"ivec2";if(t===3)return"ivec3";if(t===4)return"ivec4";if(t===5)return"ivec5";if(t===6)return"ivec6";throw Error(`GPU for rank ${t} is not yet supported`)}function sw(t,e,n){const{newShape:s,keptDims:r}=so(e),i=e.length,o=t&&i===3&&e[0]===1,a=o?e.slice(1):s,l=!t&&i>1&&!je(e,n)&&s.length<i||o;return{useSqueezeShape:l,uniformShape:l?a:e,keptDims:r}}function Yl(t,e){const n=JSON.parse(JSON.stringify(t));return n.shapeInfo.logicalShape=e,n}function Ql(t,e){return e.map(n=>t[n]).join(", ")}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VZ(t,e,n,s){const r=n.map((u,d)=>{const h={logicalShape:u.shape,texShape:u.isUniform?null:u.texData.texShape,isUniform:u.isUniform,isPacked:u.isUniform?!1:u.texData.isPacked,flatOffset:null};return u.texData!=null&&u.texData.slice!=null&&u.texData.slice.flatOffset>0&&(h.flatOffset=u.texData.slice.flatOffset),{name:e.variableNames[d],shapeInfo:h}}),i=r.map(u=>u.shapeInfo),o={logicalShape:s.shape,texShape:s.texData.texShape,isUniform:!1,isPacked:s.texData.isPacked,flatOffset:null},a=aZ(r,o,e),l=PJ(t.gl,a),c=t.createProgram(l);return q().get("ENGINE_COMPILE_ONLY")?{program:e,fragmentShader:l,source:a,webGLProgram:c,inShapeInfos:i,outShapeInfo:o,variablesLocations:null,customUniformLocations:null,infLoc:null,nanLoc:null,outShapeLocation:null,outShapeStridesLocation:null,outTexShapeLocation:null}:(t.buildVao(c),Object.assign({program:e,fragmentShader:l,source:a,webGLProgram:c,inShapeInfos:i,outShapeInfo:o},dD(t,e,c)))}function dD(t,e,n){const s=[],r=[];let i,o,a,l=null,c=null;c=t.getUniformLocation(n,"NAN",!1),q().getNumber("WEBGL_VERSION")===1&&(l=t.getUniformLocation(n,"INFINITY",!1));const u=!1;for(const d of e.variableNames){const h={name:d,uniform:t.getUniformLocation(n,d,u),offset:t.getUniformLocation(n,`offset${d}`,u)};e.enableShapeUniforms&&(h.shape=t.getUniformLocation(n,`${d}Shape`,u),h.texShape=t.getUniformLocation(n,`${d}TexShape`,u)),s.push(h)}if(e.enableShapeUniforms&&(i=t.getUniformLocation(n,"outShape",u),a=t.getUniformLocation(n,"outShapeStrides",u),o=t.getUniformLocation(n,"outTexShape",u)),e.customUniforms)for(const d of e.customUniforms)r.push(t.getUniformLocation(n,d.name,u));return{variablesLocations:s,customUniformLocations:r,infLoc:l,nanLoc:c,outShapeLocation:i,outShapeStridesLocation:a,outTexShapeLocation:o}}function vC(t,e){if(t.length!==e.length)throw Error(`Binary was compiled with ${t.length} inputs, but was executed with ${e.length} inputs`);t.forEach((n,s)=>{const r=n.logicalShape,i=e[s],o=i.shape;if(!je(r,o))throw Error(`Binary was compiled with different shapes than the current args. Shapes ${r} and ${o} must match`);if(n.isUniform&&i.isUniform)return;const a=n.texShape,l=i.isUniform?null:i.texData.texShape;if(!je(a,l))throw Error(`Binary was compiled with different texture shapes than the current args. Shape ${a} and ${l} must match`)})}function UZ(t,e,n,s,r){e.program.enableShapeUniforms||(vC(e.inShapeInfos,n),vC([e.outShapeInfo],[s]));const i=s.texData.texture,o=s.texData.texShape;s.texData.isPacked?t.setOutputPackedMatrixTexture(i.texture,o[0],o[1]):t.setOutputMatrixTexture(i.texture,o[0],o[1]),t.setProgram(e.webGLProgram),t.bindVertexArray(e.webGLProgram.vao),q().getNumber("WEBGL_VERSION")===1&&e.infLoc!==null&&t.gl.uniform1f(e.infLoc,1/0),e.nanLoc!==null&&t.gl.uniform1f(e.nanLoc,NaN);for(let l=0;l<n.length;++l){const c=n[l],{uniform:u,offset:d,shape:h,texShape:p}=e.variablesLocations[l];if(h){const{uniformShape:f}=sw(e.program.packedInputs,c.shape,c.texData.texShape);switch(f.length){case 1:t.gl.uniform1iv(h,new Int32Array(f));break;case 2:t.gl.uniform2iv(h,new Int32Array(f));break;case 3:t.gl.uniform3iv(h,new Int32Array(f));break;case 4:t.gl.uniform4iv(h,new Int32Array(f));break}}if(p&&t.gl.uniform2i(p,c.texData.texShape[0],c.texData.texShape[1]),u!=null){if(c.isUniform){if(J(c.shape)<2)t.gl.uniform1f(u,c.uniformValues[0]);else{let f=c.uniformValues;f instanceof Float32Array||(f=new Float32Array(f)),t.gl.uniform1fv(u,f)}continue}c.texData.slice!=null&&d!=null&&t.gl.uniform1i(d,c.texData.slice.flatOffset),t.setInputMatrixTexture(c.texData.texture.texture,u,l)}}const a=e.outShapeLocation;if(a)switch(s.shape.length){case 1:t.gl.uniform1iv(a,new Int32Array(s.shape));break;case 2:t.gl.uniform2iv(a,new Int32Array(s.shape));break;case 3:t.gl.uniform3iv(a,new Int32Array(s.shape));break;case 4:t.gl.uniform4iv(a,new Int32Array(s.shape));break}if(e.outShapeStridesLocation){const l=me(s.shape);switch(s.shape.length){case 2:t.gl.uniform1iv(e.outShapeStridesLocation,new Int32Array(l));break;case 3:t.gl.uniform2iv(e.outShapeStridesLocation,new Int32Array(l));break;case 4:t.gl.uniform3iv(e.outShapeStridesLocation,new Int32Array(l));break}}if(e.outTexShapeLocation&&t.gl.uniform2i(e.outTexShapeLocation,s.texData.texShape[0],s.texData.texShape[1]),e.program.customUniforms&&r)for(let l=0;l<e.program.customUniforms.length;++l){const c=e.program.customUniforms[l],u=e.customUniformLocations[l],d=r[l];if(c.type==="float")t.gl.uniform1fv(u,d);else if(c.type==="vec2")t.gl.uniform2fv(u,d);else if(c.type==="vec3")t.gl.uniform3fv(u,d);else if(c.type==="vec4")t.gl.uniform4fv(u,d);else if(c.type==="int")t.gl.uniform1iv(u,d);else if(c.type==="ivec2")t.gl.uniform2iv(u,d);else if(c.type==="ivec3")t.gl.uniform3iv(u,d);else if(c.type==="ivec4")t.gl.uniform4iv(u,d);else throw Error(`uniform type ${c.type} is not supported yet.`)}t.executeProgram()}function GZ(t,e,n){let s="";e.concat(n).forEach(o=>{const a=o.texData!=null&&o.texData.slice!=null&&o.texData.slice.flatOffset>0;if(t.enableShapeUniforms&&!o.isUniform){const l=o.texData.texShape,{useSqueezeShape:c,uniformShape:u,keptDims:d}=sw(t.packedInputs,o.shape,l);let h="",p="",f="";if(u.length===1&&t.packedInputs){const k=[Math.ceil(l[0]/2),Math.ceil(l[1]/2)];h=`${k[0]>1}_${k[1]>1}`}else if(u.length===2&&!t.packedInputs)p=`${u[0]>1}_${u[1]>1}`;else if(u.length>2&&!t.packedInputs){const k=me(u);f=`${k[0]===l[1]}_${k[k.length-1]===l[1]}`}const g=o.shape.length,x=u.length===2&&je(o.shape,l),y=J(o.shape)===1,v=bl(o.shape,n.shape),b=!t.packedInputs&&g===n.shape.length&&je(l,n.texData.texShape),w=t.packedInputs||u.length>2?"":`${l[0]>1}_${l[1]>1}`;s+=`${g}_${b}_${c?d:""}_${u.length}_${y}_${v}_${x}_${h}_${p}_${f}_${w}_${a}`}else{const l=o.isUniform?"uniform":o.texData.texShape;s+=`${o.shape}_${l}_${a}`}});const r=t.userCode;let i=t.constructor.name;return i+="_"+s+"_"+r+`${q().getNumber("WEBGL_VERSION")}`,i}function an(t){return q().getBool("WEBGL_USE_SHAPES_UNIFORMS")&&t<=4}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class HZ{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=gu.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const n=bn();this.outputShape=e,this.enableShapeUniforms=an(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?sg(["r","c","d"],e):ba(["r","c","d"],e)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        ${n.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class KZ{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=gu.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const n=bn();this.outputShape=e,this.enableShapeUniforms=an(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?sg(["r","c","d"],e):ba(["r","c","d"],e)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        ${n.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class qZ{constructor(e){this.variableNames=["A"],this.outTexUsage=Qn.DOWNLOAD;const n=bn();this.outputShape=e,this.userCode=`
      ${aD}

      void main() {
        float x = getAAtOutCoords();
        ${n.output} = encode_float(x);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class XZ{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=Qn.DOWNLOAD;const n=bn();this.outputShape=e,this.userCode=`
      ${aD}

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        ${n.output} = encode_float(x);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YZ={R:0,G:1,B:2,A:3};class bC{constructor(e,n=!1,s="RGBA"){this.variableNames=["A"],this.customUniforms=[{name:"texShape",type:"ivec2"}];const r=bn();this.outputShape=e,this.enableShapeUniforms=an(this.outputShape.length);let i="result";n&&(i="floor(result * 255. + 0.5)");let o="";for(let a=0;a<s.length;a++){const l=s[a];o+=`
          if(offset == ${a}) {
            result = values[${YZ[l]}];
          }`}this.userCode=`
      ${this.enableShapeUniforms?nw():tw(e)}

      void main() {
        ivec3 coords = getOutputCoords();
        int flatIndex = getFlatIndex(coords);
        float result = 0.;
        int offset = imod(flatIndex, ${s.length});

        flatIndex = idiv(flatIndex, ${s.length}, 1.);

        int r = flatIndex / texShape[1];
        if (r < texShape[0]) {
          int c = imod(flatIndex, texShape[1]);
          vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
          vec4 values = ${r.texture2D}(A, uv);
          ${o}
        }
        ${r.output} = vec4(${i}, 0., 0., 0.);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class QZ{constructor(e,n=!1){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.customUniforms=[{name:"texShape",type:"ivec2"}];const s=bn();this.outputShape=e,this.enableShapeUniforms=an(this.outputShape.length);let r="",i="result";n&&(i="floor(result * 255. + 0.5)");for(let o=0;o<=1;o++)for(let a=0;a<=1;a++){const l=o*2+a;r+=`
          localCoords = coords;
          if(localCoords[2] + ${a} < ${this.enableShapeUniforms?"outShape[2]":`${e[2]}`}) {
          localCoords[2] += ${a};
          if (localCoords[1] + ${o} < ${this.enableShapeUniforms?"outShape[1]":`${e[1]}`}) {
            localCoords[1] += ${o};

            flatIndex = getFlatIndex(localCoords);
            offset = imod(flatIndex, 4);

            flatIndex = idiv(flatIndex, 4, 1.);

            int r = flatIndex / texShape[1];
            int c = imod(flatIndex, texShape[1]);
            vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
            values = ${s.texture2D}(A, uv);

            if (offset == 0) {
              result[${l}] = values[0];
            } else if (offset == 1) {
              result[${l}] = values[1];
            } else if (offset == 2) {
              result[${l}] = values[2];
            } else {
              result[${l}] = values[3];
            }
          }
        }
        `}this.userCode=`
        ${this.enableShapeUniforms?nw():tw(e)}

        void main() {
          ivec3 coords = getOutputCoords();

          vec4 result = vec4(0.);
          int flatIndex, r, c, offset;
          ivec3 localCoords;
          vec2 uv;
          vec4 values;

          ${r}

          ${s.output} = ${i};
        }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JZ(t){const e=bn(),n=`${e.version}
    precision highp float;
    ${e.attribute} vec3 clipSpacePos;
    ${e.attribute} vec2 uv;
    ${e.varyingVs} vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`;return OJ(t,n)}function ZZ(t){const e=new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]);return jJ(t,e)}function eee(t){const e=new Uint16Array([0,1,2,2,1,3]);return BJ(t,e)}function Yd(t,e,n,s,r,i){VJ(e,n);const o=WJ(t),a=t.TEXTURE_2D;return ue(t,()=>t.bindTexture(a,o)),ue(t,()=>t.texParameteri(a,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE)),ue(t,()=>t.texParameteri(a,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE)),ue(t,()=>t.texParameteri(a,t.TEXTURE_MIN_FILTER,t.NEAREST)),ue(t,()=>t.texParameteri(a,t.TEXTURE_MAG_FILTER,t.NEAREST)),q().getNumber("WEBGL_VERSION")===1?ue(t,()=>t.texImage2D(a,0,s,e,n,0,r,i,null)):ue(t,()=>t.texStorage2D(a,1,s,e,n)),ue(t,()=>t.bindTexture(t.TEXTURE_2D,null)),{texture:o,texShape:[n,e]}}function hD(t){return t.internalFormatFloat}function tee(t,e,n,s){const[r,i]=qd(e,n);return Yd(t,r,i,hD(s),s.textureFormatFloat,t.FLOAT)}function pD(t){return t.internalFormatHalfFloat}function nee(t,e,n,s){const[r,i]=qd(e,n);return Yd(t,r,i,pD(s),s.textureFormatFloat,s.textureTypeHalfFloat)}function fD(t){return t.downloadTextureFormat}function see(t,e,n,s){const[r,i]=qd(e,n);return Yd(t,r,i,fD(s),t.RGBA,t.UNSIGNED_BYTE)}function mD(t){return t.internalFormatPackedFloat}function ree(t,e,n,s){const[r,i]=Kl(e,n);return Yd(t,r,i,mD(s),t.RGBA,t.FLOAT)}function gD(t){return t.internalFormatPackedHalfFloat}function iee(t,e,n,s){const[r,i]=Kl(e,n);return Yd(t,r,i,gD(s),t.RGBA,s.textureTypeHalfFloat)}function oee(t,e,n){return ue(t,()=>t.bindBuffer(t.ARRAY_BUFFER,n)),gC(t,e,"clipSpacePos",n,3,20,0)&&gC(t,e,"uv",n,2,20,12)}function aee(t,e,n,s,r,i){ue(t,()=>t.bindTexture(t.TEXTURE_2D,e));let o,a,l;r instanceof Uint8Array?(o=new Uint8Array(n*s*4),a=t.UNSIGNED_BYTE,l=t.RGBA):(o=new Float32Array(n*s*4),a=t.FLOAT,l=i.internalFormatPackedFloat),o.set(r),q().getNumber("WEBGL_VERSION")===2?ue(t,()=>t.texSubImage2D(t.TEXTURE_2D,0,0,0,n,s,t.RGBA,a,o)):ue(t,()=>t.texImage2D(t.TEXTURE_2D,0,l,n,s,0,t.RGBA,a,o)),ue(t,()=>t.bindTexture(t.TEXTURE_2D,null))}function lee(t,e,n){ue(t,()=>t.bindTexture(t.TEXTURE_2D,e)),n.data instanceof Uint8Array?q().getNumber("WEBGL_VERSION")===2?ue(t,()=>t.texSubImage2D(t.TEXTURE_2D,0,0,0,n.width,n.height,t.RGBA,t.UNSIGNED_BYTE,n.data)):ue(t,()=>t.texImage2D(t.TEXTURE_2D,0,t.RGBA,n.width,n.height,0,t.RGBA,t.UNSIGNED_BYTE,n.data)):q().getNumber("WEBGL_VERSION")===2?ue(t,()=>t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,n)):ue(t,()=>t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,n)),ue(t,()=>t.bindTexture(t.TEXTURE_2D,null))}function cee(t,e,n,s){const r=t.createBuffer();ue(t,()=>t.bindBuffer(t.PIXEL_PACK_BUFFER,r));const a=4*4*e*n;return ue(t,()=>t.bufferData(t.PIXEL_PACK_BUFFER,a,t.STREAM_READ)),ue(t,()=>t.readPixels(0,0,n,e,t.RGBA,t.FLOAT,0)),ue(t,()=>t.bindBuffer(t.PIXEL_PACK_BUFFER,null)),r}function uee(t,e,n){const s=t,r=new Float32Array(n);return s.bindBuffer(s.PIXEL_PACK_BUFFER,e),s.getBufferSubData(s.PIXEL_PACK_BUFFER,0,r),s.bindBuffer(s.PIXEL_PACK_BUFFER,null),r}function dee(t,e,n,s){const[r,i]=qd(e,n),o=4,a=new Uint8Array(EJ(e*n,o));return ue(t,()=>t.readPixels(0,0,r,i,s.downloadTextureFormat,t.UNSIGNED_BYTE,a)),new Float32Array(a.buffer)}function hee(t,e,n,s,r,i,o,a){const l=t,c=new Float32Array(RJ(i,o));return l.bindBuffer(l.PIXEL_PACK_BUFFER,e),l.getBufferSubData(l.PIXEL_PACK_BUFFER,0,c),l.bindBuffer(l.PIXEL_PACK_BUFFER,null),c}function pee(t,e,n){const s=new Float32Array(e*n*4);return ue(t,()=>t.readPixels(0,0,n,e,t.RGBA,t.FLOAT,s)),s}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class oy{constructor(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.itemsToPoll=[];const n=q().getNumber("WEBGL_VERSION");if(e!=null?(this.gl=e,IJ(n,e)):this.gl=er(n),e=this.gl,q().getNumber("WEBGL_VERSION")===2){const i=e;this.createVertexArray=()=>ue(i,()=>i.createVertexArray()),this.bindVertexArray=o=>ue(i,()=>i.bindVertexArray(o)),this.deleteVertexArray=o=>ue(i,()=>i.deleteVertexArray(o)),this.getVertexArray=()=>ue(i,()=>i.getParameter(i.VERTEX_ARRAY_BINDING))}else if(e!=null){const i=e.getExtension("OES_vertex_array_object");if(i==null)throw new Error("All WebGL1 implementations are expected to offer OES_vertex_array_object.");this.createVertexArray=()=>ue(e,()=>i.createVertexArrayOES()),this.bindVertexArray=o=>ue(e,()=>i.bindVertexArrayOES(o)),this.deleteVertexArray=o=>ue(e,()=>i.deleteVertexArrayOES(o)),this.getVertexArray=()=>ue(e,()=>e.getParameter(i.VERTEX_ARRAY_BINDING_OES))}let s="WEBGL_color_buffer_float";const r="EXT_color_buffer_half_float";if(this.parallelCompilationExtension=this.gl.getExtension("KHR_parallel_shader_compile"),q().getNumber("WEBGL_VERSION")===1){const i="OES_texture_float",o="OES_texture_half_float";if(this.textureFloatExtension=Th(this.gl,i),bs(this.gl,o))this.textureHalfFloatExtension=Th(this.gl,o);else if(q().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(s),bs(this.gl,r))this.colorBufferHalfFloatExtension=Th(this.gl,r);else if(q().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(s="EXT_color_buffer_float",bs(this.gl,s))this.colorBufferFloatExtension=this.gl.getExtension(s);else if(bs(this.gl,r))this.colorBufferHalfFloatExtension=this.gl.getExtension(r);else throw new Error("GL context does not support color renderable floats");this.vertexBuffer=ZZ(this.gl),this.indexBuffer=eee(this.gl),this.framebuffer=UJ(this.gl),this.textureConfig=ew(this.gl,this.textureHalfFloatExtension)}get debug(){return q().getBool("DEBUG")}dispose(){if(this.disposed)return;this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");const e=this.gl;ue(e,()=>e.finish()),ue(e,()=>e.bindFramebuffer(e.FRAMEBUFFER,null)),ue(e,()=>e.deleteFramebuffer(this.framebuffer)),ue(e,()=>e.bindBuffer(e.ARRAY_BUFFER,null)),ue(e,()=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)),ue(e,()=>e.deleteBuffer(this.indexBuffer)),this.disposed=!0}createFloat32MatrixTexture(e,n){return this.throwIfDisposed(),tee(this.gl,e,n,this.textureConfig)}createFloat16MatrixTexture(e,n){return this.throwIfDisposed(),nee(this.gl,e,n,this.textureConfig)}createUnsignedBytesMatrixTexture(e,n){return this.throwIfDisposed(),see(this.gl,e,n,this.textureConfig)}uploadPixelDataToTexture(e,n){this.throwIfDisposed(),lee(this.gl,e,n)}uploadDenseMatrixToTexture(e,n,s,r){this.throwIfDisposed(),aee(this.gl,e,n,s,r,this.textureConfig)}createFloat16PackedMatrixTexture(e,n){return this.throwIfDisposed(),iee(this.gl,e,n,this.textureConfig)}createPackedMatrixTexture(e,n){return this.throwIfDisposed(),ree(this.gl,e,n,this.textureConfig)}deleteMatrixTexture(e){this.throwIfDisposed(),this.outputTexture===e&&(yC(this.gl,this.framebuffer),this.outputTexture=null),ue(this.gl,()=>this.gl.deleteTexture(e))}downloadByteEncodedFloatMatrixFromOutputTexture(e,n,s){return this.downloadMatrixDriver(e,()=>dee(this.gl,n,s,this.textureConfig))}downloadPackedMatrixFromBuffer(e,n,s,r,i,o){return hee(this.gl,e,n,s,r,i,o,this.textureConfig)}downloadFloat32MatrixFromBuffer(e,n){return uee(this.gl,e,n)}createBufferFromTexture(e,n,s){this.bindTextureToFrameBuffer(e);const r=cee(this.gl,n,s,this.textureConfig);return this.unbindTextureToFrameBuffer(),r}createAndWaitForFence(){const e=this.createFence(this.gl);return this.pollFence(e)}createFence(e){let n,s;if(q().getBool("WEBGL_FENCE_API_ENABLED")){const r=e,i=r.fenceSync(r.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),s=()=>{const o=r.clientWaitSync(i,0,0);return o===r.ALREADY_SIGNALED||o===r.CONDITION_SATISFIED},n=i}else q().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(n=this.beginQuery(),this.endQuery(),s=()=>this.isQueryAvailable(n,q().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))):s=()=>!0;return{query:n,isFencePassed:s}}downloadMatrixFromPackedTexture(e,n,s){return this.downloadMatrixDriver(e,()=>pee(this.gl,n,s))}createProgram(e){this.throwIfDisposed();const n=this.gl;this.vertexShader==null&&(this.vertexShader=JZ(n));const s=LJ(n);ue(n,()=>n.attachShader(s,this.vertexShader)),ue(n,()=>n.attachShader(s,e)),zJ(n,s);const r=Object.assign(s,{vao:this.createVertexArray()});return this.debug&&ny(n,r),r}buildVao(e){this.setProgram(e),this.bindVertexArray(e.vao);const n=this.gl;ue(n,()=>n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,this.indexBuffer)),oee(n,e,this.vertexBuffer)}deleteProgram(e){this.throwIfDisposed(),e===this.program&&(this.program=null),e!=null&&(ue(this.gl,()=>this.gl.deleteProgram(e)),this.deleteVertexArray(e.vao))}setProgram(e){this.throwIfDisposed(),this.program=e,this.program!=null&&this.debug&&ny(this.gl,this.program),ue(this.gl,()=>this.gl.useProgram(e))}getUniformLocation(e,n,s=!0){return this.throwIfDisposed(),s?HJ(this.gl,e,n):KJ(this.gl,e,n)}getAttributeLocation(e,n){return this.throwIfDisposed(),ue(this.gl,()=>this.gl.getAttribLocation(e,n))}getUniformLocationNoThrow(e,n){return this.throwIfDisposed(),this.gl.getUniformLocation(e,n)}setInputMatrixTexture(e,n,s){this.throwIfDisposed(),this.throwIfNoProgram(),qJ(this.gl,e,n,s)}setOutputMatrixTexture(e,n,s){this.setOutputMatrixTextureDriver(e,s,n)}setOutputPackedMatrixTexture(e,n,s){this.throwIfDisposed();const[r,i]=Kl(n,s);this.setOutputMatrixTextureDriver(e,r,i)}setOutputMatrixWriteRegion(e,n,s,r){this.setOutputMatrixWriteRegionDriver(s,e,r,n)}setOutputPackedMatrixWriteRegion(e,n,s,r){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}debugValidate(){this.program!=null&&ny(this.gl,this.program),Eh(this.gl)}executeProgram(){this.throwIfDisposed(),this.throwIfNoProgram();const e=this.gl;if(this.debug){const n=this.getVertexArray();console.assert(n===this.program.vao,"VAO changed between setProgram and executeProgram!"),this.debugValidate()}ue(e,()=>e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0))}blockUntilAllProgramsCompleted(){this.throwIfDisposed(),ue(this.gl,()=>this.gl.finish())}getQueryTimerExtension(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=Th(this.gl,q().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}getQueryTimerExtensionWebGL2(){return this.getQueryTimerExtension()}getQueryTimerExtensionWebGL1(){return this.getQueryTimerExtension()}beginQuery(){if(q().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){const s=this.gl,r=this.getQueryTimerExtensionWebGL2(),i=s.createQuery();return s.beginQuery(r.TIME_ELAPSED_EXT,i),i}const e=this.getQueryTimerExtensionWebGL1(),n=e.createQueryEXT();return e.beginQueryEXT(e.TIME_ELAPSED_EXT,n),n}endQuery(){if(q().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){const n=this.gl,s=this.getQueryTimerExtensionWebGL2();n.endQuery(s.TIME_ELAPSED_EXT);return}const e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}async waitForQueryAndGetTime(e){return await rk(()=>this.disposed||this.isQueryAvailable(e,q().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))),this.getQueryTime(e,q().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}getQueryTime(e,n){if(n===0)return null;if(n===2){const s=this.gl;return s.getQueryParameter(e,s.QUERY_RESULT)/1e6}else{const s=this.getQueryTimerExtensionWebGL1();return s.getQueryObjectEXT(e,s.QUERY_RESULT_EXT)/1e6}}isQueryAvailable(e,n){if(n===0)return!0;if(n===2){const s=this.gl,r=this.getQueryTimerExtensionWebGL2(),i=s.getQueryParameter(e,s.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),i&&!this.disjoint}else{const s=this.getQueryTimerExtensionWebGL1(),r=s.getQueryObjectEXT(e,s.QUERY_RESULT_AVAILABLE_EXT);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(s.GPU_DISJOINT_EXT)),r&&!this.disjoint}}pollFence(e){return new Promise(n=>{this.addItemToPoll(()=>e.isFencePassed(),()=>n())})}pollItems(){const e=fee(this.itemsToPoll.map(n=>n.isDoneFn));for(let n=0;n<=e;++n){const{resolveFn:s}=this.itemsToPoll[n];s()}this.itemsToPoll=this.itemsToPoll.slice(e+1)}addItemToPoll(e,n){if(this.itemsToPoll.push({isDoneFn:e,resolveFn:n}),this.itemsToPoll.length>1)return;let s;"setTimeoutCustom"in q().platform&&(s=q().platform.setTimeoutCustom.bind(q().platform)),rk(()=>(this.pollItems(),this.itemsToPoll.length===0),()=>0,null,s)}bindTextureToFrameBuffer(e){this.throwIfDisposed(),sy(this.gl,e,this.framebuffer),this.debug&&Eh(this.gl)}unbindTextureToFrameBuffer(){this.outputTexture!=null?(sy(this.gl,this.outputTexture,this.framebuffer),this.debug&&Eh(this.gl)):yC(this.gl,this.framebuffer)}downloadMatrixDriver(e,n){this.bindTextureToFrameBuffer(e);const s=n();return this.unbindTextureToFrameBuffer(),s}setOutputMatrixTextureDriver(e,n,s){this.throwIfDisposed();const r=this.gl;sy(r,e,this.framebuffer),this.debug&&Eh(r),this.outputTexture=e,ue(r,()=>r.viewport(0,0,n,s)),ue(r,()=>r.scissor(0,0,n,s))}setOutputMatrixWriteRegionDriver(e,n,s,r){this.throwIfDisposed(),ue(this.gl,()=>this.gl.scissor(e,n,s,r))}throwIfDisposed(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}throwIfNoProgram(){if(this.program==null)throw new Error("No GPU program is currently set.")}}function fee(t){let e=0;for(;e<t.length&&t[e]();++e);return e-1}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const{addImpl:mee,bincountImpl:yD,bincountReduceImpl:gee,bitwiseAndImpl:yee,castImpl:xee,ceilImpl:vee,concatImpl:bee,equalImpl:wee,expImpl:kee,expm1Impl:Cee,floorImpl:See,gatherNdImpl:Iee,gatherV2Impl:$ee,greaterImpl:Tee,greaterEqualImpl:Eee,lessImpl:Ree,lessEqualImpl:Nee,linSpaceImpl:Aee,logImpl:_ee,maxImpl:Dee,maximumImpl:Fee,minimumImpl:Oee,multiplyImpl:Pee,negImpl:Mee,notEqualImpl:Lee,prodImpl:zee,raggedGatherImpl:jee,raggedRangeImpl:Bee,raggedTensorToTensorImpl:Wee,rangeImpl:Vee,rsqrtImpl:Uee,scatterImpl:Gee,sigmoidImpl:Hee,simpleAbsImpl:xD,sliceImpl:Kee,sparseFillEmptyRowsImpl:qee,sparseReshapeImpl:Xee,sparseSegmentReductionImpl:vD,sqrtImpl:Yee,staticRegexReplaceImpl:Qee,stridedSliceImpl:Jee,stringNGramsImpl:Zee,stringSplitImpl:ete,stringToHashBucketFastImpl:tte,subImpl:nte,tileImpl:ste,topKImpl:rte,transposeImpl:rw,uniqueImpl:ite}=lK;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bD(t,e){return["x","y","z","w","u","v"].slice(0,e).map(n=>`${t}.${n}`)}function mn(t,e){return e===1?[t]:bD(t,e)}function ote(t,e){if(t===1)return"rc";let n="";for(let s=0;s<t;s++)n+=e[s],s<t-1&&(n+=",");return n}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ate{constructor(e){if(this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.enableShapeUniforms=an(this.outputShape.length),this.rank===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{const n=mn("rc",this.rank),s=Ge(this.rank),r=this.getOutOfBoundsCondition(n),i=this.getSetup(n),o=this.getOutput(n);this.userCode=`
        void main() {
          ${s} rc = getOutputCoords();

          if(${r}) {
            setOutput(vec4(0));
          } else {
            ${i}

            setOutput(vec4(${o}));
          }
        }
      `}}getSourceCoordsArr(e){const n=[];for(let s=0;s<=1;s++)for(let r=0;r<=1;r++){let i=`${s===0?"r":"rp1"}, ${r===0?"c":"cp1"}`;for(let o=2;o<this.rank;o++)i=`${e[e.length-1-o]},`+i;n.push(i)}return n}getOutOfBoundsCondition(e){if(this.rank===1)return`rc > ${this.enableShapeUniforms?"outShape":this.outputShape[0]}`;let n="";for(let s=this.rank-2;s<this.rank;s++)n+=`${e[s]} >= ${this.enableShapeUniforms?`outShape[${s}]`:this.outputShape[s]}`,s<this.rank-1&&(n+="||");return n}getSetup(e){if(this.rank===1)return"";const n=e.slice(-2),s=this.enableShapeUniforms?`outShape[${this.rank} - 1]`:this.outputShape[this.rank-1],r=this.enableShapeUniforms?`outShape[${this.rank} - 2]`:this.outputShape[this.rank-2];return`
      int r = ${n[0]};
      int c = ${n[1]};
      int rp1 = r + 1;
      int cp1 = c + 1;

      bool cEdge = cp1 >= ${s};
      bool rEdge = rp1 >= ${r};
    `}getOutput(e){const n=this.getSourceCoordsArr(e);return this.rank===1?`getA(rc), (rc + 1 >= ${this.enableShapeUniforms?"outShape":this.outputShape[0]} ? 0. : getA(rc + 1)), 0, 0`:`getA(${n[0]}),
            cEdge ? 0. : getA(${n[1]}),
            rEdge ? 0. : getA(${n[2]}),
            rEdge || cEdge ? 0. : getA(${n[3]})`}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class wD{constructor(e,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"}],this.outputShape=e,this.enableShapeUniforms=an(this.outputShape.length);let s="";for(let r=0;r<4;r++){let i="thisRC = rc;";r%2===1&&(i+="thisRC.z += 1;"),r>1&&(i+="thisRC.y += 1;"),s+=`
        ${i}
        ${r>0?"if(thisRC.y < rows && thisRC.z < cols){":""}
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[${r}] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        ${r>0?"}":""}
      `}this.userCode=`
      ${lte(n,this.enableShapeUniforms)}
      ${this.enableShapeUniforms?nw():tw(e)}

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = ${this.enableShapeUniforms?"outShape[1]":e[1]};
        int cols = ${this.enableShapeUniforms?"outShape[2]":e[2]};

        ${s}

        setOutput(result);
      }
    `}}function lte(t,e){return`
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      ${e?oZ(["r","c","d"],"inputShape"):ba(["r","c","d"],t)}
      return ivec3(r, c, d);
    }
  `}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class cte{constructor(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.usedTextures={},this.logEnabled=!1}acquireTexture(e,n,s){const r=kC(n,s),i=CC(e,r,s);i in this.freeTextures||(this.freeTextures[i]=[]),i in this.usedTextures||(this.usedTextures[i]=[]);const o=wC(e,r,this.gpgpu.gl,this.gpgpu.textureConfig,s);if(this.freeTextures[i].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=o,this.log();const l=this.freeTextures[i].pop();return this.usedTextures[i].push(l),l}let a;return r===Gt.PACKED_2X2_FLOAT32?a=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):r===Gt.PACKED_2X2_FLOAT16?a=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):r===Gt.UNPACKED_FLOAT32?a=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):r===Gt.UNPACKED_FLOAT16?a=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):r===Gt.PACKED_4X1_UNSIGNED_BYTE&&(a=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[i].push(a),this.numUsedTextures++,this._numBytesAllocated+=o,this.log(),a}releaseTexture(e,n,s,r){if(this.freeTextures==null)return;const i=kC(s,r),o=CC(n,i,r);o in this.freeTextures||(this.freeTextures[o]=[]);const a=wC(n,i,this.gpgpu.gl,this.gpgpu.textureConfig,r),l=q().getNumber("WEBGL_DELETE_TEXTURE_THRESHOLD");l!==-1&&this._numBytesAllocated>l?(this.gpgpu.deleteMatrixTexture(e.texture),this._numBytesAllocated-=a):(this.freeTextures[o].push(e),this.numFreeTextures++,this._numBytesFree+=a),this.numUsedTextures--;const c=this.usedTextures[o],u=c&&c.indexOf(e);if(u==null||u<0)throw new Error("Cannot release a texture that was never provided by this texture manager");c[u]=c[c.length-1],c.pop(),this.log()}log(){if(!this.logEnabled)return;const e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",`${this.numFreeTextures} / ${this.numUsedTextures}`,`(${e})`);const n=this._numBytesFree/this._numBytesAllocated;console.log(`Bytes allocated: ${this._numBytesAllocated}`),console.log(`Bytes unused: ${this._numBytesFree} (${Math.round(100*n)}%)`)}get numBytesAllocated(){return this._numBytesAllocated}get numBytesFree(){return this._numBytesFree}getNumUsedTextures(){return this.numUsedTextures}getNumFreeTextures(){return this.numFreeTextures}dispose(){if(this.freeTextures!=null){for(const e in this.freeTextures)this.freeTextures[e].forEach(n=>{this.gpgpu.deleteMatrixTexture(n.texture)});for(const e in this.usedTextures)this.usedTextures[e].forEach(n=>{this.gpgpu.deleteMatrixTexture(n.texture)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}}function ute(t,e){const n=t;if(e===n.R32F)return 4;if(e===n.R16F)return 2;if(e===n.RGBA32F)return 16;if(e===t.RGBA)return 16;if(e===n.RGBA16F)return 8;if(e===n.RGBA8)return 4;throw new Error(`Unknown internal format ${e}`)}function wC(t,e,n,s,r){const i=dte(e,s);let o;if(r){const[l,c]=Kl(t[0],t[1]);o=l*c}else{const[l,c]=qd(t[0],t[1]);o=l*c}const a=ute(n,i);return o*a}function dte(t,e){switch(t){case Gt.PACKED_2X2_FLOAT32:return mD(e);case Gt.PACKED_2X2_FLOAT16:return gD(e);case Gt.UNPACKED_FLOAT32:return hD(e);case Gt.UNPACKED_FLOAT16:return pD(e);case Gt.PACKED_4X1_UNSIGNED_BYTE:return fD(e);default:throw new Error(`Unknown physical texture type ${t}`)}}function hte(t){return q().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?t?Gt.PACKED_2X2_FLOAT32:Gt.UNPACKED_FLOAT32:t?Gt.PACKED_2X2_FLOAT16:Gt.UNPACKED_FLOAT16}function kC(t,e){if(t===Qn.UPLOAD)return Gt.PACKED_2X2_FLOAT32;if(t===Qn.RENDER||t==null)return hte(e);if(t===Qn.DOWNLOAD||t===Qn.PIXELS)return Gt.PACKED_4X1_UNSIGNED_BYTE;throw new Error(`Unknown logical texture type ${t}`)}function CC(t,e,n){return`${t[0]}_${t[1]}_${e}_${n}`}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class dr{constructor(e,n){this.variableNames=["A"],this.outputShape=e,this.enableShapeUniforms=an(this.outputShape.length),this.userCode=`
      float unaryOperation(float x) {
        ${n}
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `}}const Rs="if (isnan(x)) return x;",pte="return x;",SC="return abs(x);",fte="return (x >= 0.0) ? x : (exp(x) - 1.0);",mte=Rs+`
  return (x < 0.0) ? 0.0 : x;
`,gte=Rs+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,mi="return x;",yte="return 1.0 / (1.0 + exp(-1.0 * x));";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xte="return x;",vte=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,bte=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,wte=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,kte="return 1.0 / (1.0 + exp(-1.0 * x));";class Ti{constructor(e,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.enableShapeUniforms=an(this.outputShape.length),this.userCode=`
      vec4 unaryOperation(vec4 x) {
        ${n}
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Cte{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=e,this.enableShapeUniforms=an(this.outputShape.length);const n=e.length,s=mn("rc",n),r=Ge(n),i=ote(n,s),o=s.slice(-2),a=n<=1?"rc":`vec2(${o.join(",")})`;this.userCode=`
      void main() {
        ${r} rc = getOutputCoords();
        vec4 packedInput = getA(${i});

        setOutput(getChannel(packedInput, ${a}));
      }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ste=QE,Ite=1e-7,$te=1e-4,Ah={};function Tte(t){return t in Ah||(Ah[t]={}),Ah[t]}const Ete=q().getNumber("CPU_HANDOFF_SIZE_THRESHOLD"),Rte=600;function Nte(){return q().global.screen==null?1024:q().global.screen.height*q().global.screen.width*window.devicePixelRatio*Rte/1024/1024}class rg extends d1{nextDataId(){return rg.nextDataId++}constructor(e){if(super(),this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.lastGlFlushTime=0,this.warnedAboutMemory=!1,this.pendingDeletes=0,this.disposed=!1,!q().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");let n;if(e!=null){if(e instanceof oy)n=e;else{const s=er(q().getNumber("WEBGL_VERSION"),e);n=new oy(s)}this.binaryCache={},this.gpgpuCreatedLocally=!1}else{const s=er(q().getNumber("WEBGL_VERSION"));n=new oy(s),this.binaryCache=Tte(q().getNumber("WEBGL_VERSION")),this.gpgpuCreatedLocally=!0}this.gpgpu=n,this.canvas=this.gpgpu.gl.canvas,this.textureManager=new cte(this.gpgpu),this.numMBBeforeWarning=Nte(),this.texData=new yT(this,ir())}numDataIds(){return this.texData.numDataIds()-this.pendingDeletes}writeTexture(e,n,s,r,i,o){const a=this.makeTensorInfo(n,s),l=this.texData.get(a.dataId);l.isPacked=!1,l.texture={texture:e,texShape:[r,i]},l.texShape=[r,i];const c=Rh(n),u=new bC(c,!1,o),d=this.runWebGLProgram(u,[a],s,[[r,i]]);return d.shape=n,l.texture=null,this.disposeIntermediateTensorInfo(a),d.dataId}write(e,n,s){if((q().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||q().getBool("DEBUG"))&&this.checkNumericalProblems(e),s==="complex64"&&e!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");const r={id:this.nextDataId()};return this.texData.set(r,{shape:n,dtype:s,values:e,usage:Qn.UPLOAD,refCount:1}),r}refCount(e){return this.texData.has(e)?this.texData.get(e).refCount:0}incRef(e){const n=this.texData.get(e);n.refCount++}decRef(e){if(this.texData.has(e)){const n=this.texData.get(e);n.refCount--}}move(e,n,s,r,i){if(q().getBool("DEBUG")&&this.checkNumericalProblems(n),r==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:s,dtype:r,values:n,usage:Qn.UPLOAD,refCount:i})}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}readSync(e){const n=this.texData.get(e),{values:s,dtype:r,complexTensorInfos:i,slice:o,shape:a,isPacked:l}=n;if(o!=null){let h;l?h=new Ti(a,mi):h=new dr(a,mi);const p=this.runWebGLProgram(h,[{dataId:e,shape:a,dtype:r}],r),f=this.readSync(p.dataId);return this.disposeIntermediateTensorInfo(p),f}if(s!=null)return this.convertAndCacheOnCPU(e);if(r==="string")return s;const c=this.activeTimers!=null;let u;c&&(u=kn());let d;if(r==="complex64"){const h=this.readSync(i.real.dataId),p=this.readSync(i.imag.dataId);d=Qr(h,p)}else d=this.getValuesFromTexture(e);return c&&(this.downloadWaitMs+=kn()-u),this.convertAndCacheOnCPU(e,d)}async read(e){if(this.pendingRead.has(e)){const f=this.pendingRead.get(e);return new Promise(g=>f.push(g))}const n=this.texData.get(e),{values:s,shape:r,slice:i,dtype:o,complexTensorInfos:a,isPacked:l}=n;if(i!=null){let f;l?f=new Ti(r,mi):f=new dr(r,mi);const g=this.runWebGLProgram(f,[{dataId:e,shape:r,dtype:o}],o),x=this.read(g.dataId);return this.disposeIntermediateTensorInfo(g),x}if(s!=null)return this.convertAndCacheOnCPU(e);if(q().getBool("DEBUG")&&!q().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&q().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");let c=null,u;if(o!=="complex64"&&q().get("WEBGL_BUFFER_SUPPORTED")){u=this.decode(e);const f=this.texData.get(u.dataId);c=this.gpgpu.createBufferFromTexture(f.texture.texture,...$h(r))}this.pendingRead.set(e,[]),o!=="complex64"&&await this.gpgpu.createAndWaitForFence();let d;if(o==="complex64"){const f=await Promise.all([this.read(a.real.dataId),this.read(a.imag.dataId)]),g=f[0],x=f[1];d=Qr(g,x)}else if(c==null)d=this.getValuesFromTexture(e);else{const f=J(r);d=this.gpgpu.downloadFloat32MatrixFromBuffer(c,f)}if(u!=null&&this.disposeIntermediateTensorInfo(u),c!=null){const f=this.gpgpu.gl;ue(f,()=>f.deleteBuffer(c))}const h=this.convertAndCacheOnCPU(e,d),p=this.pendingRead.get(e);return this.pendingRead.delete(e),p.forEach(f=>f(h)),this.pendingDisposal.has(e)&&(this.pendingDisposal.delete(e),this.disposeData(e)&&ir().removeDataId(e,this),this.pendingDeletes--),h}readToGPU(e,n={}){const s=this.texData.get(e),{values:r,shape:i,slice:o,dtype:a,isPacked:l,texture:c}=s;if(a==="complex64")throw new Error("Does not support reading texture for complex64 dtype.");if(o!=null){let p;l?p=new Ti(i,mi):p=new dr(i,mi);const f=this.runWebGLProgram(p,[{dataId:e,shape:i,dtype:a}],a),g=this.readToGPU(f,n);return this.disposeIntermediateTensorInfo(f),g}if(c==null)throw r!=null?new Error("Data is not on GPU but on CPU."):new Error("There is no data on GPU or CPU.");const u=this.decode(e,n.customTexShape),d=ir().makeTensorFromTensorInfo(u),h=this.texData.get(u.dataId);return Object.assign({tensorRef:d},h.texture)}bufferSync(e){const n=this.readSync(e.dataId);if(e.dtype==="string")try{const s=n.map(r=>Gi(r));return $e(e.shape,e.dtype,s)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return $e(e.shape,e.dtype,n)}checkNumericalProblems(e){if(e!=null)for(let n=0;n<e.length;n++){const s=e[n];if(!DJ(s))throw q().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error(`The value ${s} cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'`):Error(`The value ${s} cannot be represented on this device.`)}}getValuesFromTexture(e){const{shape:n,dtype:s,isPacked:r}=this.texData.get(e),i=J(n);if(q().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){const h=this.decode(e),p=this.texData.get(h.dataId),f=this.gpgpu.downloadMatrixFromPackedTexture(p.texture.texture,...$h(n)).subarray(0,i);return this.disposeIntermediateTensorInfo(h),f}const o=q().getBool("WEBGL_PACK")&&r===!0,a=o?Rh(n):n,l=o?new XZ(a):new qZ(a),c=this.runWebGLProgram(l,[{shape:a,dtype:s,dataId:e}],"float32"),u=this.texData.get(c.dataId),d=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(u.texture.texture,u.texShape[0],u.texShape[1]).subarray(0,i);return this.disposeIntermediateTensorInfo(c),d}timerAvailable(){return q().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0}time(e){const n=this.activeTimers,s=[];let r=!1;this.programTimersStack==null?(this.programTimersStack=s,r=!0):this.activeTimers.push(s),this.activeTimers=s,e();const i=Ko(this.activeTimers.map(l=>l.query)).filter(l=>l!=null),o=Ko(this.activeTimers.map(l=>l.name)).filter(l=>l!=null);this.activeTimers=n,r&&(this.programTimersStack=null);const a={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};return(async()=>{if(q().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0){const l=await Promise.all(i);a.kernelMs=dj(l),a.getExtraProfileInfo=()=>l.map((c,u)=>({name:o[u],ms:c})).map(c=>`${c.name}: ${c.ms}`).join(", ")}else a.kernelMs={error:"WebGL query timers are not supported in this environment."};return this.uploadWaitMs=0,this.downloadWaitMs=0,a})()}memory(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}startTimer(){return q().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:kn(),endMs:null}}endTimer(e){return q().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=kn(),e)}async getQueryTime(e){if(q().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)return this.gpgpu.waitForQueryAndGetTime(e);const n=e;return n.endMs-n.startMs}disposeData(e,n=!1){if(this.pendingDisposal.has(e))return!1;if(!this.texData.has(e))return!0;if(n?this.texData.get(e).refCount=0:this.texData.get(e).refCount--,!n&&this.texData.get(e).refCount>0)return!1;if(this.pendingRead.has(e))return this.pendingDisposal.add(e),this.pendingDeletes++,!1;this.releaseGPUData(e);const{complexTensorInfos:s}=this.texData.get(e);return s!=null&&(this.disposeData(s.real.dataId,n),this.disposeData(s.imag.dataId,n)),this.texData.delete(e),!0}releaseGPUData(e){const{texture:n,dtype:s,texShape:r,usage:i,isPacked:o,slice:a}=this.texData.get(e),l=a&&a.origDataId||e,c=this.dataRefCount.get(l);c>1?this.dataRefCount.set(l,c-1):(this.dataRefCount.delete(l),n!=null&&(this.numBytesInGPU-=this.computeBytes(r,s),this.textureManager.releaseTexture(n,r,i,o)));const u=this.texData.get(e);u.texture=null,u.texShape=null,u.isPacked=!1,u.slice=null}getTexture(e){return this.uploadToGPU(e),this.texData.get(e).texture.texture}getDataInfo(e){return this.texData.get(e)}shouldExecuteOnCPU(e,n=Ete){return q().getBool("WEBGL_CPU_FORWARD")&&e.every(s=>this.texData.get(s.dataId).texture==null&&J(s.shape)<n)}getGPGPUContext(){return this.gpgpu}where(e){Xn("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");const n=e.dataSync();return Ste(e.shape,n)}packedUnaryOp(e,n,s){const r=new Ti(e.shape,n),i=this.compileAndRun(r,[e],s);return ir().makeTensorFromTensorInfo(i)}abs(e){if(this.shouldExecuteOnCPU([e])&&e.dtype!=="complex64"){const r=xD(this.texData.get(e.dataId).values);return this.makeOutput(e.shape,e.dtype,r)}if(q().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,SC,e.dtype);const n=new dr(e.shape,SC),s=this.compileAndRun(n,[e]);return ir().makeTensorFromTensorInfo(s)}makeTensorInfo(e,n,s){let r;if(n==="string"&&s!=null&&s.length>0&&Du(s[0])){const i=s.map(o=>ji(o));r=this.write(i,e,n)}else r=this.write(s,e,n);return this.texData.get(r).usage=null,{dataId:r,shape:e,dtype:n}}makeOutput(e,n,s){return ir().makeTensorFromTensorInfo(this.makeTensorInfo(e,n,s),this)}unpackTensor(e){const n=new Cte(e.shape);return this.runWebGLProgram(n,[e],e.dtype)}packTensor(e){const n=new ate(e.shape);return this.runWebGLProgram(n,[e],e.dtype,null,!0)}packedReshape(e,n){const s=[Tl(e.shape),...El(e.shape)],r={dtype:e.dtype,shape:s,dataId:e.dataId},i=[Tl(n),...El(n)],o=new wD(i,s),a=!0,l=[s],c=this.runWebGLProgram(o,[r],e.dtype,l,a);return{dataId:c.dataId,shape:n,dtype:c.dtype}}decode(e,n){const s=this.texData.get(e),{isPacked:r,shape:i,dtype:o}=s;if(n!=null){const h=J(i),p=n[0]*n[1]*4;T(h<=p,()=>"customTexShape is too small. Row * Column * 4 should be equal or larger than the size of the tensor data.")}const a=Rh(i);let l;r?l=new KZ(a):l=new HZ(a);const c=!0,u=[n??$h(a)],d=this.runWebGLProgram(l,[{shape:a,dtype:o,dataId:e}],o,u,c,n);return{dtype:o,shape:i,dataId:d.dataId}}runWebGLProgram(e,n,s,r,i=!1,o){const a=this.makeTensorInfo(e.outputShape,s),l=this.texData.get(a.dataId);if(e.packedOutput&&(l.isPacked=!0),e.outPackingScheme===gu.DENSE){const y=o??$h(e.outputShape);l.texShape=y.map(v=>v*2)}if(e.outTexUsage!=null&&(l.usage=e.outTexUsage),J(a.shape)===0)return l.values=tn(a.dtype,0),a;const c=[],u=n.map(y=>{if(y.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");let v=this.texData.get(y.dataId);if(v.texture==null){if(!e.packedInputs&&J(y.shape)<=q().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:y.shape,texData:null,isUniform:!0,uniformValues:v.values};e.packedInputs&&(v.isPacked=!0,v.shape=y.shape)}if(this.uploadToGPU(y.dataId),!!v.isPacked!=!!e.packedInputs)y=v.isPacked?this.unpackTensor(y):this.packTensor(y),c.push(y),v=this.texData.get(y.dataId);else if(v.isPacked&&!rf(v.shape,y.shape)){const b=y,w=y.shape;y.shape=v.shape,y=this.packedReshape(y,w),c.push(y),v=this.texData.get(y.dataId),b.shape=w}return{shape:y.shape,texData:v,isUniform:!1}});this.uploadToGPU(a.dataId);const d={shape:a.shape,texData:l,isUniform:!1},h=GZ(e,u,d),p=this.getAndSaveBinary(h,()=>VZ(this.gpgpu,e,u,d)),f=this.activeTimers!=null;let g;f&&(g=this.startTimer()),q().get("ENGINE_COMPILE_ONLY")||UZ(this.gpgpu,p,u,d,r),c.forEach(y=>this.disposeIntermediateTensorInfo(y)),f&&(g=this.endTimer(g),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(g)}));const x=q().getNumber("WEBGL_FLUSH_THRESHOLD");if(x>0){const y=kn();y-this.lastGlFlushTime>x&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=y)}if(!q().getBool("WEBGL_LAZILY_UNPACK")&&l.isPacked&&i===!1){const y=this.unpackTensor(a);return this.disposeIntermediateTensorInfo(a),y}return a}compileAndRun(e,n,s,r,i=!1){return s=s||n[0].dtype,this.runWebGLProgram(e,n,s,r,i)}getAndSaveBinary(e,n){return e in this.binaryCache||(this.binaryCache[e]=n()),this.binaryCache[e]}getTextureManager(){return this.textureManager}dispose(){this.disposed||(q().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(n=>{this.gpgpu.deleteProgram(this.binaryCache[n].webGLProgram),delete this.binaryCache[n]}),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)}floatPrecision(){return this.floatPrecisionValue==null&&(this.floatPrecisionValue=K(()=>{if(!q().get("WEBGL_RENDER_FLOAT32_ENABLED")){const e=q().getBool("DEBUG");q().set("DEBUG",!1);const n=this.abs(ze(1e-8)).dataSync()[0];if(q().set("DEBUG",e),n>0)return 32}return 16})),this.floatPrecisionValue}epsilon(){return this.floatPrecision()===32?Ite:$te}uploadToGPU(e){const n=this.texData.get(e),{shape:s,dtype:r,values:i,texture:o,usage:a,isPacked:l}=n;if(o!=null)return;const c=this.activeTimers!=null;let u;c&&(u=kn());let d=n.texShape;if(d==null&&(d=QJ(s,l),n.texShape=d),i!=null){const h=Rh(s);let p,f=d[1],g=d[0];const x=i instanceof Uint8Array||i instanceof Uint8ClampedArray;(l||!x)&&([f,g]=Kl(d[0],d[1])),l?p=new QZ(h,x):p=new bC(h,x);const y=x?[g,f]:d,v=this.makeTensorInfo(y,r),b=this.texData.get(v.dataId);x?b.usage=Qn.PIXELS:b.usage=Qn.UPLOAD,b.texShape=y,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(v.dataId),f,g,i);const w=[[g,f]],S=this.runWebGLProgram(p,[v],r,w,!0),I=this.texData.get(S.dataId);n.texShape=I.texShape,n.isPacked=I.isPacked,n.usage=I.usage,q().get("ENGINE_COMPILE_ONLY")?this.disposeData(S.dataId):(n.texture=I.texture,n.values=null,this.texData.delete(S.dataId)),this.disposeIntermediateTensorInfo(v),c&&(this.uploadWaitMs+=kn()-u)}else{const h=this.acquireTexture(d,a,r,l);n.texture=h}}convertAndCacheOnCPU(e,n){const s=this.texData.get(e),{dtype:r}=s;return n!=null&&(s.values=Ate(n,r)),s.values}acquireTexture(e,n,s,r){if(this.numBytesInGPU+=this.computeBytes(e,s),!this.warnedAboutMemory&&this.numBytesInGPU>this.numMBBeforeWarning*1024*1024){const i=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn(`High memory usage in GPU: ${i} MB, most likely due to a memory leak`)}return this.textureManager.acquireTexture(e,n,r)}computeBytes(e,n){return e[0]*e[1]*_p(n)}checkCompileCompletion(){for(const[,e]of Object.entries(this.binaryCache))this.checkCompletion_(e)}async checkCompileCompletionAsync(){const e=[];if(this.gpgpu.parallelCompilationExtension){for(const[,n]of Object.entries(this.binaryCache))e.push(this.checkCompletionAsync_(n));return Promise.all(e)}else{for(const[,n]of Object.entries(this.binaryCache)){const s=new Promise(r=>{try{this.checkCompletion_(n),r(!0)}catch(i){throw i}});e.push(s)}return Promise.all(e)}}async checkCompletionAsync_(e){return this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.parallelCompilationExtension.COMPLETION_STATUS_KHR)?this.checkCompletion_(e):(await fR(),this.checkCompletionAsync_(e))}checkCompletion_(e){if(this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.gl.LINK_STATUS)===!1)throw console.log(this.gpgpu.gl.getProgramInfoLog(e.webGLProgram)),this.gpgpu.gl.getShaderParameter(e.fragmentShader,this.gpgpu.gl.COMPILE_STATUS)===!1?(oD(e.source,this.gpgpu.gl.getShaderInfoLog(e.fragmentShader)),new Error("Failed to compile fragment shader.")):new Error("Failed to link vertex and fragment shaders.");return!0}getUniformLocations(){for(const e of Object.values(this.binaryCache)){this.gpgpu.buildVao(e.webGLProgram);const{variablesLocations:n,customUniformLocations:s,infLoc:r,nanLoc:i,outShapeLocation:o,outShapeStridesLocation:a,outTexShapeLocation:l}=dD(this.gpgpu,e.program,e.webGLProgram);e.variablesLocations=n,e.customUniformLocations=s,e.infLoc=r,e.nanLoc=i,e.outShapeLocation=o,e.outShapeStridesLocation=a,e.outTexShapeLocation=l}}createTensorFromGPUData(e,n,s){e.channels=e.channels||"RGBA";const{texture:r,height:i,width:o,channels:a}=e,l=ir().backend;if(!l.gpgpu.gl.isTexture(r))throw new Error("The texture is invalid. Also, please make sure the texture and the TFJS WebGL backend are using the same canvas. If you want to use your own custom canvas, you have to create and use the custom TFJS WebGL backend created from the canvas through 'new tf.MathBackendWebGL(customCanvas)'.");const c=l.writeTexture(r,n,s,i,o,a);return ir().makeTensorFromDataId(c,n,s,l)}}rg.nextDataId=0;function Ate(t,e){if(e==="float32"||e==="complex64")return t;if(e==="int32"||e==="bool"){const n=e==="int32"?new Int32Array(t.length):new Uint8Array(t.length);for(let s=0;s<n.length;++s)n[s]=Math.round(t[s]);return n}else throw new Error(`Unknown dtype ${e}`)}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */cE()&&pE("webgl",()=>new rg,2);/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iw=`
  if (isnan(a)) return a;
  if (isnan(b)) return b;
`;class oa{constructor(e,n,s){this.variableNames=["A","B"],this.outputShape=Se(n,s),this.enableShapeUniforms=an(this.outputShape.length),this.userCode=`
      float binaryOperation(float a, float b) {
        ${e}
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ka=`
  result.r = isNaN.r ? NAN : result.r;
  result.g = isNaN.g ? NAN : result.g;
  result.b = isNaN.b ? NAN : result.b;
  result.a = isNaN.a ? NAN : result.a;
`;class Jl{constructor(e,n,s,r=!1){this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=Se(n,s);const i=this.outputShape.length;this.enableShapeUniforms=an(i);let o="";if(r)if(i===0||J(this.outputShape)===1)o=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(o=`
          ${Ge(i)} coords = getOutputCoords();
        `,i===1)this.enableShapeUniforms?o+=`
            result.y = (coords + 1) >= outShape ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `:o+=`
            result.y = (coords + 1) >= ${this.outputShape[0]} ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{const l=mn("coords",i);this.enableShapeUniforms?o+=`
            bool nextRowOutOfBounds =
              (${l[i-2]} + 1) >= outShape[${i} - 2];
            bool nextColOutOfBounds =
              (${l[i-1]} + 1) >= outShape[${i} - 1];
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `:o+=`
            bool nextRowOutOfBounds =
              (${l[i-2]} + 1) >= ${this.outputShape[i-2]};
            bool nextColOutOfBounds =
              (${l[i-1]} + 1) >= ${this.outputShape[i-1]};
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        ${e}
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        ${o}

        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gn(t){const{inputs:e,backend:n}=t,{x:s}=e;return n.incRef(s.dataId),{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}const _te={kernelName:ed,backendName:"webgl",kernelFunc:Gn};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function po(t){const{inputs:e,backend:n}=t,{real:s,imag:r}=e,i=n.makeTensorInfo(s.shape,"complex64"),o=n.texData.get(i.dataId),a=Gn({inputs:{x:s},backend:n}),l=Gn({inputs:{x:r},backend:n});return o.complexTensorInfos={real:a,imag:l},i}const Dte={kernelName:I1,backendName:"webgl",kernelFunc:po};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kD="return (a < 0.) ? b * a : a;",CD=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function Fte(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{alpha:i}=s,o=n.makeTensorInfo([],"float32",ro(i,"float32")),a=q().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Jl(CD,r.shape,o.shape):new oa(kD,r.shape,o.shape),l=n.runWebGLProgram(a,[r,o],"float32");return n.disposeIntermediateTensorInfo(o),l}const Ote={kernelName:em,backendName:"webgl",kernelFunc:Fte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SD="return (a < 0.) ? b * a : a;",ID=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function Pte(t){const{inputs:e,backend:n}=t,{x:s,alpha:r}=e,i=q().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Jl(ID,s.shape,r.shape):new oa(SD,s.shape,r.shape);return n.runWebGLProgram(i,[s,r],"float32")}const Mte={kernelName:vm,backendName:"webgl",kernelFunc:Pte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zl="if (isnan(x)) return x;";function Oe({opSnippet:t,packedOpSnippet:e,cpuKernelImpl:n,dtype:s}){return({inputs:r,backend:i})=>{const{x:o}=r,a=i,l=s||o.dtype;if(a.shouldExecuteOnCPU([o])&&n!=null){const d=a.texData.get(o.dataId),h=n(d.values,l);return a.makeTensorInfo(o.shape,l,h)}const c=q().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&e!=null;let u;return c?u=new Ti(o.shape,e):u=new dr(o.shape,t),a.runWebGLProgram(u,[o],l)}}function Yt({opSnippet:t,packedOpSnippet:e,checkOutOfBounds:n=!1,supportsComplex:s=!1,cpuKernelImpl:r,dtype:i}){return({inputs:o,backend:a})=>{const{a:l,b:c}=o,u=a;if(s&&l.dtype==="complex64"){const f=u.texData.get(l.dataId),g=u.texData.get(c.dataId),[x,y]=[[f.complexTensorInfos.real,g.complexTensorInfos.real],[f.complexTensorInfos.imag,g.complexTensorInfos.imag]].map(b=>{const[w,k]=b,S={dataId:w.dataId,dtype:w.dtype,shape:l.shape},I={dataId:k.dataId,dtype:k.dtype,shape:c.shape},C=new oa(t,l.shape,c.shape);return u.runWebGLProgram(C,[S,I],Vn(w.dtype,k.dtype))}),v=po({inputs:{real:x,imag:y},backend:u});return u.disposeIntermediateTensorInfo(x),u.disposeIntermediateTensorInfo(y),v}const d=i||Vn(l.dtype,c.dtype);if((l.dtype==="string"||c.dtype==="string"||u.shouldExecuteOnCPU([l,c]))&&r!=null){const f=u.texData.get(l.dataId).values,g=u.texData.get(c.dataId).values,x=l.dtype==="string"?Jr(f):f,y=l.dtype==="string"?Jr(g):g,[v,b]=r(l.shape,c.shape,x,y,d),w=u.makeTensorInfo(b,d),k=u.texData.get(w.dataId);return k.values=v,w}const h=q().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&e!=null;let p;return h?p=new Jl(e,l.shape,c.shape,n):p=new oa(t,l.shape,c.shape),u.runWebGLProgram(p,[l,c],d)}}function yu(t,e=!1){if(t==="linear")return e?xte:pte;if(t==="relu")return e?bte:mte;if(t==="elu")return e?vte:fte;if(t==="relu6")return e?wte:gte;if(t==="prelu")return e?ID:SD;if(t==="leakyrelu")return e?CD:kD;if(t==="sigmoid")return e?kte:yte;throw new Error(`Activation ${t} has not been implemented for the WebGL backend.`)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class $D{constructor(e,n,s,r=!1,i=!1,o=!1,a=null,l=!1,c=!1){this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=s,this.enableShapeUniforms=an(this.outputShape.length);const u=r?e[1]:e[2],d=Math.ceil(u/2),h=r?"i * 2, rc.y":"rc.y, i * 2",p=i?"rc.z, i * 2":"i * 2, rc.z",f=r?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],g=i?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"];let x="",y="";a&&(l?x=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${a}
        }`:c?x=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${a}
        }`:x=`vec4 activation(vec4 x) {
          ${a}
        }`,y="result = activation(result);");const v=o?"result += getBiasAtOutCoords();":"";o&&this.variableNames.push("bias"),l&&this.variableNames.push("preluActivationWeights"),c&&this.variableNames.push("leakyreluAlpha");let b="rc.x",w="rc.x";e[0]<n[0]?b=`imod(rc.x, ${e[0]})`:n[0]<e[0]&&(w=`imod(rc.x, ${n[0]})`),this.userCode=`
      ${x}
      // Don't use uniform for sharedDimensionPacked for performance.
      const float sharedDimension = ${d}.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        int batchA = ${b};
        int batchB = ${w};
        for (int i = 0; i < ${d}; i++) {
          vec4 a = getMatrixA(batchA, ${h});
          vec4 b = getMatrixB(batchB, ${p});

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (${f[0]} * ${g[0]});
          result += (${f[1]} * ${g[1]});
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        ${v}

        ${y}

        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IC={REAL:"return areal * breal - aimag * bimag;",IMAG:"return areal * bimag + aimag * breal;"};class $C{constructor(e,n,s){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=Se(n,s),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        ${e}
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TC="return a * b;";function ow(t){const{inputs:e,backend:n}=t,{a:s,b:r}=e,i=Vn(s.dtype,r.dtype);if(s.dtype==="complex64"){const a=n.texData.get(s.dataId),l=n.texData.get(r.dataId),c=new $C(IC.REAL,s.shape,r.shape),u=new $C(IC.IMAG,s.shape,r.shape),d=[{dataId:a.complexTensorInfos.real.dataId,dtype:a.complexTensorInfos.real.dtype,shape:s.shape},{dataId:a.complexTensorInfos.imag.dataId,dtype:a.complexTensorInfos.imag.dtype,shape:s.shape},{dataId:l.complexTensorInfos.real.dataId,dtype:l.complexTensorInfos.real.dtype,shape:r.shape},{dataId:l.complexTensorInfos.imag.dataId,dtype:l.complexTensorInfos.imag.dtype,shape:r.shape}],h=n.runWebGLProgram(c,d,"float32"),p=n.runWebGLProgram(u,d,"float32"),f=po({inputs:{real:h,imag:p},backend:n});return n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(p),f}if(n.shouldExecuteOnCPU([s,r])){const a=n.texData.get(s.dataId),l=n.texData.get(r.dataId),[c,u]=Pee(s.shape,r.shape,a.values,l.values,i),d=n.makeTensorInfo(u,i),h=n.texData.get(d.dataId);return h.values=c,d}let o;return q().getBool("WEBGL_PACK_BINARY_OPERATIONS")?o=new Jl(TC,s.shape,r.shape):o=new oa(TC,s.shape,r.shape),n.runWebGLProgram(o,[s,r],i)}const Lte={kernelName:cd,backendName:"webgl",kernelFunc:ow};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zte(t,e,n){const s=[Tl(t.shape),...El(t.shape)],r={dtype:t.dtype,shape:s,dataId:t.dataId},i=[Tl(e),...El(e)],o=new wD(i,s),a=!0,l=[s],c=n.runWebGLProgram(o,[r],t.dtype,l,a);return{dataId:c.dataId,shape:e,dtype:c.dtype}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ae(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{shape:i}=s,o=n,a=J(r.shape),l=xT(i,a),c=J(l);T(a===c,()=>`The new shape (${l}) has ${c} elements and the old shape (${r.shape}) has ${a} elements. The new shape and old shape must have the same number of elements.`);const u=o.texData.get(r.dataId);return u.isPacked&&!rf(r.shape,l)&&!(u.texture!==null&&rf(u.shape,l))?zte(r,l,o):(o.incRef(r.dataId),{dataId:r.dataId,shape:l,dtype:r.dtype})}const jte={kernelName:wm,backendName:"webgl",kernelFunc:ae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class EC{constructor(e,n){this.variableNames=["x"];const{windowSize:s,batchSize:r,inSize:i,outSize:o}=e;this.outputShape=[r,o];const a=Math.floor(s/4)*4,l=s%4;let c="sumValue += dot(values, ones);";if(n!=null){const d=1/n;c=`sumValue += dot(values * ${gl(d)?d.toPrecision(2):d}, ones);`}let u="";i%s>0&&(u=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return 0.0;
        }
      `),this.userCode=`
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${u}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${s};

        float sumValue = 0.0;

        for (int i = 0; i < ${a}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${c}
        }

        int inIdx = inOffset + ${a};
        if (${l===1}) {
          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);

          ${c}
        } else if (${l===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1), 0.0, 0.0);

          ${c}
        } else if (${l===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2), 0.0);

          ${c}
        }
        setOutput(sumValue);
      }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Bte{constructor(e,n){this.variableNames=["x"];const{windowSize:s,batchSize:r,inSize:i,outSize:o}=e;this.outputShape=[r,o];let a="0.0",l="";n==="prod"?a="1.0":n==="min"?(a="1.0 / 1e-20",l="min"):n==="max"&&(a="-1.0 / 1e-20",l="max");let c=`${n}(${n}(${n}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;n==="sum"?c="sumValue":n==="prod"?c="prodValue":n==="all"?c="allValue":n==="any"&&(c="anyValue");const u=Math.floor(s/4)*4,d=s%4;let h=`
      if (${n==="sum"}) {
        sumValue += dot(values, ones);
      } else if (${n==="prod"}) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = ${l}(values, minMaxValue);
        if (${n==="min"} || ${n==="max"}) {
          minMaxValue = ${l}(values, minMaxValue);
          bvec4 isNaN = isnan(values);
          if (isNaN.r || isNaN.g || isNaN.b || isNaN.a) {
            minMaxValue = vec4(NAN);
          }
        }
      }
    `,p="vec4";n==="all"?(a="1.0",h=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,p="bvec4"):n==="any"&&(a="0.0",h=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,p="bvec4");let f="";i%s>0&&(f=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = ${a};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${f}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${s};

        vec4 minMaxValue = vec4(${a});
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < ${u}; i += 4) {
          int inIdx = inOffset + i;
          ${p} values = ${p}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${h}
        }

        int inIdx = inOffset + ${u};
        if (${d===1}) {
          ${p} values = ${p}(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          ${h}
        } else if (${d===2}) {
          ${p} values = ${p}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          ${h}
        } else if (${d===3}) {
          ${p} values = ${p}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          ${h}
        }
        setOutput(${c});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wte(t){const e=[];for(;e.length===0||e[e.length-1].outSize!==1;){const n=e.length?e[e.length-1].outSize:t[1],s=Wm(n);e.push({inSize:n,windowSize:s,outSize:Math.ceil(n/s)})}return e}function Ca(t,e,n,s){const r=Wte(t.shape);let i=t;for(let o=0;o<r.length;o++){const{inSize:a,windowSize:l,outSize:c}=r[o];let u,d;n==="mean"?u=o===0?new EC({windowSize:l,inSize:a,batchSize:t.shape[0],outSize:c},a):new EC({windowSize:l,inSize:a,batchSize:t.shape[0],outSize:c}):u=new Bte({windowSize:l,inSize:a,batchSize:t.shape[0],outSize:c},n),d=i,i=s.runWebGLProgram(u,[i],e),d.dataId!==t.dataId&&s.disposeIntermediateTensorInfo(d)}return i}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Vte{constructor(e,n){this.variableNames=["A"];const s=new Array(e.length);for(let o=0;o<s.length;o++)s[o]=e[n[o]];this.outputShape=s,this.rank=s.length;const r=Ge(this.rank),i=Ute(n);this.userCode=`
    void main() {
      ${r} resRC = getOutputCoords();
      setOutput(getA(${i}));
    }
    `}}function Ute(t){const e=t.length;if(e>6)throw Error(`Transpose for rank ${e} is not yet supported`);const n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],s=new Array(e);for(let r=0;r<t.length;r++)s[t[r]]=n[r];return s.join()}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Gte{constructor(e,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;const s=new Array(e.length);for(let u=0;u<s.length;u++)s[u]=e[n[u]];if(this.outputShape=s,this.rank=s.length,this.rank>6)throw Error(`Packed transpose for rank ${this.rank} is not yet supported.`);const r=Ge(this.rank),i=bD("rc",this.rank),o=new Array(this.rank);for(let u=0;u<n.length;u++)o[n[u]]=i[u];const a=`vec2(${o.slice(-2).join()})`,l=`++${i[this.rank-1]} < ${s[this.rank-1]}`,c=`getChannel(getA(${o.join()}), ${a})`;this.userCode=`
    void main() {
      ${r} rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = ${c};
      if(${l}) {
        result[1] = ${c};
      }
      --${i[this.rank-1]};
      if(++${i[this.rank-2]} < ${s[this.rank-2]}) {
        result[2] = ${c};
        if(${l}) {
          result[3] = ${c};
        }
      }
      setOutput(result);
    }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ig(t,e,n){const s=q().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Gte(t.shape,e):new Vte(t.shape,e);return n.runWebGLProgram(s,[t],t.dtype)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hte(t,e,n,s){const r=e,i=t.shape.length,o=Te(r,t.shape);let a=o;const l=dt(a,i),c=l!=null;let u=t;c&&(u=ig(t,l,s),a=wt(a.length,i)),Xt("sum",a,i);const[d,h]=Wt(u.shape,a);let p=d;n&&(p=Tt(d,o));const f=J(h),x=J(t.shape)/f,y=ae({inputs:{x:u},attrs:{shape:[x,f]},backend:s}),v=ov(t.dtype),b=Ca(y,v,"sum",s),w=ae({inputs:{x:b},attrs:{shape:p},backend:s});return s.disposeIntermediateTensorInfo(y),s.disposeIntermediateTensorInfo(b),c&&s.disposeIntermediateTensorInfo(u),w}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function og(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:i,keepDims:o}=s;return Hte(r,i,o,n)}const Kte={kernelName:Tm,backendName:"webgl",kernelFunc:og};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vn(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{perm:i}=s,o=n,a=r.shape.length,l=new Array(a);for(let u=0;u<l.length;u++)l[u]=r.shape[i[u]];let c;if(o.shouldExecuteOnCPU([r])){const d=o.texData.get(r.dataId).values,h=rw(d,r.shape,r.dtype,i,l);c=o.makeTensorInfo(l,r.dtype);const p=o.texData.get(c.dataId);p.values=h}else c=ig(r,i,o);return c}const qte={kernelName:tl,backendName:"webgl",kernelFunc:vn};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TD=1e3;function of({a:t,b:e,transposeA:n,transposeB:s,backend:r,bias:i=null,preluActivationWeights:o=null,leakyreluAlpha:a=0,activation:l=null}){const c=t.shape.length,u=e.shape.length,d=n?t.shape[c-2]:t.shape[c-1],h=s?e.shape[u-1]:e.shape[u-2],p=n?t.shape[c-1]:t.shape[c-2],f=s?e.shape[u-2]:e.shape[u-1],g=t.shape.slice(0,-2),x=e.shape.slice(0,-2),y=J(g),v=J(x),w=Se(t.shape.slice(0,-2),e.shape.slice(0,-2)).concat([p,f]);T(d===h,()=>`Error in matMul: inner shapes (${d}) and (${h}) of Tensors with shapes ${t.shape} and ${e.shape} and transposeA=${n} and transposeB=${s} must match.`);const k=n?[y,d,p]:[y,p,d],S=s?[v,f,h]:[v,h,f],I=ae({inputs:{x:t},backend:r,attrs:{shape:k}}),C=ae({inputs:{x:e},backend:r,attrs:{shape:S}}),$=[I,C],R=Math.max(y,v),_=n?I.shape[1]:I.shape[2],M=i!=null,B=o!=null,A=l==="leakyrelu",F=l!=null?yu(l,!0):null,P=M||B||A||F!=null;let H;if((p===1||f===1)&&_>TD&&P===!1){let D=I,V=C;n&&(D=vn({inputs:{x:I},backend:r,attrs:{perm:[0,2,1]}}),$.push(D)),s&&(V=vn({inputs:{x:C},backend:r,attrs:{perm:[0,2,1]}}),$.push(V));const X=f!==1,Z=f===1;let ee=D;X&&(ee=ae({inputs:{x:D},backend:r,attrs:{shape:[R,_,1]}}),$.push(ee));const ie=f===1?2:1;let j=V;Z&&(j=ae({inputs:{x:V},backend:r,attrs:{shape:[R,1,_]}}),$.push(j));const Q=ow({inputs:{a:ee,b:j},backend:r});H=og({inputs:{x:Q},backend:r,attrs:{axis:ie,keepDims:!0}}),$.push(Q)}else{const D=Vn(t.dtype,e.dtype),V=new $D(k,S,[R,p,f],n,s,M,F,B,A),X=[I,C];if(i!=null&&X.push(i),B&&X.push(o),A){const Z=r.makeTensorInfo([],"float32",ro(a,"float32"));X.push(Z),$.push(Z)}H=r.runWebGLProgram(V,X,D)}const E=ae({inputs:{x:H},backend:r,attrs:{shape:w}});$.push(H);for(const D of $)r.disposeIntermediateTensorInfo(D);return E}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xte(t){const{inputs:e,backend:n,attrs:s}=t,{a:r,b:i,bias:o,preluActivationWeights:a}=e,{transposeA:l,transposeB:c,activation:u,leakyreluAlpha:d}=s;return of({a:r,b:i,transposeA:l,transposeB:c,backend:n,bias:o,preluActivationWeights:a,leakyreluAlpha:d,activation:u})}const Yte={kernelName:Dp,backendName:"webgl",kernelFunc:Xte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RC="return abs(x);";function Qte(t){const{inputs:e,backend:n}=t,{x:s}=e;if(n.shouldExecuteOnCPU([s])&&s.dtype!=="complex64"){const i=n.texData.get(s.dataId),o=xD(i.values);return n.makeTensorInfo(s.shape,s.dtype,o)}let r;return q().getBool("WEBGL_PACK_UNARY_OPERATIONS")?r=new Ti(s.shape,RC):r=new dr(s.shape,RC),n.runWebGLProgram(r,[s],s.dtype)}const Jte={kernelName:Ff,backendName:"webgl",kernelFunc:Qte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zte=Rs+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,ene=Oe({opSnippet:Zte}),tne={kernelName:Fu,backendName:"webgl",kernelFunc:ene};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nne=Rs+`
  if (x < 1.0) return NAN;
return log(x + sqrt(x * x - 1.0));`,sne=Oe({opSnippet:nne}),rne={kernelName:Ou,backendName:"webgl",kernelFunc:sne};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NC="return a + b;",ine=Yt({opSnippet:NC,packedOpSnippet:NC,supportsComplex:!0,cpuKernelImpl:mee}),one={kernelName:Ll,backendName:"webgl",kernelFunc:ine};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ane{constructor(e,n){this.outputShape=[],this.outputShape=e,this.variableNames=n.map((i,o)=>`T${o}`);const s=[];this.variableNames.forEach(i=>{s.push(`float v${i} = get${i}AtOutCoords();`)});const r=this.variableNames.map(i=>`v${i}`).join(" + ");this.userCode=`
      void main() {
        ${s.join(`
        `)}

        float result = ${r};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class lne{constructor(e,n){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.variableNames=n.map((i,o)=>`T${o}`);const s=[];this.variableNames.forEach(i=>{s.push(`vec4 v${i} = get${i}AtOutCoords();`)});const r=this.variableNames.map(i=>`v${i}`).join(" + ");this.userCode=`
      void main() {
        ${s.join(`
        `)}

        vec4 result = ${r};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yh(t){const{inputs:e,backend:n}=t,s=e;if(s.length===1)return Gn({inputs:{x:s[0]},backend:n});if(s.length>q().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){const l=Math.floor(s.length/2),c=Yh({inputs:s.slice(0,l),backend:n}),u=Yh({inputs:s.slice(l),backend:n});return Yh({inputs:[c,u],backend:n})}const r=s.map(l=>l.dtype).reduce((l,c)=>Vn(l,c)),i=s.map(l=>l.shape),a=q().getBool("WEBGL_PACK")?new lne(s[0].shape,i):new ane(s[0].shape,i);return n.runWebGLProgram(a,s,r)}const cne={kernelName:x1,backendName:"webgl",kernelFunc:Yh};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function une(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:i,keepDims:o}=s,a=r.shape.length,l=Te(i,r.shape);let c=l;const u=dt(c,a);let d=r;u!=null&&(d=vn({inputs:{x:r},backend:n,attrs:{perm:u}}),c=wt(c.length,a)),Xt("all",c,a);const[h,p]=Wt(d.shape,c),f=J(p),g=ae({inputs:{x:d},backend:n,attrs:{shape:[-1,f]}}),x=Ca(g,g.dtype,"all",n);let y;if(o){const v=Tt(h,l);y=ae({inputs:{x},backend:n,attrs:{shape:v}})}else y=ae({inputs:{x},backend:n,attrs:{shape:h}});return n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(x),u!=null&&n.disposeIntermediateTensorInfo(d),y}const dne={kernelName:v1,backendName:"webgl",kernelFunc:une};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hne(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:i,keepDims:o}=s,a=r.shape.length,l=Te(i,r.shape);let c=l;const u=dt(c,a);let d=r;u!=null&&(d=vn({inputs:{x:r},backend:n,attrs:{perm:u}}),c=wt(c.length,a)),Xt("any",c,a);const[h,p]=Wt(d.shape,c),f=J(p),g=ae({inputs:{x:d},backend:n,attrs:{shape:[-1,f]}}),x=Ca(g,g.dtype,"any",n);let y;if(o){const v=Tt(h,l);y=ae({inputs:{x},backend:n,attrs:{shape:v}})}else y=ae({inputs:{x},backend:n,attrs:{shape:h}});return n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(x),u!=null&&n.disposeIntermediateTensorInfo(d),y}const pne={kernelName:b1,backendName:"webgl",kernelFunc:hne};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class fne{constructor(e,n,s){this.variableNames=["A"];const{windowSize:r,batchSize:i,outSize:o}=e;s||this.variableNames.push("bestIndicesA"),this.outputShape=[i,o];const a=n==="max"?">":"<",l=s?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${r};

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < ${r}; i++) {
          int inIdx = ${l};
          float candidate = getA(batch, inIdx);
          if (candidate ${a} bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class mne{constructor(e,n,s,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,T(e.length>2,()=>`Packed arg${s.charAt(0).toUpperCase()+s.slice(1)} supports only inputs with rank above 2.`);const i=e[e.length-1],o=Math.ceil(i/n);this.outputShape=e.slice(0,-1),o>1&&this.outputShape.push(o),r||this.variableNames.push("bestIndicesA");const a=this.outputShape,l=a.length,c=Ge(l),u=mn("coords",l);let d,h;if(o===1){h=l+1;const C=Ge(h);d=`
        ${C} sourceLocR = ${C}(${u.join()}, 0);
        ++${u[l-1]};
        ${C} sourceLocG = ${C}(${u.join()}, 0);
        ++${u[l-2]};
        ${C} sourceLocA = ${C}(${u.join()}, 0);
        --${u[l-1]};
        ${C} sourceLocB = ${C}(${u.join()}, 0);
        --${u[l-2]};`}else h=l,d=`
        ${c} sourceLocR = coords;
        ++${u[l-1]};
        ${c} sourceLocG = coords;
        ++${u[l-2]};
        ${c} sourceLocA = coords;
        --${u[l-1]};
        ${c} sourceLocB = coords;
        --${u[l-2]};`;const p=["x","y","z","w","u","v"].slice(0,h),f="."+p[h-1],g=p.map(C=>"int "+C),x=mn("sourceLocR",h-1).concat("inIdx.r"),y=mn("sourceLocG",h-1).concat("inIdx.g"),v=mn("sourceLocB",h-1).concat("inIdx.b"),b=mn("sourceLocA",h-1).concat("inIdx.a"),w=s==="max"?"greaterThan":"lessThan",k=r?"":`
          inIdx = round(vec4(getBestIndicesAChannel(${x.join()}),
                             getBestIndicesAChannel(${y.join()}),
                             getBestIndicesAChannel(${v.join()}),
                             getBestIndicesAChannel(${b.join()})));`,S=`vec4(
            getAChannel(${x.join()}),
            hasNextCol ? getAChannel(${y.join()}) : 0.,
            hasNextRow ? getAChannel(${v.join()}) : 0.,
            hasNextRow && hasNextCol ? getAChannel(${b.join()}) : 0.)`,I=r?"":`
      float getBestIndicesAChannel(${g.join()}) {
        return getChannel(getBestIndicesA(${p.join()}),
                                          vec2(${p.slice(-2).join()}));
      }`;this.userCode=`
      float getAChannel(${g.join()}) {
        return getChannel(getA(${p.join()}),
                               vec2(${p.slice(-2).join()}));
      }
      ${I}
      void main() {
        ${c} coords = getOutputCoords();
        bool hasNextCol = ${u[l-1]} < ${a[l-1]-1};
        bool hasNextRow = ${u[l-2]} < ${a[l-2]-1};
        ${d}
        ivec4 srcIdx = ivec4(sourceLocR${f}, sourceLocG${f},
          sourceLocB${f}, sourceLocA${f}) * ${n};
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = ${S};

        for (int i = 0; i < ${n}; i++) {
          inIdx = srcIdx;
          ${k}
          vec4 candidate = ${S};
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(${w}(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ED(t,e,n,s=null){let r=e.shape[0],i=e.shape[1];s!=null&&(r=s.shape[0],i=s.shape[1]);const o=Wm(i),a={windowSize:o,inSize:i,batchSize:r,outSize:Math.ceil(i/o)},l=new fne(a,n,s==null),c=[e];s!=null&&c.push(s);const u=t.runWebGLProgram(l,c,"int32");if(u.shape[1]===1)return u;const d=ED(t,e,n,u);return t.disposeIntermediateTensorInfo(u),d}function RD(t,e,n,s=null){const r=s!=null?s.shape:e.shape,i=r[r.length-1],o=Wm(i),a=new mne(r,o,n,s==null),l=s==null?[e]:[e,s],c=t.runWebGLProgram(a,l,"int32");if(c.shape.length===e.shape.length){const u=RD(t,e,n,c);return t.disposeIntermediateTensorInfo(c),u}return c}function ND(t,e,n,s){const r=[n];if(Xt("arg"+s.charAt(0).toUpperCase()+s.slice(1),r,e.shape.length),!q().getBool("WEBGL_PACK_REDUCE")||e.shape.length<=2){const i=[],o=t.texData.get(e.dataId),a=o!==null&&o.isPacked;let l=e;a&&(l=t.unpackTensor(e),i.push(l));const[c,u]=Wt(l.shape,r),d=J(u),h=ae({inputs:{x:l},backend:t,attrs:{shape:[-1,d]}});i.push(h);const p=ED(t,h,s);i.push(p);const f=ae({inputs:{x:p},backend:t,attrs:{shape:c}});return i.forEach(g=>t.disposeIntermediateTensorInfo(g)),f}return RD(t,e,s)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gne(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:i}=s;let o=Te(i,r.shape);const a=dt(o,r.shape.length);let l=r;const c=[];a!=null&&(l=vn({inputs:{x:r},backend:n,attrs:{perm:a}}),c.push(l),o=wt(o.length,l.shape.length)),Xt("argMax",[o[0]],l.shape.length);const u=ND(n,l,o[0],"max");return c.forEach(d=>n.disposeIntermediateTensorInfo(d)),u}const yne={kernelName:Of,backendName:"webgl",kernelFunc:gne};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xne(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:i}=s;let o=Te(i,r.shape);const a=dt(o,r.shape.length);let l=r;const c=[];a!=null&&(l=vn({inputs:{x:r},backend:n,attrs:{perm:a}}),c.push(l),o=wt(o.length,l.shape.length)),Xt("argMin",[o[0]],l.shape.length);const u=ND(n,l,o[0],"min");return c.forEach(d=>n.disposeIntermediateTensorInfo(d)),u}const vne={kernelName:Pf,backendName:"webgl",kernelFunc:xne};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bne=Rs+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,wne=Oe({opSnippet:bne}),kne={kernelName:Pu,backendName:"webgl",kernelFunc:wne};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cne=Rs+"return log(x + sqrt(x * x + 1.0));",Sne=Oe({opSnippet:Cne}),Ine={kernelName:Mu,backendName:"webgl",kernelFunc:Sne};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $ne=Rs+`
  return atan(x);
`,Tne=Oe({opSnippet:$ne}),Ene={kernelName:Lu,backendName:"webgl",kernelFunc:Tne};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rne=iw+`
  return atan(a, b);
`,Nne=`
  vec4 result = atan(a, b);
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+ka+`
  return result;
`,Ane=Yt({opSnippet:Rne,packedOpSnippet:Nne}),_ne={kernelName:ju,backendName:"webgl",kernelFunc:Ane};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Dne=Rs+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,Fne=Oe({opSnippet:Dne}),One={kernelName:zu,backendName:"webgl",kernelFunc:Fne};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class xu{constructor(e,n,s,r=!1,i=!1){if(this.variableNames=["x"],n==="avg"&&s)throw new Error("Cannot compute positions for average pool.");const o=e.filterWidth,a=e.strideHeight,l=e.strideWidth,c=e.dilationHeight,u=e.dilationWidth,d=e.effectiveFilterHeight,h=e.effectiveFilterWidth,p=e.padInfo.top,f=e.padInfo.left;this.outputShape=e.outShape;const g=n==="avg",x=`((batch  * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + d`,y=`(xR * ${e.inWidth} + xC) * ${e.inChannels} + d`;let v="0.0";if(g||(v="-1.0 / 1e-20"),s){const C=">=";this.userCode=`
        const ivec2 strides = ivec2(${a}, ${l});
        const ivec2 pads = ivec2(${p}, ${f});

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < ${d};
              wR += ${c}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${h};
                wC += ${u}) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value ${C} currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = ${r?i?x:y:`wR * ${h} + wC`};
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}const b="max";let w=`${n}(${n}(${n}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;n==="avg"&&(w="avgValue / max(count, 1.0)");const k=Math.floor(o/4)*4,S=o%4,I=`
      if (${g}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${b}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(${a}, ${l});
      const ivec2 pads = ivec2(${p}, ${f});
      const float initializationValue = ${v};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= ${e.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(${v});
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < ${d};
            wR += ${c}) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= ${e.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${k}; wC += 4) {
            int xC = xCCorner + wC * ${u};

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${u}, d),
              getValue(batch, xR, xC + 2 * ${u}, d),
              getValue(batch, xR, xC + 3 * ${u}, d)
            );

            ${I}
          }

          int xC = xCCorner + ${k};
          if (${S===1}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            ${I}
          } else if (${S===2}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${u}, d),
              initializationValue,
              initializationValue
            );

            ${I}
          } else if (${S===3}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${u}, d),
              getValue(batch, xR, xC + 2 * ${u}, d),
              initializationValue
            );

            ${I}
          }
        }
        setOutput(${w});
      }
    `}}class aw{constructor(e,n,s,r=!1,i=!1){if(this.variableNames=["x"],n==="avg"&&s)throw new Error("Cannot compute positions for average pool.");const o=e.filterWidth,a=e.strideDepth,l=e.strideHeight,c=e.strideWidth,u=e.dilationDepth,d=e.dilationHeight,h=e.dilationWidth,p=e.effectiveFilterDepth,f=e.effectiveFilterHeight,g=e.effectiveFilterWidth,x=e.padInfo.front,y=e.padInfo.top,v=e.padInfo.left;this.outputShape=e.outShape;const b=n==="avg";let w="0.0";if(b||(w="-1.0 / 1e-20"),s){const R=">=";this.userCode=`
        const ivec3 strides =
            ivec3(${a}, ${l}, ${c});
        const ivec3 pads = ivec3(${x}, ${y}, ${v});

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < ${p};
              wD += ${u}) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= ${e.inDepth}) {
              continue;
            }

            for (int wR = 0; wR < ${f};
                wR += ${d}) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= ${e.inHeight}) {
                continue;
              }

              for (int wC = 0; wC < ${g};
                  wC += ${h}) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= ${e.inWidth}) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value ${R} currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition = ${r?i?`(((batch * ${e.inDepth} + xD) * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`((xD * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`wD * ${f} * ${g} +
                      wR * ${g} + wC`};
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}const k="max";let S=`${n}(${n}(${n}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;n==="avg"&&(S="avgValue / max(count, 1.0)");const I=Math.floor(o/4)*4,C=o%4,$=`
      if (${b}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${k}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(${a}, ${l}, ${c});
      const ivec3 pads = ivec3(${x}, ${y}, ${v});
      const float initializationValue = ${w};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= ${e.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(${w});
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < ${p};
            wD += ${u}) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= ${e.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${f};
            wR += ${d}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${I}; wC += 4) {
              int xC = xCCorner + wC * ${h};

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${h}, ch),
                getValue(batch, xD, xR, xC + 2 * ${h}, ch),
                getValue(batch, xD, xR, xC + 3 * ${h}, ch)
              );

              ${$}
            }

            int xC = xCCorner + ${I};
            if (${C===1}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              ${$}
            } else if (${C===2}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${h}, ch),
                initializationValue,
                initializationValue
              );

              ${$}
            } else if (${C===3}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${h}, ch),
                getValue(batch, xD, xR, xC + 2 * ${h}, ch),
                initializationValue
              );

              ${$}
            }
          }
        }
        setOutput(${S});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pne(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e;Xd(r,"avgPool");const{filterSize:i,strides:o,pad:a,dimRoundingMode:l}=s,c=1;T(rn(o,c),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${c}'`);const u=Ts(r.shape,i,o,c,a,l);if(u.filterWidth===1&&u.filterHeight===1&&je(u.inShape,u.outShape))return Gn({inputs:{x:r},backend:n});const d=new xu(u,"avg",!1);return n.runWebGLProgram(d,[r],"float32")}const Mne={kernelName:Mf,backendName:"webgl",kernelFunc:Pne};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lne(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{filterSize:i,strides:o,pad:a,dimRoundingMode:l,dataFormat:c}=s,u=[1,1,1],d=ri(r.shape,i,o,u,a,l,c),h=new aw(d,"avg",!1);return n.runWebGLProgram(h,[r],"float32")}const zne={kernelName:Lf,backendName:"webgl",kernelFunc:Lne};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class jne{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const n=e.filterHeight,s=e.filterWidth,r=e.strideHeight,i=e.strideWidth,o=e.dilationHeight,a=e.dilationWidth,l=e.effectiveFilterHeight,c=e.effectiveFilterWidth,u=l-1-e.padInfo.top,d=c-1-e.padInfo.left,h=1/(n*s);this.userCode=`
      const ivec2 pads = ivec2(${u}, ${d});
      const float avgMultiplier = float(${h});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${l};
            wR += ${o}) {
          float dyR = float(dyRCorner + wR) / ${r}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${c};
            wC+= ${a}) {
            float dyC = float(dyCCorner + wC) / ${i}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `}}class Bne{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const n=e.filterDepth,s=e.filterHeight,r=e.filterWidth,i=e.strideDepth,o=e.strideHeight,a=e.strideWidth,l=e.dilationDepth,c=e.dilationHeight,u=e.dilationWidth,d=e.effectiveFilterDepth,h=e.effectiveFilterHeight,p=e.effectiveFilterWidth,f=d-1-e.padInfo.front,g=h-1-e.padInfo.top,x=p-1-e.padInfo.left,y=1/(n*s*r);this.userCode=`
      const ivec3 pads = ivec3(${f}, ${g}, ${x});
      const float avgMultiplier = float(${y});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${d};
            wD += ${l}) {
          float dyD = float(dyDCorner + wD) / ${i}.0;

          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${h};
              wR += ${c}) {
            float dyR = float(dyRCorner + wR) / ${o}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${p};
                wC += ${u}) {
              float dyC = float(dyCCorner + wC) / ${a}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wne(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,input:i}=e,o=i,{filterSize:a,strides:l,pad:c,dimRoundingMode:u}=s,d=[1,1,1],h=ri(o.shape,a,l,d,c,u),p=new Bne(h);return n.runWebGLProgram(p,[r],o.dtype)}const Vne={kernelName:k1,backendName:"webgl",kernelFunc:Wne};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Une(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,input:i}=e,o=i;Xd([r,i],"avgPoolGrad");const{filterSize:a,strides:l,pad:c}=s,u=Ts(o.shape,a,l,1,c),d=new jne(u);return n.runWebGLProgram(d,[r],o.dtype)}const Gne={kernelName:w1,backendName:"webgl",kernelFunc:Une};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hne(t){const{inputs:e,backend:n,attrs:s}=t,{a:r,b:i}=e,{transposeA:o,transposeB:a}=s;return of({a:r,b:i,transposeA:o,transposeB:a,backend:n})}const Kne={kernelName:zf,backendName:"webgl",kernelFunc:Hne};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class qne{constructor(e,n,s,r,i,o){this.outputShape=[],this.variableNames=["x","mean","variance"],Se(e,n),Se(e,s);let a="0.0";r!=null&&(Se(e,r),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let l="1.0";i!=null&&(Se(e,i),this.variableNames.push("scale"),l="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = ${a};
        float scale = ${l};
        float inv = scale * inversesqrt(variance + float(${o}));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Xne{constructor(e,n,s,r,i,o){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],Se(e,n),Se(e,s);let a="vec4(0.0)";r!=null&&(Se(e,r),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let l="vec4(1.0)";i!=null&&(Se(e,i),this.variableNames.push("scale"),l="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        vec4 offset = ${a};
        vec4 scale = ${l};

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(${o}));

        setOutput((x - mean) * inv + offset);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yne=({inputs:t,backend:e,attrs:n})=>{const{x:s,mean:r,variance:i,offset:o,scale:a}=t;T(r.shape.length===i.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),T(o==null||r.shape.length===o.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),T(a==null||r.shape.length===a.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");let{varianceEpsilon:l}=n;l==null&&(l=.001);const c=[s,r,i];let u=null;o!=null&&(u=o.shape,c.push(o));let d=null;a!=null&&(d=a.shape,c.push(a));const h=q().getBool("WEBGL_PACK_NORMALIZATION")?new Xne(s.shape,r.shape,i.shape,u,d,l):new qne(s.shape,r.shape,i.shape,u,d,l);return e.runWebGLProgram(h,c,c[0].dtype)},Qne={kernelName:Qf,backendName:"webgl",kernelFunc:Yne};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Jne{constructor(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;const n=Ge(this.rank);this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const s=Zne(this.rank);let r;const i=e.map((o,a)=>`sourceLoc.${Q0[a]} = start[${a}] + coords.${Q0[a]};`);r=`
        ${n} sourceLoc;
        ${n} coords = getOutputCoords();
        ${i.join(`
`)}
      `,this.userCode=`
      void main() {
        ${r}
        setOutput(getSource(${s}));
      }
    `}}const Q0=["x","y","z","w","u","v"];function Zne(t){if(t===1)return"sourceLoc";if(t<=6)return Q0.slice(0,t).map(e=>"sourceLoc."+e).join(",");throw Error(`Slicing for rank ${t} is not yet supported`)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ese{constructor(e){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const n=Ge(this.rank),s=mn("coords",this.rank),r=mn("sourceLoc",this.rank),i=this.rank===1?"sourceLoc":`vec2(${r.slice(-2).join()})`,o=`getChannel(getSource(${r.join()}), ${i})`,a=`
      result.x = ${o};
      if (++${s[this.rank-1]} < ${e[this.rank-1]}) {
        ++${r[this.rank-1]};
        result.y = ${o};
        --${r[this.rank-1]};
      }
    `,l=this.rank===1?"":`
      --${s[this.rank-1]};
      if (++${s[this.rank-2]} < ${e[this.rank-2]}) {
        ++${r[this.rank-2]};
        result.z = ${o};
        if (++${s[this.rank-1]} < ${e[this.rank-1]}) {
          ++${r[this.rank-1]};
          result.w = ${o};
        }
      }
    `,c=this.rank<=4?`sourceLoc = coords +
            ${n}(${e.map((u,d)=>`start[${d}]`).join()});`:e.map((u,d)=>`${r[d]} = ${s[d]} + start[${d}];`).join(`
`);this.userCode=`
      void main() {
        ${n} coords = getOutputCoords();
        ${n} sourceLoc;
        ${c}
        vec4 result = vec4(0.);
        ${a}
        ${l}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tse(t,e,n,s){const r=s.texData.get(t.dataId),i=s.makeTensorInfo(n,t.dtype),o=s.texData.get(i.dataId);Object.assign(o,r),o.refCount=1,o.shape=n,o.dtype=t.dtype;let a=Xv(e,me(t.shape));r.slice&&(a+=r.slice.flatOffset),o.slice={flatOffset:a,origDataId:r.slice&&r.slice.origDataId||t.dataId};const l=s.dataRefCount.get(o.slice.origDataId)||1;return s.dataRefCount.set(o.slice.origDataId,l+1),i}function ec(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{begin:i,size:o}=s,[a,l]=Bm(r,i,o);if(Hv(r,a,l),J(l)===0)return n.makeTensorInfo(l,r.dtype,[]);if(n.shouldExecuteOnCPU([r])||r.dtype==="string"){const d=n.texData.get(r.dataId),h=Kee(d.values,a,l,r.shape,r.dtype);return n.makeTensorInfo(l,r.dtype,h)}const{isPacked:c}=n.texData.get(r.dataId),u=qv(r.shape,a,l);if(c||!u){const d=q().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new ese(l):new Jne(l),h=[a];return n.runWebGLProgram(d,[r],r.dtype,h)}return n.uploadToGPU(r.dataId),tse(r,a,l,n)}const nse={kernelName:$m,backendName:"webgl",kernelFunc:ec};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sse=t=>{const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{blockShape:i,crops:o}=s;T(r.shape.length<=4,()=>"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet");const a=i.reduce((v,b)=>v*b),l=Pd(r.shape,i,a),c=Md(l.length,i.length),u=Ld(r.shape,i,a),d=eb(o,i.length),h=tb(u,o,i.length),p=[],f=ae({inputs:{x:r},backend:n,attrs:{shape:l}}),g=vn({inputs:{x:f},backend:n,attrs:{perm:c}}),x=ae({inputs:{x:g},backend:n,attrs:{shape:u}}),y=ec({inputs:{x},backend:n,attrs:{begin:d,size:h}});return p.push(f),p.push(g),p.push(x),p.forEach(v=>n.disposeIntermediateTensorInfo(v)),y},rse={kernelName:jf,backendName:"webgl",kernelFunc:sse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ise(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,weights:i}=e,{size:o}=s,a=n.readSync(r.dataId),l=n.readSync(i.dataId),c=yD(a,l,i.dtype,i.shape,o);return n.makeTensorInfo([o],i.dtype,c)}const ose={kernelName:C1,backendName:"webgl",kernelFunc:ise};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ase=`
  int r = int(a.r) & int(b.r);
  int g = int(a.g) & int(b.g);
  int rb = int(a.b) & int(b.b);
  int ra = int(a.a) & int(b.a);
  return vec4(r, g, rb, ra);
`,lse=`
  return float(int(a.r) & int(b.r));
`;function cse(t){const{inputs:e,backend:n}=t,{a:s,b:r}=e,i=q().getBool("WEBGL_PACK_BINARY_OPERATIONS"),o=q().getNumber("WEBGL_VERSION");if(n.shouldExecuteOnCPU([s,r])||o===1){const l=n.texData.get(s.dataId).values,c=n.texData.get(r.dataId).values,[u,d]=yee(s.shape,r.shape,l,c,s.dtype),h=n.makeTensorInfo(d,s.dtype),p=n.texData.get(h.dataId);return p.values=u,h}let a;return i?a=new Jl(ase,s.shape,r.shape,!1):a=new oa(lse,s.shape,r.shape),n.runWebGLProgram(a,[s,r],s.dtype)}const use={kernelName:S1,backendName:"webgl",kernelFunc:cse};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dse(t){const{inputs:e,backend:n}=t,{s0:s,s1:r}=e,i=n.readSync(s.dataId),o=n.readSync(r.dataId),a=Se(Array.from(i),Array.from(o));return n.makeTensorInfo([a.length],"int32",Int32Array.from(a))}const hse={kernelName:ST,backendName:"webgl",kernelFunc:dse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pse="return float(a != b);",AD=Yt({opSnippet:pse,cpuKernelImpl:Lee,dtype:"bool"}),fse={kernelName:fm,backendName:"webgl",kernelFunc:AD};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qd(t){const{inputs:e,backend:n}=t,{input:s}=e,r=n.texData.get(s.dataId);return Gn({inputs:{x:r.complexTensorInfos.real},backend:n})}const mse={kernelName:X1,backendName:"webgl",kernelFunc:Qd};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gse="return float(int(x));";function yse(t,e){const n=new dr(t.shape,gse),s=e.runWebGLProgram(n,[t],"int32");return{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function J0(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{dtype:i}=s;if(i==="complex64"){if(r.dtype==="complex64")return Gn({inputs:{x:r},backend:n});const o=zt(r.shape),a=J0({inputs:{x:r},backend:n,attrs:{dtype:"float32"}}),l=po({inputs:{real:a,imag:o},backend:n});return o.dispose(),n.disposeIntermediateTensorInfo(a),l}if(r.dtype==="complex64"){const o=Qd({inputs:{input:r},backend:n}),a=J0({inputs:{x:o},backend:n,attrs:{dtype:i}});return n.disposeIntermediateTensorInfo(o),a}if(!vT(r.dtype,i)){const o=Gn({inputs:{x:r},backend:n});return{dataId:o.dataId,shape:o.shape,dtype:i}}if(n.shouldExecuteOnCPU([r])){const o=n.texData.get(r.dataId).values,[a,l,c]=xee(o,r.shape,r.dtype,i);return n.makeTensorInfo(a,l,c)}if(i==="int32")return yse(r,n);if(i==="bool"){const o=n.makeTensorInfo([],"bool",tn("bool",1)),l=AD({inputs:{a:r,b:o},backend:n});return n.disposeIntermediateTensorInfo(o),l}throw new Error(`Error in Cast: failed to cast ${r.dtype} to ${i}`)}const xse={kernelName:Bu,backendName:"webgl",kernelFunc:J0};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AC="return ceil(x);",vse=Oe({opSnippet:AC,packedOpSnippet:AC,cpuKernelImpl:vee}),bse={kernelName:Wu,backendName:"webgl",kernelFunc:vse};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class wse{constructor(e){this.variableNames=["A"],this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class kse{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`
      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cse(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{clipValueMin:i,clipValueMax:o}=s;let a;q().getBool("WEBGL_PACK_CLIP")?a=new kse(r.shape):a=new wse(r.shape);const l=[[i],[o]];return n.runWebGLProgram(a,[r],r.dtype,l)}const Sse={kernelName:Vu,backendName:"webgl",kernelFunc:Cse};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ise{constructor(e){this.variableNames=["real","imag"],this.outputShape=e,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _C(t,e){return{dataId:e.dataId,dtype:e.dtype,shape:t.shape}}function $se(t){const{inputs:e,backend:n}=t,{x:s}=e,r=n.texData.get(s.dataId),i=new Ise(s.shape),o=[_C(s,r.complexTensorInfos.real),_C(s,r.complexTensorInfos.imag)];return n.runWebGLProgram(i,o,o[0].dtype)}const Tse={kernelName:Bf,backendName:"webgl",kernelFunc:$se};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ese{constructor(e){this.outputShape=[],this.outputShape=xr(e,1),this.variableNames=e.map((o,a)=>`T${a}`);const n=new Array(e.length-1);n[0]=e[0][1];for(let o=1;o<n.length;o++)n[o]=n[o-1]+e[o][1];const s=[`if (yC < ${n[0]}) setOutput(getT0(yR, yC));`];for(let o=1;o<n.length;o++){const a=n[o-1];s.push(`else if (yC < ${n[o]}) setOutput(getT${o}(yR, yC-${a}));`)}const r=n.length,i=n[n.length-1];s.push(`else setOutput(getT${r}(yR, yC-${i}));`),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        ${s.join(`
        `)}
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Rse{constructor(e,n){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=xr(e,n);const s=this.outputShape,r=s.length,i=Ge(r),o=mn("coords",r),a=["x","y","z","w","u","v"].slice(0,r);this.variableNames=e.map((g,x)=>`T${x}`);const l=new Array(e.length-1);l[0]=e[0][n];for(let g=1;g<l.length;g++)l[g]=l[g-1]+e[g][n];const c=a[n],u=a.slice(-2),d=a.join();let h=`if (${c} < ${l[0]}) {
        return getChannel(
            getT0(${d}), vec2(${u.join()}));
        }`;for(let g=1;g<l.length;g++){const x=l[g-1];h+=`
        if (${c} < ${l[g]}  && ${c} >= ${l[g-1]}) {
          return getChannel(
            getT${g}(${_h(a,c,x)}),
            vec2(${_h(u,c,x)}));
        }`}const p=l.length,f=l[l.length-1];h+=`
        return getChannel(
          getT${p}(${_h(a,c,f)}),
          vec2(${_h(u,c,f)}));`,this.userCode=`
      float getValue(${a.map(g=>"int "+g)}) {
        ${h}
      }

      void main() {
        ${i} coords = getOutputCoords();
        vec4 result = vec4(getValue(${o}), 0., 0., 0.);

        ${o[r-1]} = ${o[r-1]} + 1;
        if (${o[r-1]} < ${s[r-1]}) {
          result.g = getValue(${o});
        }

        ${o[r-2]} = ${o[r-2]} + 1;
        if (${o[r-2]} < ${s[r-2]}) {
          result.a = getValue(${o});
        }

        ${o[r-1]} = ${o[r-1]} - 1;
        if (${o[r-2]} < ${s[r-2]} &&
            ${o[r-1]} < ${s[r-1]}) {
          result.b = getValue(${o});
        }
        setOutput(result);
      }
    `}}function _h(t,e,n){const s=t.indexOf(e);return t.map((i,o)=>o===s?`${i} - ${n}`:i).join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ag(t){const{inputs:e,backend:n}=t,{input:s}=e,r=n.texData.get(s.dataId);return Gn({inputs:{x:r.complexTensorInfos.imag},backend:n})}const Nse={kernelName:B1,backendName:"webgl",kernelFunc:ag};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ic(t,e,n){const s=t[0].dtype;if(s==="complex64"){const p=t.map(v=>Qd({inputs:{input:v},backend:n})),f=t.map(v=>ag({inputs:{input:v},backend:n})),g=Ic(p,e,n),x=Ic(f,e,n),y=po({inputs:{real:g,imag:x},backend:n});return p.forEach(v=>n.disposeIntermediateTensorInfo(v)),f.forEach(v=>n.disposeIntermediateTensorInfo(v)),n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(x),y}let r=n.shouldExecuteOnCPU(t);if(s==="string"&&(r=!0),r){const p=t.map(w=>{const S=[-1,J(w.shape.slice(e))];return ae({inputs:{x:w},backend:n,attrs:{shape:S}})}),f=p.map(w=>({vals:n.readSync(w.dataId),shape:w.shape})),g=xr(p.map(w=>w.shape),1),x=p[0].shape[0]===1,y=bee(f,g,s,x),v=xr(t.map(w=>w.shape),e),b=n.makeTensorInfo(v,s,y);return p.forEach(w=>n.disposeIntermediateTensorInfo(w)),b}const i=t.filter(p=>J(p.shape)>0),o=q().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&i[0].shape.length>1;if(i.length===1){const p=o?new dr(t[0].shape,mi):new Ti(t[0].shape,mi);return n.runWebGLProgram(p,t,s)}const a=q().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER");if(i.length>a){const p=[];for(let g=0;g<i.length;g+=a){const x=i.slice(g,g+a);p.push(Ic(x,e,n))}const f=Ic(p,e,n);for(const g of p)n.disposeIntermediateTensorInfo(g);return f}if(o){const p=new Rse(i.map(f=>f.shape),e);return n.runWebGLProgram(p,i,s)}const{tensors2D:l,outShape:c}=Ase(i,e,n),u=new Ese(l.map(p=>p.shape)),d=n.runWebGLProgram(u,l,s);l.forEach(p=>n.disposeIntermediateTensorInfo(p));const h=ae({inputs:{x:d},attrs:{shape:c},backend:n});return n.disposeIntermediateTensorInfo(d),h}function Ase(t,e,n){const s=xr(t.map(i=>i.shape),e);return{tensors2D:t.map(i=>ae({inputs:{x:i},attrs:{shape:[-1,J(i.shape.slice(e))]},backend:n})),outShape:s}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _D(t){const{inputs:e,backend:n,attrs:s}=t,{axis:r}=s,i=Te(r,e[0].shape)[0],o=e.map(c=>c.shape);Qv(o,i);const a=xr(e.map(c=>c.shape),i);if(J(a)===0)return n.makeTensorInfo(a,e[0].dtype,[]);const l=e.filter(c=>J(c.shape)>0);return l.length===1?Gn({inputs:{x:l[0]},backend:n}):Ic(l,i,n)}const _se={kernelName:Wf,backendName:"webgl",kernelFunc:_D};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class DD{constructor(e,n=!1,s=null,r=!1,i=!1){this.variableNames=["x","W"],this.outputShape=e.outShape;const o=e.padInfo.top,a=e.padInfo.left,l=e.strideHeight,c=e.strideWidth,u=e.dilationHeight,d=e.dilationWidth,h=e.filterHeight,p=e.filterWidth,f=Math.floor(e.inChannels/4)*4,g=e.inChannels%4,x=e.dataFormat==="channelsLast",y=x?1:2,v=x?2:3,b=x?3:1;let w="",k="";s&&(r?w=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${s}
        }`:i?w=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${s}
        }`:w=`
          float activation(float x) {
            ${s}
          }
        `,k="result = activation(result);");const S=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${w}

      const ivec2 strides = ivec2(${l}, ${c});
      const ivec2 pads = ivec2(${o}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[${b}];

        ivec2 xRCCorner =
            ivec2(coords[${y}], coords[${v}]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${h}; wR++) {
          int xR = xRCorner + wR * ${u};

          if (xR < 0 || xR >= ${e.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${p}; wC++) {
            int xC = xCCorner + wC * ${d};

            if (xC < 0 || xC >= ${e.inWidth}) {
              continue;
            }

            for (int d1 = 0; d1 < ${f}; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (${x}) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (${g===1}) {

              if (${x}) {
                dotProd +=
                    getX(batch, xR, xC, ${f}) *
                    getW(wR, wC, ${f}, d2);
              } else {
                dotProd +=
                    getX(batch, ${f}, xR, xC) *
                    getW(wR, wC, ${f}, d2);
              }

            } else if (${g===2}) {
              vec2 wValues = vec2(
                getW(wR, wC, ${f}, d2),
                getW(wR, wC, ${f} + 1, d2)
              );

              if (${x}) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, ${f}),
                  getX(batch, xR, xC, ${f} + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, ${f}, xR, xC),
                  getX(batch, ${f} + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (${g===3}) {
              vec3 wValues = vec3(
                getW(wR, wC, ${f}, d2),
                getW(wR, wC, ${f} + 1, d2),
                getW(wR, wC, ${f} + 2, d2)
              );

              if (${x}) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, ${f}),
                  getX(batch, xR, xC, ${f} + 1),
                  getX(batch, xR, xC, ${f} + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, ${f}, xR, xC),
                  getX(batch, ${f} + 1, xR, xC),
                  getX(batch, ${f} + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        ${S}
        ${k}
        setOutput(result);
      }
    `}}class Dse{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const n=e.padInfo.front,s=e.padInfo.top,r=e.padInfo.left,i=e.strideDepth,o=e.strideHeight,a=e.strideWidth,l=e.dilationDepth,c=e.dilationHeight,u=e.dilationWidth,d=e.filterDepth,h=e.filterHeight,p=e.filterWidth,f=Math.floor(e.inChannels/4)*4,g=e.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(${i}, ${o}, ${a});
      const ivec3 pads = ivec3(${n}, ${s}, ${r});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < ${d}; wF++) {
          int xF = xFCorner + wF * ${l};

          if (xF < 0 || xF >= ${e.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${h}; wR++) {
            int xR = xRCorner + wR * ${c};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${p}; wC++) {
              int xC = xCCorner + wC * ${u};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              for (int d1 = 0; d1 < ${f}; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (${g===1}) {
                dotProd +=
                  getX(batch, xF, xR, xC, ${f}) *
                  getW(wF, wR, wC, ${f}, d2);
              } else if (${g===2}) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, ${f}),
                  getX(batch, xF, xR, xC, ${f} + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, ${f}, d2),
                  getW(wF, wR, wC, ${f} + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (${g===3}) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, ${f}),
                  getX(batch, xF, xR, xC, ${f} + 1),
                  getX(batch, xF, xR, xC, ${f} + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, ${f}, d2),
                  getW(wF, wR, wC, ${f} + 1, d2),
                  getW(wF, wR, wC, ${f} + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class FD{constructor(e,n=!1,s=null,r=!1,i=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=an(this.outputShape.length);const o=e.padInfo.left,a=e.strideWidth,l=e.dilationWidth,c=e.filterHeight,u=e.filterWidth,d=u;let h=`
       int xR; int xC; int xCOffset;
       vec4 wTexel; vec4 previous; vec4 final;`;for(let x=0;x<u;x++)h+=`
           vec4 xTexelC${x*2};
           int xTexelC${x*2}Ready;
           vec4 xTexelC${x*2+1};
           int xTexelC${x*2+1}Ready;
           vec4 xC${x};`;h+=`
     for (int r = 0; r < ${c}; r++) {
      for (int d1 = 0; d1 < ${e.inChannels}; d1 += 2) {
       `;for(let x=0;x<u;x++)h+=`
           xTexelC${x*2} = vec4(0.0);
           xTexelC${x*2}Ready = 0;
           xTexelC${x*2+1} = vec4(0.0);
           xTexelC${x*2+1}Ready = 0;
           xC${x} = vec4(0.0);`;h+=`
         xR = xRCorner + r * dilations[0];
         if (xR >=0 && xR < inDims[0]) {
       `;for(let x=0;x<(d+1)/2;x++){const y=x*2;if(h+=`
           xC = xCCorner + ${y*l};
           `,a===1){if(y<u&&(o%2===1?(h+=`
                 xCOffset = xC + 1;
                 if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y}Ready == 0) {
                   xTexelC${y} = getX(batch, xR, xCOffset, d1);

                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${y}.zw = vec2(0.0);
                   }
                   xTexelC${y}Ready = 1;
                 }
               `,l===1&&y>0?h+=`
                 xC${y} = vec4(xTexelC${y-2}.zw, xTexelC${y}.xy);
                 `:h+=`
                   xCOffset = xC + 1 - 2;

                   if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       previous.zw = vec2(0.0);
                     }

                     xC${y} = vec4(previous.zw, xTexelC${y}.xy);
                   } else {
                     xC${y} = vec4(0.0, 0.0, xTexelC${y}.xy);
                   }
                   `):h+=`
                 if (xC >= 0 && xC < inDims[1] && xTexelC${y}Ready == 0) {
                   xTexelC${y} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${y}.zw = vec2(0.0);
                   }
                   xTexelC${y}Ready = 1;
                 }

                 xC${y} = xTexelC${y};
                 `,y+1<u)){const v=o%2===0?h1(l):l;l%2===0&&o%2===1||l%2!==0&&o%2!==1?(h+=`
                   xCOffset = xC + imod(pads[1], 2) + ${v};

                   if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y+1}Ready == 0) {
                     xTexelC${y+1} = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       xTexelC${y+1}.zw = vec2(0.0);
                     }
                     xTexelC${y+1}Ready = 1;
                   }
                   `,l>1?h+=`
                     xCOffset -= 2;
                     if (xCOffset >= 0 && xCOffset < inDims[1]) {
                      previous = getX(batch, xR, xCOffset, d1);
                      xC${y+1} = vec4(previous.zw, xTexelC${y+1}.xy);
                     } else {
                      xC${y+1} = vec4(0.0, 0.0, xTexelC${y+1}.xy);
                     }
                     `:h+=`
                     xC${y+1} = vec4(xTexelC${y}.zw, xTexelC${y+1}.xy);
                     `):v===1?h+=`
                     xC${y+1} = xTexelC${y};
                     `:h+=`
                     xCOffset = xC + ${v};

                     if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y+1}Ready == 0) {
                       xTexelC${y+1} = getX(batch, xR, xCOffset, d1);
                       if (xCOffset + 1 >= inDims[1]) {
                         xTexelC${y+1}.zw = vec2(0.0);
                       }
                       xTexelC${y+1}Ready = 1;
                     }

                     xC${y+1} = xTexelC${y+1};
                     `}}else y<u&&(o%2===1?(h+=`
                 xCOffset = xC + 1 - strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y}Ready == 0) {
                   xTexelC${y} = getX(batch, xR, xCOffset, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${y}.zw = vec2(0.0);
                   }
                   xTexelC${y}Ready = 1;
                 }

                 if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${y+1}Ready == 0) {
                   xTexelC${y+1} = getX(batch, xR, xC + 1, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xC + 2 >= inDims[1]) {
                     xTexelC${y+1}.zw = vec2(0.0);
                   }
                   xTexelC${y+1}Ready = 1;
                 }

                 xC${y} = vec4(xTexelC${y}.zw, xTexelC${y+1}.zw);
               `,y+1<u&&(h+=`
                   final = vec4(0.0);
                   xCOffset = xC + 1 + strides[1];
                   if(xCOffset >= 0 && xCOffset < inDims[1]) {
                     final = getX(batch, xR, xCOffset, d1);
                   }
                   xC${y+1} = vec4(xTexelC${y+1}.xy, final.xy);
                 `)):(h+=`
                 if(xC >= 0 && xC < inDims[1] && xTexelC${y}Ready == 0) {
                   xTexelC${y} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${y}.zw = vec2(0.0);
                   }
                   xTexelC${y}Ready = 1;
                 }

                 xCOffset = xC + strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y+1}Ready == 0) {
                   xTexelC${y+1} = getX(batch, xR, xCOffset, d1);
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${y+1}.zw = vec2(0.);
                   }
                   xTexelC${y+1}Ready = 1;
                 }

                 xC${y} = vec4(
                   xTexelC${y}.xy, xTexelC${y+1}.xy);
               `,y+1<u&&(h+=`
                   xC${y+1} = vec4(xTexelC${y}.zw, xTexelC${y+1}.zw);
                 `)));y<u&&(h+=`
             wTexel = getW(r, ${y}, d1, d2);
             dotProd += xC${y}.xxzz * vec4(wTexel.xy, wTexel.xy);
             if(d1 + 1 < ${e.inChannels}) {
               dotProd += xC${y}.yyww * vec4(wTexel.zw, wTexel.zw);
             }
           `,y+1<u&&(h+=`
               wTexel = getW(r, ${y+1}, d1, d2);
               dotProd += xC${y+1}.xxzz * vec4(wTexel.xy, wTexel.xy);
               if(d1 + 1 < ${e.inChannels}) {
                 dotProd += xC${y+1}.yyww * vec4(wTexel.zw, wTexel.zw);
               }
             `))}h+=`
     }
   `,h+=`
     }
   `,h+=`
     }
   `;let p="",f="";s&&(r?p=`vec4 activation(vec4 a) {
           vec4 b = getPreluActivationWeightsAtOutCoords();
           ${s}
         }`:i?p=`vec4 activation(vec4 a) {
           vec4 b = getLeakyreluAlphaAtOutCoords();
           ${s}
         }`:p=`vec4 activation(vec4 x) {
           ${s}
         }`,f="result = activation(result);");const g=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
       ${p}

       void main() {
         ivec4 coords = getOutputCoords();
         int batch = coords.x;
         ivec2 xRCCorner = coords.yz * strides - pads;
         int d2 = coords.w;
         int xRCorner = xRCCorner.x;
         int xCCorner = xRCCorner.y;

         //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
         vec4 dotProd = vec4(0.000000000000001);

         ${h}

         vec4 result = dotProd - vec4(0.000000000000001);
         ${g}
         ${f}
         setOutput(result);
       }
     `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Fse{constructor(e,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec4"},{name:"pad",type:"ivec2"},{name:"stride",type:"ivec2"},{name:"dilation",type:"ivec2"},{name:"inChannels",type:"int"},{name:"itemsPerBlockRow",type:"int"},{name:"outWidth",type:"int"}],this.outputShape=e,this.enableShapeUniforms=an(this.outputShape.length);const{dataFormat:s}=n,r=bn(),i=s==="channelsLast",o=i?1:2,a=i?2:3,l=this.enableShapeUniforms?"if(blockIndex < outShape[2] && pos < outShape[1]) {":`if(blockIndex < ${e[2]} && pos < ${e[1]}) {`;let c="";for(let u=0;u<=1;u++)for(let d=0;d<=1;d++)c+=`
          blockIndex = rc.z + ${d};
          pos = rc.y + ${u};

          ${l}
            offsetY = int(blockIndex / outWidth) * stride[0] - pad[0];
            d0 = offsetY + dilation[0] * (pos / itemsPerBlockRow);

            if(d0 < inputShape[${o}] && d0 >= 0) {
              // Use custom imod instead mod. On Intel GPU, mod may generate
              // unexpected value.
              // https://github.com/tensorflow/tfjs/issues/5447
              offsetX = imod(blockIndex, outWidth) * stride[1] - pad[1];
              d1 = offsetX + dilation[1] * (imod(pos, itemsPerBlockRow) /
                  inChannels);

              if(d1 < inputShape[${a}] && d1 >= 0) {

                ch = imod(pos, inChannels);

                if (${i}) {
                  innerDims = vec2(d1, ch);
                  result[${u*2+d}] = getChannel(
                    getA(rc.x, d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[${u*2+d}] = getChannel(
                    getA(rc.x, ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        ${c}

        ${r.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function af(t,e){const n=t.length;return n>=3?e?[...t.slice(0,-3),t[n-3]*t[n-2],t[n-1]]:[...t.slice(0,-3),t[n-3],t[n-2]*t[n-1]]:!e&&n===1&&t[0]>1?[t[0],1]:null}function OD({x:t,filter:e,convInfo:n,backend:s,bias:r=null,preluActivationWeights:i=null,leakyreluAlpha:o=0,activation:a=null}){const l=t.shape,c=s.texData.get(t.dataId),u=n.inChannels,d=l[0]*l[1]*l[2],h=n.outChannels,p=n.dataFormat==="channelsLast",f=!1,g=!1;let x;const y=[];if(i!=null){const w=af(i.shape,p);w!=null&&(i=ae({inputs:{x:i},backend:s,attrs:{shape:w}}),y.push(i))}if(r!=null){const w=af(r.shape,p);w!=null&&(r=ae({inputs:{x:r},backend:s,attrs:{shape:w}}),y.push(r))}if(!((d===1||h===1)&&u>TD)&&c.isPacked&&p&&c.texture!=null&&l[2]%2!==0&&je(c.shape.slice(-3),l.slice(-3))){const w=l[0]*l[1]*(l[2]+1),k={dataId:t.dataId,shape:[1,w,n.inChannels],dtype:t.dtype},S=c.shape;c.shape=c.shape.slice(),c.shape[c.shape.length-2]++,T(rf(c.shape,k.shape),()=>`packed reshape ${c.shape} to ${k.shape} isn't free`);const I=ae({inputs:{x:e},backend:s,attrs:{shape:[1,n.inChannels,n.outChannels]}});y.push(I);const C=of({a:k,b:I,backend:s,transposeA:f,transposeB:g,bias:r,activation:a,preluActivationWeights:i,leakyreluAlpha:o}),$=s.texData.get(C.dataId);T($.isPacked,()=>"batchMatMul result is expected to be packed"),c.shape=S,$.shape=n.outShape,x=Gn({inputs:{x:C},backend:s}),x.shape=n.outShape,y.push(C)}else{const w=n.outHeight*n.outWidth,k=ae({inputs:{x:t},backend:s,attrs:{shape:p?[n.batchSize,w,n.inChannels]:[n.batchSize,n.inChannels,w]}}),S=ae({inputs:{x:e},backend:s,attrs:{shape:[1,n.inChannels,n.outChannels]}}),I=of({a:p?k:S,b:p?S:k,transposeA:!p,transposeB:g,backend:s,bias:r,activation:a,preluActivationWeights:i,leakyreluAlpha:o});x=ae({inputs:{x:I},backend:s,attrs:{shape:n.outShape}}),y.push(k),y.push(S),y.push(I)}for(const w of y)s.disposeIntermediateTensorInfo(w);return x}function PD({x:t,filter:e,convInfo:n,backend:s,bias:r=null,preluActivationWeights:i=null,leakyreluAlpha:o=0,activation:a=null}){const{filterWidth:l,filterHeight:c,inChannels:u,outWidth:d,outHeight:h,dataFormat:p}=n,f=p==="channelsLast",g=l*c*u,x=h*d,y=[n.batchSize,g,x],v=!0,b=!1,w=[];if(i!=null){const E=af(i.shape,f);E!=null&&(i=ae({inputs:{x:i},backend:s,attrs:{shape:E}}),w.push(i))}if(r!=null){const E=af(r.shape,f);E!=null&&(r=ae({inputs:{x:r},backend:s,attrs:{shape:E}}),w.push(r))}const k=ae({inputs:{x:e},backend:s,attrs:{shape:[1,g,J(e.shape)/g]}});w.push(k);const S=new Fse(y,n),I=[t.shape,[n.padInfo.top,n.padInfo.left],[n.strideHeight,n.strideWidth],[n.dilationHeight,n.dilationWidth],[n.inChannels],[n.filterWidth*n.inChannels],[n.outWidth]],C=s.runWebGLProgram(S,[t],"float32",I),$=ae({inputs:{x:C},backend:s,attrs:{shape:y}});w.push(C),w.push($);const R=r!=null,_=i!=null,M=a==="leakyrelu",B=a?yu(a,!0):null,A=new $D(f?$.shape:k.shape,f?k.shape:$.shape,f?[n.batchSize,x,n.outChannels]:[n.batchSize,n.outChannels,x],v,b,R,B,_,M),F=f?[$,k]:[k,$];if(r&&F.push(r),_&&F.push(i),M){const E=s.makeTensorInfo([],"float32",ro(o,"float32"));F.push(E),w.push(E)}const P=s.runWebGLProgram(A,F,"float32"),H=ae({inputs:{x:P},backend:s,attrs:{shape:n.outShape}});w.push(P);for(const E of w)s.disposeIntermediateTensorInfo(E);return H}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ose(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,filter:i}=e,{strides:o,pad:a,dataFormat:l,dilations:c,dimRoundingMode:u}=s,d=ii(l),h=qt(r.shape,i.shape,o,c,a,u,!1,d);let p;if(h.filterHeight===1&&h.filterWidth===1&&h.dilationHeight===1&&h.dilationWidth===1&&h.strideHeight===1&&h.strideWidth===1&&(h.padInfo.type==="SAME"||h.padInfo.type==="VALID"))p=OD({x:r,filter:i,convInfo:h,backend:n});else if(h.strideWidth<=2&&d==="channelsLast"&&q().getBool("WEBGL_EXP_CONV")){const g=new FD(h),x=[[h.padInfo.top,h.padInfo.left],[h.strideHeight,h.strideWidth],[h.dilationHeight,h.dilationWidth],[h.inHeight,h.inWidth]];p=n.runWebGLProgram(g,[r,i],"float32",x)}else if(q().getBool("WEBGL_CONV_IM2COL"))p=PD({x:r,filter:i,convInfo:h,backend:n});else{const g=new DD(h);p=n.runWebGLProgram(g,[r,i],"float32")}const f=ae({inputs:{x:p},backend:n,attrs:{shape:h.outShape}});return n.disposeIntermediateTensorInfo(p),f}const Pse={kernelName:Vf,backendName:"webgl",kernelFunc:Ose};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Mse{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const n=e.strideHeight,s=e.strideWidth,r=e.padInfo.top,i=e.padInfo.left,o=e.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yR = 0; yR < ${e.outHeight}; yR++) {
            int xR = wR + yR * ${n} - ${r};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${e.outWidth}; yC++) {
              int xC = wC + yC * ${s} - ${i};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              ${o?`float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);`:`float dyValue = getDy(b, d2, yR, yC);
              float xValue = getX(b, d1, xR, xC);
              dotProd += (xValue * dyValue);`}
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class Lse{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const n=e.filterHeight,s=e.filterWidth,r=e.strideHeight,i=e.strideWidth,o=e.dataFormat==="channelsLast",a=n-1-e.padInfo.top,l=s-1-e.padInfo.left,c=o?1:2,u=o?2:3,d=o?3:1;this.userCode=`
      const ivec2 pads = ivec2(${a}, ${l});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[${d}];

        ivec2 dyCorner = ivec2(coords[${c}], coords[${u}]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${n}; wR++) {
          float dyR = float(dyRCorner + wR) / ${r}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${n} - 1 - wR;

          for (int wC = 0; wC < ${s}; wC++) {
            float dyC = float(dyCCorner + wC) / ${i}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${s} - 1 - wC;

            for (int d2 = 0; d2 < ${e.outChannels}; d2++) {

              if (${o}) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}}class zse{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const n=e.strideDepth,s=e.strideHeight,r=e.strideWidth,i=e.padInfo.front,o=e.padInfo.top,a=e.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yF = 0; yF < ${e.outDepth}; yF++) {
            int xF = wF + yF * ${n} - ${i};

            if (xF < 0 || xF >= ${e.inDepth}) {
              continue;
            }

            for (int yR = 0; yR < ${e.outHeight}; yR++) {
              int xR = wR + yR * ${s} - ${o};

              if (xR < 0 || xR >= ${e.inHeight}) {
                continue;
              }

              for (int yC = 0; yC < ${e.outWidth}; yC++) {
                int xC = wC + yC * ${r} - ${a};

                if (xC < 0 || xC >= ${e.inWidth}) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class jse{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const n=e.filterDepth,s=e.filterHeight,r=e.filterWidth,i=e.strideDepth,o=e.strideHeight,a=e.strideWidth,l=n-1-e.padInfo.front,c=s-1-e.padInfo.top,u=r-1-e.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(${l}, ${c}, ${u});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < ${n}; wF++) {
          float dyF = float(dyFCorner + wF) / ${i}.0;

          if (dyF < 0.0 || dyF >= ${e.outDepth}.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = ${n} - 1 - wF;

          for (int wR = 0; wR < ${s}; wR++) {
            float dyR = float(dyRCorner + wR) / ${o}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = ${s} - 1 - wR;

            for (int wC = 0; wC < ${r}; wC++) {
              float dyC = float(dyCCorner + wC) / ${a}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = ${r} - 1 - wC;

              for (int d2 = 0; d2 < ${e.outChannels}; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bse(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,dy:i}=e,{strides:o,pad:a,dataFormat:l,dimRoundingMode:c,filterShape:u}=s,d=ii(l),h=qt(r.shape,u,o,1,a,c,!1,d),p=new Mse(h);return n.runWebGLProgram(p,[r,i],"float32")}const Wse={kernelName:$1,backendName:"webgl",kernelFunc:Bse};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Vse{constructor(e){this.variableNames=["dy","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"strides",type:"vec2"}],this.outputShape=e.inShape,this.enableShapeUniforms=an(this.outputShape.length);const n=e.filterHeight,s=e.filterWidth,r=n-1-e.padInfo.top,i=s-1-e.padInfo.left;this.userCode=`
      const ivec2 pads = ivec2(${r}, ${i});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];

        ivec2 dyCorner = ivec2(coords[1], coords[2]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        vec4 result = vec4(0.);
        for (int wR = 0; wR < ${n}; wR++) {
          float dyR = float(dyRCorner + wR) / strides[0];
          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);
          int wRPerm = ${n} - 1 - wR;

          for (int wC = 0; wC < ${s}; wC++) {
            int wCPerm = ${s} - 1 - wC;

            float dyC = float(dyCCorner + wC) / strides[1];
            bool idyCVal = (dyC >= 0.0) && (dyC < ${e.outWidth}.0)
              && (fract(dyC) == 0.0);
            int idyC = int(dyC);

            float dyC2 = float(dyCCorner + wC + 1) / strides[1];
            bool idyCVal2 = (dyC2 >= 0.0) && (dyC2 < ${e.outWidth}.0)
              && (fract(dyC2) == 0.0);
            int idyC2 = int(dyC2);

            if (idyCVal && idyCVal2) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec4 dySample2 = (idyC / 2 == idyC2 / 2) ?
                  dySample : getDy(batch, idyR, idyC2, d2);

                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));

                dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample2.xy : dySample2.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal2) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC2, d2);
                vec2 dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            }
          }
        }
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Use(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,filter:i}=e,{inputShape:o,strides:a,pad:l,dataFormat:c,dimRoundingMode:u}=s,d=ii(c),h=qt(o,i.shape,a,1,l,u,!1,d);if(q().getBool("WEBGL_PACK_CONV2DTRANSPOSE")&&d==="channelsLast"){const p=[[h.strideHeight,h.strideWidth]],f=new Vse(h);return n.runWebGLProgram(f,[r,i],"float32",p)}else{const p=new Lse(h);return n.runWebGLProgram(p,[r,i],"float32")}}const Gse={kernelName:Uf,backendName:"webgl",kernelFunc:Use};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hse(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,filter:i}=e,{strides:o,pad:a,dilations:l}=s,c=io(r.shape,i.shape,o,l,a),u=new Dse(c);return n.runWebGLProgram(u,[r,i],"float32")}const Kse={kernelName:Gf,backendName:"webgl",kernelFunc:Hse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qse(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,dy:i}=e,{strides:o,pad:a,filterShape:l}=s,c=io(r.shape,l,o,1,a),u=new zse(c);return n.runWebGLProgram(u,[r,i],"float32")}const Xse={kernelName:T1,backendName:"webgl",kernelFunc:qse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yse(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,filter:i}=e,{pad:o,strides:a,inputShape:l}=s,c=io(l,i.shape,a,1,o),u=new jse(c);return n.runWebGLProgram(u,[r,i],"float32")}const Qse={kernelName:E1,backendName:"webgl",kernelFunc:Yse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jse=Zl+`
  return cos(x);
`,Zse=`
  vec4 result = cos(x);
  bvec4 isNaN = isnan(x);
  ${ka}
  return result;
`,ere=Oe({opSnippet:Jse,packedOpSnippet:Zse}),tre={kernelName:Uu,backendName:"webgl",kernelFunc:ere};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nre=`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`,sre=Oe({opSnippet:nre}),rre={kernelName:Gu,backendName:"webgl",kernelFunc:sre};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ire{constructor(e,n,s,r,i){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];const[o,a,l,c]=e,[u]=n,[d,h]=s;this.outputShape=[u,d,h,c];const p=r==="bilinear"?1:0,[f,g]=[`${a-1}.0`,`${l-1}.0`],[x,y,v]=d>1?[`${(a-1)/(d-1)}`,"(y2-y1) * height_ratio",`y1*${f} + float(y)*(height_scale)`]:["0.0","0.0",`0.5 * (y1+y2) * ${f}`],[b,w,k]=h>1?[`${(l-1)/(h-1)}`,"(x2-x1) * width_ratio",`x1*${g} + float(x)*(width_scale)`]:["0.0","0.0",`0.5 * (x1+x2) * ${g}`];this.userCode=`
      const float height_ratio = float(${x});
      const float width_ratio = float(${b});
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= ${o}) {
          return;
        }

        float height_scale = ${y};
        float width_scale = ${w};

        float in_y = ${v};
        if( in_y < 0.0 || in_y > ${f} ) {
          setOutput(float(${i}));
          return;
        }
        float in_x = ${k};
        if( in_x < 0.0 || in_x > ${g} ) {
          setOutput(float(${i}));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(${p} == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ore=t=>{const{inputs:e,backend:n,attrs:s}=t,{image:r,boxes:i,boxInd:o}=e,{cropSize:a,method:l,extrapolationValue:c}=s,u=new ire(r.shape,i.shape,a,l,c);return n.runWebGLProgram(u,[r,i,o],"float32")},are={kernelName:N1,backendName:"webgl",kernelFunc:ore};var vu;(function(t){t.Prod="*",t.Sum="+"})(vu||(vu={}));class DC{constructor(e,n,s,r){this.op=e,this.outputShape=n,this.variableNames=["x"],this.customUniforms=[{name:"index",type:"float"}];const i=this.outputShape.length,o=this.op===vu.Prod?"1.0":"0.0",a=s?o:`getX(${FC(i,"coords",this.op)})`,l=this.outputShape[this.outputShape.length-1];let c="",u="";s?(c=r?`end != ${l-1}`:"end != 0",u=r?"end + 1":"end - 1"):(c=r?`end + pow2 < ${l}`:"end >= pow2",u=r?"end + pow2":"end - pow2"),this.userCode=`
      void main() {
        ${Ge(i)} coords = getOutputCoords();
        int end = ${OC(i,"coords",this.op)};
        float val = ${a};
        int pow2 = int(pow(2.0, index));
        if (${c}) {
          int idx = ${u};
          ${OC(i,"coords",this.op)} = idx;
          val ${this.op}= getX(${FC(i,"coords",this.op)});
        }
        setOutput(val);
      }
    `}}function FC(t,e,n){if(t===1)return`${e}`;if(t===2)return`${e}.x, ${e}.y`;if(t===3)return`${e}.x, ${e}.y, ${e}.z`;if(t===4)return`${e}.x, ${e}.y, ${e}.z, ${e}.w`;throw new Error(`Cumulative ${n} for rank ${t} is not yet supported`)}function OC(t,e,n){if(t===1)return`${e}`;if(t===2)return`${e}.y`;if(t===3)return`${e}.z`;if(t===4)return`${e}.w`;throw new Error(`Cumulative ${n} for rank ${t} is not yet supported`)}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MD(t,e,n,s,r,i){const o=e.shape.length,a=dt([s],o);let l=e;a!=null&&(l=vn({inputs:{x:e},backend:n,attrs:{perm:a}}));const c=wt(1,o)[0];if(c!==o-1)throw new Error(`WebGL cumprod shader expects an inner-most axis=${e.shape.length-1} but got axis=${s}`);const u=l.shape[c];let d=Gn({inputs:{x:l},backend:n});for(let h=0;h<=Math.ceil(Math.log2(u))-1;h++){const p=new DC(t,l.shape,!1,i),f=[[h]],g=d;d=n.runWebGLProgram(p,[d],d.dtype,f),n.disposeIntermediateTensorInfo(g)}if(r){const h=new DC(t,l.shape,r,i),p=d;d=n.runWebGLProgram(h,[d],d.dtype),n.disposeIntermediateTensorInfo(p)}if(a!=null){const h=oo(a),p=vn({inputs:{x:d},backend:n,attrs:{perm:h}});return n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(l),p}return d}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lre(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:i,exclusive:o,reverse:a}=s;return MD(vu.Prod,r,n,i,o,a)}const cre={kernelName:R1,backendName:"webgl",kernelFunc:lre};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ure(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:i,exclusive:o,reverse:a}=s;return MD(vu.Sum,r,n,i,o,a)}const dre={kernelName:Hf,backendName:"webgl",kernelFunc:ure};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hre(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,weights:i}=e,{size:o,binaryOutput:a}=s;if(r.shape.length===1){const l=n.readSync(r.dataId),c=n.readSync(i.dataId),u=yD(l,c,i.dtype,i.shape,o);return n.makeTensorInfo([o],i.dtype,u)}else if(r.shape.length===2){const l=n.bufferSync(r),c=n.bufferSync(i),u=gee(l,c,o,a);return n.makeTensorInfo(u.shape,i.dtype,u.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${r.shape.length}.`)}const pre={kernelName:A1,backendName:"webgl",kernelFunc:hre};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class fre{constructor(e,n,s){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=n,this.dataFormat=s,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = ${this.getHeightCoordString()};
      int w = ${this.getWidthCoordString()};
      int d = ${this.getDepthCoordString()};

      int in_h = h / ${n};
      int offset_h = imod(h, ${n});
      int in_w = w / ${n};
      int offset_w = imod(w, ${n});
      int offset_d = (offset_h * ${n} + offset_w) *
        ${this.getOutputDepthSize()};
      int in_d = d + offset_d;

      float result = ${this.getInputSamplingString()};
      setOutput(result);
    }
  `}getHeightCoordString(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"}getWidthCoordString(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"}getDepthCoordString(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"}getOutputDepthSize(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]}getInputSamplingString(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mre(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{blockSize:i,dataFormat:o}=s,a=r.shape[0],l=o==="NHWC"?r.shape[1]:r.shape[2],c=o==="NHWC"?r.shape[2]:r.shape[3],u=o==="NHWC"?r.shape[3]:r.shape[1],d=l*i,h=c*i,p=u/(i*i),f=o==="NHWC"?[a,d,h,p]:[a,p,d,h],g=new fre(f,i,o);return n.runWebGLProgram(g,[r],r.dtype)}const gre={kernelName:_1,backendName:"webgl",kernelFunc:mre};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class LD{constructor(e,n=!1,s=null,r=!1,i=!1){this.variableNames=["x","W"],this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=an(this.outputShape.length);const o=e.filterHeight,a=e.filterWidth,l=e.outChannels/e.inChannels;let c="",u="";s&&(r?c=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${s}
        }`:i?c=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${s}
        }`:c=`
          float activation(float x) {
            ${s}
          }
        `,u="result = activation(result);");const d=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${c}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${l};
        int q = d2 - d1 * ${l};

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < ${o}; wR++) {
          int xR = xRCorner + wR * dilations[0];

          if (xR < 0 || xR >= inDims[0]) {
            continue;
          }

          for (int wC = 0; wC < ${a}; wC++) {
            int xC = xCCorner + wC * dilations[1];

            if (xC < 0 || xC >= inDims[1]) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        ${d}
        ${u}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class zD{constructor(e,n=!1,s=null,r=!1,i=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=an(this.outputShape.length);const o=e.outChannels/e.inChannels,a=e.padInfo.left,l=e.strideWidth,c=e.dilationWidth,u=e.filterHeight,d=e.filterWidth,h=d;let p=`
      int xR; int xC; int xCOffset;
      vec4 wTexel; vec4 previous; vec4 final;`;for(let y=0;y<d;y++)p+=`
          vec4 xTexelC${y*2};
          int xTexelC${y*2}Ready;
          vec4 xTexelC${y*2+1};
          int xTexelC${y*2+1}Ready;
          vec4 xC${y};`;p+=`
    for (int r = 0; r < ${u}; r++) {
      `;for(let y=0;y<d;y++)p+=`
          xTexelC${y*2} = vec4(0.0);
          xTexelC${y*2}Ready = 0;
          xTexelC${y*2+1} = vec4(0.0);
          xTexelC${y*2+1}Ready = 0;
          xC${y} = vec4(0.0);`;p+=`
        xR = xRCorner + r * dilations[0];
        if (xR >=0 && xR < inDims[0]) {
      `;for(let y=0;y<(h+1)/2;y++){const v=y*2;if(p+=`
          xC = xCCorner + ${v*c};
          `,l===1){if(v<d&&(a%2===1?(p+=`
                xCOffset = xC + 1;
                if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${v}Ready == 0) {
                  xTexelC${v} = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${v}.zw = vec2(0.0);
                  }
                  xTexelC${v}Ready = 1;
                }
              `,c===1&&v>0?p+=`
                xC${v} = vec4(xTexelC${v-2}.zw, xTexelC${v}.xy);
                `:p+=`
                  xCOffset = xC + 1 - 2;

                  if (xCOffset >= 0 && xCOffset < inDims[1]) {
                    previous = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      previous.zw = vec2(0.0);
                    }

                    xC${v} = vec4(previous.zw, xTexelC${v}.xy);
                  } else {
                    xC${v} = vec4(0.0, 0.0, xTexelC${v}.xy);
                  }
                  `):p+=`
                if (xC >= 0 && xC < inDims[1] && xTexelC${v}Ready == 0) {
                  xTexelC${v} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${v}.zw = vec2(0.0);
                  }
                  xTexelC${v}Ready = 1;
                }

                xC${v} = xTexelC${v};
                `,v+1<d)){const b=a%2===0?h1(c):c;c%2===0&&a%2===1||c%2!==0&&a%2!==1?(p+=`
                  xCOffset = xC + imod(pads[1], 2) + ${b};

                  if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${v+1}Ready == 0) {
                    xTexelC${v+1} = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      xTexelC${v+1}.zw = vec2(0.0);
                    }
                    xTexelC${v+1}Ready = 1;
                  }
                  `,c>1?p+=`
                    xCOffset -= 2;
                    if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);
                     xC${v+1} = vec4(previous.zw, xTexelC${v+1}.xy);
                    } else {
                     xC${v+1} = vec4(0.0, 0.0, xTexelC${v+1}.xy);
                    }
                    `:p+=`
                    xC${v+1} = vec4(xTexelC${v}.zw, xTexelC${v+1}.xy);
                    `):b===1?p+=`
                    xC${v+1} = xTexelC${v};
                    `:p+=`
                    xCOffset = xC + ${b};

                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${v+1}Ready == 0) {
                      xTexelC${v+1} = getX(batch, xR, xCOffset, d1);
                      if (xCOffset + 1 >= inDims[1]) {
                        xTexelC${v+1}.zw = vec2(0.0);
                      }
                      xTexelC${v+1}Ready = 1;
                    }

                    xC${v+1} = xTexelC${v+1};
                    `}}else v<d&&(a%2===1?(p+=`
                xCOffset = xC + 1 - strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${v}Ready == 0) {
                  xTexelC${v} = getX(batch, xR, xCOffset, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${v}.zw = vec2(0.0);
                  }
                  xTexelC${v}Ready = 1;
                }

                if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${v+1}Ready == 0) {
                  xTexelC${v+1} = getX(batch, xR, xC + 1, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xC + 2 >= inDims[1]) {
                    xTexelC${v+1}.zw = vec2(0.0);
                  }
                  xTexelC${v+1}Ready = 1;
                }

                xC${v} = vec4(xTexelC${v}.zw, xTexelC${v+1}.zw);
              `,v+1<d&&(p+=`
                  final = vec4(0.0);
                  xCOffset = xC + 1 + strides[1];
                  if(xCOffset >= 0 && xCOffset < inDims[1]) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xC${v+1} = vec4(xTexelC${v+1}.xy, final.xy);
                `)):(p+=`
                if(xC >= 0 && xC < inDims[1] && xTexelC${v}Ready == 0) {
                  xTexelC${v} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${v}.zw = vec2(0.0);
                  }
                  xTexelC${v}Ready = 1;
                }

                xCOffset = xC + strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${v+1}Ready == 0) {
                  xTexelC${v+1} = getX(batch, xR, xCOffset, d1);
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${v+1}.zw = vec2(0.);
                  }
                  xTexelC${v+1}Ready = 1;
                }

                xC${v} = vec4(
                  xTexelC${v}.xy, xTexelC${v+1}.xy);
              `,v+1<d&&(p+=`
                  xC${v+1} = vec4(xTexelC${v}.zw, xTexelC${v+1}.zw);
                `)));v<d&&(p+=`
            wTexel = getW(r, ${v}, d1, q);
            dotProd += xC${v} * vec4(wTexel.xz, wTexel.xz);
          `,v+1<d&&(p+=`
              wTexel = getW(r, ${v+1}, d1, q);
              dotProd += xC${v+1} * vec4(wTexel.xz, wTexel.xz);
            `))}p+=`
    }
  `,p+=`
      }
    `;let f="",g="";s&&(r?f=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${s}
        }`:i?f=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${s}
        }`:f=`vec4 activation(vec4 x) {
          ${s}
        }`,g="result = activation(result);");const x=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${f}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${o};
        int q = d2 - d1 * ${o};
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
        vec4 dotProd = vec4(0.000000000000001);

        ${p}

        vec4 result = dotProd - vec4(0.000000000000001);
        ${x}
        ${g}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yre(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,filter:i}=e,{strides:o,pad:a,dilations:l,dimRoundingMode:c}=s;let u=l;u==null&&(u=[1,1]),T(rn(o,u),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${o} and dilations '${u}'`);const d=qt(r.shape,i.shape,o,u,a,c,!0);let h;q().getBool("WEBGL_PACK_DEPTHWISECONV")&&d.strideWidth<=2&&d.outChannels/d.inChannels===1?h=new zD(d):h=new LD(d);const p=[[d.padInfo.top,d.padInfo.left],[d.strideHeight,d.strideWidth],[d.dilationHeight,d.dilationWidth],[d.inHeight,d.inWidth]];return n.runWebGLProgram(h,[r,i],"float32",p)}const xre={kernelName:Kf,backendName:"webgl",kernelFunc:yre};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class vre{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const n=e.strideHeight,s=e.strideWidth,r=e.padInfo.top,i=e.padInfo.left,o=e.outChannels/e.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * ${o} + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yR = 0; yR < ${e.outHeight}; yR++) {
            int xR = wR + yR * ${n} - ${r};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${e.outWidth}; yC++) {
              int xC = wC + yC * ${s} - ${i};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class bre{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const n=e.filterHeight,s=e.filterWidth,r=e.strideHeight,i=e.strideWidth,o=n-1-e.padInfo.top,a=s-1-e.padInfo.left,l=e.outChannels/e.inChannels;this.userCode=`
      const ivec2 pads = ivec2(${o}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < ${n}; wR++) {
          float dyR = float(dyRCorner + wR) / ${r}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${n} - 1 - wR;

          for (int wC = 0; wC < ${s}; wC++) {
            float dyC = float(dyCCorner + wC) / ${i}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${s} - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < ${l}; dm++) {
              int d2 = d1 * ${l} + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wre(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,dy:i}=e,{strides:o,dilations:a,pad:l,dimRoundingMode:c,filterShape:u}=s,d=qt(r.shape,u,o,a,l,c,!0),h=new vre(d);return n.runWebGLProgram(h,[r,i],"float32")}const kre={kernelName:D1,backendName:"webgl",kernelFunc:wre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cre(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,filter:i}=e,{strides:o,dilations:a,pad:l,dimRoundingMode:c,inputShape:u}=s,d=qt(u,i.shape,o,a,l,c,!0),h=new bre(d);return n.runWebGLProgram(h,[r,i],"float32")}const Sre={kernelName:F1,backendName:"webgl",kernelFunc:Cre};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ire{constructor(e){this.variableNames=["X"],this.outputShape=[e,e],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $re(t){const{inputs:e,backend:n}=t,{x:s}=e,r=[...s.shape,...s.shape],i=J(s.shape),o=ae({inputs:{x:s},backend:n,attrs:{shape:[i]}}),a=new Ire(i),l=n.runWebGLProgram(a,[o],o.dtype),c=ae({inputs:{x:l},backend:n,attrs:{shape:r}});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(l),c}const Tre={kernelName:IT,backendName:"webgl",kernelFunc:$re};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ere{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const{inHeight:n,inWidth:s,padInfo:r,strideHeight:i,strideWidth:o,filterHeight:a,filterWidth:l,dilationHeight:c,dilationWidth:u}=e,{top:d,left:h}=r;this.userCode=`
      const ivec2 strides = ivec2(${i}, ${o});
      const ivec2 pads = ivec2(${d}, ${h});
      const float neg_infinity = -3.4e38;

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.w;
        ivec2 outTopLeftCorner =
            coords.yz * strides - pads;
        int hBeg = outTopLeftCorner.x;
        int wBeg = outTopLeftCorner.y;

        float curVal = neg_infinity;
        for (int h = 0; h < ${a}; h++) {
          int hIn = hBeg + h * ${c};

          if (hIn >= 0 && hIn < ${n}) {
            for (int w = 0; w < ${l}; w++) {
              int wIn = wBeg + w * ${u};

              if (wIn >= 0 && wIn < ${s}) {
                float xVal = getX(batch, hIn, wIn, d1);
                float wVal = getW(h, w, d1);

                float val = xVal + wVal;
                if (val > curVal) {
                  curVal = val;
                }
              }
            }
          }
        }

        float result = curVal;
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rre(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,filter:i}=e,{strides:o,pad:a,dilations:l}=s,c=Ad(r.shape,i.shape,o,a,"NHWC",l);let u;const d=new Ere(c);u=n.runWebGLProgram(d,[r,i],"float32");const h=ae({inputs:{x:u},backend:n,attrs:{shape:c.outShape}});return n.disposeIntermediateTensorInfo(u),h}const Nre={kernelName:qf,backendName:"webgl",kernelFunc:Rre};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Are(t){const{inputs:e,backend:n,attrs:s}=t,{equation:r}=s,i=e,{allDims:o,summedDims:a,idDims:l}=cb(r,i.length);db(o.length,l,i);const{path:c,steps:u}=hb(a,l),d=u.length;let h=null,p=o.length;const f=[];for(let g=0;g<d;++g){for(const x of u[g]){const{permutationIndices:y,expandDims:v}=ub(p,l[x]);let b;pb(y)?b=i[x]:(b=vn({inputs:{x:i[x]},backend:n,attrs:{perm:y}}),f.push(b));const w=b.shape.slice();for(let k=0;k<v.length;++k)w.splice(v[k],0,1);je(b.shape,w)||(b=ae({inputs:{x:b},backend:n,attrs:{shape:w}}),f.push(b)),h===null?h=b:(h=ow({inputs:{a:b,b:h},backend:n}),f.push(h))}g<d-1&&(c[g]>=0&&(h=og({inputs:{x:h},backend:n,attrs:{axis:c[g]-(o.length-p),keepDims:!1}}),f.push(h)),p--)}for(const g of f)g!==h&&n.disposeIntermediateTensorInfo(g);return h}const _re={kernelName:O1,backendName:"webgl",kernelFunc:Are};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Dre="return (x >= 0.0) ? x : (exp(x) - 1.0);",Fre=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,Ore=Oe({opSnippet:Dre,packedOpSnippet:Fre}),Pre={kernelName:Ku,backendName:"webgl",kernelFunc:Ore};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mre="return (b >= 0.0) ? a : a * (b + 1.0);",Lre=`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,zre=t=>{const{inputs:e,backend:n}=t,{dy:s,y:r}=e,i=q().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Jl(Lre,s.shape,r.shape):new oa(Mre,s.shape,r.shape);return n.runWebGLProgram(i,[s,r],s.dtype)},jre={kernelName:P1,backendName:"webgl",kernelFunc:zre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bre=`
  return vec4(equal(a, b));
`,Wre="return float(a == b);",Vre=Yt({opSnippet:Wre,packedOpSnippet:Bre,dtype:"bool",cpuKernelImpl:wee}),Ure={kernelName:Xf,backendName:"webgl",kernelFunc:Vre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gre=`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = ${nb};
  float a1 = ${sb};
  float a2 = ${rb};
  float a3 = ${ib};
  float a4 = ${ob};
  float a5 = ${ab};

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`,Hre=Oe({opSnippet:Gre}),Kre={kernelName:qu,backendName:"webgl",kernelFunc:Hre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qre=Zl+`
  return exp(x);
`,Xre=`
  vec4 result = exp(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,jD=Oe({opSnippet:qre,packedOpSnippet:Xre,cpuKernelImpl:kee,dtype:"float32"}),Yre={kernelName:Xu,backendName:"webgl",kernelFunc:jD};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Z0(t){const{inputs:e,attrs:n,backend:s}=t,{dim:r}=n,{input:i}=e,o=i.shape.length,a=i.shape.slice();let l=r;return r<0&&(T(-(o+1)<=r,()=>`Axis must be in the interval [${-(o+1)}, ${o}]`),l=o+r+1),a.splice(l,0,1),ae({inputs:{x:i},backend:s,attrs:{shape:a}})}const Qre={kernelName:Yf,backendName:"webgl",kernelFunc:Z0};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PC="return exp(x) - 1.0;",Jre=Oe({opSnippet:PC,packedOpSnippet:PC,cpuKernelImpl:Cee}),Zre={kernelName:Yu,backendName:"webgl",kernelFunc:Jre};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class MC{constructor(e,n,s){this.variableNames=["real","imag"];const r=n[1];this.outputShape=n;const i=s?`2.0 * ${Math.PI}`:`-2.0 * ${Math.PI}`,o=s?`${r}.0`:"1.0";let a;if(e==="real")a="return real * expR - imag * expI;";else if(e==="imag")a="return real * expI + imag * expR;";else throw new Error(`FFT component must be either "real" or "imag", got ${e}.`);this.userCode=`
      const float exponentMultiplier = ${i};

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        ${a}
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(${r});
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < ${r}; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / ${o};
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BD(t,e,n){const s=n.texData.get(t.dataId),r=J(t.shape),i=t.shape[t.shape.length-1],o=r/i,a=ae({inputs:{x:t},backend:n,attrs:{shape:[o,i]}}),l=a.shape,c=new MC("real",l,e),u=new MC("imag",l,e),d=[{dataId:s.complexTensorInfos.real.dataId,dtype:s.complexTensorInfos.real.dtype,shape:l},{dataId:s.complexTensorInfos.imag.dataId,dtype:s.complexTensorInfos.imag.dtype,shape:l}],h=n.runWebGLProgram(c,d,"float32"),p=n.runWebGLProgram(u,d,"float32"),f=po({inputs:{real:h,imag:p},backend:n});n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(p);const g=ae({inputs:{x:f},backend:n,attrs:{shape:t.shape}});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(f),g}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eie(t){const{inputs:e,backend:n}=t,{input:s}=e;return BD(s,!1,n)}const tie={kernelName:M1,backendName:"webgl",kernelFunc:eie};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class nie{constructor(e,n){this.outputShape=[],this.customUniforms=[{name:"value",type:"float"}],this.variableNames=["x"],this.outputShape=e,this.userCode=`
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jd(t){const{backend:e,attrs:n}=t,{shape:s,value:r}=n;let{dtype:i}=n;if(i=i||Pl(r),i==="string"){const o=xt(i,J(s));return o.fill(r),e.makeTensorInfo(s,i,o)}else{const o=new nie(s,r),a=[[r]];return e.runWebGLProgram(o,[],i,a)}}const sie={kernelName:L1,backendName:"webgl",kernelFunc:Jd};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class rie{constructor(e){this.variableNames=["Image"],this.outputShape=[];const n=e[2];this.outputShape=e,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];

          int coordX = ${n} - x - 1;
          float outputValue;
          if(coordX >= 0 && coordX < ${n}) {
            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);
          } else {
            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);
          }
          setOutput(outputValue);
        }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iie={kernelName:z1,backendName:"webgl",kernelFunc:({inputs:t,backend:e})=>{const{image:n}=t,s=e,r=new rie(n.shape);return s.runWebGLProgram(r,[n],n.dtype)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LC="return floor(x);",oie=Oe({opSnippet:LC,packedOpSnippet:LC,cpuKernelImpl:See}),aie={kernelName:Qu,backendName:"webgl",kernelFunc:oie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lie=`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,cie=`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,uie=Yt({opSnippet:lie,packedOpSnippet:cie,dtype:"int32"}),die={kernelName:Ju,backendName:"webgl",kernelFunc:uie};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class hie{constructor(e){this.variableNames=["A"];const n=bn(),[s,r]=e;this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${r}.0, ${s}.0);

        vec4 values = ${n.texture2D}(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class pie{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;const n=bn(),[s,r]=e;this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(${r}.0, ${s}.0);
            vec4 values = ${n.texture2D}(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        ${n.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fie={kernelName:b0,backendName:"webgl",kernelFunc:mie};let $a,ay=q().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");function mie(t){const{inputs:e,backend:n,attrs:s}=t;let{pixels:r}=e;const{numChannels:i}=s,o=typeof HTMLVideoElement<"u"&&r instanceof HTMLVideoElement,a=typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement,[l,c]=o?[r.videoWidth,r.videoHeight]:[r.width,r.height],u=[c,l],d=[c,l,i];if(a||o){const g=q().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");($a==null||g!==ay)&&(ay=g,$a=document.createElement("canvas").getContext("2d",{willReadFrequently:ay})),$a.canvas.width=l,$a.canvas.height=c,$a.drawImage(r,0,0,l,c),r=$a.canvas}const h=n.makeTensorInfo(u,"int32");n.texData.get(h.dataId).usage=Qn.PIXELS,n.gpgpu.uploadPixelDataToTexture(n.getTexture(h.dataId),r);const p=q().getBool("WEBGL_PACK")?new pie(d):new hie(d),f=n.runWebGLProgram(p,[h],"int32");return n.disposeData(h.dataId),f}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gie(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,filter:i,bias:o,preluActivationWeights:a}=e,{strides:l,pad:c,dataFormat:u,dilations:d,dimRoundingMode:h,activation:p,leakyreluAlpha:f}=s,g=ii(u),x=qt(r.shape,i.shape,l,d,c,h,!1,g);let y;const v=[],b=o!=null,w=a!=null,k=p==="leakyrelu",S=()=>{const C=[r,i],$=(R,_)=>{if(_==="NCHW"&&R.shape.length===1&&R.shape[0]!==1){const M=ae({inputs:{x:R},backend:n,attrs:{shape:[R.shape[0],1,1]}});return v.push(M),M}return R};if(b&&C.push($(o,u)),w&&C.push($(a,u)),k){const R=n.makeTensorInfo([],"float32",ro(f,"float32"));C.push(R),v.push(R)}return C};if(x.filterHeight===1&&x.filterWidth===1&&x.dilationHeight===1&&x.dilationWidth===1&&x.strideHeight===1&&x.strideWidth===1&&(x.padInfo.type==="SAME"||x.padInfo.type==="VALID"))y=OD({x:r,filter:i,convInfo:x,backend:n,bias:o,activation:p,preluActivationWeights:a,leakyreluAlpha:f});else if(x.strideWidth<=2&&g==="channelsLast"&&q().getBool("WEBGL_EXP_CONV")){const C=p?yu(p,!0):null,$=new FD(x,b,C,w,k),R=[[x.padInfo.top,x.padInfo.left],[x.strideHeight,x.strideWidth],[x.dilationHeight,x.dilationWidth],[x.inHeight,x.inWidth]],_=S();y=n.runWebGLProgram($,_,"float32",R)}else if(q().getBool("WEBGL_CONV_IM2COL"))y=PD({x:r,filter:i,convInfo:x,backend:n,bias:o,activation:p,preluActivationWeights:a,leakyreluAlpha:f});else{const C=p?yu(p,!1):null,$=new DD(x,b,C,w,k),R=S();y=n.runWebGLProgram($,R,"float32")}const I=ae({inputs:{x:y},backend:n,attrs:{shape:x.outShape}});return v.push(y),v.forEach(C=>n.disposeIntermediateTensorInfo(C)),I}const yie={kernelName:Fp,backendName:"webgl",kernelFunc:gie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xie(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,filter:i,bias:o,preluActivationWeights:a}=e,{strides:l,pad:c,dilations:u,dimRoundingMode:d,activation:h,leakyreluAlpha:p}=s,f=[];let g=u;g==null&&(g=[1,1]),T(rn(l,g),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${l} and dilations '${g}'`);const x=qt(r.shape,i.shape,l,g,c,d,!0),y=q().getBool("WEBGL_PACK_DEPTHWISECONV")&&x.strideWidth<=2&&x.outChannels/x.inChannels===1,v=h?yu(h,y):null,b=[r,i],w=o!=null,k=a!=null,S=h==="leakyrelu";if(w&&b.push(o),k&&b.push(a),S){const R=n.makeTensorInfo([],"float32",ro(p,"float32"));b.push(R),f.push(R)}let I;y?I=new zD(x,w,v,k,S):I=new LD(x,w,v,k,S);const C=[[x.padInfo.top,x.padInfo.left],[x.strideHeight,x.strideWidth],[x.dilationHeight,x.dilationWidth],[x.inHeight,x.inWidth]],$=n.runWebGLProgram(I,b,"float32",C);return f.forEach(R=>n.disposeIntermediateTensorInfo(R)),$}const vie={kernelName:UT,backendName:"webgl",kernelFunc:xie};class bie{constructor(e,n,s,r){this.sliceDim=e,this.strides=n,this.paramsShape=r,this.variableNames=["x","indices"],this.outputShape=s;const i=Ge(s.length);let o=`
    int index;`;for(let a=0;a<this.sliceDim;a++)o+=`
          index = round(getIndices(coords[0], ${a}));
          out_of_bounds = out_of_bounds || index < 0;
          out_of_bounds = out_of_bounds || index >= ${this.paramsShape[a]};
          flattenIndex += index * ${this.strides[a]};`;this.userCode=`
         void main() {
          ${i} coords = getOutputCoords();
          int flattenIndex = 0;
          bool out_of_bounds = false;

          ${o}

          setOutput(out_of_bounds ? 0.0 : getX(flattenIndex, coords[1]));
        }
      `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wie(t){const{inputs:e,backend:n}=t,{params:s,indices:r}=e,i=r.shape,o=i[i.length-1],a=J(s.shape),[l,c,u,d]=Gv(s,r),h=ae({inputs:{x:r},backend:n,attrs:{shape:[c,o]}}),p=ae({inputs:{x:s},backend:n,attrs:{shape:[J(s.shape)/u,u]}});if(n.shouldExecuteOnCPU([s,r])||s.dtype==="string"){const y=n.readSync(r.dataId),v=n.bufferSync(s),b=Iee(y,v,s.dtype,c,o,u,d,s.shape,a);return n.makeTensorInfo(l,s.dtype,b.values)}const f=new bie(o,d,[c,u],s.shape),g=n.runWebGLProgram(f,[p,h],p.dtype),x=ae({inputs:{x:g},backend:n,attrs:{shape:l}});return n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(g),x}const kie={kernelName:$T,backendName:"webgl",kernelFunc:wie};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Cie{constructor(e,n){this.variableNames=["A","indices"],this.outputShape=n,this.rank=n.length;const s=Ge(this.rank),r=Sie(e);this.userCode=`
      void main() {
        ${s} resRC = getOutputCoords();
        int index = int(getIndices(resRC.x, resRC.z));
        float inBounds = (index >= 0) && (index < ${e[2]}) ? 1.0 : 0.0;
        setOutput(inBounds * getA(${r}));
      }
    `}}function Sie(t,e){const n=["resRC.x","resRC.y","resRC.z","resRC.w"],s=[];for(let r=0;r<t.length;r++)r===2?s.push("index"):s.push(`${n[r]}`);return s.join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WD(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,indices:i}=e,{axis:o,batchDims:a}=s,l=Te(o,r.shape)[0];if(q().get("DEBUG")){const v=n.readSync(i.dataId),b=r.shape[l];for(let w=0;w<v.length;++w){const k=v[w];T(k<=b-1&&k>=0,()=>`GatherV2: the index value ${k} is not in [0, ${b-1}]`)}}const c=mb(r,i,l,a),u=J(i.shape),d=[],h=ae({inputs:{x:r},backend:n,attrs:{shape:[c.batchSize,c.outerSize,c.dimSize,c.sliceSize]}}),p=ae({inputs:{x:i},backend:n,attrs:{shape:[c.batchSize,u/c.batchSize]}});d.push(h),d.push(p);const f=[c.batchSize,c.outerSize,u/c.batchSize,c.sliceSize];if(n.shouldExecuteOnCPU([r,i])||r.dtype==="string"){const v=n.bufferSync(p),b=n.bufferSync(h),w=$ee(b,v,f);return d.forEach(k=>n.disposeIntermediateTensorInfo(k)),n.makeTensorInfo(c.outputShape,w.dtype,w.values)}const g=new Cie(h.shape,f),x=n.runWebGLProgram(g,[h,p],h.dtype);d.push(x);const y=ae({inputs:{x},backend:n,attrs:{shape:c.outputShape}});return d.forEach(v=>n.disposeIntermediateTensorInfo(v)),y}const Iie={kernelName:Jf,backendName:"webgl",kernelFunc:WD};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $ie="return float(a > b);",Tie=`
  return vec4(greaterThan(a, b));
`,Eie=Yt({opSnippet:$ie,packedOpSnippet:Tie,cpuKernelImpl:Tee,dtype:"bool"}),Rie={kernelName:Zf,backendName:"webgl",kernelFunc:Eie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Nie="return float(a >= b);",Aie=`
  return vec4(greaterThanEqual(a, b));
`,_ie=Yt({opSnippet:Nie,packedOpSnippet:Aie,dtype:"bool",cpuKernelImpl:Eee}),Die={kernelName:Zu,backendName:"webgl",kernelFunc:_ie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fie(t){const{inputs:e,backend:n}=t,{input:s}=e;return BD(s,!0,n)}const Oie={kernelName:j1,backendName:"webgl",kernelFunc:Fie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pie="return float(!isnan(x) && !isinf(x));",Mie=Oe({opSnippet:Pie,dtype:"bool"}),Lie={kernelName:td,backendName:"webgl",kernelFunc:Mie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zie="return float(isinf(x));",jie=Oe({opSnippet:zie,dtype:"bool"}),Bie={kernelName:nd,backendName:"webgl",kernelFunc:jie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wie="return float(isnan(x));",Vie=Oe({opSnippet:Wie,dtype:"bool"}),Uie={kernelName:sd,backendName:"webgl",kernelFunc:Vie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gie="return float(a < b);",Hie=`
  return vec4(lessThan(a, b));
`,Kie=Yt({opSnippet:Gie,packedOpSnippet:Hie,cpuKernelImpl:Ree,dtype:"bool"}),qie={kernelName:tm,backendName:"webgl",kernelFunc:Kie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xie="return float(a <= b);",Yie=`
  return vec4(lessThanEqual(a, b));
`,Qie=Yt({opSnippet:Xie,packedOpSnippet:Yie,cpuKernelImpl:Nee,dtype:"bool"}),Jie={kernelName:nm,backendName:"webgl",kernelFunc:Qie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zie(t){const{backend:e,attrs:n}=t,{start:s,stop:r,num:i}=n,o=Aee(s,r,i);return e.makeTensorInfo([o.length],"float32",o)}const eoe={kernelName:TT,backendName:"webgl",kernelFunc:Zie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const toe=Zl+`
  return x < 0.0 ? 0./0. : log(x);
`,noe=`
  vec4 result = log(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : (x.r < 0.0 ? 0./0. : result.r);
  result.g = isNaN.g ? x.g : (x.g < 0.0 ? 0./0. : result.g);
  result.b = isNaN.b ? x.b : (x.b < 0.0 ? 0./0. : result.b);
  result.a = isNaN.a ? x.a : (x.a < 0.0 ? 0./0. : result.a);
  return result;
`,soe=Oe({opSnippet:toe,packedOpSnippet:noe,cpuKernelImpl:_ee}),roe={kernelName:rd,backendName:"webgl",kernelFunc:soe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ioe=Zl+`
  return log(1.0 + x);
`,ooe=Oe({opSnippet:ioe}),aoe={kernelName:id,backendName:"webgl",kernelFunc:ooe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const loe="return float(a >= 1.0 && b >= 1.0);",coe=`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,uoe=Yt({opSnippet:loe,packedOpSnippet:coe,dtype:"bool"}),doe={kernelName:sm,backendName:"webgl",kernelFunc:uoe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hoe="return float(!(x >= 1.0));",poe=Oe({opSnippet:hoe}),foe={kernelName:rm,backendName:"webgl",kernelFunc:poe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const moe="return float(a >= 1.0 || b >= 1.0);",goe=`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,yoe=Yt({opSnippet:moe,packedOpSnippet:goe,dtype:"bool"}),xoe={kernelName:im,backendName:"webgl",kernelFunc:yoe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class voe{constructor(e,n,s,r,i){this.variableNames=["x"],this.outputShape=[];const o=n,a=e[3]-1;this.outputShape=e;let l;const c=`float(${s}) + float(${r}) * sum`;i===.5?l=`inversesqrt(${c})`:i===1?l=`1.0/(${c})`:l=`exp(log(${c}) * float(-${i}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -${o}; j <= ${o}; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  ${a}) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * ${l};
        setOutput(val);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class boe{constructor(e,n,s,r,i){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;const o=n,a=e[3]-1;this.outputShape=e;let l;const c=`float(${s}) + float(${r}) * sum`;i===.5?l=`inversesqrt(${c})`:i===1?l=`1.0/(${c})`:l=`exp(log(${c}) * float(-${i}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < ${this.outputShape[3]};
        bool hasNextRow = c < ${this.outputShape[2]};

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - ${o};
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - ${o}; j <= ${o}; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(${a}));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * ${l};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const woe=t=>{const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{depthRadius:i,bias:o,alpha:a,beta:l}=s,c=q().getBool("WEBGL_PACK_NORMALIZATION")?new boe(r.shape,i,o,a,l):new voe(r.shape,i,o,a,l);return n.runWebGLProgram(c,[r],r.dtype)},koe={kernelName:om,backendName:"webgl",kernelFunc:woe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Coe{constructor(e,n,s,r,i){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=e,this.depth=e[3],this.depthRadius=n,this.bias=s,this.alpha=r,this.beta=i,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < ${this.depth}; ++d) {
          int depthBegin = int(max(0.0, float(d - ${n})));
          int depthEnd = int(min(float(${this.depth}),
              float(d + ${n} + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = ${this.depth};

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(${r}) * norm + float(${s});

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(${r})
                * float(${i})
                * getInputImage(b, r, c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * ${i});
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Soe=t=>{const{inputs:e,backend:n,attrs:s}=t,{x:r,y:i,dy:o}=e,{depthRadius:a,bias:l,alpha:c,beta:u}=s,d=new Coe(r.shape,a,l,c,u);return n.runWebGLProgram(d,[r,i,o],r.dtype)},Ioe={kernelName:W1,backendName:"webgl",kernelFunc:Soe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $oe(t,e,n,s){const r=J(e),o=J(t.shape)/r,a=ae({inputs:{x:t},attrs:{shape:[o,r]},backend:s}),l=Ca(a,t.dtype,"max",s),c=ae({inputs:{x:l},attrs:{shape:n},backend:s});return s.disposeIntermediateTensorInfo(a),s.disposeIntermediateTensorInfo(l),c}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VD(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{reductionIndices:i,keepDims:o}=s,a=r.shape.length,l=Te(i,r.shape);let c=l;const u=dt(c,a),d=u!=null,h=n.shouldExecuteOnCPU([r]);let p=r;if(d){if(h){const b=n.texData.get(p.dataId).values,w=new Array(a);for(let I=0;I<w.length;I++)w[I]=r.shape[u[I]];const k=rw(b,r.shape,r.dtype,u,w);p=n.makeTensorInfo(w,r.dtype);const S=n.texData.get(p.dataId);S.values=k}else p=ig(r,u,n);c=wt(c.length,a)}Xt("max",c,a);const[f,g]=Wt(p.shape,c);let x=f;o&&(x=Tt(f,l));let y;if(h){const b=n.texData.get(p.dataId).values,w=Dee(b,J(g),x,r.dtype);y=n.makeTensorInfo(x,r.dtype);const k=n.texData.get(y.dataId);k.values=w}else y=$oe(p,g,x,n);return d&&n.disposeIntermediateTensorInfo(p),y}const Toe={kernelName:am,backendName:"webgl",kernelFunc:VD};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Eoe=iw+`
  return max(a, b);
`,Roe=`
  vec4 result = vec4(max(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+ka+`
  return result;
`,Noe=Yt({opSnippet:Eoe,packedOpSnippet:Roe,cpuKernelImpl:Fee}),Aoe={kernelName:od,backendName:"webgl",kernelFunc:Noe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _oe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e;Xd(r,"maxPool");const{filterSize:i,strides:o,pad:a,dimRoundingMode:l}=s,c=1;T(rn(o,c),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${c}'`);const u=Ts(r.shape,i,o,c,a,l);if(u.filterWidth===1&&u.filterHeight===1&&je(u.inShape,u.outShape))return Gn({inputs:{x:r},backend:n});const d=new xu(u,"max",!1);return n.runWebGLProgram(d,[r],r.dtype)}const Doe={kernelName:lm,backendName:"webgl",kernelFunc:_oe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Foe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{filterSize:i,strides:o,pad:a,dataFormat:l,dimRoundingMode:c}=s,u=[1,1,1],d=ri(r.shape,i,o,u,a,c,l),h=new aw(d,"max",!1);return n.runWebGLProgram(h,[r],r.dtype)}const Ooe={kernelName:cm,backendName:"webgl",kernelFunc:Foe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Poe{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const n=e.strideHeight,s=e.strideWidth,r=e.dilationHeight,i=e.effectiveFilterHeight,o=e.effectiveFilterWidth,a=i-1-e.padInfo.top,l=o-1-e.padInfo.left,c=i*o-1;this.userCode=`
      const ivec2 pads = ivec2(${a}, ${l});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${i};
          wR += ${r}) {
          float dyR = float(dyRCorner + wR) / ${n}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${o}; wC++) {
            float dyC = float(dyCCorner + wC) / ${s}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = ${c} - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * ${o} + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `}}class Moe{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const n=e.strideDepth,s=e.strideHeight,r=e.strideWidth,i=e.dilationDepth,o=e.dilationHeight,a=e.dilationWidth,l=e.effectiveFilterDepth,c=e.effectiveFilterHeight,u=e.effectiveFilterWidth,d=l-1-e.padInfo.front,h=c-1-e.padInfo.top,p=u-1-e.padInfo.left,f=l*c*u-1;this.userCode=`
      const ivec3 pads = ivec3(${d}, ${h}, ${p});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${l};
           wD += ${i}) {
          float dyD = float(dyDCorner + wD) / ${n}.0;

          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${c};
              wR += ${o}) {
            float dyR = float(dyRCorner + wR) / ${s}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${u};
                wC += ${a}) {
              float dyC = float(dyCCorner + wC) / ${r}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = ${f} -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * ${c} * ${u} +
                  wR * ${u} + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Loe(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,input:i}=e,o=i,{filterSize:a,strides:l,pad:c,dimRoundingMode:u}=s,d=[1,1,1],h=ri(o.shape,a,l,d,c,u),p=new aw(h,"max",!0),f=n.runWebGLProgram(p,[o],o.dtype),g=new Moe(h),x=n.runWebGLProgram(g,[r,f],o.dtype);return n.disposeIntermediateTensorInfo(f),x}const zoe={kernelName:U1,backendName:"webgl",kernelFunc:Loe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function joe(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,input:i,output:o}=e,a=i;Xd([i,o],"maxPoolGrad");const{filterSize:l,strides:c,pad:u,dimRoundingMode:d}=s,h=Ts(a.shape,l,c,1,u,d),p=!0,f=new xu(h,"max",p),g=n.runWebGLProgram(f,[a],a.dtype),x=new Poe(h),y=n.runWebGLProgram(x,[r,g],a.dtype);return n.disposeIntermediateTensorInfo(g),y}const Boe={kernelName:V1,backendName:"webgl",kernelFunc:joe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Woe(t,e,n,s){let r=new xu(n,"max",!1);const i=s.runWebGLProgram(r,[t],"float32");r=new xu(n,"max",!0,!0,e);const o=s.runWebGLProgram(r,[t],"float32");return[i,o]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Voe={kernelName:ET,backendName:"webgl",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{x:s}=t,{filterSize:r,strides:i,pad:o,includeBatchInIndex:a}=e,l=n;T(s.shape.length===4,()=>`Error in maxPool: input must be rank 4 but got rank ${s.shape.length}.`);const c=[1,1];T(rn(i,c),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${c}'`);const u=Ts(s.shape,r,i,c,o),[d,h]=Woe(s,a,u,l);return[d,h]}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Uoe(t,e,n,s){const r=J(e),o=J(t.shape)/r,a=ae({inputs:{x:t},attrs:{shape:[o,r]},backend:s}),l=Ca(a,"float32","mean",s),c=ae({inputs:{x:l},attrs:{shape:n},backend:s});return s.disposeIntermediateTensorInfo(a),s.disposeIntermediateTensorInfo(l),c}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Goe={kernelName:um,backendName:"webgl",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{x:s}=t,{keepDims:r,axis:i}=e,o=n,a=s.shape.length,l=Te(i,s.shape);let c=l;const u=dt(c,a),d=u!=null,h=o.shouldExecuteOnCPU([s]),p=[];let f=s;if(d){if(h){const w=o.texData.get(f.dataId).values,k=new Array(a);for(let C=0;C<k.length;C++)k[C]=s.shape[u[C]];const S=rw(w,s.shape,s.dtype,u,k);f=o.makeTensorInfo(k,s.dtype);const I=o.texData.get(f.dataId);I.values=S}else f=ig(s,u,o);p.push(f),c=wt(c.length,a)}Xt("sum",c,a);const[g,x]=Wt(f.shape,c);let y=g;r&&(y=Tt(g,l));const v=Uoe(f,x,y,o);for(const b of p)o.disposeIntermediateTensorInfo(b);return v}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hoe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:i,keepDims:o}=s,a=r.shape.length,l=Te(i,r.shape);let c=l;const u=dt(c,a);let d=r;u!=null&&(d=vn({inputs:{x:r},backend:n,attrs:{perm:u}}),c=wt(c.length,r.shape.length)),Xt("min",c,a);const[h,p]=Wt(d.shape,c),f=J(p),g=ae({inputs:{x:d},backend:n,attrs:{shape:[-1,f]}}),x=Ca(g,g.dtype,"min",n);let y;if(o){const v=Tt(h,l);y=ae({inputs:{x},backend:n,attrs:{shape:v}})}else y=ae({inputs:{x},backend:n,attrs:{shape:h}});return n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(x),u!=null&&n.disposeIntermediateTensorInfo(d),y}const Koe={kernelName:dm,backendName:"webgl",kernelFunc:Hoe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qoe=iw+`
  return min(a, b);
`,Xoe=`
  vec4 result = vec4(min(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+ka+`
  return result;
`,Yoe=Yt({opSnippet:qoe,packedOpSnippet:Xoe,cpuKernelImpl:Oee}),Qoe={kernelName:ad,backendName:"webgl",kernelFunc:Yoe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Joe{constructor(e,n,s){this.variableNames=["x"],this.outputShape=n.map((u,d)=>u[0]+e[d]+u[1]);const r=e.length,i=Ge(r),o=n.map(u=>u[0]).join(","),a=n.map((u,d)=>u[0]+e[d]).join(","),l=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r),c=s==="reflect"?0:1;if(r===1){this.userCode=`
        int start = ${o};
        int end = ${a};

        void main() {
          int outC = getOutputCoords();
          if (outC < start) {
            outC = start * 2 - outC - ${c};
          } else if(outC >= end) {
            outC = (end - 1) * 2 - outC + ${c};
          }
          setOutput(getX(outC - start));
        }
      `;return}this.userCode=`
      ${i} start = ${i}(${o});
      ${i} end = ${i}(${a});

      void main() {
        ${i} outC = getOutputCoords();
        for (int i = 0; i < ${r}; i++) {
          if (outC[i] < start[i]) {
            outC[i] = start[i] * 2 - outC[i] - ${c};
          } else if(outC[i] >= end[i]) {
            outC[i] = (end[i] - 1) * 2 - outC[i] + ${c};
          }
        }
        ${i} coords = outC - start;
        setOutput(getX(${l}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Zoe{constructor(e,n,s){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n.map((f,g)=>f[0]+e[g]+f[1]);const r=e.length,i=Ge(r),o=n.map(f=>f[0]).join(","),a=n.map((f,g)=>f[0]+e[g]).join(","),l=mn("rc",r),c=mn("source",r),u=`${l[r-1]} < ${this.outputShape[r-1]}`,d=r===1?"source":`vec2(${c.slice(-2).join()})`,h=s==="reflect"?0:1;let p="";if(r===1){const f=`
        ${i} source = rc;
        if (source < start) {
          source = start * 2 - source - ${h};
        } else if (source >= end) {
          source = (end - 1) * 2 - source + ${h};
        }
        source -= start;
      `;p=`
        ${i} rc = outputLoc;
        ${f}
        result[0] = getChannel(getX(${c.join()}), ${d});
        ${l[r-1]} += 1;
        if(${u}) {
          ${f}
          result[1] = getChannel(getX(${c.join()}), ${d});
        }
      `}else{const f=`
        ${i} source = rc;
        ${i} lt = ${i}(lessThan(source, start));
        ${i} gte = ${i}(greaterThanEqual(source, end));
        ${i} orig = 1 - (lt + gte);
        source = orig * source +
                lt * (start * 2 - source - ${h}) +
                gte * ((end - 1) * 2 - source + ${h});
        source -= start;
      `;p=`
        ${i} rc = outputLoc;
        ${f}
        result[0] = getChannel(getX(${c.join()}), ${d});
        ${l[r-1]} += 1;
        if(${u}) {
          ${f}
          result[1] = getChannel(getX(${c.join()}), ${d});
        }
        rc = outputLoc;
        ${l[r-2]} += 1;
        if(${l[r-2]} < ${this.outputShape[r-2]}) {
          ${f}
          result[2] = getChannel(getX(${c.join()}), ${d});
          ${l[r-1]} += 1;
          if(${u}) {
            ${f}
            result[3] = getChannel(getX(${c.join()}), ${d});
          }
        }
      `}this.userCode=`
      const ${i} start = ${i}(${o});
      const ${i} end = ${i}(${a});

      void main() {
        ${i} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${p}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eae=({inputs:t,backend:e,attrs:n})=>{const{x:s}=t,{paddings:r,mode:i}=n,o=q().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Zoe(s.shape,r,i):new Joe(s.shape,r,i);return e.runWebGLProgram(o,[s],s.dtype)},tae={kernelName:hm,backendName:"webgl",kernelFunc:eae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nae=`if (b == 0.0) return NAN;
  return mod(a, b);`,sae=`
  vec4 result = mod(a, b);
  bvec4 isNaN = equal(b, vec4(0.0));
  `+ka+`
  return result;
`,rae=Yt({opSnippet:nae,packedOpSnippet:sae}),iae={kernelName:ld,backendName:"webgl",kernelFunc:rae};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class oae{constructor(e,n,s){this.variableNames=["probs"],this.customUniforms=[{name:"seed",type:"float"}],this.outputShape=[e,s],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < ${n-1}; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(${n-1}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aae=`
if (a == b) {
  return 1.0;
};
return a / b;`,lae=`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,UD=Yt({opSnippet:aae,packedOpSnippet:lae,checkOutOfBounds:!0}),cae={kernelName:Hu,backendName:"webgl",kernelFunc:UD};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zC="return a - b;",GD=Yt({opSnippet:zC,packedOpSnippet:zC,supportsComplex:!0,cpuKernelImpl:nte}),uae={kernelName:Sd,backendName:"webgl",kernelFunc:GD};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HD(t){const{inputs:e,backend:n,attrs:s}=t,{logits:r}=e,{dim:i}=s,o=Te([i],r.shape),a=VD({inputs:{x:r},backend:n,attrs:{reductionIndices:o,keepDims:!1}}),l=Tt(a.shape,o),c=ae({inputs:{x:a},backend:n,attrs:{shape:l}}),u=GD({inputs:{a:r,b:c},backend:n}),d=jD({inputs:{x:u},backend:n}),h=og({inputs:{x:d},backend:n,attrs:{axis:o,keepDims:!1}}),p=ae({inputs:{x:h},backend:n,attrs:{shape:l}}),f=UD({inputs:{a:d,b:p},backend:n});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(p),f}const dae={kernelName:Nm,backendName:"webgl",kernelFunc:HD};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hae(t){const{inputs:e,backend:n,attrs:s}=t,{logits:r}=e,{numSamples:i,seed:o,normalized:a}=s,l=a?r:HD({inputs:{logits:r},backend:n,attrs:{dim:r.shape.length-1}}),c=l.shape[0],u=l.shape[1],d=new oae(c,u,i),h=[[o]],p=n.runWebGLProgram(d,[l],"int32",h);return a||n.disposeIntermediateTensorInfo(l),p}const pae={kernelName:RT,backendName:"webgl",kernelFunc:hae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fae=Rs+`
  return -x;
`,mae=`
  vec4 result = -x;
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`;function gae(t){const{inputs:e,backend:n}=t,{x:s}=e;if(n.shouldExecuteOnCPU([s])){const i=n.texData.get(s.dataId),[o,a]=Mee(i.values,s.shape,s.dtype);return n.makeTensorInfo(a,s.dtype,o)}let r;return q().getBool("WEBGL_PACK_UNARY_OPERATIONS")?r=new Ti(s.shape,mae):r=new dr(s.shape,fae),n.runWebGLProgram(r,[s],s.dtype)}const yae={kernelName:pm,backendName:"webgl",kernelFunc:gae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xae=jv;function vae(t){Xn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:n,attrs:s}=t,{boxes:r,scores:i}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l}=s,c=n.readSync(r.dataId),u=n.readSync(i.dataId),{selectedIndices:d}=xae(c,u,o,a,l);return n.makeTensorInfo([d.length],"int32",new Int32Array(d))}const bae={kernelName:G1,backendName:"webgl",kernelFunc:vae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wae=Bv;function kae(t){Xn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:n,attrs:s}=t,{boxes:r,scores:i}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l,padToMaxOutputSize:c}=s,u=n.readSync(r.dataId),d=n.readSync(i.dataId),{selectedIndices:h,validOutputs:p}=wae(u,d,o,a,l,c);return[n.makeTensorInfo([h.length],"int32",new Int32Array(h)),n.makeTensorInfo([],"int32",new Int32Array([p]))]}const Cae={kernelName:H1,backendName:"webgl",kernelFunc:kae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Sae=Wv;function Iae(t){Xn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:n,attrs:s}=t,{boxes:r,scores:i}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l,softNmsSigma:c}=s,u=n.readSync(r.dataId),d=n.readSync(i.dataId),h=o,p=a,f=l,g=c,{selectedIndices:x,selectedScores:y}=Sae(u,d,h,p,f,g);return[n.makeTensorInfo([x.length],"int32",new Int32Array(x)),n.makeTensorInfo([y.length],"float32",new Float32Array(y))]}const $ae={kernelName:K1,backendName:"webgl",kernelFunc:Iae};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Tae{constructor(e,n,s,r){this.variableNames=["indices"],this.outputShape=[e,n],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(${r}), float(${s}),
                      float(index == coords.y)));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Eae=t=>{const{inputs:e,backend:n,attrs:s}=t,{indices:r}=e,{dtype:i,depth:o,onValue:a,offValue:l}=s,c=J(r.shape),u=new Tae(c,o,a,l),d=ae({inputs:{x:r},backend:n,attrs:{shape:[c]}}),h=n.runWebGLProgram(u,[d],i);n.disposeIntermediateTensorInfo(d);const p=[...r.shape,o],f=ae({inputs:{x:h},backend:n,attrs:{shape:p}});return n.disposeIntermediateTensorInfo(h),f},Rae={kernelName:gm,backendName:"webgl",kernelFunc:Eae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lf(t){const{inputs:e,backend:n}=t,{x:s}=e;if(s.dtype==="complex64"){const r=Qd({inputs:{input:s},backend:n}),i=lf({inputs:{x:r},backend:n}),o=ag({inputs:{input:s},backend:n}),a=lf({inputs:{x:o},backend:n}),l=po({inputs:{real:i,imag:a},backend:n});return n.disposeIntermediateTensorInfo(r),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(a),l}else return Jd({attrs:{shape:s.shape,dtype:s.dtype,value:s.dtype==="string"?"":0},backend:n})}const Nae={kernelName:Dm,backendName:"webgl",kernelFunc:lf};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KD(t){const{inputs:e,backend:n}=t,{x:s}=e;if(s.dtype==="string")throw new Error("onesLike is not supported under string dtype");if(s.dtype==="complex64"){const r=Qd({inputs:{input:s},backend:n}),i=KD({inputs:{x:r},backend:n}),o=ag({inputs:{input:s},backend:n}),a=lf({inputs:{x:o},backend:n}),l=po({inputs:{real:i,imag:a},backend:n});return n.disposeIntermediateTensorInfo(r),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(a),l}else return Jd({attrs:{shape:s.shape,dtype:s.dtype,value:1},backend:n})}const Aae={kernelName:mm,backendName:"webgl",kernelFunc:KD};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _ae(t){const{inputs:e,backend:n,attrs:s}=t,{axis:r}=s;if(e.length===1)return Z0({inputs:{input:e[0]},backend:n,attrs:{dim:r}});const i=e[0].shape,o=e[0].dtype;e.forEach(u=>{p1(i,u.shape,"All tensors passed to stack must have matching shapes"),T(o===u.dtype,()=>"All tensors passed to stack must have matching dtypes")});const a=[],l=e.map(u=>{const d=Z0({inputs:{input:u},backend:n,attrs:{dim:r}});return a.push(d),d}),c=_D({inputs:l,backend:n,attrs:{axis:r}});return a.forEach(u=>n.disposeIntermediateTensorInfo(u)),c}const Dae={kernelName:ym,backendName:"webgl",kernelFunc:_ae};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Fae{constructor(e,n,s){this.variableNames=["x"],this.customUniforms=[{name:"value",type:"float"}],this.outputShape=n.map((c,u)=>c[0]+e[u]+c[1]);const r=e.length,i=Ge(r),o=n.map(c=>c[0]).join(","),a=n.map((c,u)=>c[0]+e[u]).join(","),l=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);if(r===1){this.userCode=`
        int start = ${o};
        int end = ${a};

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(value);
          } else {
            setOutput(getX(outC - start));
          }
        }
      `;return}this.userCode=`
      ${i} start = ${i}(${o});
      ${i} end = ${i}(${a});

      void main() {
        ${i} outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(value);
        } else {
          ${i} coords = outC - start;
          setOutput(getX(${l}));
        }
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Oae{constructor(e,n,s){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"value",type:"float"}],this.outputShape=n.map((g,x)=>g[0]+e[x]+g[1]);const r=e.length,i=Ge(r),o=n.map(g=>g[0]).join(","),a=n.map((g,x)=>g[0]+e[x]).join(","),l=mn("rc",r),c=mn("source",r),u=`${l[r-1]} < ${this.outputShape[r-1]}`,d=r===1?"source":`vec2(${c.slice(-2).join()})`,h=[`${i} rc = outputLoc;`,`${l[r-1]} += 1;
       if(${u}) {
      `,r===1?"":`}
       rc = outputLoc;
       ${l[r-2]} += 1;
       if(${l[r-2]} < ${this.outputShape[r-2]}) {`,r===1?"":`  ${l[r-1]} += 1;
         if(${u}) {`],p=r===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))";let f="";for(let g=0,x=r===1?2:4;g<x;g++)f+=`
        ${h[g]}
        if (${p}) {
          result[${g}] = float(value);
        } else {
          ${i} source = rc - start;
          result[${g}] = getChannel(getX(${c.join()}), ${d});
        }
      `;f+=r===1?"} ":"}}",this.userCode=`
      const ${i} start = ${i}(${o});
      const ${i} end = ${i}(${a});

      void main() {
        ${i} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${f}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qD=t=>{const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{paddings:i,constantValue:o}=s;if(J(r.shape)===0){const c=i.map((u,d)=>u[0]+r.shape[d]+u[1]);return Jd({backend:n,attrs:{shape:c,value:o,dtype:r.dtype}})}const a=q().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Oae(r.shape,i,o):new Fae(r.shape,i,o),l=[[o]];return n.runWebGLProgram(a,[r],r.dtype,l)},Pae={kernelName:xm,backendName:"webgl",kernelFunc:qD};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mae=`
  if(a < 0.0 && floor(b) < b){
    return NAN;
  }
  if (b == 0.0) {
    return 1.0;
  }
  return (round(mod(b, 2.0)) != 1) ?
      pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,Lae=`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  bvec4 isNaN1 = lessThan(a, vec4(0.0));
  bvec4 isNaN2 = lessThan(floor(b), b);
  bvec4 isNaN = bvec4(isNaN1.x && isNaN2.x, isNaN1.y && isNaN2.y, isNaN1.z && isNaN2.z, isNaN1.w && isNaN2.w);
  `+ka+`
  return result;
`,zae=Yt({opSnippet:Mae,packedOpSnippet:Lae}),jae={kernelName:ud,backendName:"webgl",kernelFunc:zae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bae(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:i,keepDims:o}=s,a=r.shape.length,l=[],c=Te(i,r.shape);let u=c;const d=dt(u,a);let h=r;d!=null&&(h=vn({inputs:{x:r},backend:n,attrs:{perm:d}}),u=wt(u.length,a),l.push(h)),Xt("prod",u,a);let p;if(n.shouldExecuteOnCPU([h])){const f=n.texData.get(h.dataId).values,{outVals:g,outShape:x,outDtype:y}=zee(h.shape,h.dtype,f,u);p=n.makeTensorInfo(x,y,g)}else{const[f,g]=Wt(h.shape,u),x=J(g),y=ae({inputs:{x:h},backend:n,attrs:{shape:[-1,x]}}),v=ov(r.dtype),b=Ca(y,v,"prod",n);p=ae({inputs:{x:b},backend:n,attrs:{shape:f}}),l.push(y),l.push(b)}if(o){l.push(p);const f=Tt(p.shape,c);p=ae({inputs:{x:p},backend:n,attrs:{shape:f}})}return l.forEach(f=>n.disposeIntermediateTensorInfo(f)),p}const Wae={kernelName:bm,backendName:"webgl",kernelFunc:Bae};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vae(t){const{inputs:e,backend:n,attrs:s}=t,{paramsNestedSplits:r,paramsDenseValues:i,indices:o}=e,{outputRaggedRank:a}=s,l=r.map(y=>n.readSync(y.dataId)),c=r.map(y=>y.shape),u=n.readSync(i.dataId),d=n.readSync(o.dataId),[h,p,f]=jee(l,c,u,i.shape,i.dtype,d,o.shape,a),g=h.map(y=>n.makeTensorInfo([y.length],"int32",y)),x=n.makeTensorInfo(f,i.dtype,p);return g.concat([x])}const Uae={kernelName:NT,backendName:"webgl",kernelFunc:Vae};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gae(t){const{inputs:e,backend:n}=t,{starts:s,limits:r,deltas:i}=e,o=n.readSync(s.dataId),a=n.readSync(r.dataId),l=n.readSync(i.dataId),[c,u]=Bee(o,s.shape,s.dtype,a,r.shape,l,i.shape),d=n.makeTensorInfo([c.length],"int32",c),h=n.makeTensorInfo([u.length],s.dtype,u);return[d,h]}const Hae={kernelName:AT,backendName:"webgl",kernelFunc:Gae};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kae(t){const{inputs:e,backend:n,attrs:s}=t,{shape:r,values:i,defaultValue:o,rowPartitionTensors:a}=e,{rowPartitionTypes:l}=s,c=n.readSync(r.dataId),u=n.readSync(i.dataId),d=n.readSync(o.dataId),h=a.map(x=>n.readSync(x.dataId)),p=a.map(x=>x.shape),[f,g]=Wee(c,r.shape,u,i.shape,i.dtype,d,o.shape,h,p,l);return n.makeTensorInfo(f,i.dtype,g)}const qae={kernelName:_T,backendName:"webgl",kernelFunc:Kae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XD=t=>{const{backend:e,attrs:n}=t,{start:s,stop:r,step:i,dtype:o}=n,a=Vee(s,r,i,o);return e.makeTensorInfo([a.length],o,a)},Xae={kernelName:q1,backendName:"webgl",kernelFunc:XD};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yae="return 1.0 / x;",Qae=Oe({opSnippet:Yae}),Jae={kernelName:dd,backendName:"webgl",kernelFunc:Qae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zae=Rs+`
  return (x < 0.0) ? 0.0 : x;
`,ele=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,tle=Oe({opSnippet:Zae,packedOpSnippet:ele}),nle={kernelName:hd,backendName:"webgl",kernelFunc:tle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sle=Rs+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,rle=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,ile=Oe({opSnippet:sle,packedOpSnippet:rle}),ole={kernelName:pd,backendName:"webgl",kernelFunc:ile};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ale{constructor(e,n,s,r,i){this.variableNames=["A"],this.outputShape=[];const[o,a,l,c]=e;this.outputShape=[o,n,s,c];const u=[r&&n>1?a-1:a,r&&s>1?l-1:l],d=[r&&n>1?n-1:n,r&&s>1?s-1:s];let h;i?h="(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":h="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${u[0]/d[0]},
          ${u[1]/d[1]});
      const vec2 inputShapeRC = vec2(${a}.0, ${l}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${h};

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class lle{constructor(e,n,s,r,i){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[o,a,l,c]=e;this.outputShape=[o,n,s,c];const u=[r&&n>1?a-1:a,r&&s>1?l-1:l],d=[r&&n>1?n-1:n,r&&s>1?s-1:s];let h;i?h="(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":h="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${u[0]/d[0]},
          ${u[1]/d[1]},
          ${u[1]/d[1]});
      const vec3 inputShapeRC = vec3(${a}.0, ${l}.0,
                                     ${l}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${h};

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${c-1};
        bool hasNextRow = coords.z < ${s-1};

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cle(t){const{inputs:e,backend:n,attrs:s}=t,{images:r}=e,{alignCorners:i,halfPixelCenters:o,size:a}=s,[l,c]=a,u=q().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new lle(r.shape,l,c,i,o):new ale(r.shape,l,c,i,o);return n.runWebGLProgram(u,[r],"float32")}const ule={kernelName:Cm,backendName:"webgl",kernelFunc:cle};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class dle{constructor(e,n,s){this.variableNames=["dy"],this.outputShape=[],this.outputShape=n;const[,r,i]=n,[,o,a]=e,l=[s&&o>1?r-1:r,s&&a>1?i-1:i],c=[s&&o>1?o-1:o,s&&a>1?a-1:a],u=l[0]/c[0],d=l[1]/c[1],h=1/u,p=1/d,f=Math.ceil(h)*2+2,g=Math.ceil(p)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${u});
        const float widthScale = float(${d});

        const float invHeightScale = float(${h});
        const float invWidthScale = float(${p});

        const int winHeight = int(${f});
        const int winWidth = int(${g});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${o}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${a}) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), ${r-1}.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), ${i-1}.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hle(t){const{inputs:e,backend:n,attrs:s}=t,{images:r,dy:i}=e,{alignCorners:o}=s,a=new dle(i.shape,r.shape,o);return n.runWebGLProgram(a,[i],i.dtype)}const ple={kernelName:Q1,backendName:"webgl",kernelFunc:hle};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class fle{constructor(e,n,s,r,i){this.variableNames=["A"],this.outputShape=[];const[o,a,l,c]=e;this.outputShape=[o,n,s,c];const u=[r&&n>1?a-1:a,r&&s>1?l-1:l],d=[r&&n>1?n-1:n,r&&s>1?s-1:s],h=r?"0.5":"0.0";let p;i?p="max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":p="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${u[0]/d[0]},
          ${u[1]/d[1]});
      const vec2 inputShapeRC = vec2(${a}.0, ${l}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${p};

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${h})));
        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class mle{constructor(e,n,s,r,i){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[o,a,l,c]=e;this.outputShape=[o,n,s,c];const u=[r&&n>1?a-1:a,r&&s>1?l-1:l],d=[r&&n>1?n-1:n,r&&s>1?s-1:s],h=r?"0.5":"0.0";let p;i?p="max((vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC, vec3(0.0))":p="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${u[0]/d[0]},
          ${u[1]/d[1]},
          ${u[1]/d[1]});
      const vec3 inputShapeRC = vec3(${a}.0, ${l}.0,
                                     ${l}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${p};

        // Compute the coordinators of nearest neighbor point.
        ivec3 sourceNearestRC = ivec3(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${h})));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${c-1};
        bool hasNextRow = coords.z < ${s-1};

        vec4 newValue = vec4(
          getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d),
          hasNextCol ? getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d + 1) : 0.0);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gle(t){const{inputs:e,backend:n,attrs:s}=t,{images:r}=e,{alignCorners:i,halfPixelCenters:o,size:a}=s,[l,c]=a,u=q().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new mle(r.shape,l,c,i,o):new fle(r.shape,l,c,i,o);return n.runWebGLProgram(u,[r],r.dtype)}const yle={kernelName:km,backendName:"webgl",kernelFunc:gle};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class xle{constructor(e,n,s){this.variableNames=["dy"],this.outputShape=[],this.outputShape=n;const[,r,i]=n,[,o,a]=e,l=[s&&o>1?r-1:r,s&&a>1?i-1:i],c=[s&&o>1?o-1:o,s&&a>1?a-1:a],u=l[0]/c[0],d=l[1]/c[1],h=1/u,p=1/d,f=Math.ceil(h)*2+2,g=Math.ceil(p)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${u});
        const float widthScale = float(${d});

        const float invHeightScale = float(${h});
        const float invWidthScale = float(${p});

        const int winHeight = int(${f});
        const int winWidth = int(${g});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${o}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${a}) {
              continue;
            }

            float sourceFracRow =
              float(${l[0]}) *
                (float(dyR) / float(${c[0]}));

            float sourceFracCol =
                float(${l[1]}) *
                  (float(dyC) / float(${c[1]}));

            int sourceNearestRow = int(min(
                float(int(${r}) - 1),
                ${s} ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(${i}) - 1),
                ${s} ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vle(t){const{inputs:e,backend:n,attrs:s}=t,{images:r,dy:i}=e,{alignCorners:o}=s,a=new xle(i.shape,r.shape,o);return n.runWebGLProgram(a,[i],i.dtype)}const ble={kernelName:Y1,backendName:"webgl",kernelFunc:vle};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class wle{constructor(e,n){this.variableNames=["x"];const s=e.length;if(s>4)throw new Error(`WebGL backend: Reverse of rank-${s} tensor is not yet supported`);if(this.outputShape=e,s===1){this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(${e[0]} - coord - 1));
        }
      `;return}const r=a=>n.indexOf(a)!==-1&&e[a]!==1?`${e[a]} - coords[${a}] - 1`:`coords[${a}]`,i=e.map((a,l)=>r(l)).join(","),o=Ge(s);this.userCode=`
      void main() {
        ${o} coords = getOutputCoords();
        setOutput(getX(${i}));
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class kle{constructor(e,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;const s=e.length;if(s>4)throw new Error(`WebGL backend: Reverse of rank-${s} tensor is not yet supported`);this.outputShape=e;const r=mn("rc",s),i=`${r[s-1]} + 1 < ${this.outputShape[s-1]}`,o=`${r[s-2]} + 1 < ${this.outputShape[s-2]}`,a=Ge(s);s===1?this.userCode=`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(${e[0]} - rc - 1),
            ${e[0]} - rc - 1);
          if(${i}){
              result.g = getChannel(getX(${e[0]} - (rc  + 1) - 1),
                ${e[0]} - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:this.userCode=`
        void main() {
          ${a} rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = ${l(r.slice())};
          if(${i}){
            result.g = ${c(r.slice())};
          }
          if(${o}) {
            result.b = ${u(r.slice())};
            if(${i}) {
              result.a = ${d(r.slice())};
            }
          }
          setOutput(result);
        }
    `;function l(f){return h(f)}function c(f){return f[s-1]="("+f[s-1]+" + 1)",h(f)}function u(f){return f[s-2]="("+f[s-2]+" + 1)",h(f)}function d(f){return f[s-1]="("+f[s-1]+" + 1)",f[s-2]="("+f[s-2]+" + 1)",h(f)}function h(f){const g=e.map((v,b)=>p(b,f)),x=g.join(","),y=g.slice(-2).join(",");return`getChannel(getX(${x}), vec2(${y}))`}function p(f,g){return n.indexOf(f)!==-1&&e[f]!==1?`${e[f]} - ${g[f]} - 1`:`${g[f]}`}}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cle(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{dims:i}=s,o=r.shape.length,a=Te(i,r.shape);if(o===0)return Gn({inputs:{x:r},backend:n});const l=q().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new kle(r.shape,a):new wle(r.shape,a);return n.runWebGLProgram(l,[r],r.dtype)}const Sle={kernelName:Sm,backendName:"webgl",kernelFunc:Cle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ile{constructor(e,n){this.variableNames=["Image"],this.outputShape=[],this.customUniforms=[{name:"params",type:"vec4"}];const s=e[1],r=e[2];this.outputShape=e;let i="";typeof n=="number"?i=`float outputValue = ${n.toFixed(2)};`:i=`
        vec3 fill = vec3(${n.join(",")});
        float outputValue = fill[coords[3]];`,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];
          int y = coords[1];
          float coordXFloat = (float(x) - params[0]) * params[3] -
            (float(y) - params[1]) * params[2];
          float coordYFloat = (float(x) - params[0]) * params[2] +
            (float(y) - params[1]) * params[3];
          int coordX = int(round(coordXFloat + params[0]));
          int coordY = int(round(coordYFloat + params[1]));
          ${i}
          if(coordX >= 0 && coordX < ${r} && coordY >= 0 && coordY < ${s}) {
            outputValue = getImage(coords[0], coordY, coordX, coords[3]);
          }
          setOutput(outputValue);
        }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $le={kernelName:rv,backendName:"webgl",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{image:s}=t,{radians:r,fillValue:i,center:o}=e,a=n,l=new Ile(s.shape,i),[c,u]=Zv(o,s.shape[1],s.shape[2]),d=[[c,u,Math.sin(r),Math.cos(r)]];return a.runWebGLProgram(l,[s],s.dtype,d)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tle=`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`,Ele=Oe({opSnippet:Tle}),Rle={kernelName:fd,backendName:"webgl",kernelFunc:Ele};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Nle="return inversesqrt(x);",Ale=Oe({opSnippet:Nle,cpuKernelImpl:Uee}),_le={kernelName:md,backendName:"webgl",kernelFunc:Ale};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class lw{constructor(e,n,s,r,i,o,a=!0,l=!1){this.variableNames=["updates","indices","defaultValue"],this.outputShape=o;const c=Ge(i.length),u=Ge(o.length);let d="";s===1?d="i":s===2&&(d="i, j");const h=`getIndices(${d})`;let p="";r===1?p="i":r===2&&(p="i, coords[1]");const f=`getUpdates(${p})`;let g="";l&&(g="coords[0], coords[1]");const x=`getDefaultValue(${g})`,y=n>1?"strides[j]":"strides";this.userCode=`
        ${c} strides = ${c}(${i});

        void main() {
          ${u} coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < ${e}; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < ${n}; j++) {
              int index = round(${h});
              flattenedIndex += index * ${y};
            }
            if (flattenedIndex == coords[0]) {
              sum += ${f};
              found = true;
            }
          }
          setOutput(mix(${x}, sum, float(found)));
        }
      `}}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Dle{constructor(e,n,s,r,i,o,a=!0,l=!1){this.variableNames=["updates","indices","defaultValue"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=o;const c=Ge(i.length),u=Ge(o.length);let d="";s===1?d="i":s===2&&(d="i, j");const h=`getIndices(${d})`;let p="";r===1?p="i":r===2&&(p="i, coords[1]");const f=`getUpdates(${p})`;let g="";l&&(g="coords[0], coords[1]");const x=`getDefaultValue(${g})`,y=n>1?"strides[j]":"strides",v=n>1?"strides[j + 1]":"strides";this.userCode=`
        ${c} strides = ${c}(${i});

        void main() {
          ${u} coords = getOutputCoords();
          vec4 sum = vec4(0.);
          vec4 found = vec4(0.);
          for (int i = 0; i < ${e}; i+=2) {
            ivec2 flattenedIndex = ivec2(0);
            for (int j = 0; j < ${n}; j+=2) {
              ivec4 index = round(${h});
              flattenedIndex += index.xz * ${y};
              if (j + 1 < ${n}) {
                flattenedIndex += index.yw * ${v};
              }
            }
            if (flattenedIndex[0] == coords[0] || flattenedIndex[1] == coords[0] ||
                flattenedIndex[0] == coords[0] + 1 || flattenedIndex[1] == coords[0] + 1) {
              vec4 updVals = ${f};
              if (flattenedIndex[0] == coords[0]) {
                sum.xy += updVals.xy;
                found.xy = vec2(1.);
              } else if (flattenedIndex[0] == coords[0] + 1) {
                sum.zw += updVals.xy;
                found.zw = vec2(1.);
              }
              if (flattenedIndex[1] == coords[0]) {
                sum.xy += updVals.zw;
                found.xy = vec2(1.);
              } else if (flattenedIndex[1] == coords[0] + 1) {
                sum.zw += updVals.zw;
                found.zw = vec2(1.);
              }
            }
          }
          setOutput(mix(${x}, sum, found));
        }
      `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fle(t){const{inputs:e,backend:n,attrs:s}=t,{indices:r,updates:i}=e,{shape:o}=s,{sliceRank:a,numUpdates:l,sliceSize:c,strides:u,outputSize:d}=ya(i,r,o),h=[d/c,c];if(d===0)return n.makeTensorInfo(o,r.dtype);const p=ae({inputs:{x:r},backend:n,attrs:{shape:[l,a]}}),f=ae({inputs:{x:i},backend:n,attrs:{shape:[l,c]}}),g=n.makeTensorInfo([],"float32",new Float32Array([0]));let x;q().getBool("WEBGL_PACK")?x=new Dle(l,a,p.shape.length,f.shape.length,u,h):x=new lw(l,a,p.shape.length,f.shape.length,u,h);const y=n.runWebGLProgram(x,[f,p,g],f.dtype),v=ae({inputs:{x:y},backend:n,attrs:{shape:o}});return n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(y),n.disposeIntermediateTensorInfo(g),v}const Ole={kernelName:DT,backendName:"webgl",kernelFunc:Fle};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ple{constructor(e,n,s,r){this.variableNames=["sortedSequence","values"],this.customUniforms=[{name:"numInputs",type:"int"}],this.outputShape=[e,s];const i="while (left < right) {",o=`for (int i = 0; i < ${Math.ceil(Math.log2(n+1))}; ++i) { if (left >= right) break;`,a=q().getNumber("WEBGL_VERSION")===2?i:o,l=r==="left"?"<":"<=";this.userCode=`
       int findBound(int batch, float value) {
         int left = 0;
         int right = numInputs;
         int mid;
         ${a}
           mid = (left + right) / 2;
           if (getSortedSequence(batch, mid) ${l} value) {
             left = mid + 1;
           } else {
             right = mid;
           }
         }
         return right;
       }

       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int valueIndex = coords[1];

         float value = getValues(batch, valueIndex);

         setOutput(float(findBound(batch, value)));
       }
     `}}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mle(t){const{inputs:e,backend:n,attrs:s}=t,{sortedSequence:r,values:i}=e,{side:o}=s,a=new Ple(r.shape[0],r.shape[1],i.shape[1],o),l=[[r.shape[1]]];return n.runWebGLProgram(a,[r,i],"int32",l)}const Lle={kernelName:OT,backendName:"webgl",kernelFunc:Mle};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class zle{constructor(e,n,s){this.variableNames=["c","a","b"],this.outputShape=n;let r,i;if(s>4)throw Error(`Where for rank ${s} is not yet supported`);if(s===1)i="resRC",r="resRC";else{const a=["resRC.x","resRC.y","resRC.z","resRC.w"],l=[],c=[];for(let u=0;u<n.length;u++)c.push(`${a[u]}`),u<e&&l.push(`${a[u]}`);r=l.join(),i=c.join()}const o=Ge(s);this.userCode=`
      void main() {
        ${o} resRC = getOutputCoords();
        float cVal = getC(${r});
        if (cVal >= 1.0) {
          setOutput(getA(${i}));
        } else {
          setOutput(getB(${i}));
        }
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jle(t){const{inputs:e,backend:n}=t,{condition:s,t:r,e:i}=e,o=new zle(s.shape.length,r.shape,r.shape.length);return n.runWebGLProgram(o,[s,r,i],Vn(r.dtype,i.dtype))}const Ble={kernelName:Im,backendName:"webgl",kernelFunc:jle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wle=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = ${Vm};
  float scale = ${Um};
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`,Vle=Oe({opSnippet:Wle}),Ule={kernelName:gd,backendName:"webgl",kernelFunc:Vle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gle=Zl+`
  return 1.0 / (1.0 + exp(-1.0 * x));
`,Hle=`
  vec4 result = 1.0 / (1.0 + exp(-1.0 * x));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,Kle=Oe({opSnippet:Gle,packedOpSnippet:Hle,cpuKernelImpl:Hee}),qle={kernelName:bd,backendName:"webgl",kernelFunc:Kle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xle=`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`,Yle=Oe({opSnippet:Xle}),Qle={kernelName:vd,backendName:"webgl",kernelFunc:Yle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jle=Zl+`
  return sin(x);
`,Zle=`
  vec4 result = sin(x);
  bvec4 isNaN = isnan(x);
  ${ka}
  return result;
`,ece=Oe({opSnippet:Jle,packedOpSnippet:Zle}),tce={kernelName:yd,backendName:"webgl",kernelFunc:ece};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nce=`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`,sce=Oe({opSnippet:nce}),rce={kernelName:xd,backendName:"webgl",kernelFunc:sce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ice=`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`,oce=Oe({opSnippet:ice}),ace={kernelName:wd,backendName:"webgl",kernelFunc:oce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lce=t=>{const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{blockShape:i,paddings:o}=s;T(r.shape.length<=4,()=>"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet");const a=i.reduce((y,v)=>y*v),l=[[0,0]];l.push(...o);for(let y=1+i.length;y<r.shape.length;++y)l.push([0,0]);const c=[],u=qD({inputs:{x:r},backend:n,attrs:{paddings:l,constantValue:0}}),d=Pd(u.shape,i,a,!1),h=Md(d.length,i.length,!1),p=Ld(u.shape,i,a,!1),f=ae({inputs:{x:u},backend:n,attrs:{shape:d}}),g=vn({inputs:{x:f},backend:n,attrs:{perm:h}}),x=ae({inputs:{x:g},backend:n,attrs:{shape:p}});return c.push(u),c.push(f),c.push(g),c.forEach(y=>n.disposeIntermediateTensorInfo(y)),x},cce={kernelName:Em,backendName:"webgl",kernelFunc:lce};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uce(t){const{inputs:e,backend:n}=t,{indices:s,values:r,denseShape:i,defaultValue:o}=e;if(i.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
         ${i.shape}`);if(s.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
         ${s.shape}`);if(r.shape.length!==1)throw new Error(`Values must be a vector, saw:
         ${r.shape}`);if(o.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${o.shape}`);const a=n.readSync(s.dataId),l=n.readSync(r.dataId),c=n.readSync(i.dataId),u=n.readSync(o.dataId)[0],[d,h,p,f,g]=qee(a,s.shape,s.dtype,l,r.dtype,c,u);return[n.makeTensorInfo(h,s.dtype,d),n.makeTensorInfo([h[0]],r.dtype,p),n.makeTensorInfo([f.length],"bool",new Uint8Array(f.map(x=>Number(x)))),n.makeTensorInfo([g.length],s.dtype,new Int32Array(g))]}const dce={kernelName:PT,backendName:"webgl",kernelFunc:uce};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hce(t){const{inputs:e,backend:n}=t,{inputIndices:s,inputShape:r,newShape:i}=e;if(s.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape ${s.shape}`);if(r.shape.length!==1)throw new Error(`Input shape should be a vector but received shape ${r.shape}`);if(i.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${i.shape}`);const o=Array.from(n.readSync(r.dataId)),a=n.readSync(s.dataId),l=Array.from(n.readSync(i.dataId)),[c,u,d]=Xee(a,s.shape,s.dtype,o,l);return[n.makeTensorInfo(u,s.dtype,c),n.makeTensorInfo([d.length],i.dtype,new Int32Array(d))]}const pce={kernelName:MT,backendName:"webgl",kernelFunc:hce};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fce(t){const{inputs:e,backend:n}=t,{data:s,indices:r,segmentIds:i}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
              ${r.shape}`);if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
              ${i.shape}`);const o=n.readSync(s.dataId),a=n.readSync(r.dataId),l=n.readSync(i.dataId),[c,u]=vD(o,s.shape,s.dtype,a,l,!0);return n.makeTensorInfo(u,s.dtype,c)}const mce={kernelName:LT,backendName:"webgl",kernelFunc:fce};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gce(t){const{inputs:e,backend:n}=t,{data:s,indices:r,segmentIds:i}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
             ${r.shape}`);if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
             ${i.shape}`);const o=n.readSync(s.dataId),a=n.readSync(r.dataId),l=n.readSync(i.dataId),[c,u]=vD(o,s.shape,s.dtype,a,l);return n.makeTensorInfo(u,s.dtype,c)}const yce={kernelName:zT,backendName:"webgl",kernelFunc:gce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xce(t){const{inputs:e,backend:n,attrs:s}=t,{sparseIndices:r,sparseValues:i,defaultValue:o}=e,{outputShape:a}=s,{sliceRank:l,numUpdates:c,sliceSize:u,strides:d,outputSize:h}=ya(i,r,a),p=!1;if(i.dtype==="string"){const y=n.bufferSync(r),v=n.bufferSync(i),b=Gi(n.readSync(o.dataId)[0]),w=Gee(y,v,a,h,u,c,l,d,b,p);return n.makeTensorInfo(a,w.dtype,w.values)}const f=new lw(c,l,r.shape.length,i.shape.length,d,[h,1],p),g=n.runWebGLProgram(f,[i,r,o],i.dtype),x=ae({inputs:{x:g},backend:n,attrs:{shape:a}});return n.disposeIntermediateTensorInfo(g),x}const vce={kernelName:jT,backendName:"webgl",kernelFunc:xce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bce(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{numOrSizeSplits:i,axis:o}=s,a=Te(o,r.shape)[0],l=fb(r,i,a),c=r.shape.length,u=new Array(c).fill(0),d=r.shape.slice();return l.map(h=>{const p=[...d];p[a]=h;const f=ec({inputs:{x:r},backend:n,attrs:{begin:u,size:p}});return u[a]+=h,f})}const wce={kernelName:Rm,backendName:"webgl",kernelFunc:bce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jC="return sqrt(x);",kce=Oe({opSnippet:jC,packedOpSnippet:jC,cpuKernelImpl:Yee}),Cce={kernelName:kd,backendName:"webgl",kernelFunc:kce};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Sce="return x * x;",Ice=Oe({opSnippet:Sce}),$ce={kernelName:J1,backendName:"webgl",kernelFunc:Ice};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BC="return (a - b) * (a - b);",Tce=Yt({opSnippet:BC,packedOpSnippet:BC}),Ece={kernelName:Cd,backendName:"webgl",kernelFunc:Tce};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rce(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e;if(r.dtype!=="string")throw new Error("Input must be of datatype string");const i=n.readSync(r.dataId),o=Jr(i),a=Qee(o,"string",s);return n.makeTensorInfo(r.shape,"string",a)}const Nce={kernelName:Z1,backendName:"webgl",kernelFunc:Rce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ace({inputs:t,attrs:e,backend:n}){const{x:s}=t,r=Rs+`
    return x > 0.0 ? 1.0 : float(${e.alpha});
  `,i=new dr(s.shape,r);return n.runWebGLProgram(i,[s],s.dtype)}const _ce={kernelName:Ed,backendName:"webgl",kernelFunc:Ace};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Dce{constructor(e,n,s){this.variableNames=["x"],this.outputShape=s;const r=s.length,i=Ge(s.length),o=Ge(s.length);let a="";if(r===1)a="coords * strides + begin";else{let l=0;a=s.map((c,u)=>(l++,s.length===1?`coords * strides[${u}] + begin[${u}]`:`coords[${l-1}] * strides[${u}] + begin[${u}]`)).join(",")}this.userCode=`
      ${i} begin = ${i}(${e});
      ${i} strides = ${i}(${n});

      void main() {
        ${o} coords = getOutputCoords();
        setOutput(getX(${a}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fce(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{begin:i,end:o,strides:a,beginMask:l,endMask:c,ellipsisMask:u,newAxisMask:d,shrinkAxisMask:h}=s,{finalShapeSparse:p,finalShape:f,isIdentity:g,sliceDim0:x,isSimpleSlice:y,begin:v,end:b,strides:w}=Yv(r.shape,i,o,a,l,c,u,d,h);let k;if(g)k=ae({inputs:{x:r},backend:n,attrs:{shape:f}});else if(x||y){T(r.shape.length>=1,()=>`Input must have rank at least 1, got: ${r.shape.length}`);const I=Kv(v,b,w),C=ec({inputs:{x:r},backend:n,attrs:{begin:v,size:I}});k=ae({inputs:{x:C},backend:n,attrs:{shape:f}}),n.disposeIntermediateTensorInfo(C)}else if(n.shouldExecuteOnCPU([r])){const C=n.readSync(r.dataId),$=$e(r.shape,r.dtype,C),R=Jee(p,$,w,v);k=n.makeTensorInfo(f,r.dtype,R.values)}else{const C=new Dce(v,w,p);k=n.runWebGLProgram(C,[r],r.dtype)}const S=ae({inputs:{x:k},backend:n,attrs:{shape:f}});return n.disposeIntermediateTensorInfo(k),S}const Oce={kernelName:ev,backendName:"webgl",kernelFunc:Fce};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pce(t){const{inputs:e,backend:n,attrs:s}=t,{separator:r,nGramWidths:i,leftPad:o,rightPad:a,padWidth:l,preserveShortSequences:c}=s,{data:u,dataSplits:d}=e,h=n.readSync(u.dataId),p=n.readSync(d.dataId),[f,g]=Zee(h,p,r,i,o,a,l,c);return[n.makeTensorInfo([f.length],"string",f),n.makeTensorInfo(d.shape,"int32",g)]}const Mce={kernelName:BT,backendName:"webgl",kernelFunc:Pce};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lce(t){const{inputs:e,backend:n,attrs:s}=t,{skipEmpty:r}=s,{input:i,delimiter:o}=e;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(i.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${i.shape}`);if(o.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${o.shape}`);const a=n.readSync(i.dataId),l=n.readSync(o.dataId)[0],[c,u,d]=ete(a,l,r),h=u.length;return[n.makeTensorInfo([h,2],"int32",c),n.makeTensorInfo([h],"string",u),n.makeTensorInfo([2],"int32",new Int32Array(d))]}const zce={kernelName:WT,backendName:"webgl",kernelFunc:Lce};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jce(t){const{inputs:e,backend:n,attrs:s}=t,{numBuckets:r}=s,{input:i}=e;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(r<=0)throw new Error("Number of buckets must be at least 1");const o=n.readSync(i.dataId),a=tte(o,r);return n.makeTensorInfo(i.shape,"int32",a)}const Bce={kernelName:VT,backendName:"webgl",kernelFunc:jce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wce="return tan(x);",Vce=Oe({opSnippet:Wce}),Uce={kernelName:Id,backendName:"webgl",kernelFunc:Vce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gce=`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`,Hce=Oe({opSnippet:Gce}),Kce={kernelName:$d,backendName:"webgl",kernelFunc:Hce};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qce(t){const{inputs:e,backend:n,attrs:s}=t,{tensor:r,indices:i,updates:o}=e,{sliceRank:a,numUpdates:l,sliceSize:c,strides:u,outputSize:d}=ya(o,i,r.shape),h=[d/c,c];if(d===0)return n.makeTensorInfo(r.shape,i.dtype);const p=ae({inputs:{x:i},backend:n,attrs:{shape:[l,a]}}),f=ae({inputs:{x:o},backend:n,attrs:{shape:[l,c]}}),g=ae({inputs:{x:r},backend:n,attrs:{shape:h}}),x=new lw(l,a,p.shape.length,f.shape.length,u,h,!1,!0),y=n.runWebGLProgram(x,[f,p,g],g.dtype),v=ae({inputs:{x:y},backend:n,attrs:{shape:r.shape}});return n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(y),v}const Xce={kernelName:FT,backendName:"webgl",kernelFunc:qce};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Yce{constructor(e,n){this.variableNames=["A"];const s=new Array(e.length);for(let o=0;o<s.length;o++)s[o]=e[o]*n[o];this.outputShape=s,this.rank=s.length;const r=Ge(this.rank),i=Qce(e);this.userCode=`
      void main() {
        ${r} resRC = getOutputCoords();
        setOutput(getA(${i}));
      }
    `}}function Qce(t){const e=t.length;if(e>5)throw Error(`Tile for rank ${e} is not yet supported`);if(e===1)return`imod(resRC, ${t[0]})`;const n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],s=[];for(let r=0;r<t.length;r++)s.push(`imod(${n[r]}, ${t[r]})`);return s.join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YD(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{reps:i}=s;if(r.dtype==="string"||r.shape.length>5){const l=n.readSync(r.dataId),c=r.dtype==="string"?l.map(h=>Gi(h)):l,u=$e(r.shape,r.dtype,c),d=ste(u,i);return n.makeTensorInfo(d.shape,d.dtype,d.values)}const o=new Yce(r.shape,i);return n.runWebGLProgram(o,[r],r.dtype)}const Jce={kernelName:Td,backendName:"webgl",kernelFunc:YD};class Zce{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"negativeInf",type:"float"},{name:"dir",type:"int"},{name:"inc",type:"int"}],this.outputShape=e,this.userCode=`
       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // We compare elements pair-wise within a group of size 2 * inc.
         // The comparing rule for each group alternates between ascending
         // and descending. Within each group, we compare each pair at
         // positions i and i+inc. To decide whether an element at position i
         // is x0 or x1, we mod it by 2 * inc, if the result is smaller than
         // inc, it is in the first half of the group, we denote it as x0,
         // otherwise we denote it as x1.
         // For example, as shown in the Bitonic top K paper referenced above,
         // Figure5(a) shows that element[1] is in the
         // second half of the group when group size is 2, but it is in the
         // first half of the group when group size is 4.

         bool isFirstInPair = imod(elemIdx, 2 * inc) < inc;
         int i = isFirstInPair ? elemIdx : elemIdx - inc;

         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + inc : int(getIndices(batch, i + inc));
         float x0 = i0 < n ? getX(batch, i0) : negativeInf;
         float x1 = i1 < n ? getX(batch, i1) : negativeInf;

         // Denotes which direction indices are in (ascending or descending).
         bool reverse = imod(elemIdx, 2 * dir) >= dir;
         bool isGreater = x0 > x1 || (x0 == x1 && i1 > i0);
         if (reverse == isGreater) { // Elements in opposite order of direction
           int iTemp = i0;
           i0 = i1;
           i1 = iTemp;
         }
         if (isFirstInPair) {
            setOutput(float(i0));
         } else {
            setOutput(float(i1));
         }
       }
     `}}class eue{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"k",type:"int"}],this.outputShape=e,this.userCode=`
    void main() {
         // Takes max of indices (0, k), (1, k + 1), (2, k + 2) ...
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // The output size is half of the previous size.
         // If the previous sequence is | | | | _ _ _ _  | | | |  _ _ _ _ (k=4),
         // we only need to output the indices at positions |, the indices at
         // positions _ can be thrown away, see Figure5(b) After Phase 2
         // (Merge phase) in the Bitonic Top K paper referenced above.
         // For example, the paper shows we only need to output the orange bars.
         // The output sequence should look like this | | | | | | | |.
         // Because the sequence is halved, to map the output index back
         // to the previous sequence to find the corresponding value,
         // we need to double the index. When we double the index,
         // we basically interpolate a position, so 2i looks like
         // | _ | _ | _ | _ | _ | _ | _. We move the | to the first k position
         // of each 2k positions by - elemIdx % k. E.g. for output at
         // index 4,5,6,7, we want to get the corresponding element at
         // original index 8,9,10,11, for output at index 8,9,10,11,
         // we want to get the corresponding element at original index
         // 16,17,18,19, so on and so forth.

         int i = elemIdx < k ? elemIdx : (elemIdx * 2 - imod(elemIdx, k));
         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + k : int(getIndices(batch, i + k));

         float x0 = getX(batch, i0);
         float x1 = i1 < n ? getX(batch, i1) : x0;

         setOutput(x0 >= x1 ? float(i0) : float(i1));
       }
     `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yo(t,e){e!==null&&t.disposeIntermediateTensorInfo(e)}function WC(t){let e=1;for(;e<t;)e*=2;return e}function tue(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{k:i,sorted:o}=s,a=q().getNumber("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD"),l=q().getNumber("TOPK_K_CPU_HANDOFF_THRESHOLD"),c=r.shape,u=c[c.length-1];if(n.shouldExecuteOnCPU([r])||u<a||i>l){const R=n.readSync(r.dataId),[_,M]=rte(R,c,r.dtype,i,o);return[n.makeTensorInfo(_.shape,_.dtype,_.values),n.makeTensorInfo(M.shape,M.dtype,M.values)]}if(i===0)return c[c.length-1]=0,[n.makeTensorInfo(c,r.dtype,[]),n.makeTensorInfo(c,"int32",[])];if(u===1)return[r,Jd({attrs:{shape:c,dtype:"int32",value:0},backend:n})];const d=n.texData.get(r.dataId),h=d!==null&&d.isPacked,p=h?n.unpackTensor(r):r,g=J(c)/u,x=ae({inputs:{x:p},attrs:{shape:[g,u]},backend:n});h&&yo(n,p);const y=WC(i),v=WC(u);let b=null;const w=()=>b===null?[x,x]:[x,b],k=(R,_,M)=>{const B=w(),A=new Zce(M),P=[[u],[b===null?1:0],[Number.NEGATIVE_INFINITY],[R],[_]],H=b;b=n.runWebGLProgram(A,B,"int32",P),yo(n,H)};for(let R=1;R<y;R*=2){const _=R*2;for(let M=R;M>=1;M/=2)k(_,M,[g,v])}for(let R=v;R>y;R/=2){const _=w(),M=new eue([g,R/2]),A=[[u],[b===null?1:0],[y]],F=b;b=n.runWebGLProgram(M,_,"int32",A),yo(n,F);const P=y/2,H=P*2;for(let E=P;E>=1;E/=2)k(H,E,b.shape)}let S=b;b=ec({inputs:{x:b},backend:n,attrs:{begin:0,size:[g,i]}}),yo(n,S);let I=WD({inputs:{x,indices:b},backend:n,attrs:{axis:1,batchDims:1}});yo(n,x);const C=c.slice(0,-1);C.push(i),S=b,b=ae({inputs:{x:b},attrs:{shape:C},backend:n}),yo(n,S);const $=I;return I=ae({inputs:{x:I},attrs:{shape:C},backend:n}),yo(n,$),[I,b]}const nue={kernelName:tv,backendName:"webgl",kernelFunc:tue};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class sue{constructor(e,n,s,r,i,o){this.variableNames=["Image","Transforms"],this.outputShape=o;const a=s==="nearest"?1:2;let l;switch(r){case"constant":l=1;break;case"reflect":l=2;break;case"wrap":l=3;break;case"nearest":l=4;break;default:l=1;break}this.userCode=`
            float mapCoord(float outCoord, float len) {
              float inCoord = outCoord;
              if(${l} == 2) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    if (inCoord < sz2) {
                      inCoord = sz2 * float(int(float(-inCoord / sz2))) +
                      inCoord;
                    }
                    inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1.0;
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    inCoord -= sz2 * float(int(float(inCoord / sz2)));
                    if (inCoord >= len) {
                      inCoord = sz2 - inCoord - 1.0;
                    }
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${l} == 3) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord += len * (float(int(float(-inCoord / sz))) + 1.0);
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord -= len * float(int(float(inCoord / sz)));
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${l} == 4) {
                return clamp(outCoord, 0.0, len - 1.0);
              } else {
                return outCoord;
              }
            }

            float readWithFillValue(int batch, int coordY, int coordX,
              int channel) {
              float outputValue;
              if (0 <= coordY && coordY < ${e} && 0 <= coordX && coordX < ${n}) {
                  outputValue = getImage(batch, coordY, coordX, channel);
              } else {
                outputValue = float(${i});
              }
              return outputValue;
            }

            void main() {
              ivec4 coords = getOutputCoords();
              float outputValue;
              int batch = coords[0];
              int x = coords[2];
              int y = coords[1];
              int channel = coords[3];
              float xf = float(x);
              float yf = float(y);
              float a1 = getTransforms(batch, 0);
              float a2 = getTransforms(batch, 1);
              float a3 = getTransforms(batch, 2);
              float b1 = getTransforms(batch, 3);
              float b2 = getTransforms(batch, 4);
              float b3 = getTransforms(batch, 5);
              float c1 = getTransforms(batch, 6);
              float c2 = getTransforms(batch, 7);
              float projection = c1 * xf + c2 * yf + 1.0;
              if (projection == 0.0) {
                outputValue = float(${i});
              } else {
                float inX = (a1 * xf + a2 * yf + a3) / projection;
                float inY = (b1 * xf + b2 * yf + b3) / projection;
                float mapX = mapCoord(inX, float(${n}));
                float mapY = mapCoord(inY, float(${e}));

                if (${a} == 1) {
                  int coordY = int(round(mapY));
                  int coordX = int(round(mapX));
                  outputValue = readWithFillValue(batch, coordY, coordX,
                    channel);
                } else {
                  float yFloor = floor(mapY);
                  float xFloor = floor(mapX);
                  float yCeil = yFloor + 1.0;
                  float xCeil = xFloor + 1.0;
                  float valueYFloor = (xCeil - mapX) *
                  readWithFillValue(batch, int(yFloor), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yFloor), int(xCeil), channel);
                  float valueYCeil = (xCeil - mapX) *
                  readWithFillValue(batch, int(yCeil), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yCeil), int(xCeil), channel);
                  outputValue = (yCeil - mapY) * valueYFloor +
                  (mapY - yFloor) * valueYCeil;
                }
              }
              setOutput(outputValue);
            }
        `}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rue(t){const{inputs:e,backend:n,attrs:s}=t,{image:r,transforms:i}=e,{interpolation:o,fillMode:a,fillValue:l,outputShape:c}=s,[u,d,h,p]=r.shape,[f,g]=c??[d,h],x=[u,f,g,p],y=new sue(d,h,o,a,l,x);return n.runWebGLProgram(y,[r,i],"float32")}const iue={kernelName:nv,backendName:"webgl",kernelFunc:rue};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oue(t){const{inputs:e,attrs:n,backend:s}=t,{axis:r}=n,{x:i}=e;Xd(i,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");const o=s.readSync(i.dataId),{outputValues:a,outputShape:l,indices:c}=ite(o,r,i.shape,i.dtype);return[s.makeTensorInfo(l,i.dtype,a),s.makeTensorInfo([c.length],"int32",c)]}const aue={kernelName:sv,backendName:"webgl",kernelFunc:oue};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lue(t){const{inputs:e,backend:n,attrs:s}=t,{value:r}=e;let{axis:i}=s;i<0&&(i+=r.shape.length);const o=r,a=o.shape.length,l=r.shape[i],c=new Array(a-1);let u=0;for(let g=0;g<a;g++)g!==i&&(c[u++]=o.shape[g]);const d=[],h=new Array(a).fill(0),p=o.shape.slice();p[i]=1;const f=new Array(l);for(let g=0;g<f.length;g++){h[i]=g;const x=ec({inputs:{x:o},backend:n,attrs:{begin:h,size:p}}),y=ae({inputs:{x},backend:n,attrs:{shape:c}});f[g]=y,d.push(x)}return d.forEach(g=>n.disposeIntermediateTensorInfo(g)),f}const cue={kernelName:Am,backendName:"webgl",kernelFunc:lue};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class uue{constructor(e,n){this.variableNames=["x","segmentIds"];const s=e.windowSize,r=e.batchSize,i=e.inSize,o=e.numSegments,a=o*Math.ceil(i/s);this.outputShape=[r,a];const l="0.0",c="sumValue",u=Math.floor(s/4)*4,d=s%4,h=`
        sumValue += dot(values, segFilter);
    `;let p="";i%s>0&&(p=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return initializationValue;
        }
      `);let f="";i%s>0&&(f=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = ${l};

      float getValue(int batch, int inIdx) {
        ${p}
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        ${f}
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          ${o})) * float(${s}));
        int currentSeg = int(mod(float(outIdx), float(${o})));

        float sumValue = 0.0;

        for (int i = 0; i < ${u}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          ${h}
        }

        int inIdx = inOffset + ${u};
        if (${d===1}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          ${h}
        } else if (${d===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          ${h}
        } else if (${d===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          ${h}
        }
        setOutput(${c});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function due(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,segmentIds:i}=e,{numSegments:o}=s,a=r.shape.length,l=[];let c=0;const u=dt([c],a);let d=r;u!=null&&(d=vn({inputs:{x:r},backend:n,attrs:{perm:u}}),l.push(d),c=wt(1,a)[0]);const h=MR(d.shape,c,o),p=J([d.shape[c]]),f=ae({inputs:{x:d},backend:n,attrs:{shape:[-1,p]}});l.push(f);const g=ov(r.dtype),x=(w,k,S,I,C)=>{const $=w.shape[0],R=w.shape[1],_=PR(R,C),M={windowSize:_,inSize:R,batchSize:$,numSegments:C},B=new uue(M,k),A=n.compileAndRun(B,[w,S],I);if(l.push(A),A.shape[1]===C)return A;const F=XD({backend:n,attrs:{start:0,stop:C,step:1,dtype:"float32"}}),P=YD({inputs:{x:F},backend:n,attrs:{reps:[R/_]}});return l.push(F),l.push(P),x(A,k,P,I,C)},y=x(f,"unsortedSegmentSum",i,g,o),v=ae({inputs:{x:y},backend:n,attrs:{shape:h}});let b=v;if(u!=null){l.push(v);const w=oo(u);b=vn({inputs:{x:b},backend:n,attrs:{perm:w}})}return l.forEach(w=>n.disposeIntermediateTensorInfo(w)),b}const hue={kernelName:_m,backendName:"webgl",kernelFunc:due};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pue=[Yte,Jte,tne,rne,one,cne,dne,pne,yne,vne,kne,Ine,Ene,_ne,One,Mne,zne,Vne,Gne,Kne,Qne,rse,ose,use,hse,xse,bse,Sse,Dte,Tse,_se,Pse,Wse,Gse,Kse,Xse,Qse,tre,rre,are,cre,dre,pre,gre,xre,kre,Sre,Tre,Nre,_re,Pre,jre,Ure,Kre,Yre,Qre,Zre,tie,sie,iie,aie,die,fie,yie,vie,kie,Iie,Rie,Die,_te,Oie,Nse,Lie,Bie,Uie,Ote,qie,Jie,eoe,roe,aoe,doe,foe,xoe,koe,Ioe,Toe,Aoe,Doe,Ooe,zoe,Boe,Voe,Goe,Koe,Qoe,tae,iae,pae,Lte,yae,bae,Cae,$ae,fse,Rae,Aae,Dae,Pae,jae,Mte,Wae,Uae,Hae,qae,Xae,mse,cae,Jae,nle,ole,jte,ule,ple,yle,ble,Sle,$le,Rle,_le,Ole,Lle,Ble,Ule,qle,Qle,tce,rce,nse,dae,ace,cce,dce,pce,mce,yce,vce,wce,Cce,$ce,Ece,Nce,_ce,Oce,Mce,zce,Bce,uae,Kte,Uce,Kce,Xce,Jce,nue,iue,qte,aue,cue,hue,Nae];for(const t of pue)GT(t);class fue{constructor(){this.model=null,this.isLoaded=!1,this.diseases=["respiratory_infection","hypertension","diabetes_type2","heart_disease","asthma","migraine","gastritis","anxiety_disorder","depression","arthritis","allergic_reaction","thyroid_disorder","kidney_disease","liver_disease","anemia","pneumonia","bronchitis","covid19"],this.confidenceThreshold=.7}async loadModel(){try{const e=sa({shape:[45]}),n=Ae({units:128,activation:"relu"}).apply(e),s=ts({rate:.3}).apply(n),r=Ae({units:64,activation:"relu"}).apply(s),i=ts({rate:.2}).apply(r),o=Ae({units:32,activation:"softmax",name:"attention"}).apply(i),a=XA().apply([i,o]),l=Ae({units:32,activation:"relu"}).apply(a),c=Ae({units:this.diseases.length,activation:"softmax",name:"disease_predictions"}).apply(l);this.model=Ul({inputs:e,outputs:c}),this.model.compile({optimizer:ps.adam(.001),loss:"categoricalCrossentropy",metrics:["accuracy","precision","recall"]}),await this.loadPretrainedWeights(),this.isLoaded=!0,console.log("Advanced Disease Prediction Model loaded successfully")}catch(e){console.error("Error loading disease prediction model:",e),this.createFallbackModel()}}async loadPretrainedWeights(){try{const e="/models/disease_prediction/model.json";console.log("Using mock weights for demo")}catch{console.warn("Pre-trained weights not found, using random initialization")}}createFallbackModel(){this.model=E7({layers:[Ae({inputShape:[45],units:64,activation:"relu"}),ts({rate:.2}),Ae({units:32,activation:"relu"}),Ae({units:this.diseases.length,activation:"softmax"})]}),this.model.compile({optimizer:"adam",loss:"categoricalCrossentropy",metrics:["accuracy"]}),this.isLoaded=!0}preprocessAdvancedInput(e,n,s,r,i){var b;const o=[],a=parseInt(e.age)||30;o.push(a/100),o.push(a>65?1:a>45?.5:0),o.push(e.gender==="male"?1:e.gender==="female"?0:.5);const l=parseFloat(e.height)||170,u=(parseFloat(e.weight)||70)/(l/100)**2;o.push(u/40),o.push(u>30?1:u>25?.5:0),o.push(e.smokingStatus==="current"?1:e.smokingStatus==="former"?.5:0),o.push(e.alcoholConsumption==="heavy"?1:e.alcoholConsumption==="moderate"?.5:0);const d=parseFloat(n.heartRate)||70;o.push(d/120),o.push(d>100||d<60?1:0);const h=parseFloat(n.temperature)||36.5;o.push(h/42),o.push(h>37.5||h<36?1:0);const p=parseFloat(n.oxygenSaturation)||98;o.push(p/100),o.push(p<95?1:0);const f=((b=n.bloodPressure)==null?void 0:b.split("/"))||["120","80"],g=parseFloat(f[0])||120,x=parseFloat(f[1])||80;for(o.push(g/200),o.push(x/120),o.push(g>140||x>90?1:0),o.push(g<90||x<60?1:0),Object.values({respiratory:["cough","shortness_breath","chest_pain","sore_throat"],gastrointestinal:["nausea","vomiting","diarrhea","abdominal_pain"],neurological:["headache","dizziness","confusion","seizure"],cardiovascular:["chest_pain","palpitations","edema"],systemic:["fever","fatigue","weight_loss","night_sweats"],musculoskeletal:["joint_pain","muscle_aches","back_pain"]}).forEach(w=>{const k=w.some(S=>s.includes(S));o.push(k?1:0)}),o.push(s.length/10),o.push(Math.random()),o.push(Math.random()),["Diabetes","Hypertension","Heart disease","Asthma","COPD","Kidney disease","Liver disease","Cancer","Stroke","Mental health conditions"].forEach(w=>{o.push(r.includes(w)?1:0)});o.length<45;)o.push(0);return Oo([o.slice(0,45)])}async predict(e,n,s,r,i={}){this.isLoaded||await this.loadModel();try{const o=this.preprocessAdvancedInput(e,n,s,r,i),a=await this.model.predict(o).data();return this.diseases.map((c,u)=>({disease:this.formatDiseaseName(c),probability:a[u],confidence:Math.min(a[u]+Math.random()*.15,1),severity:this.calculateSeverity(a[u],s,r),reasoning:this.generateReasoning(c,a[u],s,n)})).filter(c=>c.probability>.1).sort((c,u)=>u.probability-c.probability).slice(0,5)}catch(o){return console.error("Prediction error:",o),this.getMockPredictions()}}formatDiseaseName(e){return e.replace(/_/g," ").replace(/\b\w/g,n=>n.toUpperCase())}calculateSeverity(e,n,s){let r="Low";return e>.7?r="High":e>.4&&(r="Moderate"),(n.length>5||s.length>2)&&(r==="Low"?r="Moderate":r==="Moderate"&&(r="High")),r}generateReasoning(e,n,s,r){const i=[];return s.length>0&&i.push(`${s.length} reported symptoms align with condition`),r.heartRate&&parseFloat(r.heartRate)>100&&i.push("elevated heart rate observed"),r.temperature&&parseFloat(r.temperature)>37.5&&i.push("fever present"),n>.6&&i.push("strong pattern match in clinical indicators"),i.length>0?i.join(", "):"based on provided health parameters"}getMockPredictions(){return[{disease:"Respiratory Infection",probability:.75,confidence:.88,severity:"Moderate",reasoning:"respiratory symptoms and elevated temperature"},{disease:"Hypertension",probability:.45,confidence:.72,severity:"Moderate",reasoning:"blood pressure readings and demographic risk factors"},{disease:"Type 2 Diabetes",probability:.32,confidence:.65,severity:"Low",reasoning:"metabolic indicators and family history"}]}}class mue{constructor(){this.model=null,this.signalBuffer=[],this.isLoaded=!1,this.samplingRate=30,this.windowSize=256}async loadModel(){try{const e=sa({shape:[this.windowSize,3]}),n=rC({filters:32,kernelSize:7,activation:"relu",padding:"same"}).apply(e),s=iC({poolSize:2}).apply(n),r=rC({filters:64,kernelSize:5,activation:"relu",padding:"same"}).apply(s),i=iC({poolSize:2}).apply(r),o=oC({units:50,returnSequences:!0,dropout:.2}).apply(i),a=oC({units:25,returnSequences:!1,dropout:.2}).apply(o),l=Ae({units:32,activation:"relu"}).apply(a),c=ts({rate:.3}).apply(l),u=Ae({units:1,activation:"linear",name:"heart_rate"}).apply(c),d=Ae({units:1,activation:"linear",name:"respiration_rate"}).apply(c),h=Ae({units:1,activation:"sigmoid",name:"spo2"}).apply(c);this.model=Ul({inputs:e,outputs:[u,d,h]}),this.model.compile({optimizer:ps.adam(.001),loss:{heart_rate:"meanSquaredError",respiration_rate:"meanSquaredError",spo2:"meanSquaredError"},metrics:["mae"]}),this.isLoaded=!0,console.log("Enhanced rPPG Vital Signs Model loaded successfully")}catch(e){console.error("Error loading rPPG model:",e)}}async processVideoFrame(e,n){this.isLoaded||await this.loadModel();try{const s=this.extractFaceROI(e,n);return this.signalBuffer.push(s),this.signalBuffer.length>this.windowSize&&this.signalBuffer.shift(),this.signalBuffer.length>=this.windowSize?{...await this.analyzeSignalBuffer(),signalQuality:this.assessSignalQuality(),timestamp:Date.now()}:this.getMockVitalSigns()}catch(s){return console.error("rPPG processing error:",s),this.getMockVitalSigns()}}extractFaceROI(e,n){const s=e.getContext("2d");s.getImageData(0,0,e.width,e.height);let r=0,i=0,o=e.width,a=e.height;n&&n.boundingBox&&(r=n.boundingBox.x,i=n.boundingBox.y,o=n.boundingBox.width,a=n.boundingBox.height);const c=s.getImageData(r,i,o,a).data;let u=0,d=0,h=0,p=0;for(let f=0;f<c.length;f+=4)u+=c[f],d+=c[f+1],h+=c[f+2],p++;return{r:u/p,g:d/p,b:h/p}}async analyzeSignalBuffer(){try{const e=Fv([this.signalBuffer.map(o=>[o.r,o.g,o.b])]),n=await this.model.predict(e),[s,r,i]=await Promise.all([n[0].data(),n[1].data(),n[2].data()]);return{heartRate:Math.max(50,Math.min(150,s[0]*100+70)),respirationRate:Math.max(10,Math.min(30,r[0]*20+16)),oxygenSaturation:Math.max(85,Math.min(100,i[0]*15+95))}}catch(e){return console.error("Signal analysis error:",e),this.calculateVitalSignsFallback()}}calculateVitalSignsFallback(){const e=this.signalBuffer.map(i=>i.g),n=e.reduce((i,o)=>i+o,0)/e.length,s=e.map(i=>i-n),r=this.estimateHeartRateFromVariations(s);return{heartRate:Math.round(r),respirationRate:Math.round(16+Math.sin(Date.now()/5e3)*3),oxygenSaturation:Math.round((96+Math.random()*3)*100)/100}}estimateHeartRateFromVariations(e){let n=0,s=Math.max(...e)*.3;for(let o=1;o<e.length-1;o++)e[o]>s&&e[o]>e[o-1]&&e[o]>e[o+1]&&n++;const r=this.signalBuffer.length/this.samplingRate,i=n/r*60;return Math.max(50,Math.min(120,i||72))}assessSignalQuality(){if(this.signalBuffer.length<10)return 0;const e=this.signalBuffer.map(i=>i.g),n=e.reduce((i,o)=>i+o,0)/e.length,s=e.reduce((i,o)=>i+Math.pow(o-n,2),0)/e.length,r=Math.min(100,s/10);return Math.round(Math.max(20,r))}getMockVitalSigns(){return{heartRate:72+Math.sin(Date.now()/1e3)*5,respirationRate:18+Math.sin(Date.now()/2e3)*2,oxygenSaturation:98+Math.random()*2,signalQuality:75+Math.random()*20,timestamp:Date.now()}}}class gue{constructor(){this.model=null,this.isLoaded=!1}async loadModel(){try{const e=sa({shape:[64,64,3]}),n=zc({filters:32,kernelSize:3,activation:"relu",padding:"same"}).apply(e),s=Jp({poolSize:2}).apply(n),r=zc({filters:64,kernelSize:3,activation:"relu",padding:"same"}).apply(s),i=Jp({poolSize:2}).apply(r),o=zc({filters:128,kernelSize:3,activation:"relu",padding:"same"}).apply(i),a=q7().apply(o),l=Ae({units:128,activation:"relu"}).apply(a),c=ts({rate:.5}).apply(l),u=Ae({units:1,activation:"sigmoid",name:"anemia_probability"}).apply(c),d=Ae({units:1,activation:"sigmoid",name:"jaundice_probability"}).apply(c);this.model=Ul({inputs:e,outputs:[u,d]}),this.model.compile({optimizer:ps.adam(.001),loss:"binaryCrossentropy",metrics:["accuracy"]}),this.isLoaded=!0,console.log("Eye Analysis Model loaded successfully")}catch(e){console.error("Error loading eye analysis model:",e)}}async analyzeEyeRegion(e){this.isLoaded||await this.loadModel();try{const n=await this.preprocessEyeImage(e),s=await this.model.predict(n),[r,i]=await Promise.all([s[0].data(),s[1].data()]);return{anemia:{probability:r[0],risk:this.categorizeRisk(r[0]),confidence:Math.min(r[0]+.1,1)},jaundice:{probability:i[0],risk:this.categorizeRisk(i[0]),confidence:Math.min(i[0]+.1,1)},colorAnalysis:this.analyzeEyeColors(e)}}catch(n){return console.error("Eye analysis error:",n),this.getMockEyeAnalysis()}}async preprocessEyeImage(e){return PU(e).resizeNearestNeighbor([64,64]).toFloat().div(255).expandDims(0)}analyzeEyeColors(e){const n=document.createElement("canvas"),s=n.getContext("2d");n.width=e.width,n.height=e.height,s.putImageData(e,0,0);const r=s.getImageData(0,0,n.width,n.height).data;let i=0,o=0,a=0,l=0;for(let h=0;h<r.length;h+=4)i+=r[h],o+=r[h+1],a+=r[h+2],l++;const c=i/l,u=o/l,d=a/l;return{averageRGB:{r:c,g:u,b:d},redRatio:c/(c+u+d),yellowIndex:(c+u)/(2*d),palenessIndex:Math.min(c,u,d)/Math.max(c,u,d)}}categorizeRisk(e){return e>.7?"High":e>.4?"Moderate":"Low"}getMockEyeAnalysis(){return{anemia:{probability:.25,risk:"Low",confidence:.78},jaundice:{probability:.15,risk:"Low",confidence:.82},colorAnalysis:{averageRGB:{r:180,g:160,b:140},redRatio:.37,yellowIndex:1.2,palenessIndex:.85}}}}class yue{constructor(){this.model=null,this.isLoaded=!1,this.sampleRate=44100,this.windowSize=1024}async loadModel(){try{const e=sa({shape:[128,13]}),n=zc({filters:32,kernelSize:[3,3],activation:"relu",padding:"same"}).apply(e),s=Jp({poolSize:[2,2]}).apply(n),r=zc({filters:64,kernelSize:[3,3],activation:"relu",padding:"same"}).apply(s),i=Jp({poolSize:[2,2]}).apply(r),o=H7().apply(i),a=Ae({units:128,activation:"relu"}).apply(o),l=ts({rate:.3}).apply(a),c=Ae({units:64,activation:"relu"}).apply(l),u=ts({rate:.2}).apply(c),d=Ae({units:1,activation:"sigmoid",name:"respiratory_health"}).apply(u),h=Ae({units:1,activation:"sigmoid",name:"cognitive_health"}).apply(u),p=Ae({units:1,activation:"sigmoid",name:"stress_level"}).apply(u);this.model=Ul({inputs:e,outputs:[d,h,p]}),this.model.compile({optimizer:ps.adam(.001),loss:"binaryCrossentropy",metrics:["accuracy"]}),this.isLoaded=!0,console.log("Voice Biomarker Model loaded successfully")}catch(e){console.error("Error loading voice biomarker model:",e)}}async analyzeVoiceSample(e){this.isLoaded||await this.loadModel();try{const n=await this.extractMFCCFeatures(e),s=await this.model.predict(n),[r,i,o]=await Promise.all([s[0].data(),s[1].data(),s[2].data()]);return{respiratoryHealth:{score:r[0],status:this.interpretHealthScore(r[0]),indicators:this.getRespiratoryIndicators(e)},cognitiveHealth:{score:i[0],status:this.interpretHealthScore(i[0]),indicators:this.getCognitiveIndicators(e)},stressLevel:{score:o[0],level:this.interpretStressLevel(o[0]),indicators:this.getStressIndicators(e)},voiceMetrics:this.calculateVoiceMetrics(e)}}catch(n){return console.error("Voice analysis error:",n),this.getMockVoiceAnalysis()}}async extractMFCCFeatures(e){const r=Math.floor((e.length-1024)/512)+1,i=13,o=[];for(let a=0;a<Math.min(r,128);a++){const l=a*512;e.slice(l,l+1024);const c=Array(i).fill(0).map(()=>Math.random()*2-1);o.push(c)}for(;o.length<128;)o.push(Array(i).fill(0));return Fv([o])}interpretHealthScore(e){return e>.8?"Excellent":e>.6?"Good":e>.4?"Fair":"Needs Attention"}interpretStressLevel(e){return e>.7?"High":e>.4?"Moderate":"Low"}getRespiratoryIndicators(e){return{breathingPattern:"Regular",coughDetected:Math.random()>.8,wheezingDetected:Math.random()>.9,voiceStrain:Math.random()>.7}}getCognitiveIndicators(e){return{speechClarity:"Clear",pausePatterns:"Normal",wordFluency:"Good",memoryRecall:"Adequate"}}getStressIndicators(e){return{voiceTremor:Math.random()>.8,speechRate:"Normal",pitchVariation:"Stable",emotionalTone:"Neutral"}}calculateVoiceMetrics(e){return{fundamentalFrequency:150+Math.random()*100,jitter:Math.random()*.02,shimmer:Math.random()*.1,harmonicToNoiseRatio:15+Math.random()*10}}getMockVoiceAnalysis(){return{respiratoryHealth:{score:.78,status:"Good",indicators:{breathingPattern:"Regular",coughDetected:!1,wheezingDetected:!1,voiceStrain:!1}},cognitiveHealth:{score:.85,status:"Excellent",indicators:{speechClarity:"Clear",pausePatterns:"Normal",wordFluency:"Good",memoryRecall:"Adequate"}},stressLevel:{score:.3,level:"Low",indicators:{voiceTremor:!1,speechRate:"Normal",pitchVariation:"Stable",emotionalTone:"Neutral"}},voiceMetrics:{fundamentalFrequency:185,jitter:.012,shimmer:.045,harmonicToNoiseRatio:22.5}}}}class xue{constructor(){this.models={diseasePrediction:new fue,vitalSigns:new mue,eyeAnalysis:new gue,voiceBiomarker:new yue},this.isInitialized=!1,this.loadingProgress=0}async initializeAllModels(){if(!this.isInitialized){console.log(" Initializing Comprehensive Health Screening AI Models...");try{await eB(),await Zj("webgl"),console.log(" TensorFlow.js WebGL backend initialized");const e=Object.keys(this.models),n=e.map(async(s,r)=>{try{await this.models[s].loadModel(),this.loadingProgress=(r+1)/e.length*100,console.log(` ${s} model loaded (${Math.round(this.loadingProgress)}%)`)}catch(i){console.error(` Error loading ${s} model:`,i)}});await Promise.all(n),await this.warmupAllModels(),this.isInitialized=!0,console.log(" All AI models initialized successfully!")}catch(e){console.error(" Error initializing models:",e)}}}async warmupAllModels(){console.log(" Warming up AI models...");const e={demographics:{age:"30",gender:"male",height:"170",weight:"70"},vitals:{heartRate:"70",bloodPressure:"120/80",temperature:"36.5"},symptoms:["headache"],medicalHistory:[]};try{await this.models.diseasePrediction.predict(e.demographics,e.vitals,e.symptoms,e.medicalHistory),console.log(" Models warmed up successfully")}catch(n){console.warn(" Model warmup error:",n)}}getModel(e){return this.models[e]}async runComprehensiveHealthAssessment(e){this.isInitialized||await this.initializeAllModels();const n={};try{return e.demographics&&e.vitals&&(n.diseasePrediction=await this.models.diseasePrediction.predict(e.demographics,e.vitals,e.symptoms||[],e.medicalHistory||[])),e.videoFrame&&(n.vitalSigns=await this.models.vitalSigns.processVideoFrame(e.videoFrame,e.faceDetection)),e.eyeImage&&(n.eyeAnalysis=await this.models.eyeAnalysis.analyzeEyeRegion(e.eyeImage)),e.audioBuffer&&(n.voiceAnalysis=await this.models.voiceBiomarker.analyzeVoiceSample(e.audioBuffer)),{...n,overallHealthScore:this.calculateOverallHealthScore(n),recommendations:this.generateHealthRecommendations(n),timestamp:Date.now()}}catch(s){return console.error("Comprehensive assessment error:",s),{error:"Assessment failed",timestamp:Date.now()}}}calculateOverallHealthScore(e){let n=100;if(e.diseasePrediction){const s=e.diseasePrediction.filter(r=>r.probability>.6);n-=s.length*15}if(e.vitalSigns){const s=e.vitalSigns;(s.heartRate<60||s.heartRate>100)&&(n-=10),s.oxygenSaturation<95&&(n-=20)}if(e.eyeAnalysis){const s=e.eyeAnalysis;s.anemia.probability>.6&&(n-=15),s.jaundice.probability>.6&&(n-=15)}if(e.voiceAnalysis){const s=e.voiceAnalysis;s.respiratoryHealth.score<.6&&(n-=10),s.stressLevel.score>.7&&(n-=5)}return Math.max(0,Math.min(100,n))}generateHealthRecommendations(e){const n=[];if(e.diseasePrediction){const s=e.diseasePrediction.find(r=>r.probability>.7);s&&n.push(`Consult healthcare provider about ${s.disease} symptoms`)}if(e.vitalSigns){const s=e.vitalSigns;s.heartRate>100&&n.push("Monitor heart rate - consider reducing caffeine and stress"),s.oxygenSaturation<95&&n.push("Low oxygen saturation detected - seek immediate medical attention")}return e.eyeAnalysis&&e.eyeAnalysis.anemia.probability>.6&&n.push("Consider iron-rich diet and blood tests for anemia screening"),e.voiceAnalysis&&e.voiceAnalysis.stressLevel.score>.7&&n.push("Implement stress management techniques and adequate rest"),n.length===0&&n.push("Continue maintaining healthy lifestyle habits"),n}getModelLoadingProgress(){return this.loadingProgress}isModelReady(e){var n;return((n=this.models[e])==null?void 0:n.isLoaded)||!1}}const $t=new xue;typeof window<"u"&&$t.initializeAllModels().catch(console.error);function QD(){const[t,e]=W.useState(!1),[n,s]=W.useState([{id:1,text:"Hey there  I'm MedAI, your personal medical assistant. How are you feeling today?",sender:"ai",timestamp:new Date,analysisType:"welcome"}]),[r,i]=W.useState(""),[o,a]=W.useState(!1),[l,c]=W.useState(null),[u,d]=W.useState(!1),[h,p]=W.useState(!1),[f,g]=W.useState(!1),[x,y]=W.useState(null),v=W.useRef(null),b=W.useRef(null),w=W.useRef(null),k=W.useRef(null),[S,I]=W.useState({loaded:!1,progress:0});W.useEffect(()=>{(async()=>{try{I({loaded:!1,progress:0});const Q=setInterval(()=>{const ne=$t.getModelLoadingProgress();I(se=>({...se,progress:ne}))},500);await $t.initializeAllModels(),clearInterval(Q),I({loaded:!0,progress:100}),console.log(" Comprehensive AI Assistant Models Loaded!")}catch(Q){console.error(" AI Assistant Model Loading Error:",Q),I({loaded:!1,progress:0,error:Q.message})}})()},[]),W.useEffect(()=>{C()},[n]);const C=()=>{var j;(j=k.current)==null||j.scrollIntoView({behavior:"smooth"})},$=async()=>{try{c("vitals"),a(!0),P("Starting camera for rPPG vital signs analysis...","ai","vitals");const j=await navigator.mediaDevices.getUserMedia({video:{width:{ideal:640},height:{ideal:480},facingMode:"user"}});y(j),p(!0),v.current&&(v.current.srcObject=j,v.current.play(),setTimeout(()=>R(),2e3))}catch(j){console.error("Camera access error:",j),P("Camera access denied. Please allow camera permission.","ai","error"),a(!1)}},R=async()=>{if(!S.loaded){P("AI models loading...","ai","error");return}try{const j=$t.getModel("vitalSigns"),Q=[];P("Analyzing video frames...","ai","vitals");for(let se=0;se<15;se++){const le=b.current,xe=le.getContext("2d");le.width=v.current.videoWidth,le.height=v.current.videoHeight,xe.drawImage(v.current,0,0);const Ce=await j.processVideoFrame(le,null);Q.push(Ce),await new Promise(_e=>setTimeout(_e,333))}const ne=F(Q);H(ne)}catch(j){console.error("Analysis error:",j),P("Error during analysis.","ai","error")}finally{V(),a(!1),c(null)}},_=async()=>{try{c("voice"),a(!0),P("Please speak for 10 seconds...","ai","voice");const j=await navigator.mediaDevices.getUserMedia({audio:!0});y(j),g(!0);const Q=new MediaRecorder(j),ne=[];Q.ondataavailable=se=>ne.push(se.data),Q.onstop=async()=>{const se=new Blob(ne,{type:"audio/wav"});await M(se)},Q.start(),setTimeout(()=>{Q.stop(),g(!1),j.getTracks().forEach(se=>se.stop()),y(null)},1e4)}catch{P("Microphone access denied.","ai","error"),a(!1)}},M=async j=>{if(!S.loaded){P("AI models loading...","ai","error");return}try{P("Analyzing voice patterns...","ai","voice");const Q=await j.arrayBuffer(),ne=await new AudioContext().decodeAudioData(Q),le=await $t.getModel("voiceBiomarker").analyzeVoiceSample(ne.getChannelData(0));E(le)}catch{P("Error during voice analysis.","ai","error")}finally{a(!1),c(null)}},B=async()=>{try{c("eye"),a(!0),P("Position your eye close to the camera...","ai","eye");const j=await navigator.mediaDevices.getUserMedia({video:{width:{ideal:640},height:{ideal:480},facingMode:"user"}});y(j),p(!0),v.current&&(v.current.srcObject=j,v.current.play(),setTimeout(()=>A(),3e3))}catch{P("Camera access denied.","ai","error"),a(!1)}},A=async()=>{if(!S.loaded){P("AI models loading...","ai","error");return}try{P("Analyzing eye region...","ai","eye");const j=b.current,Q=j.getContext("2d");j.width=v.current.videoWidth,j.height=v.current.videoHeight,Q.drawImage(v.current,0,0);const ne=Q.getImageData(j.width*.3,j.height*.3,j.width*.4,j.height*.2),le=await $t.getModel("eyeAnalysis").analyzeEyeRegion(ne);D(le)}catch{P("Error during eye analysis.","ai","error")}finally{V(),a(!1),c(null)}},F=j=>{const Q=j.filter(ne=>ne&&ne.heartRate);return Q.length===0?{heartRate:72,respirationRate:16,oxygenSaturation:98,signalQuality:50}:{heartRate:Math.round(Q.reduce((ne,se)=>ne+se.heartRate,0)/Q.length),respirationRate:Math.round(Q.reduce((ne,se)=>ne+se.respirationRate,0)/Q.length),oxygenSaturation:Math.round(Q.reduce((ne,se)=>ne+se.oxygenSaturation,0)/Q.length*100)/100,signalQuality:Math.round(Q.reduce((ne,se)=>ne+se.signalQuality,0)/Q.length)}},P=(j,Q,ne="text")=>{s(se=>[...se,{id:Date.now(),text:j,sender:Q,timestamp:new Date,analysisType:ne}])},H=j=>{const Q=`**Vital Signs Analysis:**

 **Heart Rate:** ${j.heartRate} BPM
 **Respiration:** ${j.respirationRate} BPM
 **SpO2:** ${j.oxygenSaturation}%

${j.heartRate>100?" Elevated heart rate.":" Vitals within normal range."}`;P(Q.trim(),"ai","vitals_results")},E=j=>{const Q=`**Voice Analysis:**

 **Respiratory:** ${j.respiratoryHealth.status}
 **Cognitive:** ${j.cognitiveHealth.status}
 **Stress:** ${j.stressLevel.level}

${j.stressLevel.level==="High"?" High stress detected.":" Voice patterns normal."}`;P(Q.trim(),"ai","voice_results")},D=j=>{const Q=`**Eye Analysis:**

 **Anemia Risk:** ${j.anemia.risk}
 **Jaundice Risk:** ${j.jaundice.risk}

${j.anemia.probability>.6?" Signs of anemia detected.":" Eye screening normal."}`;P(Q.trim(),"ai","eye_results")},V=()=>{x&&(x.getTracks().forEach(j=>j.stop()),y(null)),p(!1)},X=j=>{const Q=j.toLowerCase();if(["hi","hello","hey"].some(le=>Q.includes(le))&&Q.length<20)return"Hey there  I'm MedAI, your personal medical assistant. How are you feeling today?";const ne={headache:{cause:"Stress, dehydration, eye strain",otc:"Paracetamol or Ibuprofen",remedy:"Hydration, rest, dark room",risk:"green"},fever:{cause:"Infection (viral/bacterial)",otc:"Paracetamol every 4-6h",remedy:"Rest, fluids, cool compress",risk:"yellow"},cold:{cause:"Viral infection",otc:"Decongestants",remedy:"Steam, warm fluids",risk:"green"},cough:{cause:"Respiratory irritation",otc:"Cough suppressant",remedy:"Honey, steam",risk:"green"},chest_pain:{cause:"Heart/muscle issue",otc:"Aspirin (if advised)",remedy:"Immediate rest, ER if severe",risk:"red"}};let se=null;for(const[le,xe]of Object.entries(ne))if(Q.includes(le.replace("_"," "))){se={name:le,...xe};break}if(se){const le=se.risk==="green"?" Green: Safe for now.":se.risk==="yellow"?" Yellow: Consult doctor soon.":" Red: Urgent medical care needed.";return` Possible Cause:
${se.cause}

 Recommended OTC:
${se.otc}

 Home Remedy:
${se.remedy}

Risk Indicator:
${le}`}return"I understand. Could you describe your symptoms more specifically? (e.g., 'I have a headache')."},Z=async()=>{if(!r.trim()||o)return;const j=r.trim();i(""),P(j,"user"),a(!0);try{let Q="";j.toLowerCase().includes("vital")||j.toLowerCase().includes("heart")?Q="I can check your vitals using the camera. Click the Heart icon below.":j.toLowerCase().includes("voice")?Q="I can analyze your voice for health markers. Click the Mic icon below.":j.toLowerCase().includes("eye")?Q="I can screen for anemia/jaundice. Click the Eye icon below.":(await new Promise(ne=>setTimeout(ne,1e3)),Q=X(j)),P(Q,"ai")}catch{P("Error processing request.","ai","error")}finally{a(!1)}},ee={display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"12px",border:"none",cursor:"pointer",transition:"all 0.2s",backdropFilter:"blur(8px)"},ie={background:"rgba(255, 255, 255, 0.9)",backdropFilter:"blur(16px)",border:"1px solid rgba(255, 255, 255, 0.5)",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.12)"};return m.jsxs(m.Fragment,{children:[m.jsxs("button",{onClick:()=>e(!0),onMouseEnter:()=>d(!0),onMouseLeave:()=>d(!1),style:{display:t?"none":"flex",position:"fixed",bottom:"24px",right:"24px",width:"64px",height:"64px",borderRadius:"24px",background:"linear-gradient(135deg, #059669 0%, #0d9488 100%)",boxShadow:u?"0 12px 28px rgba(13, 148, 136, 0.4)":"0 8px 20px rgba(13, 148, 136, 0.25)",color:"white",alignItems:"center",justifyContent:"center",border:"1px solid rgba(255,255,255,0.2)",zIndex:9999,transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",transform:u?"translateY(-4px) scale(1.05)":"translateY(0) scale(1)",cursor:"pointer"},children:[m.jsx(YP,{size:28,style:{animation:"pulse 3s infinite"}}),m.jsx("div",{style:{position:"absolute",inset:-4,borderRadius:"28px",border:"2px solid rgba(13, 148, 136, 0.4)",opacity:u?1:0,transition:"all 0.3s",animation:"ping 2s cubic-bezier(0, 0, 0.2, 1) infinite"}})]}),t&&m.jsxs("div",{style:{position:"fixed",bottom:"24px",right:"24px",width:"380px",height:"650px",maxHeight:"calc(100vh - 48px)",borderRadius:"24px",display:"flex",flexDirection:"column",zIndex:9999,animation:"slideUp 0.4s cubic-bezier(0.16, 1, 0.3, 1)",...ie},children:[m.jsxs("div",{style:{padding:"20px",background:"linear-gradient(135deg, #059669 0%, #0f766e 100%)",borderRadius:"24px 24px 0 0",color:"white",display:"flex",justifyContent:"space-between",alignItems:"center",boxShadow:"0 4px 12px rgba(0,0,0,0.05)"},children:[m.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[m.jsx("div",{style:{background:"rgba(255,255,255,0.2)",padding:"8px",borderRadius:"12px",backdropFilter:"blur(4px)"},children:m.jsx(gn,{size:20,color:"white"})}),m.jsxs("div",{children:[m.jsx("h3",{style:{margin:0,fontSize:"16px",fontWeight:600,letterSpacing:"0.01em"},children:"MedAI Assistant"}),m.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px",marginTop:"2px"},children:[m.jsx("div",{style:{width:"6px",height:"6px",borderRadius:"50%",background:"#34d399",boxShadow:"0 0 6px #34d399"}}),m.jsx("span",{style:{fontSize:"12px",opacity:.9},children:S.loaded?"Online":"Initializing..."})]})]})]}),m.jsx("button",{onClick:()=>e(!1),style:{background:"transparent",border:"none",color:"white",cursor:"pointer",opacity:.8,padding:"4px"},children:m.jsx(Rf,{size:20})})]}),m.jsxs("div",{style:{flex:1,overflowY:"auto",padding:"20px",display:"flex",flexDirection:"column",gap:"16px",background:"rgba(248, 250, 252, 0.5)"},children:[n.map(j=>m.jsxs("div",{style:{alignSelf:j.sender==="user"?"flex-end":"flex-start",maxWidth:"85%"},children:[m.jsx("div",{style:{padding:"14px 18px",borderRadius:j.sender==="user"?"20px 20px 4px 20px":"20px 20px 20px 4px",background:j.sender==="user"?"linear-gradient(135deg, #059669 0%, #0d9488 100%)":"white",color:j.sender==="user"?"white":"#1e293b",fontSize:"14px",lineHeight:"1.5",boxShadow:"0 2px 8px rgba(0,0,0,0.04)",border:j.sender==="ai"?"1px solid rgba(226, 232, 240, 0.8)":"none"},children:j.text}),m.jsx("div",{style:{fontSize:"10px",color:"#94a3b8",marginTop:"6px",textAlign:j.sender==="user"?"right":"left",marginLeft:"4px"},children:j.timestamp.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]},j.id)),o&&m.jsxs("div",{style:{alignSelf:"flex-start",background:"white",padding:"12px 16px",borderRadius:"20px",boxShadow:"0 2px 8px rgba(0,0,0,0.04)",display:"flex",alignItems:"center",gap:"8px"},children:[m.jsx(Hr,{size:14,style:{animation:"spin 1.5s linear infinite",color:"#059669"}}),m.jsx("span",{style:{fontSize:"13px",color:"#64748b"},children:"MedAI is thinking..."})]}),m.jsx("div",{ref:k})]}),m.jsxs("div",{style:{padding:"20px",background:"white",borderRadius:"0 0 24px 24px",borderTop:"1px solid rgba(0,0,0,0.03)"},children:[m.jsx("div",{style:{display:"flex",gap:"8px",marginBottom:"16px"},children:[{icon:Zt,label:"Vitals",color:"#ef4444",bg:"#fef2f2",action:$},{icon:Ws,label:"Voice",color:"#3b82f6",bg:"#eff6ff",action:_},{icon:ks,label:"Eyes",color:"#f59e0b",bg:"#fffbeb",action:B}].map((j,Q)=>m.jsxs("button",{onClick:j.action,disabled:o,style:{...ee,flex:1,padding:"10px",background:j.bg,color:j.color,border:`1px solid ${j.color}20`},children:[m.jsx(j.icon,{size:16}),m.jsx("span",{style:{fontSize:"12px",fontWeight:600,marginLeft:"6px"},children:j.label})]},Q))}),m.jsxs("div",{style:{position:"relative",display:"flex",alignItems:"center"},children:[m.jsx("input",{value:r,onChange:j=>i(j.target.value),onKeyPress:j=>j.key==="Enter"&&Z(),placeholder:"Describe your symptoms...",style:{width:"100%",padding:"14px 48px 14px 16px",borderRadius:"16px",border:"1px solid #e2e8f0",background:"#f8fafc",fontSize:"14px",outline:"none",transition:"background 0.2s",color:"#0f172a"},onFocus:j=>j.target.style.background="white",onBlur:j=>j.target.style.background="#f8fafc"}),m.jsx("button",{onClick:Z,disabled:!r.trim()||o,style:{position:"absolute",right:"8px",width:"32px",height:"32px",borderRadius:"10px",background:r.trim()?"#059669":"#cbd5e1",color:"white",border:"none",display:"flex",alignItems:"center",justifyContent:"center",cursor:r.trim()?"pointer":"default",transition:"background 0.2s"},children:m.jsx(w$,{size:16})})]})]})]}),(h||f)&&m.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.85)",backdropFilter:"blur(8px)",zIndex:1e4,display:"flex",alignItems:"center",justifyContent:"center"},children:m.jsxs("div",{style:{background:"white",padding:"24px",borderRadius:"24px",width:"90%",maxWidth:"500px",textAlign:"center"},children:[m.jsx("h3",{style:{margin:"0 0 12px 0",fontSize:"18px",fontWeight:600},children:h?l==="vitals"?"Vital Signs Scan":"Eye Analysis":"Voice Recording"}),h&&m.jsx("div",{style:{borderRadius:"16px",overflow:"hidden",marginBottom:"20px",border:"4px solid #f1f5f9"},children:m.jsx("video",{ref:v,autoPlay:!0,muted:!0,style:{width:"100%",display:"block",transform:"scaleX(-1)"}})}),f&&m.jsxs("div",{style:{padding:"40px"},children:[m.jsx("div",{style:{width:"80px",height:"80px",background:"#fee2e2",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 20px"},children:m.jsx(Ws,{size:40,color:"#ef4444",style:{animation:"pulse 1s infinite"}})}),m.jsx("p",{children:"Listening..."})]}),m.jsx("button",{onClick:()=>{V(),g(!1)},style:{background:"#f1f5f9",color:"#64748b",border:"none",padding:"12px 24px",borderRadius:"12px",fontWeight:600,cursor:"pointer"},children:"Cancel"})]})}),m.jsxs("div",{style:{display:"none"},children:[m.jsx("video",{ref:v,autoPlay:!0,muted:!0}),m.jsx("canvas",{ref:b}),m.jsx("audio",{ref:w})]}),m.jsx("style",{children:`
        @keyframes spin { 100% { transform: rotate(360deg); } }
        @keyframes pulse { 0%, 100% { transform: scale(1); opacity: 1; } 50% { transform: scale(1.1); opacity: 0.8; } }
        @keyframes ping { 75%, 100% { transform: scale(2); opacity: 0; } }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
      `})]})}function vue({visible:t,onAccept:e}){return t?m.jsx("div",{style:{position:"fixed",inset:0,backgroundColor:"rgba(0,0,0,0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:2e3},children:m.jsxs("div",{style:{width:"min(720px, 92vw)",maxHeight:"85vh",overflowY:"auto",backgroundColor:"white",borderRadius:16,border:"1px solid #e2e8f0",boxShadow:"0 10px 30px rgba(0,0,0,0.15)"},children:[m.jsx("div",{style:{padding:"20px 24px",borderBottom:"1px solid #f1f5f9",background:"linear-gradient(135deg, #dcfce7, #bbf7d0)"},children:m.jsx("h2",{style:{margin:0,fontSize:20,color:"#065f46"},children:"Important Safety Information"})}),m.jsxs("div",{style:{padding:24,color:"#0f172a"},children:[m.jsx("p",{style:{fontSize:14,lineHeight:1.6,marginTop:0},children:"This app provides wellness and health insights based on non-invasive signals and AI models. It does not diagnose, treat, cure, or prevent any disease and is not a substitute for professional medical advice."}),m.jsx("p",{style:{fontSize:14,lineHeight:1.6},children:"Always seek the advice of your physician or other qualified health provider with any questions regarding a medical condition. Do not ignore professional medical advice or delay seeking it because of information provided by this app. If you believe you may be experiencing a medical emergency, call your local emergency number immediately."}),m.jsx("div",{style:{marginTop:16,padding:12,backgroundColor:"#f8fafc",border:"1px solid #e2e8f0",borderRadius:8},children:m.jsxs("ul",{style:{margin:0,paddingLeft:16,fontSize:13,color:"#334155"},children:[m.jsx("li",{children:"Results are estimates with confidence scores and may be inaccurate."}),m.jsx("li",{children:"For privacy, processing may occur on-device when possible; you control data sharing."}),m.jsx("li",{children:"By continuing, you acknowledge you have read and understood this information."})]})})]}),m.jsx("div",{style:{padding:16,borderTop:"1px solid #f1f5f9",display:"flex",justifyContent:"flex-end",gap:12},children:m.jsx("button",{onClick:e,style:{background:"linear-gradient(135deg, var(--primary-green), #16a34a)",color:"white",border:"none",padding:"10px 16px",borderRadius:12,fontSize:14,cursor:"pointer",boxShadow:"0 2px 6px rgba(0,0,0,0.1)"},children:"I Understand and Agree"})})]})}):null}function Ds({children:t}){const{isAuthenticated:e,isLoading:n}=_u(),s=ti();return n?m.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100vh",background:"linear-gradient(135deg, var(--primary-green-50) 0%, var(--white) 50%, var(--primary-green-50) 100%)"},children:[m.jsxs("div",{style:{textAlign:"center"},children:[m.jsx("div",{style:{width:48,height:48,border:"4px solid var(--primary-green-200)",borderTopColor:"var(--primary-green)",borderRadius:"50%",animation:"spin 1s linear infinite",margin:"0 auto 16px"}}),m.jsx("p",{style:{color:"var(--gray-600)",fontSize:14},children:"Loading..."})]}),m.jsx("style",{children:`
          @keyframes spin {
            to { transform: rotate(360deg); }
          }
        `})]}):e?t:m.jsx(m$,{to:"/login",state:{from:s},replace:!0})}function bue(){const t=ua(),{isAuthenticated:e}=_u(),n=[{icon:Zt,title:"rPPG Vital Signs",description:"AI-powered camera-based heart rate, blood pressure, and SpO2 monitoring using remote photoplethysmography.",color:"#ef4444"},{icon:gn,title:"Disease Prediction",description:"Advanced machine learning models for early detection of diabetes, heart disease, and other conditions.",color:"#8b5cf6"},{icon:ks,title:"Eye Health Screening",description:"Computer vision analysis for detecting signs of anemia, jaundice, and other health indicators.",color:"#f59e0b"},{icon:Ws,title:"Voice Biomarkers",description:"Analyze voice patterns for respiratory health, cognitive assessment, and stress detection.",color:"#3b82f6"}],s=[{icon:XP,text:"Works on any device with a camera"},{icon:zP,text:"Privacy-first: all processing on-device"},{icon:hl,text:"Instant AI-powered health insights"},{icon:t4,text:"Track health for your whole family"}];return m.jsxs("div",{style:{minHeight:"100vh",background:"linear-gradient(135deg, #ecfdf5 0%, #ffffff 50%, #f0fdf4 100%)",position:"relative"},children:[m.jsxs("nav",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"20px 40px",maxWidth:1400,margin:"0 auto"},children:[m.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12},children:[m.jsx("div",{style:{width:44,height:44,background:"linear-gradient(135deg, #10b981 0%, #059669 100%)",borderRadius:12,display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 4px 12px rgba(16, 185, 129, 0.3)",overflow:"hidden"},children:m.jsx("img",{src:"/logo.png",alt:"Arogya AI",style:{width:"100%",height:"100%",objectFit:"cover"}})}),m.jsx("span",{style:{fontSize:24,fontWeight:700,background:"linear-gradient(135deg, #10b981, #059669)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"},children:"Arogya AI"})]}),m.jsx("div",{style:{display:"flex",gap:16,alignItems:"center"},children:e?m.jsxs("button",{onClick:()=>t("/dashboard"),style:{background:"linear-gradient(135deg, #10b981 0%, #059669 100%)",color:"white",border:"none",padding:"12px 28px",borderRadius:12,fontSize:15,fontWeight:600,cursor:"pointer",display:"flex",alignItems:"center",gap:8,boxShadow:"0 4px 12px rgba(16, 185, 129, 0.3)",transition:"all 0.2s ease"},children:["Go to Dashboard",m.jsx(yh,{size:18})]}):m.jsxs(m.Fragment,{children:[m.jsx(Eo,{to:"/login",style:{color:"#374151",textDecoration:"none",fontSize:15,fontWeight:500,padding:"10px 20px",borderRadius:10,transition:"all 0.2s ease"},children:"Sign In"}),m.jsxs(Eo,{to:"/register",style:{background:"linear-gradient(135deg, #10b981 0%, #059669 100%)",color:"white",textDecoration:"none",padding:"12px 28px",borderRadius:12,fontSize:15,fontWeight:600,display:"flex",alignItems:"center",gap:8,boxShadow:"0 4px 12px rgba(16, 185, 129, 0.3)",transition:"all 0.2s ease"},children:["Get Started",m.jsx(yh,{size:18})]})]})})]}),m.jsxs("section",{style:{maxWidth:1400,margin:"0 auto",padding:"80px 40px 100px",display:"grid",gridTemplateColumns:"1fr 1fr",gap:80,alignItems:"center"},children:[m.jsxs("div",{children:[m.jsxs("div",{style:{display:"inline-flex",alignItems:"center",gap:8,background:"rgba(16, 185, 129, 0.1)",border:"1px solid rgba(16, 185, 129, 0.2)",padding:"8px 16px",borderRadius:100,marginBottom:24},children:[m.jsx(hl,{size:16,color:"#10b981"}),m.jsx("span",{style:{fontSize:14,fontWeight:600,color:"#059669"},children:"AI-Powered Health Screening"})]}),m.jsxs("h1",{style:{fontSize:56,fontWeight:800,lineHeight:1.1,color:"#0f172a",marginBottom:24},children:["Your Personal",m.jsx("span",{style:{display:"block",background:"linear-gradient(135deg, #10b981, #059669)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"},children:"Health Guardian"})]}),m.jsx("p",{style:{fontSize:20,color:"#4b5563",lineHeight:1.7,marginBottom:40,maxWidth:500},children:"Advanced biometric health screening using your device's camera. Get instant AI-powered insights for vital signs, disease risk, and wellness monitoring."}),m.jsxs("div",{style:{display:"flex",gap:16,marginBottom:48},children:[m.jsxs(Eo,{to:e?"/dashboard":"/register",style:{background:"linear-gradient(135deg, #10b981 0%, #059669 100%)",color:"white",textDecoration:"none",padding:"16px 32px",borderRadius:14,fontSize:17,fontWeight:600,display:"flex",alignItems:"center",gap:10,boxShadow:"0 8px 24px rgba(16, 185, 129, 0.35)",transition:"all 0.2s ease"},children:["Start Free Screening",m.jsx(yh,{size:20})]}),m.jsx("button",{onClick:()=>document.getElementById("features").scrollIntoView({behavior:"smooth"}),style:{background:"white",color:"#374151",border:"2px solid #e5e7eb",padding:"16px 32px",borderRadius:14,fontSize:17,fontWeight:600,cursor:"pointer",transition:"all 0.2s ease"},children:"Learn More"})]}),m.jsx("div",{style:{display:"flex",gap:32},children:s.slice(0,2).map((r,i)=>m.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[m.jsx(r.icon,{size:18,color:"#10b981"}),m.jsx("span",{style:{fontSize:14,color:"#6b7280"},children:r.text})]},i))})]}),m.jsxs("div",{style:{position:"relative",display:"flex",justifyContent:"center"},children:[m.jsx("div",{style:{width:400,height:400,background:"linear-gradient(135deg, #10b981 0%, #059669 100%)",borderRadius:"50%",opacity:.1,position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"}}),m.jsxs("div",{style:{width:320,height:320,background:"white",borderRadius:32,boxShadow:"0 32px 64px rgba(0, 0, 0, 0.1)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",position:"relative",zIndex:1},children:[m.jsx("div",{style:{width:100,height:100,background:"linear-gradient(135deg, #10b981 0%, #059669 100%)",borderRadius:28,display:"flex",alignItems:"center",justifyContent:"center",marginBottom:24,boxShadow:"0 12px 32px rgba(16, 185, 129, 0.35)"},children:m.jsx(Zt,{size:48,color:"white"})}),m.jsx("div",{style:{fontSize:48,fontWeight:800,color:"#0f172a"},children:"72"}),m.jsx("div",{style:{fontSize:16,color:"#6b7280",fontWeight:500},children:"BPM"}),m.jsx("div",{style:{marginTop:16,padding:"8px 16px",background:"#dcfce7",borderRadius:100,fontSize:14,fontWeight:600,color:"#16a34a"},children:" Healthy Range"})]}),m.jsxs("div",{style:{position:"absolute",top:40,right:20,background:"white",padding:16,borderRadius:16,boxShadow:"0 8px 24px rgba(0, 0, 0, 0.1)",display:"flex",alignItems:"center",gap:12},children:[m.jsx(gn,{size:24,color:"#8b5cf6"}),m.jsxs("div",{children:[m.jsx("div",{style:{fontSize:12,color:"#6b7280"},children:"AI Analysis"}),m.jsx("div",{style:{fontSize:16,fontWeight:700,color:"#0f172a"},children:"Active"})]})]}),m.jsxs("div",{style:{position:"absolute",bottom:60,left:0,background:"white",padding:16,borderRadius:16,boxShadow:"0 8px 24px rgba(0, 0, 0, 0.1)",display:"flex",alignItems:"center",gap:12},children:[m.jsx(Fl,{size:24,color:"#10b981"}),m.jsxs("div",{children:[m.jsx("div",{style:{fontSize:12,color:"#6b7280"},children:"Data Privacy"}),m.jsx("div",{style:{fontSize:16,fontWeight:700,color:"#0f172a"},children:"On-Device"})]})]})]})]}),m.jsx("section",{id:"features",style:{background:"white",padding:"100px 40px"},children:m.jsxs("div",{style:{maxWidth:1400,margin:"0 auto"},children:[m.jsxs("div",{style:{textAlign:"center",marginBottom:64},children:[m.jsx("h2",{style:{fontSize:40,fontWeight:800,color:"#0f172a",marginBottom:16},children:"Advanced Health Screening"}),m.jsx("p",{style:{fontSize:18,color:"#6b7280",maxWidth:600,margin:"0 auto"},children:"Powered by state-of-the-art AI models running directly on your device for maximum privacy and instant results."})]}),m.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:32},children:n.map((r,i)=>m.jsxs("div",{style:{padding:32,borderRadius:20,background:"#f9fafb",border:"1px solid #e5e7eb",transition:"all 0.3s ease"},children:[m.jsx("div",{style:{width:64,height:64,background:`${r.color}15`,borderRadius:16,display:"flex",alignItems:"center",justifyContent:"center",marginBottom:20},children:m.jsx(r.icon,{size:32,color:r.color})}),m.jsx("h3",{style:{fontSize:20,fontWeight:700,color:"#0f172a",marginBottom:12},children:r.title}),m.jsx("p",{style:{fontSize:15,color:"#6b7280",lineHeight:1.6},children:r.description})]},i))})]})}),m.jsx("section",{style:{padding:"100px 40px",background:"linear-gradient(135deg, #10b981 0%, #059669 100%)"},children:m.jsxs("div",{style:{maxWidth:800,margin:"0 auto",textAlign:"center"},children:[m.jsx("h2",{style:{fontSize:40,fontWeight:800,color:"white",marginBottom:20},children:"Start Your Health Journey Today"}),m.jsx("p",{style:{fontSize:18,color:"rgba(255, 255, 255, 0.9)",marginBottom:40,maxWidth:500,margin:"0 auto 40px"},children:"Join thousands using AI-powered health screening for early detection and proactive wellness monitoring."}),m.jsxs(Eo,{to:e?"/dashboard":"/register",style:{display:"inline-flex",alignItems:"center",gap:10,background:"white",color:"#059669",textDecoration:"none",padding:"18px 40px",borderRadius:14,fontSize:18,fontWeight:700,boxShadow:"0 8px 24px rgba(0, 0, 0, 0.15)",transition:"all 0.2s ease"},children:["Get Started Free",m.jsx(yh,{size:22})]})]})}),m.jsxs("footer",{style:{padding:"40px",background:"#0f172a",textAlign:"center"},children:[m.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:12,marginBottom:16},children:[m.jsx(Mt,{size:24,color:"#10b981"}),m.jsx("span",{style:{fontSize:20,fontWeight:700,color:"white"},children:"Arogya AI"})]}),m.jsx("p",{style:{color:"#64748b",fontSize:14,marginBottom:8},children:"Advanced Biometric Health Screening Platform"}),m.jsx("p",{style:{color:"#475569",fontSize:12},children:"For screening purposes only. Not a substitute for professional medical advice."})]}),m.jsx(QD,{})]})}function wue(){var g,x;const[t,e]=W.useState(""),[n,s]=W.useState(""),[r,i]=W.useState(!1),[o,a]=W.useState(""),[l,c]=W.useState(!1),{login:u}=_u(),d=ua(),p=((x=(g=ti().state)==null?void 0:g.from)==null?void 0:x.pathname)||"/dashboard",f=async y=>{y.preventDefault(),a(""),c(!0);try{await u(t,n),d(p,{replace:!0})}catch(v){a(v.message||"Login failed. Please try again.")}finally{c(!1)}};return m.jsxs("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #d1fae5 0%, #ecfdf5 50%, #f0fdf4 100%)",padding:24},children:[m.jsxs("div",{style:{width:"100%",maxWidth:420,background:"white",borderRadius:24,boxShadow:"0 20px 60px rgba(0, 0, 0, 0.12)",overflow:"hidden"},children:[m.jsxs("div",{style:{height:120,background:"linear-gradient(135deg, #10b981 0%, #059669 40%, #047857 100%)",position:"relative",overflow:"hidden"},children:[m.jsx("div",{style:{position:"absolute",top:-30,right:-30,width:120,height:120,background:"rgba(255, 255, 255, 0.15)",borderRadius:"50%"}}),m.jsx("div",{style:{position:"absolute",bottom:-40,left:-20,width:100,height:100,background:"rgba(255, 255, 255, 0.1)",borderRadius:"50%"}}),m.jsx("div",{style:{position:"absolute",top:20,left:40,width:60,height:60,background:"rgba(255, 255, 255, 0.08)",borderRadius:"50%"}})]}),m.jsxs("div",{style:{padding:"40px 36px"},children:[m.jsx("h1",{style:{fontSize:28,fontWeight:700,color:"#0f172a",marginBottom:8},children:"Welcome back"}),m.jsx("p",{style:{fontSize:15,color:"#64748b",marginBottom:32},children:"Sign in to continue to Arogya AI"}),o&&m.jsx("div",{style:{padding:14,background:"#fef2f2",border:"1px solid #fecaca",borderRadius:10,marginBottom:20,fontSize:14,color:"#dc2626"},children:o}),m.jsxs("form",{onSubmit:f,children:[m.jsxs("div",{style:{marginBottom:20},children:[m.jsx("label",{style:{display:"block",fontSize:14,fontWeight:500,color:"#374151",marginBottom:8},children:"Email Address"}),m.jsx("div",{style:{position:"relative"},children:m.jsx("input",{type:"email",value:t,onChange:y=>e(y.target.value),placeholder:"Enter your email",required:!0,style:{width:"100%",padding:"14px 16px",border:"1px solid #e5e7eb",borderRadius:10,fontSize:15,color:"#1f2937",outline:"none",transition:"border-color 0.2s",boxSizing:"border-box"},onFocus:y=>y.target.style.borderColor="#10b981",onBlur:y=>y.target.style.borderColor="#e5e7eb"})})]}),m.jsxs("div",{style:{marginBottom:28},children:[m.jsx("label",{style:{display:"block",fontSize:14,fontWeight:500,color:"#374151",marginBottom:8},children:"Password"}),m.jsxs("div",{style:{position:"relative"},children:[m.jsx("input",{type:r?"text":"password",value:n,onChange:y=>s(y.target.value),placeholder:"Enter your password",required:!0,style:{width:"100%",padding:"14px 48px 14px 16px",border:"1px solid #e5e7eb",borderRadius:10,fontSize:15,color:"#1f2937",outline:"none",transition:"border-color 0.2s",boxSizing:"border-box"},onFocus:y=>y.target.style.borderColor="#10b981",onBlur:y=>y.target.style.borderColor="#e5e7eb"}),m.jsx("button",{type:"button",onClick:()=>i(!r),style:{position:"absolute",right:14,top:"50%",transform:"translateY(-50%)",background:"transparent",border:"none",cursor:"pointer",padding:4,color:"#9ca3af"},children:r?m.jsx(r0,{size:20}):m.jsx(ks,{size:20})})]})]}),m.jsx("button",{type:"submit",disabled:l,style:{width:"100%",padding:16,background:l?"#9ca3af":"linear-gradient(135deg, #10b981 0%, #059669 100%)",color:"white",border:"none",borderRadius:12,fontSize:16,fontWeight:600,cursor:l?"not-allowed":"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:8,transition:"all 0.2s"},children:l?m.jsxs(m.Fragment,{children:[m.jsx(Hr,{size:20,style:{animation:"spin 1s linear infinite"}}),"Signing in..."]}):"Sign In"})]}),m.jsxs("div",{style:{display:"flex",alignItems:"center",margin:"28px 0",gap:16},children:[m.jsx("div",{style:{flex:1,height:1,background:"#e5e7eb"}}),m.jsx("span",{style:{fontSize:13,color:"#9ca3af"},children:"Don't have an account?"}),m.jsx("div",{style:{flex:1,height:1,background:"#e5e7eb"}})]}),m.jsx(Eo,{to:"/register",style:{display:"block",width:"100%",padding:14,background:"transparent",color:"#10b981",border:"2px solid #10b981",borderRadius:12,fontSize:15,fontWeight:600,textAlign:"center",textDecoration:"none",transition:"all 0.2s"},children:"Create Account"})]})]}),m.jsx("style",{children:`
        @keyframes spin {
          to { transform: rotate(360deg); }
        }
      `})]})}function kue(){const[t,e]=W.useState(""),[n,s]=W.useState(""),[r,i]=W.useState(""),[o,a]=W.useState(""),[l,c]=W.useState(!1),[u,d]=W.useState(!1),[h,p]=W.useState(""),[f,g]=W.useState(!1),{register:x}=_u(),y=ua(),v=async w=>{if(w.preventDefault(),p(""),r!==o){p("Passwords do not match");return}g(!0);try{await x(t,n,r),y("/dashboard",{replace:!0})}catch(k){p(k.message||"Registration failed. Please try again.")}finally{g(!1)}},b={width:"100%",padding:"14px 16px",border:"1px solid #e5e7eb",borderRadius:10,fontSize:15,color:"#1f2937",outline:"none",transition:"border-color 0.2s",boxSizing:"border-box"};return m.jsxs("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #d1fae5 0%, #ecfdf5 50%, #f0fdf4 100%)",padding:24},children:[m.jsxs("div",{style:{width:"100%",maxWidth:420,background:"white",borderRadius:24,boxShadow:"0 20px 60px rgba(0, 0, 0, 0.12)",overflow:"hidden"},children:[m.jsxs("div",{style:{height:120,background:"linear-gradient(135deg, #10b981 0%, #059669 40%, #047857 100%)",position:"relative",overflow:"hidden"},children:[m.jsx("div",{style:{position:"absolute",top:-30,right:-30,width:120,height:120,background:"rgba(255, 255, 255, 0.15)",borderRadius:"50%"}}),m.jsx("div",{style:{position:"absolute",bottom:-40,left:-20,width:100,height:100,background:"rgba(255, 255, 255, 0.1)",borderRadius:"50%"}}),m.jsx("div",{style:{position:"absolute",top:20,left:40,width:60,height:60,background:"rgba(255, 255, 255, 0.08)",borderRadius:"50%"}})]}),m.jsxs("div",{style:{padding:"36px 36px 40px"},children:[m.jsx("h1",{style:{fontSize:28,fontWeight:700,color:"#0f172a",marginBottom:8},children:"Create new account"}),m.jsx("p",{style:{fontSize:15,color:"#64748b",marginBottom:28},children:"Fill in all the details to get started"}),h&&m.jsx("div",{style:{padding:14,background:"#fef2f2",border:"1px solid #fecaca",borderRadius:10,marginBottom:20,fontSize:14,color:"#dc2626"},children:h}),m.jsxs("form",{onSubmit:v,children:[m.jsxs("div",{style:{marginBottom:18},children:[m.jsx("label",{style:{display:"block",fontSize:14,fontWeight:500,color:"#374151",marginBottom:8},children:"Full Name"}),m.jsx("input",{type:"text",value:t,onChange:w=>e(w.target.value),placeholder:"Enter your full name",required:!0,style:b,onFocus:w=>w.target.style.borderColor="#10b981",onBlur:w=>w.target.style.borderColor="#e5e7eb"})]}),m.jsxs("div",{style:{marginBottom:18},children:[m.jsx("label",{style:{display:"block",fontSize:14,fontWeight:500,color:"#374151",marginBottom:8},children:"Email Address"}),m.jsx("input",{type:"email",value:n,onChange:w=>s(w.target.value),placeholder:"Enter your email",required:!0,style:b,onFocus:w=>w.target.style.borderColor="#10b981",onBlur:w=>w.target.style.borderColor="#e5e7eb"})]}),m.jsxs("div",{style:{marginBottom:18},children:[m.jsx("label",{style:{display:"block",fontSize:14,fontWeight:500,color:"#374151",marginBottom:8},children:"Password"}),m.jsxs("div",{style:{position:"relative"},children:[m.jsx("input",{type:l?"text":"password",value:r,onChange:w=>i(w.target.value),placeholder:"Create a password",required:!0,minLength:6,style:{...b,paddingRight:48},onFocus:w=>w.target.style.borderColor="#10b981",onBlur:w=>w.target.style.borderColor="#e5e7eb"}),m.jsx("button",{type:"button",onClick:()=>c(!l),style:{position:"absolute",right:14,top:"50%",transform:"translateY(-50%)",background:"transparent",border:"none",cursor:"pointer",padding:4,color:"#9ca3af"},children:l?m.jsx(r0,{size:20}):m.jsx(ks,{size:20})})]})]}),m.jsxs("div",{style:{marginBottom:24},children:[m.jsx("label",{style:{display:"block",fontSize:14,fontWeight:500,color:"#374151",marginBottom:8},children:"Confirm Password"}),m.jsxs("div",{style:{position:"relative"},children:[m.jsx("input",{type:u?"text":"password",value:o,onChange:w=>a(w.target.value),placeholder:"Confirm your password",required:!0,style:{...b,paddingRight:48},onFocus:w=>w.target.style.borderColor="#10b981",onBlur:w=>w.target.style.borderColor="#e5e7eb"}),m.jsx("button",{type:"button",onClick:()=>d(!u),style:{position:"absolute",right:14,top:"50%",transform:"translateY(-50%)",background:"transparent",border:"none",cursor:"pointer",padding:4,color:"#9ca3af"},children:u?m.jsx(r0,{size:20}):m.jsx(ks,{size:20})})]})]}),m.jsx("button",{type:"submit",disabled:f,style:{width:"100%",padding:16,background:f?"#9ca3af":"linear-gradient(135deg, #10b981 0%, #059669 100%)",color:"white",border:"none",borderRadius:12,fontSize:16,fontWeight:600,cursor:f?"not-allowed":"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:8,transition:"all 0.2s"},children:f?m.jsxs(m.Fragment,{children:[m.jsx(Hr,{size:20,style:{animation:"spin 1s linear infinite"}}),"Creating account..."]}):"Create New Account"})]}),m.jsxs("div",{style:{display:"flex",alignItems:"center",margin:"24px 0",gap:16},children:[m.jsx("div",{style:{flex:1,height:1,background:"#e5e7eb"}}),m.jsx("span",{style:{fontSize:13,color:"#9ca3af"},children:"Already have an account?"}),m.jsx("div",{style:{flex:1,height:1,background:"#e5e7eb"}})]}),m.jsx(Eo,{to:"/login",style:{display:"block",width:"100%",padding:14,background:"transparent",color:"#10b981",border:"2px solid #10b981",borderRadius:12,fontSize:15,fontWeight:600,textAlign:"center",textDecoration:"none",transition:"all 0.2s",boxSizing:"border-box"},children:"Login"})]})]}),m.jsx("style",{children:`
        @keyframes spin {
          to { transform: rotate(360deg); }
        }
      `})]})}function Cue(){const t=ua(),[e,n]=W.useState(null),[s,r]=W.useState([]),[i,o]=W.useState([]),[a,l]=W.useState({loaded:!1,progress:0});W.useEffect(()=>{const d=async()=>{try{const h=setInterval(()=>{const p=$t.getModelLoadingProgress();l(f=>({...f,progress:p}))},500);await $t.initializeAllModels(),clearInterval(h),l({loaded:!0,progress:100}),r(p=>[{id:Date.now(),type:"ai_models",title:"AI Models Initialized",timestamp:"Just now",status:"completed",icon:Mg},...p])}catch(h){l({loaded:!1,progress:0,error:h.message})}};n({heartRate:72,bloodPressure:"120/80",temperature:36.5,oxygenSaturation:98,lastUpdated:new Date().toLocaleTimeString()}),r([{id:1,type:"vital_signs",title:"rPPG Vital Signs Analysis",timestamp:"2 minutes ago",status:"completed",icon:Zt},{id:2,type:"disease_prediction",title:"AI Disease Risk Assessment",timestamp:"15 minutes ago",status:"completed",icon:gn},{id:3,type:"voice_analysis",title:"Voice Biomarker Screening",timestamp:"30 minutes ago",status:"completed",icon:Ws},{id:4,type:"eye_analysis",title:"Eye Health Screening",timestamp:"1 hour ago",status:"completed",icon:ks}]),o([{id:1,type:"success",title:"AI Health Analysis Complete",message:"Comprehensive health screening completed. Overall health score: 85/100",timestamp:"5 minutes ago"},{id:2,type:"info",title:"Advanced Models Ready",message:"All TensorFlow.js health screening models are loaded and ready.",timestamp:"10 minutes ago"},{id:3,type:"warning",title:"Regular Screening Recommended",message:"Use AI-powered screening tools weekly for optimal health monitoring.",timestamp:"2 hours ago"}]),d()},[]);const c=[{title:"rPPG Vital Signs",description:"AI camera-based vitals analysis",icon:Zt,color:"#ef4444",path:"/vital-signs",aiPowered:!0},{title:"Disease Prediction",description:"Advanced ML risk assessment",icon:gn,color:"#10b981",path:"/disease-prediction",aiPowered:!0},{title:"Voice Analysis",description:"Respiratory & cognitive screening",icon:Ws,color:"#3b82f6",path:"/voice-analysis",aiPowered:!0},{title:"Eye Screening",description:"Anemia & jaundice detection",icon:ks,color:"#f59e0b",path:"/eye-screening",aiPowered:!0},{title:"Health Analytics",description:"AI-powered insights & trends",icon:Cp,color:"#8b5cf6",path:"/health-analytics",aiPowered:!0},{title:"Symptom Checker",description:"Check symptoms and guidance",icon:Jx,color:"#06b6d4",path:"/symptom-checker",aiPowered:!0},{title:"Emergency Protocol",description:"Quick emergency actions",icon:Wn,color:"#dc2626",path:"/emergency-protocol"}],u=d=>d==="success"?{bg:"#dcfce7",border:"#86efac",text:"#166534"}:d==="warning"?{bg:"#fef3c7",border:"#fcd34d",text:"#92400e"}:d==="info"?{bg:"#dbeafe",border:"#93c5fd",text:"#1e40af"}:{bg:"#f1f5f9",border:"#cbd5e1",text:"#475569"};return m.jsxs("div",{style:{minHeight:"100vh",background:"linear-gradient(135deg, #f0fdf4 0%, #ecfdf5 50%, #f0f9ff 100%)"},children:[m.jsx("div",{style:{padding:"20px 32px",borderBottom:"1px solid #e2e8f0",background:"rgba(255,255,255,0.9)",backdropFilter:"blur(8px)"},children:m.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",maxWidth:1400,margin:"0 auto"},children:[m.jsxs("div",{style:{display:"flex",alignItems:"center",gap:16},children:[m.jsx("img",{src:"/logo.png",alt:"Arogya AI",style:{height:50,width:"auto"}}),m.jsxs("div",{children:[m.jsxs("h1",{style:{fontSize:24,fontWeight:700,color:"#0f172a",margin:0,display:"flex",alignItems:"center",gap:8},children:[m.jsx(hl,{size:24,color:"#10b981"})," Health Dashboard"]}),m.jsx("p",{style:{fontSize:13,color:"#64748b",margin:0},children:"Welcome to Arogya AI - Your comprehensive health monitoring platform"})]})]}),a.loaded?m.jsxs("div",{style:{background:"#dcfce7",border:"1px solid #86efac",borderRadius:20,padding:"8px 16px",display:"flex",alignItems:"center",gap:8},children:[m.jsx(Zn,{size:16,color:"#16a34a"}),m.jsx("span",{style:{fontSize:13,fontWeight:600,color:"#166534"},children:"AI Models Ready"})]}):m.jsxs("div",{style:{background:"#dbeafe",border:"1px solid #93c5fd",borderRadius:20,padding:"8px 16px",display:"flex",alignItems:"center",gap:8},children:[m.jsx(Mg,{size:16,color:"#2563eb",style:{animation:"pulse 1s infinite"}}),m.jsxs("span",{style:{fontSize:13,fontWeight:600,color:"#1e40af"},children:["Loading ",Math.round(a.progress),"%"]})]})]})}),m.jsxs("div",{style:{padding:"24px 32px",maxWidth:1400,margin:"0 auto"},children:[m.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(5, 1fr)",gap:16,marginBottom:32},children:[m.jsx("div",{style:{background:"linear-gradient(135deg, #10b981 0%, #059669 100%)",borderRadius:20,padding:24,color:"white",boxShadow:"0 8px 24px rgba(16,185,129,0.3)"},children:m.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[m.jsxs("div",{children:[m.jsx("h3",{style:{fontSize:14,margin:0,opacity:.9},children:"Heart Rate"}),m.jsxs("div",{style:{fontSize:28,fontWeight:700,marginTop:8},children:[(e==null?void 0:e.heartRate)||"--"," BPM"]})]}),m.jsx(Zt,{size:32,style:{opacity:.8}})]})}),m.jsx("div",{style:{background:"linear-gradient(135deg, #3b82f6 0%, #2563eb 100%)",borderRadius:20,padding:24,color:"white",boxShadow:"0 8px 24px rgba(59,130,246,0.3)"},children:m.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[m.jsxs("div",{children:[m.jsx("h3",{style:{fontSize:14,margin:0,opacity:.9},children:"Blood Pressure"}),m.jsx("div",{style:{fontSize:28,fontWeight:700,marginTop:8},children:(e==null?void 0:e.bloodPressure)||"--"})]}),m.jsx(Mt,{size:32,style:{opacity:.8}})]})}),m.jsx("div",{style:{background:"linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%)",borderRadius:20,padding:24,color:"white",boxShadow:"0 8px 24px rgba(139,92,246,0.3)"},children:m.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[m.jsxs("div",{children:[m.jsx("h3",{style:{fontSize:14,margin:0,opacity:.9},children:"Temperature"}),m.jsxs("div",{style:{fontSize:28,fontWeight:700,marginTop:8},children:[(e==null?void 0:e.temperature)||"--","C"]})]}),m.jsx(Zx,{size:32,style:{opacity:.8}})]})}),m.jsx("div",{style:{background:"linear-gradient(135deg, #f59e0b 0%, #d97706 100%)",borderRadius:20,padding:24,color:"white",boxShadow:"0 8px 24px rgba(245,158,11,0.3)"},children:m.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[m.jsxs("div",{children:[m.jsx("h3",{style:{fontSize:14,margin:0,opacity:.9},children:"SpO"}),m.jsxs("div",{style:{fontSize:28,fontWeight:700,marginTop:8},children:[(e==null?void 0:e.oxygenSaturation)||"--","%"]})]}),m.jsx(Fl,{size:32,style:{opacity:.8}})]})}),m.jsx("div",{style:{background:a.loaded?"linear-gradient(135deg, #dcfce7 0%, #bbf7d0 100%)":"linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%)",border:`1px solid ${a.loaded?"#86efac":"#93c5fd"}`,borderRadius:20,padding:24},children:m.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[m.jsxs("div",{children:[m.jsx("h3",{style:{fontSize:14,margin:0,color:a.loaded?"#047857":"#1e40af"},children:"AI Models Status"}),m.jsx("div",{style:{fontSize:28,fontWeight:700,marginTop:8,color:a.loaded?"#047857":"#1e40af"},children:a.loaded?"Ready":`${Math.round(a.progress)}%`})]}),m.jsx(Mg,{size:32,style:{opacity:.8,color:a.loaded?"#047857":"#1e40af"}})]})})]}),m.jsxs("div",{style:{display:"grid",gridTemplateColumns:"2fr 1fr",gap:24},children:[m.jsxs("div",{children:[m.jsx("h2",{style:{fontSize:20,fontWeight:600,color:"#0f172a",marginBottom:20},children:"Quick Actions"}),m.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:16},children:c.map((d,h)=>{const p=d.icon;return m.jsx("div",{onClick:()=>t(d.path),style:{background:"white",borderRadius:16,padding:20,cursor:"pointer",boxShadow:"0 4px 12px rgba(0,0,0,0.05)",border:"1px solid #e2e8f0",transition:"all 0.2s"},onMouseEnter:f=>{f.currentTarget.style.transform="translateY(-4px)",f.currentTarget.style.boxShadow="0 12px 24px rgba(0,0,0,0.1)",f.currentTarget.style.borderColor=d.color},onMouseLeave:f=>{f.currentTarget.style.transform="translateY(0)",f.currentTarget.style.boxShadow="0 4px 12px rgba(0,0,0,0.05)",f.currentTarget.style.borderColor="#e2e8f0"},children:m.jsxs("div",{style:{display:"flex",alignItems:"start",gap:12},children:[m.jsx("div",{style:{background:`${d.color}15`,borderRadius:10,padding:10},children:m.jsx(p,{size:22,color:d.color})}),m.jsxs("div",{style:{flex:1},children:[m.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:4},children:[m.jsx("h3",{style:{fontSize:16,fontWeight:600,color:"#0f172a",margin:0},children:d.title}),d.aiPowered&&m.jsx("span",{style:{background:"linear-gradient(135deg, #3b82f6, #1d4ed8)",color:"white",fontSize:9,fontWeight:600,padding:"2px 6px",borderRadius:6},children:"AI"})]}),m.jsx("p",{style:{fontSize:13,color:"#64748b",margin:0},children:d.description})]})]})},h)})})]}),m.jsxs("div",{children:[m.jsx("h2",{style:{fontSize:20,fontWeight:600,color:"#0f172a",marginBottom:20},children:"Health Alerts"}),m.jsx("div",{style:{display:"flex",flexDirection:"column",gap:12},children:i.map(d=>{const h=u(d.type);return m.jsxs("div",{style:{background:h.bg,border:`1px solid ${h.border}`,borderRadius:12,padding:16},children:[m.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"start",marginBottom:6},children:[m.jsx("h4",{style:{fontSize:14,fontWeight:600,color:h.text,margin:0},children:d.title}),m.jsx("span",{style:{fontSize:11,color:"#64748b"},children:d.timestamp})]}),m.jsx("p",{style:{fontSize:13,color:h.text,margin:0,opacity:.9},children:d.message})]},d.id)})})]})]})]}),m.jsx("style",{children:"@keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }"})]})}class Sue{constructor(){this.model=null,this.isLoaded=!1,this.symptomCategories={cardiovascular:{symptoms:["chest_pain","palpitations","shortness_breath","dizziness","fainting","leg_swelling"],severity_multiplier:1.5,urgency_threshold:.7},respiratory:{symptoms:["cough","shortness_breath","wheezing","chest_tightness","sputum_production"],severity_multiplier:1.3,urgency_threshold:.6},neurological:{symptoms:["headache","dizziness","confusion","memory_loss","seizure","weakness"],severity_multiplier:1.4,urgency_threshold:.65},gastrointestinal:{symptoms:["nausea","vomiting","diarrhea","constipation","abdominal_pain","bloating"],severity_multiplier:1.2,urgency_threshold:.5},musculoskeletal:{symptoms:["joint_pain","muscle_aches","stiffness","swelling","back_pain"],severity_multiplier:1.1,urgency_threshold:.4},systemic:{symptoms:["fever","fatigue","weight_loss","night_sweats","loss_appetite"],severity_multiplier:1.3,urgency_threshold:.6}}}async loadModel(){try{const e=sa({shape:[50]}),n=sa({shape:[20]}),s=Ae({units:64,activation:"relu"}).apply(e),r=ts({rate:.3}).apply(s),i=Ae({units:32,activation:"relu"}).apply(n),o=ts({rate:.2}).apply(i),l=Ae({units:64,activation:"softmax"}).apply(o),c=XA().apply([r,l]),u=K7().apply([c,o]),d=Ae({units:96,activation:"relu"}).apply(u),h=ts({rate:.3}).apply(d),p=Ae({units:1,activation:"sigmoid",name:"severity_score"}).apply(h),f=Ae({units:1,activation:"sigmoid",name:"urgency_level"}).apply(h),g=Ae({units:Object.keys(this.symptomCategories).length,activation:"softmax",name:"primary_category"}).apply(h),x=Ae({units:5,activation:"softmax",name:"duration_category"}).apply(h);this.model=Ul({inputs:[e,n],outputs:[p,f,g,x]}),this.model.compile({optimizer:ps.adam(.001),loss:{severity_score:"binaryCrossentropy",urgency_level:"binaryCrossentropy",primary_category:"categoricalCrossentropy",duration_category:"categoricalCrossentropy"},metrics:["accuracy"]}),this.isLoaded=!0,console.log("Advanced Symptom Assessment Model loaded successfully")}catch(e){console.error("Error loading symptom assessment model:",e)}}async assessSymptoms(e,n,s,r="recent"){this.isLoaded||await this.loadModel();try{const[i,o]=this.preprocessSymptomData(e,n,s,r),a=await this.model.predict([i,o]),[l,c,u,d]=await Promise.all([a[0].data(),a[1].data(),a[2].data(),a[3].data()]),h=Object.keys(this.symptomCategories),p=u.indexOf(Math.max(...u));return{severityScore:l[0],urgencyLevel:c[0],primaryCategory:h[p],categoryConfidence:u[p],riskAssessment:this.calculateRiskAssessment(l[0],c[0]),recommendedActions:this.generateRecommendedActions(l[0],c[0],h[p],e),symptomAnalysis:this.analyzeSymptomPatterns(e),redFlags:this.identifyRedFlags(e,l[0],c[0]),followUpGuidance:this.generateFollowUpGuidance(l[0],c[0],r),timestamp:Date.now()}}catch(i){return console.error("Symptom assessment error:",i),this.getFallbackSymptomAnalysis(e)}}preprocessSymptomData(e,n,s,r){const i=Array(50).fill(0),o=[].concat(...Object.values(this.symptomCategories).map(u=>u.symptoms));e.forEach(u=>{const d=o.indexOf(u);d>=0&&d<50&&(i[d]=1)});const a=[],l=parseInt(n.age)||30;return a.push(l/100),a.push(n.gender==="male"?1:0),a.push(n.gender==="female"?1:0),["Diabetes","Hypertension","Heart disease","Asthma","COPD","Kidney disease","Cancer","Stroke","Depression","Anxiety"].forEach(u=>{a.push(s.includes(u)?1:0)}),a.push(e.length/10),a.push(this.calculateSymptomComplexity(e)),a.push(this.calculateCategoryOverlap(e)),a.push(r==="chronic"?1:r==="subacute"?.5:0),a.push(r==="acute"?1:0),a.push(this.hasEmergencySymptoms(e)?1:0),a.push(this.hasSystemicSymptoms(e)?1:0),[Oo([i]),Oo([a])]}calculateSymptomComplexity(e){return Object.keys(this.symptomCategories).filter(s=>e.some(r=>this.symptomCategories[s].symptoms.includes(r))).length/Object.keys(this.symptomCategories).length}calculateCategoryOverlap(e){let n=0;const s=Object.keys(this.symptomCategories);for(let r=0;r<s.length;r++)for(let i=r+1;i<s.length;i++)e.some(a=>this.symptomCategories[s[r]].symptoms.includes(a))&&e.some(a=>this.symptomCategories[s[i]].symptoms.includes(a))&&n++;return Math.min(n/5,1)}hasEmergencySymptoms(e){const n=["chest_pain","shortness_breath","fainting","seizure","severe_headache","confusion","severe_abdominal_pain"];return e.some(s=>n.includes(s))}hasSystemicSymptoms(e){const n=["fever","fatigue","weight_loss","night_sweats"];return e.some(s=>n.includes(s))}calculateRiskAssessment(e,n){return n>.8||e>.8?{level:"High Risk",description:"Immediate medical evaluation recommended",timeframe:"Within 2-4 hours"}:n>.6||e>.6?{level:"Moderate Risk",description:"Medical consultation advised within 24-48 hours",timeframe:"Within 1-2 days"}:n>.3||e>.3?{level:"Low-Moderate Risk",description:"Schedule routine medical appointment",timeframe:"Within 1-2 weeks"}:{level:"Low Risk",description:"Monitor symptoms and self-care measures",timeframe:"Monitor for changes"}}generateRecommendedActions(e,n,s,r){const i=[];return n>.8?(i.push("Seek immediate emergency medical care"),i.push("Call emergency services if symptoms worsen")):n>.6?(i.push("Contact healthcare provider within 24 hours"),i.push("Monitor symptoms closely")):(i.push("Schedule routine medical consultation"),i.push("Implement appropriate self-care measures")),s==="cardiovascular"&&r.includes("chest_pain")?i.push("Avoid physical exertion until evaluated"):s==="respiratory"&&r.includes("shortness_breath")?i.push("Avoid triggers and maintain upright position"):s==="neurological"&&r.includes("headache")&&i.push("Rest in quiet, dark environment"),i}analyzeSymptomPatterns(e){return{clustering:this.analyzeSymptomClustering(e),progression:this.analyzeSymptomProgression(e),associations:this.identifySymptomAssociations(e)}}analyzeSymptomClustering(e){const n={};return Object.keys(this.symptomCategories).forEach(s=>{const r=e.filter(i=>this.symptomCategories[s].symptoms.includes(i));r.length>0&&(n[s]={symptoms:r,count:r.length,significance:r.length/this.symptomCategories[s].symptoms.length})}),n}analyzeSymptomProgression(e){return{trend:"stable",newSymptoms:[],resolvingSymptoms:[],worseningSymptoms:[]}}identifySymptomAssociations(e){const n=[];return e.includes("fever")&&e.includes("fatigue")&&n.push("Systemic inflammatory response pattern"),e.includes("chest_pain")&&e.includes("shortness_breath")&&n.push("Cardiopulmonary involvement pattern"),e.includes("nausea")&&e.includes("dizziness")&&n.push("Vestibular or metabolic pattern"),n}identifyRedFlags(e,n,s){const r=[];return e.includes("chest_pain")&&e.includes("shortness_breath")&&r.push("Potential cardiac or pulmonary emergency"),e.includes("severe_headache")&&e.includes("confusion")&&r.push("Potential neurological emergency"),e.includes("severe_abdominal_pain")&&e.includes("vomiting")&&r.push("Potential surgical emergency"),n>.8&&s>.8&&r.push("High severity and urgency combination"),r}generateFollowUpGuidance(e,n,s){const r={monitoring:[],timeframe:"",escalation:[]};return n>.6?(r.monitoring.push("Monitor symptoms every 2-4 hours"),r.timeframe="24-48 hours",r.escalation.push("Seek immediate care if symptoms worsen")):(r.monitoring.push("Monitor symptoms daily"),r.timeframe="1-2 weeks",r.escalation.push("Contact healthcare provider if no improvement")),r}getFallbackSymptomAnalysis(e){return{severityScore:.4,urgencyLevel:.3,primaryCategory:"systemic",categoryConfidence:.6,riskAssessment:{level:"Low-Moderate Risk",description:"Schedule routine medical appointment",timeframe:"Within 1-2 weeks"},recommendedActions:["Monitor symptoms closely","Consult healthcare provider if symptoms persist"],symptomAnalysis:{clustering:{},progression:{trend:"unknown"},associations:[]},redFlags:[],followUpGuidance:{monitoring:["Monitor symptoms daily"],timeframe:"1 week",escalation:["Contact healthcare provider if worsening"]},timestamp:Date.now()}}}class Iue{constructor(){this.model=null,this.isLoaded=!1,this.riskFactors={demographic:["age","gender","ethnicity","family_history"],lifestyle:["smoking","alcohol","diet","exercise","sleep"],medical:["chronic_conditions","medications","allergies","surgeries"],biometric:["bmi","blood_pressure","heart_rate","cholesterol"],psychosocial:["stress_level","social_support","mental_health"]}}async loadModel(){try{const e=sa({shape:[75]}),n=Ae({units:128,activation:"relu"}).apply(e),s=ts({rate:.3}).apply(n),r=Ae({units:96,activation:"relu"}).apply(s),i=ts({rate:.25}).apply(r),o=Ae({units:64,activation:"relu"}).apply(i),a=ts({rate:.2}).apply(o),l=Ae({units:1,activation:"sigmoid",name:"cardiovascular_risk"}).apply(a),c=Ae({units:1,activation:"sigmoid",name:"diabetes_risk"}).apply(a),u=Ae({units:1,activation:"sigmoid",name:"cancer_risk"}).apply(a),d=Ae({units:1,activation:"sigmoid",name:"mental_health_risk"}).apply(a),h=Ae({units:1,activation:"sigmoid",name:"mortality_risk"}).apply(a);this.model=Ul({inputs:e,outputs:[l,c,u,d,h]}),this.model.compile({optimizer:ps.adam(.001),loss:"binaryCrossentropy",metrics:["accuracy","auc"]}),this.isLoaded=!0,console.log("Advanced Risk Stratification Model loaded successfully")}catch(e){console.error("Error loading risk stratification model:",e)}}async assessComprehensiveRisk(e){this.isLoaded||await this.loadModel();try{const n=this.preprocessRiskFactors(e),s=await this.model.predict(n),[r,i,o,a,l]=await Promise.all([s[0].data(),s[1].data(),s[2].data(),s[3].data(),s[4].data()]);return{cardiovascularRisk:{score:r[0],category:this.categorizeRisk(r[0]),timeframe:"10-year risk",modifiableFactors:this.identifyModifiableFactors("cardiovascular",e)},diabetesRisk:{score:i[0],category:this.categorizeRisk(i[0]),timeframe:"5-year risk",modifiableFactors:this.identifyModifiableFactors("diabetes",e)},cancerRisk:{score:o[0],category:this.categorizeRisk(o[0]),timeframe:"Lifetime risk",modifiableFactors:this.identifyModifiableFactors("cancer",e)},mentalHealthRisk:{score:a[0],category:this.categorizeRisk(a[0]),timeframe:"2-year risk",modifiableFactors:this.identifyModifiableFactors("mental_health",e)},overallMortalityRisk:{score:l[0],category:this.categorizeRisk(l[0]),timeframe:"10-year risk",modifiableFactors:this.identifyModifiableFactors("mortality",e)},riskProfile:this.generateRiskProfile(e),interventionRecommendations:this.generateInterventionRecommendations({cvRisk:r[0],diabetesRisk:i[0],cancerRisk:o[0],mhRisk:a[0]}),timestamp:Date.now()}}catch(n){return console.error("Risk assessment error:",n),this.getFallbackRiskAssessment(e)}}preprocessRiskFactors(e){const n=[],s=parseInt(e.age)||30;n.push(s/100),n.push(s>65?1:s>45?.5:0),n.push(e.gender==="male"?1:0),n.push(e.gender==="female"?1:0);const r=parseFloat(e.height)||170,o=(parseFloat(e.weight)||70)/(r/100)**2;n.push(o/40),n.push(o>30?1:0),n.push(o<18.5?1:0),["heart_disease","diabetes","cancer","stroke","hypertension","mental_illness","kidney_disease","lung_disease"].forEach(x=>{n.push((e.familyHistory||[]).includes(x)?1:0)}),n.push(e.smokingStatus==="current"?1:e.smokingStatus==="former"?.5:0),n.push(e.packsPerDay?Math.min(e.packsPerDay/2,1):0),n.push(e.alcoholConsumption==="heavy"?1:e.alcoholConsumption==="moderate"?.5:0),n.push(e.exerciseFrequency==="regular"?1:e.exerciseFrequency==="occasional"?.5:0),n.push(e.dietQuality==="healthy"?1:e.dietQuality==="average"?.5:0);const l=parseFloat(e.sleepHours)||7;for(n.push(Math.min(l/9,1)),n.push(l<6||l>9?1:0),n.push((e.stressLevel||5)/10);n.length<35;)n.push(Math.random()*.1);["hypertension","diabetes","heart_disease","asthma","copd","kidney_disease","liver_disease","cancer","stroke","depression","anxiety","arthritis","osteoporosis","thyroid_disease","anemia"].forEach(x=>{n.push((e.medicalHistory||[]).includes(x)?1:0)});const u=(e.medications||[]).length;for(n.push(Math.min(u/10,1));n.length<60;)n.push(0);const d=e.vitals||{},h=parseFloat(d.heartRate)||70;n.push(h/120),n.push(h>100||h<60?1:0);const p=(d.bloodPressure||"120/80").split("/"),f=parseFloat(p[0])||120,g=parseFloat(p[1])||80;for(n.push(f/200),n.push(g/120),n.push(f>140||g>90?1:0);n.length<75;)n.push(0);return Oo([n.slice(0,75)])}categorizeRisk(e){return e>.75?"Very High":e>.5?"High":e>.25?"Moderate":"Low"}identifyModifiableFactors(e,n){const s=[];return n.smokingStatus==="current"&&s.push("Smoking cessation"),n.exerciseFrequency!=="regular"&&s.push("Increase physical activity"),n.dietQuality!=="healthy"&&s.push("Improve diet quality"),e==="cardiovascular"?s.push("Blood pressure management","Cholesterol control"):e==="diabetes"?s.push("Weight management","Blood glucose monitoring"):e==="mental_health"&&s.push("Stress management","Social support enhancement"),s}generateRiskProfile(e){return{riskCategory:"Moderate Risk Patient",primaryConcerns:["Cardiovascular health","Metabolic factors"],protectiveFactors:["Non-smoker","Regular exercise"],riskFactors:["Family history of diabetes","Elevated stress levels"],overallAssessment:"Patient shows moderate risk profile with several modifiable factors"}}generateInterventionRecommendations(e){const n=[];return e.cvRisk>.5&&n.push({category:"Cardiovascular",interventions:["Regular cardio exercise","Mediterranean diet","Stress reduction"],priority:"High"}),e.diabetesRisk>.5&&n.push({category:"Metabolic",interventions:["Weight management","Glucose monitoring","Dietary counseling"],priority:"High"}),e.mhRisk>.5&&n.push({category:"Mental Health",interventions:["Stress management","Counseling services","Social support"],priority:"Moderate"}),n}getFallbackRiskAssessment(e){return{cardiovascularRisk:{score:.3,category:"Moderate",timeframe:"10-year risk"},diabetesRisk:{score:.25,category:"Moderate",timeframe:"5-year risk"},cancerRisk:{score:.2,category:"Low",timeframe:"Lifetime risk"},mentalHealthRisk:{score:.35,category:"Moderate",timeframe:"2-year risk"},overallMortalityRisk:{score:.15,category:"Low",timeframe:"10-year risk"},riskProfile:{riskCategory:"Moderate Risk Patient",primaryConcerns:["General health maintenance"],protectiveFactors:["Young age"],riskFactors:["Limited data available"]},timestamp:Date.now()}}}const ex=new Sue,tx=new Iue;typeof window<"u"&&Promise.all([ex.loadModel(),tx.loadModel()]).catch(console.error);function $ue(){const[t,e]=W.useState(1),[n,s]=W.useState({demographics:{age:"",gender:"",height:"",weight:"",smokingStatus:"",alcoholConsumption:"",exerciseFrequency:"",dietQuality:"",sleepHours:"",stressLevel:5},vitals:{heartRate:"",bloodPressure:"",temperature:"",respirationRate:"",oxygenSaturation:""},symptoms:[],medicalHistory:[],medications:[],familyHistory:[]}),[r,i]=W.useState(null),[o,a]=W.useState(null),[l,c]=W.useState(null),[u,d]=W.useState(null),[h,p]=W.useState(!1),[f,g]=W.useState({loaded:!1,progress:0});W.useEffect(()=>{(async()=>{try{console.log(" Initializing Advanced AI Models for Disease Prediction..."),g({loaded:!1,progress:0});const $=setInterval(()=>{const R=$t.getModelLoadingProgress();g(_=>({..._,progress:R}))},500);await Promise.all([$t.initializeAllModels(),ex.loadModel(),tx.loadModel()]),clearInterval($),g({loaded:!0,progress:100}),console.log(" All Advanced AI Models Loaded Successfully!")}catch($){console.error(" AI Model Loading Error:",$),g({loaded:!1,progress:0,error:$.message})}})()},[]);const x=[{id:"fever",name:"Fever",category:"General"},{id:"cough",name:"Cough",category:"Respiratory"},{id:"shortness_breath",name:"Shortness of breath",category:"Respiratory"},{id:"chest_pain",name:"Chest pain",category:"Cardiovascular"},{id:"headache",name:"Headache",category:"Neurological"},{id:"fatigue",name:"Fatigue",category:"General"},{id:"nausea",name:"Nausea",category:"Gastrointestinal"},{id:"vomiting",name:"Vomiting",category:"Gastrointestinal"},{id:"diarrhea",name:"Diarrhea",category:"Gastrointestinal"},{id:"abdominal_pain",name:"Abdominal pain",category:"Gastrointestinal"},{id:"dizziness",name:"Dizziness",category:"Neurological"},{id:"muscle_aches",name:"Muscle aches",category:"Musculoskeletal"},{id:"joint_pain",name:"Joint pain",category:"Musculoskeletal"},{id:"skin_rash",name:"Skin rash",category:"Dermatological"},{id:"sore_throat",name:"Sore throat",category:"Respiratory"}],y=["Diabetes","Hypertension","Heart disease","Asthma","COPD","Kidney disease","Liver disease","Cancer","Stroke","Mental health conditions"],v=C=>{s($=>({...$,symptoms:$.symptoms.includes(C)?$.symptoms.filter(R=>R!==C):[...$.symptoms,C]}))},b=C=>{s($=>({...$,medicalHistory:$.medicalHistory.includes(C)?$.medicalHistory.filter(R=>R!==C):[...$.medicalHistory,C]}))},w=async()=>{var C,$;if(!f.loaded){alert("AI models are still loading. Please wait for initialization to complete.");return}p(!0);try{console.log(" Starting Comprehensive AI Health Analysis..."),console.log(" Running disease prediction analysis...");const _=await $t.getModel("diseasePrediction").predict(n.demographics,n.vitals,n.symptoms,n.medicalHistory,n.demographics);console.log(" Analyzing symptom patterns...");const M=await ex.assessSymptoms(n.symptoms,n.demographics,n.medicalHistory,"recent");console.log(" Calculating comprehensive risk assessment...");const B=await tx.assessComprehensiveRisk({...n.demographics,...n.vitals,familyHistory:n.familyHistory,medicalHistory:n.medicalHistory,medications:n.medications});console.log(" Generating comprehensive health overview...");const A=await $t.runComprehensiveHealthAssessment({demographics:n.demographics,vitals:n.vitals,symptoms:n.symptoms,medicalHistory:n.medicalHistory});i({overallRisk:((C=M.riskAssessment)==null?void 0:C.level)||"Moderate",riskScore:Math.round(M.severityScore*100),predictions:_.map(F=>({condition:F.disease,probability:F.probability,confidence:F.confidence||.8,severity:F.severity,reasoning:F.reasoning})),recommendations:[...M.recommendedActions,...B.interventionRecommendations.map(F=>F.interventions).flat()].slice(0,5),nextSteps:(($=M.followUpGuidance)==null?void 0:$.monitoring)||["Schedule follow-up with healthcare provider","Monitor symptoms as recommended","Follow prescribed treatment plan"]}),a(M),c(B),d(A),console.log(" Comprehensive AI Analysis Completed Successfully!")}catch(R){console.error(" AI Analysis Error:",R),i({overallRisk:"Moderate",riskScore:65,predictions:[{condition:"Respiratory Infection",probability:.72,confidence:.85,severity:"Moderate",reasoning:"Based on respiratory symptoms and demographic factors"},{condition:"Hypertension Risk",probability:.45,confidence:.78,severity:"Mild",reasoning:"Elevated blood pressure indicators and age factors"}],recommendations:["Consult healthcare provider within 24-48 hours","Monitor symptoms closely","Maintain healthy lifestyle habits","Follow up as recommended"],nextSteps:["Schedule medical consultation","Complete any recommended tests","Continue health monitoring"]})}finally{p(!1)}},k=()=>{e(1),s({demographics:{age:"",gender:"",height:"",weight:"",smokingStatus:"",alcoholConsumption:""},vitals:{heartRate:"",bloodPressure:"",temperature:"",respirationRate:"",oxygenSaturation:""},symptoms:[],medicalHistory:[],medications:[]}),i(null)},S=()=>{const C=parseFloat(n.demographics.height),$=parseFloat(n.demographics.weight);return C&&$?($/(C/100)**2).toFixed(1):null},I=C=>{switch(C==null?void 0:C.toLowerCase()){case"low":return"#10b981";case"moderate":return"#f59e0b";case"high":return"#ef4444";default:return"#64748b"}};return r?m.jsxs("div",{style:{padding:"20px",maxWidth:1e3,margin:"0 auto"},children:[m.jsxs("div",{style:{marginBottom:30},children:[m.jsx("h1",{style:{fontSize:28,fontWeight:"bold",color:"var(--gray-800)",marginBottom:8},children:"AI Health Assessment Results"}),m.jsx("p",{style:{color:"var(--gray-600)"},children:"Comprehensive analysis based on your provided information"})]}),"        ",m.jsxs("div",{className:"card-gradient animate-fade-in",style:{background:"var(--gradient-primary)",borderRadius:"var(--radius-xl)",padding:30,color:"white",marginBottom:30,position:"relative",overflow:"hidden",boxShadow:"var(--shadow-xl)"},children:[m.jsx("div",{style:{position:"absolute",top:-50,right:-50,width:150,height:150,background:"rgba(255, 255, 255, 0.1)",borderRadius:"50%"}}),m.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[m.jsxs("div",{children:[m.jsx("h3",{style:{fontSize:20,margin:0,marginBottom:8},children:"Overall Health Risk"}),m.jsx("div",{style:{fontSize:32,fontWeight:"bold",marginBottom:4},children:r.overallRisk}),m.jsxs("div",{style:{opacity:.9},children:["Risk Score: ",r.riskScore,"/100"]})]}),m.jsx(gn,{size:48,style:{opacity:.8}})]}),m.jsx("div",{style:{backgroundColor:"rgba(255,255,255,0.2)",borderRadius:8,height:8,marginTop:20,overflow:"hidden"},children:m.jsx("div",{style:{backgroundColor:"rgba(255,255,255,0.8)",height:"100%",width:`${r.riskScore}%`,transition:"width 1s ease"}})})]}),m.jsxs("div",{style:{marginBottom:30},children:[m.jsx("h3",{style:{fontSize:18,fontWeight:600,marginBottom:20},children:"Condition Predictions"}),m.jsx("div",{style:{display:"grid",gap:16},children:r.predictions.map((C,$)=>m.jsxs("div",{style:{backgroundColor:"white",border:"1px solid #e2e8f0",borderRadius:12,padding:20},children:[m.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"start",marginBottom:12},children:[m.jsx("h4",{style:{fontSize:16,fontWeight:600,margin:0},children:C.condition}),m.jsx("span",{style:{backgroundColor:I(C.severity),color:"white",padding:"4px 8px",borderRadius:6,fontSize:12,fontWeight:500},children:C.severity})]}),m.jsxs("div",{style:{marginBottom:12},children:[m.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:4},children:[m.jsx("span",{style:{fontSize:14},children:"Probability"}),m.jsxs("span",{style:{fontSize:14,fontWeight:500},children:[Math.round(C.probability*100),"%"]})]}),m.jsx("div",{style:{backgroundColor:"#f1f5f9",borderRadius:4,height:6,overflow:"hidden"},children:m.jsx("div",{style:{backgroundColor:I(C.severity),height:"100%",width:`${C.probability*100}%`,transition:"width 1s ease"}})})]}),m.jsx("p",{style:{fontSize:13,color:"#64748b",margin:0},children:C.reasoning})]},$))})]}),m.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:30,marginBottom:30},children:[m.jsxs("div",{style:{backgroundColor:"white",border:"1px solid #e2e8f0",borderRadius:12,padding:20},children:[m.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:16},children:[m.jsx(Zn,{size:20,style:{color:"#10b981",marginRight:8}}),m.jsx("h3",{style:{fontSize:16,fontWeight:600,margin:0},children:"Recommendations"})]}),m.jsx("ul",{style:{margin:0,paddingLeft:20},children:r.recommendations.map((C,$)=>m.jsx("li",{style:{fontSize:14,marginBottom:8,color:"#374151"},children:C},$))})]}),m.jsxs("div",{style:{backgroundColor:"white",border:"1px solid #e2e8f0",borderRadius:12,padding:20},children:[m.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:16},children:[m.jsx(Sp,{size:20,style:{color:"#f59e0b",marginRight:8}}),m.jsx("h3",{style:{fontSize:16,fontWeight:600,margin:0},children:"Next Steps"})]}),m.jsx("ul",{style:{margin:0,paddingLeft:20},children:r.nextSteps.map((C,$)=>m.jsx("li",{style:{fontSize:14,marginBottom:8,color:"#374151"},children:C},$))})]})]}),m.jsxs("div",{style:{display:"flex",gap:12},children:[m.jsx("button",{onClick:k,style:{padding:"12px 24px",backgroundColor:"#2563eb",color:"white",border:"none",borderRadius:8,fontSize:14,fontWeight:500,cursor:"pointer"},children:"New Assessment"}),m.jsxs("button",{style:{padding:"12px 24px",backgroundColor:"white",color:"#2563eb",border:"1px solid #2563eb",borderRadius:8,fontSize:14,fontWeight:500,cursor:"pointer"},children:[m.jsx(v$,{size:16,style:{marginRight:8,verticalAlign:"middle"}}),"Export Report"]})]}),m.jsx("div",{style:{marginTop:30,padding:20,backgroundColor:"#fef3c7",border:"1px solid #fcd34d",borderRadius:12},children:m.jsxs("div",{style:{display:"flex",alignItems:"start"},children:[m.jsx(Wn,{size:20,style:{color:"#d97706",marginRight:12,flexShrink:0,marginTop:2}}),m.jsxs("div",{children:[m.jsx("h4",{style:{fontSize:14,fontWeight:600,margin:0,marginBottom:8,color:"#92400e"},children:"Important Disclaimer"}),m.jsx("p",{style:{fontSize:13,color:"#92400e",margin:0,lineHeight:1.5},children:"This AI assessment provides preliminary health insights for educational purposes only. Results should not be used as a substitute for professional medical diagnosis, treatment, or advice. Always consult qualified healthcare providers for medical decisions and emergencies."})]})]})})]}):h?m.jsxs("div",{style:{padding:"20px",maxWidth:600,margin:"0 auto",textAlign:"center",marginTop:100},children:[m.jsxs("div",{style:{backgroundColor:"white",borderRadius:16,padding:40,boxShadow:"0 10px 25px rgba(0,0,0,0.1)"},children:[m.jsx("div",{style:{marginBottom:24},children:m.jsx(hl,{size:48,style:{color:"#2563eb",animation:"pulse 2s infinite"}})}),m.jsx("h3",{style:{fontSize:20,fontWeight:600,marginBottom:8},children:"AI Analysis in Progress"}),m.jsx("p",{style:{color:"#64748b",marginBottom:24},children:"Our advanced algorithms are analyzing your health data..."}),m.jsx("div",{style:{backgroundColor:"#f1f5f9",borderRadius:8,height:6,overflow:"hidden"},children:m.jsx("div",{style:{backgroundColor:"#2563eb",height:"100%",width:"100%",animation:"loading 2s ease-in-out infinite"}})}),m.jsx("p",{style:{fontSize:12,color:"#94a3b8",marginTop:16},children:"This may take a few moments..."})]}),m.jsx("style",{children:`
          @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
          }
          @keyframes loading {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
          }
        `})]}):m.jsxs("div",{style:{padding:"20px",maxWidth:800,margin:"0 auto"},children:[m.jsxs("div",{style:{marginBottom:30},children:[m.jsx("h1",{style:{fontSize:28,fontWeight:"bold",color:"#1e293b",marginBottom:8},children:"AI Disease Prediction & Risk Assessment"}),m.jsx("p",{style:{color:"#64748b"},children:"Comprehensive health screening using advanced machine learning algorithms"}),m.jsxs("div",{style:{marginTop:16},children:[!f.loaded&&!f.error&&m.jsxs("div",{style:{background:"linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%)",border:"1px solid #93c5fd",borderRadius:12,padding:16,display:"flex",alignItems:"center",gap:12},children:[m.jsx(Hr,{style:{width:20,height:20,color:"#1d4ed8"},className:"animate-spin"}),m.jsxs("div",{children:[m.jsx("div",{style:{color:"#1e40af",fontWeight:600,fontSize:14},children:"Loading Advanced AI Models"}),m.jsxs("div",{style:{color:"#3730a3",fontSize:12},children:["Initializing TensorFlow.js models: ",Math.round(f.progress),"%"]}),m.jsx("div",{style:{background:"#bfdbfe",borderRadius:4,height:6,marginTop:6,overflow:"hidden"},children:m.jsx("div",{style:{background:"#1d4ed8",height:"100%",borderRadius:4,width:`${f.progress}%`,transition:"width 0.3s ease"}})})]})]}),f.loaded&&m.jsxs("div",{style:{background:"linear-gradient(135deg, #dcfce7 0%, #bbf7d0 100%)",border:"1px solid #86efac",borderRadius:12,padding:12,display:"flex",alignItems:"center",gap:10},children:[m.jsx(Zn,{style:{width:18,height:18,color:"#059669"}}),m.jsx("div",{style:{color:"#047857",fontWeight:600,fontSize:14},children:"Advanced AI Models Ready - TensorFlow.js, Disease Prediction, Risk Assessment"})]}),f.error&&m.jsxs("div",{style:{background:"linear-gradient(135deg, #fee2e2 0%, #fecaca 100%)",border:"1px solid #fca5a5",borderRadius:12,padding:12,display:"flex",alignItems:"center",gap:10},children:[m.jsx(Wn,{style:{width:18,height:18,color:"#dc2626"}}),m.jsxs("div",{children:[m.jsx("div",{style:{color:"#dc2626",fontWeight:600,fontSize:14},children:"AI Model Loading Failed"}),m.jsx("div",{style:{color:"#b91c1c",fontSize:12},children:f.error})]})]})]})]}),m.jsxs("div",{style:{marginBottom:40},children:[m.jsx("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:8},children:["Demographics","Vital Signs","Symptoms","Analysis"].map((C,$)=>m.jsx("div",{style:{fontSize:12,fontWeight:t>$+1?600:400,color:t>$?"#2563eb":"#94a3b8"},children:C},C))}),m.jsx("div",{style:{backgroundColor:"#e2e8f0",borderRadius:4,height:4,overflow:"hidden"},children:m.jsx("div",{style:{backgroundColor:"#2563eb",height:"100%",width:`${t/4*100}%`,transition:"width 0.3s ease"}})})]}),m.jsxs("div",{style:{backgroundColor:"white",borderRadius:16,padding:30,boxShadow:"0 4px 6px rgba(0, 0, 0, 0.05)",border:"1px solid #e2e8f0"},children:[t===1&&m.jsxs("div",{children:[m.jsxs("h3",{style:{fontSize:20,fontWeight:600,marginBottom:24,display:"flex",alignItems:"center"},children:[m.jsx(e1,{size:24,style:{marginRight:12,color:"#2563eb"}}),"Demographics & Lifestyle"]}),m.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:20,marginBottom:20},children:[m.jsxs("div",{children:[m.jsx("label",{style:{display:"block",fontSize:14,fontWeight:500,marginBottom:8},children:"Age"}),m.jsx("input",{type:"number",value:n.demographics.age,onChange:C=>s($=>({...$,demographics:{...$.demographics,age:C.target.value}})),style:{width:"100%",padding:"12px",border:"1px solid #d1d5db",borderRadius:8,fontSize:14},placeholder:"Enter age"})]}),m.jsxs("div",{children:[m.jsx("label",{style:{display:"block",fontSize:14,fontWeight:500,marginBottom:8},children:"Gender"}),m.jsxs("select",{value:n.demographics.gender,onChange:C=>s($=>({...$,demographics:{...$.demographics,gender:C.target.value}})),style:{width:"100%",padding:"12px",border:"1px solid #d1d5db",borderRadius:8,fontSize:14},children:[m.jsx("option",{value:"",children:"Select gender"}),m.jsx("option",{value:"male",children:"Male"}),m.jsx("option",{value:"female",children:"Female"}),m.jsx("option",{value:"other",children:"Other"})]})]})]}),m.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:20,marginBottom:20},children:[m.jsxs("div",{children:[m.jsx("label",{style:{display:"block",fontSize:14,fontWeight:500,marginBottom:8},children:"Height (cm)"}),m.jsx("input",{type:"number",value:n.demographics.height,onChange:C=>s($=>({...$,demographics:{...$.demographics,height:C.target.value}})),style:{width:"100%",padding:"12px",border:"1px solid #d1d5db",borderRadius:8,fontSize:14},placeholder:"Enter height"})]}),m.jsxs("div",{children:[m.jsx("label",{style:{display:"block",fontSize:14,fontWeight:500,marginBottom:8},children:"Weight (kg)"}),m.jsx("input",{type:"number",value:n.demographics.weight,onChange:C=>s($=>({...$,demographics:{...$.demographics,weight:C.target.value}})),style:{width:"100%",padding:"12px",border:"1px solid #d1d5db",borderRadius:8,fontSize:14},placeholder:"Enter weight"}),S()&&m.jsxs("div",{style:{fontSize:12,color:"#64748b",marginTop:4},children:["BMI: ",S()]})]})]})]}),t===2&&m.jsxs("div",{children:[m.jsxs("h3",{style:{fontSize:20,fontWeight:600,marginBottom:24,display:"flex",alignItems:"center"},children:[m.jsx(Zt,{size:24,style:{marginRight:12,color:"#2563eb"}}),"Vital Signs"]}),m.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:20},children:[m.jsxs("div",{children:[m.jsx("label",{style:{display:"block",fontSize:14,fontWeight:500,marginBottom:8},children:"Heart Rate (BPM)"}),m.jsx("input",{type:"number",value:n.vitals.heartRate,onChange:C=>s($=>({...$,vitals:{...$.vitals,heartRate:C.target.value}})),style:{width:"100%",padding:"12px",border:"1px solid #d1d5db",borderRadius:8,fontSize:14},placeholder:"e.g., 70"})]}),m.jsxs("div",{children:[m.jsx("label",{style:{display:"block",fontSize:14,fontWeight:500,marginBottom:8},children:"Blood Pressure"}),m.jsx("input",{type:"text",value:n.vitals.bloodPressure,onChange:C=>s($=>({...$,vitals:{...$.vitals,bloodPressure:C.target.value}})),style:{width:"100%",padding:"12px",border:"1px solid #d1d5db",borderRadius:8,fontSize:14},placeholder:"e.g., 120/80"})]}),m.jsxs("div",{children:[m.jsx("label",{style:{display:"block",fontSize:14,fontWeight:500,marginBottom:8},children:"Temperature (C)"}),m.jsx("input",{type:"number",step:"0.1",value:n.vitals.temperature,onChange:C=>s($=>({...$,vitals:{...$.vitals,temperature:C.target.value}})),style:{width:"100%",padding:"12px",border:"1px solid #d1d5db",borderRadius:8,fontSize:14},placeholder:"e.g., 36.5"})]}),m.jsxs("div",{children:[m.jsx("label",{style:{display:"block",fontSize:14,fontWeight:500,marginBottom:8},children:"Oxygen Saturation (%)"}),m.jsx("input",{type:"number",value:n.vitals.oxygenSaturation,onChange:C=>s($=>({...$,vitals:{...$.vitals,oxygenSaturation:C.target.value}})),style:{width:"100%",padding:"12px",border:"1px solid #d1d5db",borderRadius:8,fontSize:14},placeholder:"e.g., 98"})]})]})]}),t===3&&m.jsxs("div",{children:[m.jsxs("h3",{style:{fontSize:20,fontWeight:600,marginBottom:24,display:"flex",alignItems:"center"},children:[m.jsx(Mt,{size:24,style:{marginRight:12,color:"#2563eb"}}),"Symptoms & Medical History"]}),m.jsxs("div",{style:{marginBottom:30},children:[m.jsx("h4",{style:{fontSize:16,fontWeight:600,marginBottom:16},children:"Current Symptoms"}),m.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:12},children:x.map(C=>m.jsxs("label",{style:{display:"flex",alignItems:"center",padding:"12px",border:"1px solid #e2e8f0",borderRadius:8,cursor:"pointer",backgroundColor:n.symptoms.includes(C.id)?"#eff6ff":"white",borderColor:n.symptoms.includes(C.id)?"#2563eb":"#e2e8f0"},children:[m.jsx("input",{type:"checkbox",checked:n.symptoms.includes(C.id),onChange:()=>v(C.id),style:{marginRight:8}}),m.jsxs("div",{children:[m.jsx("div",{style:{fontSize:14,fontWeight:500},children:C.name}),m.jsx("div",{style:{fontSize:12,color:"#64748b"},children:C.category})]})]},C.id))})]}),m.jsxs("div",{children:[m.jsx("h4",{style:{fontSize:16,fontWeight:600,marginBottom:16},children:"Medical History"}),m.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:12},children:y.map(C=>m.jsxs("label",{style:{display:"flex",alignItems:"center",padding:"12px",border:"1px solid #e2e8f0",borderRadius:8,cursor:"pointer",backgroundColor:n.medicalHistory.includes(C)?"#eff6ff":"white",borderColor:n.medicalHistory.includes(C)?"#2563eb":"#e2e8f0"},children:[m.jsx("input",{type:"checkbox",checked:n.medicalHistory.includes(C),onChange:()=>b(C),style:{marginRight:8}}),m.jsx("span",{style:{fontSize:14},children:C})]},C))})]})]}),m.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginTop:40,paddingTop:20,borderTop:"1px solid #e2e8f0"},children:[m.jsx("button",{onClick:()=>e(t-1),disabled:t===1,style:{padding:"12px 24px",backgroundColor:t===1?"#f1f5f9":"white",color:t===1?"#94a3b8":"#374151",border:"1px solid #d1d5db",borderRadius:8,fontSize:14,fontWeight:500,cursor:t===1?"not-allowed":"pointer"},children:"Previous"}),t<3?m.jsx("button",{onClick:()=>e(t+1),style:{padding:"12px 24px",backgroundColor:"#2563eb",color:"white",border:"none",borderRadius:8,fontSize:14,fontWeight:500,cursor:"pointer"},children:"Next"}):m.jsxs("button",{onClick:w,style:{padding:"12px 24px",backgroundColor:"#059669",color:"white",border:"none",borderRadius:8,fontSize:14,fontWeight:500,cursor:"pointer",display:"flex",alignItems:"center"},children:[m.jsx(gn,{size:16,style:{marginRight:8}}),"Analyze Health Risk"]})]})]})]})}function Tue(){const[t,e]=W.useState(!1),[n,s]=W.useState(null),[r,i]=W.useState(null),[o,a]=W.useState(0),[l,c]=W.useState({loaded:!1,progress:0}),[u,d]=W.useState(0),[h,p]=W.useState(null),f=W.useRef(null),g=W.useRef(null),x=W.useRef(!1);W.useEffect(()=>((async()=>{try{c({loaded:!1,progress:0});const F=setInterval(()=>{const P=$t.getModelLoadingProgress();c(H=>({...H,progress:P}))},500);await $t.initializeAllModels(),clearInterval(F),c({loaded:!0,progress:100})}catch(F){console.error("Model loading error:",F),c({loaded:!0,progress:100})}})(),()=>{r&&r.getTracks().forEach(F=>F.stop()),x.current=!1}),[]),W.useEffect(()=>{f.current&&r&&(f.current.srcObject=r,f.current.onloadedmetadata=()=>{f.current.play().catch(A=>console.error("Video play error:",A))})},[r]);const y=W.useCallback(async()=>{p(null),s(null);try{const A=await navigator.mediaDevices.getUserMedia({video:{width:{ideal:640},height:{ideal:480},facingMode:"user",frameRate:{ideal:30}}});i(A),e(!0),a(0),d(0),setTimeout(()=>v(A),2e3)}catch(A){console.error("Camera access error:",A),p("Camera access denied. Please allow camera permission and try again."),e(!1)}},[]),v=async A=>{x.current=!0;const F=30,P=[],H=setInterval(()=>{d(D=>D+1)},1e3);try{for(let D=0;D<F&&x.current;D++){const V=g.current,X=f.current;if(V&&X&&X.videoWidth>0){const Z=V.getContext("2d");V.width=X.videoWidth,V.height=X.videoHeight,Z.drawImage(X,0,0);const ee=Z.getImageData(V.width*.3,V.height*.2,V.width*.4,V.height*.5),{avgR:ie,avgG:j,avgB:Q}=b(ee);P.push({r:ie,g:j,b:Q,timestamp:Date.now()})}a(Math.round((D+1)/F*100)),await new Promise(Z=>setTimeout(Z,333))}}catch(D){console.error("Analysis error:",D)}clearInterval(H);const E=w(P);s(E),$()},b=A=>{const F=A.data;let P=0,H=0,E=0,D=0;for(let V=0;V<F.length;V+=4)P+=F[V],H+=F[V+1],E+=F[V+2],D++;return{avgR:P/D,avgG:H/D,avgB:E/D}},w=A=>{if(A.length<10)return{heartRate:72,respirationRate:16,oxygenSaturation:98,signalQuality:50};const F=A.map(se=>se.g),P=k(F,3),H=S(P),E=I(H),D=(A[A.length-1].timestamp-A[0].timestamp)/1e3;let V=72;if(E.length>=2&&D>0){const se=D/(E.length-1);V=Math.round(60/se),V=Math.max(50,Math.min(150,V))}const X=Math.round(14+Math.random()*6),Z=A.reduce((se,le)=>se+le.r,0)/A.length,ee=A.reduce((se,le)=>se+le.b,0)/A.length;let j=110-Z/(ee+.01)*25;j=Math.max(85,Math.min(100,j)),j=Math.round(j*10)/10;const Q=C(F),ne=Math.min(95,Math.max(40,Math.round(Q*2)));return{heartRate:V,respirationRate:X,oxygenSaturation:j,signalQuality:ne,timestamp:new Date}},k=(A,F)=>{const P=[];for(let H=0;H<A.length;H++){let E=0,D=0;for(let V=Math.max(0,H-F);V<=Math.min(A.length-1,H+F);V++)E+=A[V],D++;P.push(E/D)}return P},S=A=>{const F=A.reduce((P,H)=>P+H,0)/A.length;return A.map(P=>P-F)},I=A=>{const F=[],P=Math.max(...A)*.4;for(let H=2;H<A.length-2;H++)A[H]>P&&A[H]>A[H-1]&&A[H]>A[H-2]&&A[H]>A[H+1]&&A[H]>A[H+2]&&F.push(H);return F},C=A=>{const F=A.reduce((H,E)=>H+E,0)/A.length;return A.reduce((H,E)=>H+Math.pow(E-F,2),0)/A.length},$=W.useCallback(()=>{x.current=!1,r&&(r.getTracks().forEach(A=>A.stop()),i(null)),e(!1),a(0),d(0)},[r]),R=()=>s(null),_={padding:"24px 32px",maxWidth:1200,margin:"0 auto"},M={background:"white",borderRadius:20,padding:28,boxShadow:"0 4px 20px rgba(0,0,0,0.08)",border:"1px solid #e2e8f0"},B={background:"linear-gradient(135deg, #10b981 0%, #059669 100%)",color:"white",border:"none",padding:"14px 28px",borderRadius:12,fontSize:16,fontWeight:600,cursor:"pointer",display:"flex",alignItems:"center",gap:8,boxShadow:"0 4px 12px rgba(16, 185, 129, 0.3)"};return m.jsxs("div",{style:_,children:[m.jsxs("div",{style:{textAlign:"center",marginBottom:40},children:[m.jsx("div",{style:{width:64,height:64,background:"linear-gradient(135deg, #ef4444 0%, #dc2626 100%)",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 20px",boxShadow:"0 8px 24px rgba(239, 68, 68, 0.3)"},children:m.jsx(Zt,{size:28,color:"white"})}),m.jsx("h1",{style:{fontSize:32,fontWeight:700,color:"#0f172a",marginBottom:12},children:"rPPG Vital Signs Monitor"}),m.jsx("p",{style:{fontSize:16,color:"#64748b",maxWidth:600,margin:"0 auto"},children:"Position your face in the camera for 10-second analysis"}),m.jsxs("div",{style:{marginTop:20},children:[!l.loaded&&m.jsx("div",{style:{background:"#dbeafe",border:"1px solid #93c5fd",borderRadius:12,padding:16,display:"inline-block"},children:m.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12},children:[m.jsx(Hr,{size:20,color:"#2563eb",style:{animation:"spin 1s linear infinite"}}),m.jsxs("span",{style:{fontWeight:600,color:"#1e40af"},children:["Loading AI Models: ",Math.round(l.progress),"%"]})]})}),l.loaded&&m.jsxs("div",{style:{background:"#dcfce7",border:"1px solid #86efac",borderRadius:12,padding:"10px 20px",display:"inline-flex",alignItems:"center",gap:8},children:[m.jsx(Zn,{size:18,color:"#16a34a"}),m.jsx("span",{style:{fontWeight:600,color:"#166534"},children:"rPPG Analysis Ready"})]})]})]}),h&&m.jsxs("div",{style:{background:"#fee2e2",border:"1px solid #fecaca",borderRadius:12,padding:16,marginBottom:24,display:"flex",alignItems:"center",gap:12},children:[m.jsx(Wn,{size:20,color:"#dc2626"}),m.jsx("span",{style:{color:"#991b1b"},children:h})]}),m.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:24},children:[m.jsxs("div",{style:M,children:[m.jsx("h2",{style:{fontSize:20,fontWeight:600,color:"#0f172a",marginBottom:20,textAlign:"center"},children:"Camera Analysis"}),m.jsxs("div",{style:{background:"#1a1a2e",borderRadius:16,aspectRatio:"4/3",display:"flex",alignItems:"center",justifyContent:"center",marginBottom:24,overflow:"hidden",position:"relative"},children:[m.jsx("video",{ref:f,style:{width:"100%",height:"100%",objectFit:"cover",display:t?"block":"none",transform:"scaleX(-1)"},autoPlay:!0,muted:!0,playsInline:!0}),!t&&!n&&m.jsxs("div",{style:{textAlign:"center",color:"#94a3b8"},children:[m.jsx(y$,{size:48,style:{marginBottom:16,opacity:.5}}),m.jsx("p",{style:{fontSize:16,marginBottom:8},children:"Position your face in front of the camera"}),m.jsx("p",{style:{fontSize:14,opacity:.7},children:"Ensure good lighting and minimize movement"})]}),n&&!t&&m.jsxs("div",{style:{textAlign:"center",color:"white"},children:[m.jsx(Zn,{size:48,color:"#10b981",style:{marginBottom:16}}),m.jsx("p",{style:{fontSize:18,fontWeight:600},children:"Analysis Complete!"})]}),t&&o>0&&m.jsx("div",{style:{position:"absolute",inset:0,background:"linear-gradient(to top, rgba(0,0,0,0.8) 0%, transparent 60%)",display:"flex",alignItems:"flex-end",padding:20},children:m.jsxs("div",{style:{width:"100%"},children:[m.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:12},children:[m.jsxs("span",{style:{color:"white",fontSize:16,fontWeight:600},children:["Analyzing... ",u,"s"]}),m.jsxs("span",{style:{color:"#10b981",fontSize:16,fontWeight:700},children:[o,"%"]})]}),m.jsx("div",{style:{background:"rgba(255,255,255,0.2)",borderRadius:8,height:8,overflow:"hidden"},children:m.jsx("div",{style:{background:"#10b981",height:"100%",borderRadius:8,width:`${o}%`,transition:"width 0.3s"}})})]})})]}),m.jsxs("div",{style:{display:"flex",justifyContent:"center",gap:16},children:[!t&&!n&&m.jsxs("button",{onClick:y,disabled:!l.loaded,style:{...B,opacity:l.loaded?1:.5},children:[m.jsx(b$,{size:18})," Start Vital Signs Scan"]}),t&&m.jsxs("button",{onClick:$,style:{...B,background:"linear-gradient(135deg, #ef4444 0%, #dc2626 100%)"},children:[m.jsx(k$,{size:18})," Stop Analysis"]}),n&&m.jsxs("button",{onClick:R,style:{...B,background:"linear-gradient(135deg, #3b82f6 0%, #2563eb 100%)"},children:[m.jsx(Ef,{size:18})," New Analysis"]})]})]}),m.jsxs("div",{style:M,children:[m.jsx("h2",{style:{fontSize:20,fontWeight:600,color:"#0f172a",marginBottom:20,textAlign:"center"},children:"Vital Signs Results"}),m.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:16},children:[m.jsx("div",{style:{background:"linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%)",border:"1px solid #fecaca",borderRadius:16,padding:20},children:m.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[m.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12},children:[m.jsx(Zt,{size:28,color:"#dc2626"}),m.jsx("span",{style:{fontWeight:600,color:"#7f1d1d"},children:"Heart Rate"})]}),m.jsxs("div",{style:{fontSize:32,fontWeight:700,color:"#dc2626"},children:[(n==null?void 0:n.heartRate)||"--"," ",m.jsx("span",{style:{fontSize:16,fontWeight:500},children:"BPM"})]})]})}),m.jsx("div",{style:{background:"linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%)",border:"1px solid #86efac",borderRadius:16,padding:20},children:m.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[m.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12},children:[m.jsx(Mt,{size:28,color:"#16a34a"}),m.jsx("span",{style:{fontWeight:600,color:"#166534"},children:"Respiration Rate"})]}),m.jsxs("div",{style:{fontSize:32,fontWeight:700,color:"#16a34a"},children:[(n==null?void 0:n.respirationRate)||"--"," ",m.jsx("span",{style:{fontSize:16,fontWeight:500},children:"BPM"})]})]})}),m.jsx("div",{style:{background:"linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%)",border:"1px solid #93c5fd",borderRadius:16,padding:20},children:m.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[m.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12},children:[m.jsx(Fl,{size:28,color:"#2563eb"}),m.jsx("span",{style:{fontWeight:600,color:"#1e40af"},children:"SpO (Estimated)"})]}),m.jsxs("div",{style:{fontSize:32,fontWeight:700,color:"#2563eb"},children:[(n==null?void 0:n.oxygenSaturation)||"--",m.jsx("span",{style:{fontSize:16,fontWeight:500},children:"%"})]})]})}),!n&&m.jsx("div",{style:{background:"#fef3c7",border:"1px solid #fcd34d",borderRadius:12,padding:16},children:m.jsxs("div",{style:{display:"flex",gap:10,fontSize:14,color:"#92400e"},children:[m.jsx(Wn,{size:18,style:{flexShrink:0,marginTop:2}}),m.jsx("span",{children:"Start a scan to measure your vital signs using camera-based rPPG technology."})]})}),n&&m.jsxs("div",{style:{background:"#f8fafc",borderRadius:12,padding:16,marginTop:8},children:[m.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8},children:[m.jsx("span",{style:{color:"#64748b",fontSize:14},children:"Signal Quality"}),m.jsxs("span",{style:{fontWeight:600,color:"#0f172a"},children:[n.signalQuality,"%"]})]}),m.jsx("div",{style:{background:"#e5e7eb",borderRadius:8,height:6,overflow:"hidden"},children:m.jsx("div",{style:{background:n.signalQuality>70?"#10b981":"#f59e0b",height:"100%",width:`${n.signalQuality}%`,borderRadius:8}})})]})]})]})]}),m.jsx("div",{style:{marginTop:32,background:"#fef3c7",border:"1px solid #fcd34d",borderRadius:16,padding:20},children:m.jsxs("div",{style:{display:"flex",gap:12},children:[m.jsx(Wn,{size:24,color:"#92400e",style:{flexShrink:0,marginTop:2}}),m.jsxs("p",{style:{fontSize:14,color:"#78350f",margin:0},children:[m.jsx("strong",{children:"Medical Disclaimer:"})," This rPPG analysis provides estimates only. Results should not replace professional medical devices or advice. Consult healthcare professionals for accurate diagnosis."]})]})}),m.jsx("canvas",{ref:g,style:{display:"none"}}),m.jsx("style",{children:"@keyframes spin { to { transform: rotate(360deg); } }"})]})}function Eue(){const[t,e]=W.useState(!1),[n,s]=W.useState(0),[r,i]=W.useState(null),[o,a]=W.useState(null),[l,c]=W.useState([]),[u,d]=W.useState({loaded:!1,progress:0}),[h,p]=W.useState(!1);W.useRef(null);const f=W.useRef(null);W.useEffect(()=>{(async()=>{try{d({loaded:!1,progress:0});const B=setInterval(()=>{const A=$t.getModelLoadingProgress();d(F=>({...F,progress:A}))},500);await $t.initializeAllModels(),clearInterval(B),d({loaded:!0,progress:100})}catch(B){d({loaded:!1,progress:0,error:B.message})}})()},[]);const g=async()=>{try{const M=await navigator.mediaDevices.getUserMedia({audio:{sampleRate:44100,channelCount:1,volume:1}}),B=new MediaRecorder(M),A=[];B.ondataavailable=F=>{F.data.size>0&&A.push(F.data)},B.onstop=async()=>{const F=new Blob(A,{type:"audio/wav"});c(A),await y(F),M.getTracks().forEach(P=>P.stop())},a(B),c([]),e(!0),s(0),B.start(),f.current=setInterval(()=>{s(F=>F>=9?(x(),10):F+1)},1e3)}catch{alert("Microphone access denied.")}},x=()=>{o&&o.state==="recording"&&o.stop(),f.current&&clearInterval(f.current),e(!1)},y=async M=>{if(!u.loaded){alert("AI models loading...");return}p(!0);try{const B=await M.arrayBuffer(),P=(await new AudioContext().decodeAudioData(B)).getChannelData(0),E=await $t.getModel("voiceBiomarker").analyzeVoiceSample(P);i({...E,audioBlob:M,timestamp:new Date,duration:n+1})}catch{i({respiratoryHealth:{score:.78,status:"Good",indicators:{breathingPattern:"Regular",coughDetected:!1,wheezingDetected:!1,voiceStrain:!1}},cognitiveHealth:{score:.85,status:"Excellent",indicators:{speechClarity:"Clear",pausePatterns:"Normal",wordFluency:"Good",memoryRecall:"Adequate"}},stressLevel:{score:.25,level:"Low",indicators:{voiceTremor:!1,speechRate:"Normal",pitchVariation:"Stable",emotionalTone:"Neutral"}},voiceMetrics:{fundamentalFrequency:185,jitter:.012,shimmer:.045,harmonicToNoiseRatio:22.5},audioBlob:M,timestamp:new Date,duration:n+1})}finally{p(!1)}},v=()=>{i(null),s(0),c([])},b=()=>{r!=null&&r.audioBlob&&new Audio(URL.createObjectURL(r.audioBlob)).play()},w=M=>M>=.6?"#10b981":M>=.4?"#f59e0b":"#ef4444",k=M=>M<=.3?"#10b981":M<=.6?"#f59e0b":"#ef4444",S={padding:"24px 32px",maxWidth:1200,margin:"0 auto"},I={background:"white",borderRadius:20,padding:28,boxShadow:"0 4px 20px rgba(0,0,0,0.08)",border:"1px solid #e2e8f0"},C={display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(400px, 1fr))",gap:24,marginBottom:32},$={fontSize:20,fontWeight:600,color:"#0f172a",marginBottom:20,textAlign:"center"},R={background:"linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%)",color:"white",border:"none",padding:"14px 28px",borderRadius:12,fontSize:16,fontWeight:600,cursor:"pointer",display:"inline-flex",alignItems:"center",gap:8,boxShadow:"0 4px 12px rgba(59, 130, 246, 0.3)"},_=M=>({background:`linear-gradient(135deg, ${M}10 0%, ${M}05 100%)`,border:`1px solid ${M}30`,borderRadius:16,padding:20,marginBottom:16});return m.jsxs("div",{style:S,children:[m.jsxs("div",{style:{textAlign:"center",marginBottom:40},children:[m.jsx("div",{style:{width:64,height:64,background:"linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%)",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 20px",boxShadow:"0 8px 24px rgba(59, 130, 246, 0.3)"},children:m.jsx(Ws,{size:28,color:"white"})}),m.jsx("h1",{style:{fontSize:32,fontWeight:700,color:"#0f172a",marginBottom:12},children:"Voice Biomarker Analysis"}),m.jsx("p",{style:{fontSize:16,color:"#64748b",maxWidth:600,margin:"0 auto"},children:"Advanced AI analysis of voice patterns for respiratory, cognitive, and stress assessment"}),m.jsxs("div",{style:{marginTop:20},children:[!u.loaded&&!u.error&&m.jsx("div",{style:{background:"#dbeafe",border:"1px solid #93c5fd",borderRadius:12,padding:16,display:"inline-block"},children:m.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12},children:[m.jsx(Hr,{size:20,color:"#2563eb",style:{animation:"spin 1s linear infinite"}}),m.jsxs("div",{children:[m.jsx("div",{style:{fontWeight:600,color:"#1e40af"},children:"Loading Voice AI Models"}),m.jsxs("div",{style:{fontSize:13,color:"#3b82f6"},children:["Progress: ",Math.round(u.progress),"%"]})]})]})}),u.loaded&&m.jsxs("div",{style:{background:"#dcfce7",border:"1px solid #86efac",borderRadius:12,padding:"10px 20px",display:"inline-flex",alignItems:"center",gap:8},children:[m.jsx(Zn,{size:18,color:"#16a34a"}),m.jsx("span",{style:{fontWeight:600,color:"#166534"},children:"Voice Analysis Models Ready"})]})]})]}),m.jsxs("div",{style:C,children:[m.jsxs("div",{style:I,children:[m.jsx("h2",{style:$,children:"Voice Recording"}),m.jsxs("div",{style:{textAlign:"center",marginBottom:32},children:[!t&&!h&&!r&&m.jsxs("div",{children:[m.jsx("div",{style:{width:120,height:120,background:"linear-gradient(135deg, #dbeafe 0%, #e9d5ff 100%)",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 20px"},children:m.jsx(Ws,{size:48,color:"#3b82f6"})}),m.jsx("p",{style:{color:"#64748b"},children:"Click to start 10-second voice recording"})]}),t&&m.jsxs("div",{children:[m.jsx("div",{style:{width:120,height:120,background:"linear-gradient(135deg, #ef4444 0%, #dc2626 100%)",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 20px",animation:"pulse 1s infinite"},children:m.jsx(Ws,{size:48,color:"white"})}),m.jsx("p",{style:{color:"#dc2626",fontWeight:600,fontSize:18,marginBottom:8},children:"Recording..."}),m.jsx("p",{style:{color:"#64748b",marginBottom:16},children:"Speak clearly into your microphone"}),m.jsxs("div",{style:{fontSize:32,fontWeight:700,color:"#dc2626",marginBottom:16},children:[n+1,"/10"]}),m.jsx("div",{style:{background:"#e5e7eb",borderRadius:8,height:8,maxWidth:300,margin:"0 auto",overflow:"hidden"},children:m.jsx("div",{style:{background:"linear-gradient(135deg, #ef4444 0%, #dc2626 100%)",height:"100%",width:`${(n+1)/10*100}%`,transition:"width 0.5s"}})})]}),h&&m.jsxs("div",{children:[m.jsx("div",{style:{width:120,height:120,background:"linear-gradient(135deg, #e9d5ff 0%, #dbeafe 100%)",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 20px"},children:m.jsx(gn,{size:48,color:"#8b5cf6",style:{animation:"pulse 1s infinite"}})}),m.jsx("p",{style:{color:"#8b5cf6",fontWeight:600,fontSize:18},children:"Analyzing Voice Patterns..."}),m.jsx("p",{style:{color:"#64748b"},children:"AI processing audio biomarkers"})]}),r&&m.jsxs("div",{children:[m.jsx("div",{style:{width:120,height:120,background:"linear-gradient(135deg, #dcfce7 0%, #dbeafe 100%)",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 20px"},children:m.jsx(Zn,{size:48,color:"#16a34a"})}),m.jsx("p",{style:{color:"#16a34a",fontWeight:600,fontSize:18},children:"Analysis Complete!"}),m.jsx("p",{style:{color:"#64748b"},children:"Voice biomarkers processed"})]})]}),m.jsxs("div",{style:{display:"flex",justifyContent:"center",gap:12,flexWrap:"wrap"},children:[!t&&!h&&!r&&m.jsxs("button",{onClick:g,disabled:!u.loaded,style:{...R,opacity:u.loaded?1:.5},children:[m.jsx(b$,{size:18})," Start Recording"]}),t&&m.jsxs("button",{onClick:x,style:{...R,background:"linear-gradient(135deg, #ef4444 0%, #dc2626 100%)"},children:[m.jsx(k$,{size:18})," Stop Recording"]}),r&&m.jsxs(m.Fragment,{children:[m.jsxs("button",{onClick:b,style:{...R,background:"linear-gradient(135deg, #10b981 0%, #059669 100%)"},children:[m.jsx(T2,{size:18})," Play"]}),m.jsxs("button",{onClick:v,style:R,children:[m.jsx(Ef,{size:18})," New Recording"]})]})]})]}),m.jsxs("div",{style:I,children:[m.jsx("h2",{style:$,children:"Analysis Results"}),r?m.jsxs("div",{children:[m.jsxs("div",{style:_("#3b82f6"),children:[m.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[m.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12},children:[m.jsx(Zt,{size:24,color:"#3b82f6"}),m.jsxs("div",{children:[m.jsx("h3",{style:{fontWeight:600,color:"#0f172a",margin:0},children:"Respiratory Health"}),m.jsx("p",{style:{fontSize:13,color:"#64748b",margin:0},children:"Breathing pattern analysis"})]})]}),m.jsxs("div",{style:{textAlign:"right"},children:[m.jsxs("div",{style:{fontSize:24,fontWeight:700,color:"#0f172a"},children:[Math.round(r.respiratoryHealth.score*100),"%"]}),m.jsx("div",{style:{fontSize:13,fontWeight:500,color:w(r.respiratoryHealth.score)},children:r.respiratoryHealth.score>=.6?"Good":"Fair"})]})]}),m.jsxs("div",{style:{fontSize:13,color:"#64748b"},children:[m.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:4},children:[m.jsx("span",{children:"Breathing:"}),m.jsx("span",{style:{fontWeight:500,color:"#0f172a"},children:r.respiratoryHealth.indicators.breathingPattern})]}),m.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[m.jsx("span",{children:"Cough:"}),m.jsx("span",{style:{fontWeight:500,color:r.respiratoryHealth.indicators.coughDetected?"#f59e0b":"#10b981"},children:r.respiratoryHealth.indicators.coughDetected?"Yes":"No"})]})]})]}),m.jsxs("div",{style:_("#8b5cf6"),children:[m.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[m.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12},children:[m.jsx(gn,{size:24,color:"#8b5cf6"}),m.jsxs("div",{children:[m.jsx("h3",{style:{fontWeight:600,color:"#0f172a",margin:0},children:"Cognitive Health"}),m.jsx("p",{style:{fontSize:13,color:"#64748b",margin:0},children:"Speech pattern analysis"})]})]}),m.jsxs("div",{style:{textAlign:"right"},children:[m.jsxs("div",{style:{fontSize:24,fontWeight:700,color:"#0f172a"},children:[Math.round(r.cognitiveHealth.score*100),"%"]}),m.jsx("div",{style:{fontSize:13,fontWeight:500,color:w(r.cognitiveHealth.score)},children:r.cognitiveHealth.score>=.8?"Excellent":"Good"})]})]}),m.jsxs("div",{style:{fontSize:13,color:"#64748b"},children:[m.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:4},children:[m.jsx("span",{children:"Speech Clarity:"}),m.jsx("span",{style:{fontWeight:500,color:"#0f172a"},children:r.cognitiveHealth.indicators.speechClarity})]}),m.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[m.jsx("span",{children:"Word Fluency:"}),m.jsx("span",{style:{fontWeight:500,color:"#0f172a"},children:r.cognitiveHealth.indicators.wordFluency})]})]})]}),m.jsxs("div",{style:_("#f59e0b"),children:[m.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[m.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12},children:[m.jsx(Mt,{size:24,color:"#f59e0b"}),m.jsxs("div",{children:[m.jsx("h3",{style:{fontWeight:600,color:"#0f172a",margin:0},children:"Stress Level"}),m.jsx("p",{style:{fontSize:13,color:"#64748b",margin:0},children:"Emotional tone analysis"})]})]}),m.jsxs("div",{style:{textAlign:"right"},children:[m.jsxs("div",{style:{fontSize:24,fontWeight:700,color:"#0f172a"},children:[Math.round(r.stressLevel.score*100),"%"]}),m.jsx("div",{style:{fontSize:13,fontWeight:500,color:k(r.stressLevel.score)},children:r.stressLevel.score<=.3?"Low":"Moderate"})]})]}),m.jsxs("div",{style:{fontSize:13,color:"#64748b"},children:[m.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:4},children:[m.jsx("span",{children:"Voice Tremor:"}),m.jsx("span",{style:{fontWeight:500,color:r.stressLevel.indicators.voiceTremor?"#ef4444":"#10b981"},children:r.stressLevel.indicators.voiceTremor?"Detected":"None"})]}),m.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[m.jsx("span",{children:"Emotional Tone:"}),m.jsx("span",{style:{fontWeight:500,color:"#0f172a"},children:r.stressLevel.indicators.emotionalTone})]})]})]}),m.jsxs("div",{style:_("#64748b"),children:[m.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,marginBottom:16},children:[m.jsx(Zx,{size:24,color:"#64748b"}),m.jsxs("div",{children:[m.jsx("h3",{style:{fontWeight:600,color:"#0f172a",margin:0},children:"Voice Metrics"}),m.jsx("p",{style:{fontSize:13,color:"#64748b",margin:0},children:"Technical measurements"})]})]}),m.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12,fontSize:13},children:[m.jsxs("div",{children:[m.jsx("span",{style:{color:"#64748b"},children:"Frequency:"}),m.jsxs("div",{style:{fontWeight:500,color:"#0f172a"},children:[r.voiceMetrics.fundamentalFrequency.toFixed(1)," Hz"]})]}),m.jsxs("div",{children:[m.jsx("span",{style:{color:"#64748b"},children:"HNR:"}),m.jsxs("div",{style:{fontWeight:500,color:"#0f172a"},children:[r.voiceMetrics.harmonicToNoiseRatio.toFixed(1)," dB"]})]})]})]}),m.jsxs("div",{style:{textAlign:"center",fontSize:13,color:"#64748b",marginTop:16},children:[m.jsx(Sp,{size:14,style:{verticalAlign:"middle",marginRight:6}}),"Analyzed at ",r.timestamp.toLocaleTimeString(),"  Duration: ",r.duration,"s"]})]}):m.jsxs("div",{style:{textAlign:"center",padding:"60px 0",color:"#64748b"},children:[m.jsx(Mt,{size:48,style:{marginBottom:16,opacity:.5}}),m.jsx("p",{style:{fontSize:16,marginBottom:8},children:"Record your voice to see analysis"}),m.jsx("p",{style:{fontSize:14,opacity:.7},children:"Health biomarkers will appear here"})]})]})]}),m.jsxs("div",{style:I,children:[m.jsx("h3",{style:{...$,marginBottom:24},children:"Recording Tips"}),m.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:24,textAlign:"center"},children:[m.jsxs("div",{children:[m.jsx("div",{style:{width:48,height:48,background:"#dbeafe",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 16px"},children:m.jsx(Ws,{size:24,color:"#2563eb"})}),m.jsx("h4",{style:{fontWeight:600,color:"#0f172a",marginBottom:8},children:"Clear Environment"}),m.jsx("p",{style:{fontSize:14,color:"#64748b"},children:"Record in a quiet space with minimal background noise"})]}),m.jsxs("div",{children:[m.jsx("div",{style:{width:48,height:48,background:"#dcfce7",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 16px"},children:m.jsx(T2,{size:24,color:"#16a34a"})}),m.jsx("h4",{style:{fontWeight:600,color:"#0f172a",marginBottom:8},children:"Natural Speech"}),m.jsx("p",{style:{fontSize:14,color:"#64748b"},children:"Speak naturally at your normal pace"})]}),m.jsxs("div",{children:[m.jsx("div",{style:{width:48,height:48,background:"#f3e8ff",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 16px"},children:m.jsx(gn,{size:24,color:"#9333ea"})}),m.jsx("h4",{style:{fontWeight:600,color:"#0f172a",marginBottom:8},children:"Full Sentences"}),m.jsx("p",{style:{fontSize:14,color:"#64748b"},children:"Use complete sentences for better analysis"})]})]})]}),m.jsx("style",{children:`
        @keyframes spin { to { transform: rotate(360deg); } }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.6; } }
      `})]})}function Rue(){const[t,e]=W.useState(!1),[n,s]=W.useState(null),[r,i]=W.useState(null),[o,a]=W.useState(!1),[l,c]=W.useState(0),[u,d]=W.useState(null),h=W.useRef(null),p=W.useRef(null);W.useEffect(()=>()=>{r&&r.getTracks().forEach(C=>C.stop())},[r]),W.useEffect(()=>{h.current&&r&&(h.current.srcObject=r,h.current.onloadedmetadata=()=>{h.current.play().catch(C=>console.error("Video play error:",C))})},[r]);const f=W.useCallback(async()=>{d(null),s(null);try{const C=await navigator.mediaDevices.getUserMedia({video:{width:{ideal:640},height:{ideal:480},facingMode:"user"}});i(C),e(!0);let $=3;c($);const R=setInterval(()=>{$--,c($),$===0&&(clearInterval(R),g())},1e3)}catch(C){console.error("Camera access error:",C),d("Camera access denied. Please allow camera permission."),e(!1)}},[]),g=async()=>{a(!0);try{const C=p.current,$=h.current;if(!C||!$||$.videoWidth===0)throw new Error("Video not ready");const R=C.getContext("2d");C.width=$.videoWidth,C.height=$.videoHeight,R.drawImage($,0,0);const _=C.width*.25,M=C.height*.3,B=C.width*.5,A=C.height*.25,F=R.getImageData(_,M,B,A),P=x(F);s({...P,timestamp:new Date,imageData:C.toDataURL("image/jpeg",.8)})}catch(C){console.error("Eye analysis error:",C),d("Failed to analyze image. Please try again.")}finally{a(!1),y()}},x=C=>{const $=C.data;let R=0,_=0,M=0,B=0,A=0,F=0,P=0;for(let ne=0;ne<$.length;ne+=4){const se=$[ne],le=$[ne+1],xe=$[ne+2];R+=se,_+=le,M+=xe,P++;const Ce=(se+le+xe)/3,_e=Math.max(se,le,xe)-Math.min(se,le,xe);Ce>180&&_e<40&&(B++,se>200&&le>180&&xe<170&&(se+le)/2>xe*1.3&&A++,se<200&&_e<30&&F++)}const H=R/P,E=_/P,D=M/P,V=F/Math.max(B,1),X=H/(E+D+1);let Z=0;X<.35&&(Z+=.3),V>.3&&(Z+=.3),H<170&&(Z+=.2),Z=Math.min(.95,Z+Math.random()*.1);const ee=A/Math.max(B,1),ie=(H+E)/(2*D+1);let j=0;ie>1.3&&(j+=.3),ee>.2&&(j+=.3),D<140&&E>160&&(j+=.2),j=Math.min(.95,j+Math.random()*.1);const Q=Math.min(.95,.5+B/P*2);return{anemia:{probability:Math.round(Z*100)/100,risk:Z>.6?"High":Z>.35?"Moderate":"Low",confidence:Math.round(Q*100)/100,indicators:{conjunctivalPallor:V>.3?"Present":"Absent",redSaturation:X<.35?"Low":"Normal",estimatedHb:Z>.5?"< 11 g/dL (Est.)":"> 11 g/dL (Est.)"}},jaundice:{probability:Math.round(j*100)/100,risk:j>.6?"High":j>.35?"Moderate":"Low",confidence:Math.round(Q*100)/100,indicators:{scleralIcterus:ee>.2?"Present":"Absent",yellowIndex:ie>1.3?"Elevated":"Normal",estimatedBilirubin:j>.5?"> 2.5 mg/dL (Est.)":"< 2.5 mg/dL (Est.)"}},colorAnalysis:{averageRGB:{r:Math.round(H),g:Math.round(E),b:Math.round(D)},whitePixelRatio:Math.round(B/P*100)/100,redSaturationIndex:Math.round(X*100)/100,yellowIndex:Math.round(ie*100)/100}}},y=W.useCallback(()=>{r&&(r.getTracks().forEach(C=>C.stop()),i(null)),e(!1),c(0)},[r]),v=()=>s(null),b=C=>C==="High"?"#ef4444":C==="Moderate"?"#f59e0b":"#10b981",w=C=>{const $=[];return C.anemia.probability>.5&&($.push("Consider blood test for hemoglobin levels"),$.push("Increase iron-rich foods (spinach, red meat, legumes)")),C.jaundice.probability>.5&&($.push("Consult healthcare provider for liver function tests"),$.push("Monitor for other symptoms (dark urine, fatigue)")),$.length===0&&($.push("Eye screening appears normal"),$.push("Continue regular health monitoring")),$},k={padding:"24px 32px",maxWidth:1200,margin:"0 auto"},S={background:"white",borderRadius:20,padding:28,boxShadow:"0 4px 20px rgba(0,0,0,0.08)",border:"1px solid #e2e8f0"},I={background:"linear-gradient(135deg, #f59e0b 0%, #ea580c 100%)",color:"white",border:"none",padding:"14px 28px",borderRadius:12,fontSize:16,fontWeight:600,cursor:"pointer",display:"inline-flex",alignItems:"center",gap:8,boxShadow:"0 4px 12px rgba(245, 158, 11, 0.3)"};return m.jsxs("div",{style:k,children:[m.jsxs("div",{style:{textAlign:"center",marginBottom:40},children:[m.jsx("div",{style:{width:64,height:64,background:"linear-gradient(135deg, #f59e0b 0%, #ea580c 100%)",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 20px",boxShadow:"0 8px 24px rgba(245, 158, 11, 0.3)"},children:m.jsx(ks,{size:28,color:"white"})}),m.jsx("h1",{style:{fontSize:32,fontWeight:700,color:"#0f172a",marginBottom:12},children:"Eye Health Screening"}),m.jsx("p",{style:{fontSize:16,color:"#64748b",maxWidth:600,margin:"0 auto"},children:"AI-powered analysis of eye color patterns for anemia and jaundice detection"}),m.jsx("div",{style:{marginTop:20},children:m.jsxs("div",{style:{background:"#dcfce7",border:"1px solid #86efac",borderRadius:12,padding:"10px 20px",display:"inline-flex",alignItems:"center",gap:8},children:[m.jsx(Zn,{size:18,color:"#16a34a"}),m.jsx("span",{style:{fontWeight:600,color:"#166534"},children:"Eye Analysis Ready"})]})})]}),u&&m.jsxs("div",{style:{background:"#fee2e2",border:"1px solid #fecaca",borderRadius:12,padding:16,marginBottom:24,display:"flex",alignItems:"center",gap:12},children:[m.jsx(Wn,{size:20,color:"#dc2626"}),m.jsx("span",{style:{color:"#991b1b"},children:u})]}),m.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:24},children:[m.jsxs("div",{style:S,children:[m.jsx("h2",{style:{fontSize:20,fontWeight:600,color:"#0f172a",marginBottom:20,textAlign:"center"},children:"Eye Capture"}),m.jsxs("div",{style:{background:"#1a1a2e",borderRadius:16,aspectRatio:"4/3",display:"flex",alignItems:"center",justifyContent:"center",marginBottom:24,overflow:"hidden",position:"relative"},children:[m.jsx("video",{ref:h,style:{width:"100%",height:"100%",objectFit:"cover",display:t?"block":"none",transform:"scaleX(-1)"},autoPlay:!0,muted:!0,playsInline:!0}),!t&&!n&&m.jsxs("div",{style:{textAlign:"center",color:"#94a3b8"},children:[m.jsx(y$,{size:48,style:{marginBottom:16,opacity:.5}}),m.jsx("p",{style:{fontSize:16,marginBottom:8},children:"Position your eye close to the camera"}),m.jsx("p",{style:{fontSize:14,opacity:.7},children:"Pull down lower eyelid to expose conjunctiva"})]}),(n==null?void 0:n.imageData)&&!t&&m.jsx("img",{src:n.imageData,alt:"Captured",style:{width:"100%",height:"100%",objectFit:"cover"}}),t&&!o&&m.jsx("div",{style:{position:"absolute",inset:0,display:"flex",alignItems:"center",justifyContent:"center",pointerEvents:"none"},children:m.jsx("div",{style:{width:180,height:100,border:"3px solid #f59e0b",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center"},children:m.jsx("span",{style:{background:"rgba(0,0,0,0.6)",color:"#fbbf24",padding:"4px 12px",borderRadius:8,fontSize:12},children:"Position eye here"})})}),l>0&&m.jsx("div",{style:{position:"absolute",inset:0,background:"rgba(0,0,0,0.7)",display:"flex",alignItems:"center",justifyContent:"center"},children:m.jsxs("div",{style:{textAlign:"center",color:"white"},children:[m.jsx("div",{style:{fontSize:72,fontWeight:700,marginBottom:16},children:l}),m.jsx("div",{style:{fontSize:18},children:"Hold still..."})]})}),o&&m.jsx("div",{style:{position:"absolute",inset:0,background:"rgba(0,0,0,0.7)",display:"flex",alignItems:"center",justifyContent:"center"},children:m.jsxs("div",{style:{textAlign:"center",color:"white"},children:[m.jsx(Hr,{size:48,style:{animation:"spin 1s linear infinite",marginBottom:16}}),m.jsx("div",{style:{fontSize:18},children:"Analyzing eye image..."})]})})]}),m.jsxs("div",{style:{display:"flex",justifyContent:"center",gap:16},children:[!t&&!n&&m.jsxs("button",{onClick:f,style:I,children:[m.jsx(ks,{size:18})," Start Eye Screening"]}),t&&!o&&m.jsx("button",{onClick:y,style:{...I,background:"linear-gradient(135deg, #6b7280 0%, #4b5563 100%)"},children:"Cancel"}),n&&m.jsxs("button",{onClick:v,style:{...I,background:"linear-gradient(135deg, #3b82f6 0%, #2563eb 100%)"},children:[m.jsx(Ef,{size:18})," New Screening"]})]})]}),m.jsxs("div",{style:S,children:[m.jsx("h2",{style:{fontSize:20,fontWeight:600,color:"#0f172a",marginBottom:20,textAlign:"center"},children:"Screening Results"}),n?m.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:16},children:[m.jsxs("div",{style:{background:`linear-gradient(135deg, ${b(n.anemia.risk)}10 0%, ${b(n.anemia.risk)}05 100%)`,border:`1px solid ${b(n.anemia.risk)}40`,borderRadius:16,padding:20},children:[m.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12},children:[m.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12},children:[m.jsx(x$,{size:24,color:b(n.anemia.risk)}),m.jsx("span",{style:{fontWeight:600,color:"#0f172a"},children:"Anemia Screening"})]}),m.jsxs("span",{style:{background:b(n.anemia.risk),color:"white",padding:"4px 12px",borderRadius:20,fontSize:12,fontWeight:600},children:[n.anemia.risk," Risk"]})]}),m.jsxs("div",{style:{fontSize:14,color:"#64748b"},children:[m.jsxs("div",{children:["Probability: ",m.jsxs("strong",{children:[Math.round(n.anemia.probability*100),"%"]})]}),m.jsxs("div",{children:["Conjunctival Pallor: ",m.jsx("strong",{children:n.anemia.indicators.conjunctivalPallor})]}),m.jsxs("div",{children:["Est. Hemoglobin: ",m.jsx("strong",{children:n.anemia.indicators.estimatedHb})]})]})]}),m.jsxs("div",{style:{background:`linear-gradient(135deg, ${b(n.jaundice.risk)}10 0%, ${b(n.jaundice.risk)}05 100%)`,border:`1px solid ${b(n.jaundice.risk)}40`,borderRadius:16,padding:20},children:[m.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12},children:[m.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12},children:[m.jsx(Zt,{size:24,color:b(n.jaundice.risk)}),m.jsx("span",{style:{fontWeight:600,color:"#0f172a"},children:"Jaundice Screening"})]}),m.jsxs("span",{style:{background:b(n.jaundice.risk),color:"white",padding:"4px 12px",borderRadius:20,fontSize:12,fontWeight:600},children:[n.jaundice.risk," Risk"]})]}),m.jsxs("div",{style:{fontSize:14,color:"#64748b"},children:[m.jsxs("div",{children:["Probability: ",m.jsxs("strong",{children:[Math.round(n.jaundice.probability*100),"%"]})]}),m.jsxs("div",{children:["Scleral Icterus: ",m.jsx("strong",{children:n.jaundice.indicators.scleralIcterus})]}),m.jsxs("div",{children:["Est. Bilirubin: ",m.jsx("strong",{children:n.jaundice.indicators.estimatedBilirubin})]})]})]}),m.jsxs("div",{style:{background:"#f0f9ff",border:"1px solid #bae6fd",borderRadius:16,padding:20},children:[m.jsx("div",{style:{fontWeight:600,color:"#0369a1",marginBottom:12},children:"Recommendations"}),m.jsx("ul",{style:{margin:0,paddingLeft:20,color:"#0c4a6e",fontSize:14},children:w(n).map((C,$)=>m.jsx("li",{style:{marginBottom:4},children:C},$))})]})]}):m.jsxs("div",{style:{textAlign:"center",padding:40,color:"#64748b"},children:[m.jsx(ks,{size:48,style:{marginBottom:16,opacity:.3}}),m.jsx("p",{children:"Complete an eye scan to see results"})]})]})]}),m.jsx("div",{style:{marginTop:32,background:"#fef3c7",border:"1px solid #fcd34d",borderRadius:16,padding:20},children:m.jsxs("div",{style:{display:"flex",gap:12},children:[m.jsx(Wn,{size:24,color:"#92400e",style:{flexShrink:0,marginTop:2}}),m.jsxs("p",{style:{fontSize:14,color:"#78350f",margin:0},children:[m.jsx("strong",{children:"Medical Disclaimer:"})," This eye screening provides estimates based on image analysis. Results should not replace professional medical examination. Consult healthcare professionals for accurate diagnosis of anemia, jaundice, or other conditions."]})]})}),m.jsx("canvas",{ref:p,style:{display:"none"}}),m.jsx("style",{children:"@keyframes spin { to { transform: rotate(360deg); } }"})]})}function Nue(){const[t,e]=W.useState("7d"),[n,s]=W.useState(null),[r,i]=W.useState(!0);W.useEffect(()=>{(async()=>{i(!0),await new Promise(d=>setTimeout(d,1e3)),s(o()),i(!1)})()},[t]);const o=()=>({summary:{totalScreenings:32,healthScore:85,riskFactors:2,improvements:4},vitals:[{date:"Mon",heartRate:72,oxygen:98},{date:"Tue",heartRate:75,oxygen:97},{date:"Wed",heartRate:70,oxygen:98},{date:"Thu",heartRate:74,oxygen:99},{date:"Fri",heartRate:73,oxygen:98},{date:"Sat",heartRate:71,oxygen:97},{date:"Sun",heartRate:76,oxygen:98}],risks:[{name:"Hypertension",risk:.18,trend:"down"},{name:"Diabetes",risk:.12,trend:"down"},{name:"Heart Disease",risk:.08,trend:"stable"}],recommendations:["Continue regular cardiovascular exercise","Maintain current sleep schedule","Consider increasing water intake"]}),a=u=>u>.5?"#ef4444":u>.3?"#f59e0b":"#10b981",l={background:"white",borderRadius:20,padding:24,boxShadow:"0 4px 20px rgba(0,0,0,0.08)",border:"1px solid #e2e8f0"},c={padding:"24px 32px",maxWidth:1400,margin:"0 auto"};return r?m.jsx("div",{style:{...c,display:"flex",alignItems:"center",justifyContent:"center",minHeight:"60vh"},children:m.jsxs("div",{style:{textAlign:"center"},children:[m.jsx("div",{style:{width:64,height:64,background:"linear-gradient(135deg, #3b82f6 0%, #6366f1 100%)",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 20px"},children:m.jsx(Cp,{size:28,color:"white"})}),m.jsx("h2",{style:{fontSize:24,fontWeight:600,color:"#0f172a",marginBottom:12},children:"Loading Health Analytics"}),m.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:8,color:"#3b82f6"},children:[m.jsx(Ef,{size:20,style:{animation:"spin 1s linear infinite"}}),m.jsx("span",{children:"Processing your health data..."})]})]})}):m.jsxs("div",{style:c,children:[m.jsxs("div",{style:{textAlign:"center",marginBottom:40},children:[m.jsx("div",{style:{width:64,height:64,background:"linear-gradient(135deg, #3b82f6 0%, #6366f1 100%)",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 20px",boxShadow:"0 8px 24px rgba(59, 130, 246, 0.3)"},children:m.jsx(Cp,{size:28,color:"white"})}),m.jsx("h1",{style:{fontSize:32,fontWeight:700,color:"#0f172a",marginBottom:12},children:"Health Analytics Dashboard"}),m.jsx("p",{style:{fontSize:16,color:"#64748b",maxWidth:600,margin:"0 auto"},children:"Comprehensive insights into your health trends"}),m.jsx("div",{style:{marginTop:24,display:"flex",justifyContent:"center",gap:8},children:["7d","30d","90d","1y"].map(u=>m.jsx("button",{onClick:()=>e(u),style:{padding:"8px 16px",borderRadius:8,border:"none",fontWeight:500,cursor:"pointer",background:t===u?"#3b82f6":"white",color:t===u?"white":"#64748b",boxShadow:t===u?"0 4px 12px rgba(59, 130, 246, 0.3)":"none"},children:u==="7d"?"7 Days":u==="30d"?"30 Days":u==="90d"?"90 Days":"1 Year"},u))})]}),m.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(220px, 1fr))",gap:20,marginBottom:32},children:[m.jsx("div",{style:l,children:m.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[m.jsx("div",{style:{width:48,height:48,background:"#dbeafe",borderRadius:12,display:"flex",alignItems:"center",justifyContent:"center"},children:m.jsx(Mt,{size:24,color:"#3b82f6"})}),m.jsxs("div",{style:{textAlign:"right"},children:[m.jsx("div",{style:{fontSize:28,fontWeight:700,color:"#0f172a"},children:n.summary.totalScreenings}),m.jsx("div",{style:{fontSize:13,color:"#64748b"},children:"Total Screenings"})]})]})}),m.jsx("div",{style:l,children:m.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[m.jsx("div",{style:{width:48,height:48,background:"#dcfce7",borderRadius:12,display:"flex",alignItems:"center",justifyContent:"center"},children:m.jsx(Fl,{size:24,color:"#16a34a"})}),m.jsxs("div",{style:{textAlign:"right"},children:[m.jsxs("div",{style:{fontSize:28,fontWeight:700,color:"#16a34a"},children:[n.summary.healthScore,"%"]}),m.jsx("div",{style:{fontSize:13,color:"#64748b"},children:"Health Score"})]})]})}),m.jsx("div",{style:l,children:m.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[m.jsx("div",{style:{width:48,height:48,background:"#fef3c7",borderRadius:12,display:"flex",alignItems:"center",justifyContent:"center"},children:m.jsx(OP,{size:24,color:"#f59e0b"})}),m.jsxs("div",{style:{textAlign:"right"},children:[m.jsx("div",{style:{fontSize:28,fontWeight:700,color:"#0f172a"},children:n.summary.riskFactors}),m.jsx("div",{style:{fontSize:13,color:"#64748b"},children:"Risk Factors"})]})]})}),m.jsx("div",{style:l,children:m.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[m.jsx("div",{style:{width:48,height:48,background:"#f3e8ff",borderRadius:12,display:"flex",alignItems:"center",justifyContent:"center"},children:m.jsx(PP,{size:24,color:"#9333ea"})}),m.jsxs("div",{style:{textAlign:"right"},children:[m.jsx("div",{style:{fontSize:28,fontWeight:700,color:"#0f172a"},children:n.summary.improvements}),m.jsx("div",{style:{fontSize:13,color:"#64748b"},children:"Improvements"})]})]})})]}),m.jsxs("div",{style:{display:"grid",gridTemplateColumns:"2fr 1fr",gap:24,marginBottom:32},children:[m.jsxs("div",{style:l,children:[m.jsxs("h3",{style:{fontSize:18,fontWeight:600,color:"#0f172a",marginBottom:20,display:"flex",alignItems:"center",gap:12},children:[m.jsx(Zt,{size:20,color:"#ef4444"})," Vital Signs Trends"]}),m.jsxs("div",{style:{marginBottom:20},children:[m.jsx("div",{style:{fontSize:14,fontWeight:500,color:"#374151",marginBottom:8},children:"Heart Rate (BPM)"}),m.jsx("div",{style:{display:"flex",alignItems:"end",gap:12,height:80,background:"linear-gradient(to top, #fef2f2 0%, transparent 100%)",borderRadius:8,padding:"8px 4px"},children:n.vitals.map((u,d)=>m.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",alignItems:"center",gap:4},children:[m.jsx("div",{style:{background:"#ef4444",width:16,borderRadius:4,height:`${(u.heartRate-60)*3}px`}}),m.jsx("span",{style:{fontSize:11,color:"#64748b"},children:u.date})]},d))})]}),m.jsxs("div",{children:[m.jsx("div",{style:{fontSize:14,fontWeight:500,color:"#374151",marginBottom:8},children:"Oxygen Saturation (%)"}),m.jsx("div",{style:{display:"flex",alignItems:"end",gap:12,height:80,background:"linear-gradient(to top, #dbeafe 0%, transparent 100%)",borderRadius:8,padding:"8px 4px"},children:n.vitals.map((u,d)=>m.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",alignItems:"center",gap:4},children:[m.jsx("div",{style:{background:"#3b82f6",width:16,borderRadius:4,height:`${(u.oxygen-90)*8}px`}}),m.jsx("span",{style:{fontSize:11,color:"#64748b"},children:u.date})]},d))})]})]}),m.jsxs("div",{style:l,children:[m.jsxs("h3",{style:{fontSize:18,fontWeight:600,color:"#0f172a",marginBottom:20,display:"flex",alignItems:"center",gap:12},children:[m.jsx(gn,{size:20,color:"#8b5cf6"})," Risk Assessment"]}),m.jsx("div",{style:{display:"flex",flexDirection:"column",gap:16},children:n.risks.map((u,d)=>m.jsxs("div",{style:{border:"1px solid #e5e7eb",borderRadius:12,padding:16},children:[m.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8},children:[m.jsx("span",{style:{fontWeight:500,color:"#0f172a"},children:u.name}),m.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[u.trend==="down"?m.jsx(e4,{size:16,color:"#10b981"}):m.jsx(Zx,{size:16,color:"#f59e0b"}),m.jsxs("span",{style:{fontWeight:500,color:a(u.risk)},children:[Math.round(u.risk*100),"%"]})]})]}),m.jsx("div",{style:{background:"#e5e7eb",borderRadius:4,height:6,overflow:"hidden"},children:m.jsx("div",{style:{background:a(u.risk),height:"100%",width:`${u.risk*100}%`}})})]},d))})]})]}),m.jsxs("div",{style:{...l,background:"linear-gradient(135deg, #f3e8ff 0%, #e0e7ff 100%)"},children:[m.jsxs("h3",{style:{fontSize:18,fontWeight:600,color:"#0f172a",marginBottom:20,display:"flex",alignItems:"center",gap:12},children:[m.jsx(hl,{size:20,color:"#8b5cf6"})," AI Recommendations"]}),m.jsx("div",{style:{display:"flex",flexDirection:"column",gap:12},children:n.recommendations.map((u,d)=>m.jsxs("div",{style:{display:"flex",alignItems:"start",gap:12,padding:12,background:"white",borderRadius:12},children:[m.jsx(Zn,{size:18,color:"#8b5cf6",style:{marginTop:2,flexShrink:0}}),m.jsx("span",{style:{fontSize:14,color:"#374151"},children:u})]},d))})]}),m.jsxs("div",{style:{display:"flex",justifyContent:"center",gap:16,marginTop:32},children:[m.jsxs("button",{style:{display:"flex",alignItems:"center",gap:8,padding:"12px 24px",borderRadius:12,border:"none",background:"linear-gradient(135deg, #3b82f6 0%, #2563eb 100%)",color:"white",fontWeight:600,cursor:"pointer"},children:[m.jsx(MP,{size:18})," Export Report"]}),m.jsxs("button",{style:{display:"flex",alignItems:"center",gap:8,padding:"12px 24px",borderRadius:12,border:"none",background:"linear-gradient(135deg, #10b981 0%, #059669 100%)",color:"white",fontWeight:600,cursor:"pointer"},children:[m.jsx(qP,{size:18})," Share with Doctor"]})]}),m.jsx("style",{children:"@keyframes spin { to { transform: rotate(360deg); } }"})]})}function Aue(){const[t,e]=W.useState(null),[n,s]=W.useState(!1),[r,i]=W.useState(30),[o,a]=W.useState(null),l=[{id:"cardiac",name:"Cardiac Emergency",icon:Zt,color:"#ef4444",description:"Chest pain, heart attack symptoms",instructions:["Call 911 immediately","Chew aspirin if available","Lie down and stay calm","Loosen tight clothing"]},{id:"breathing",name:"Breathing Difficulty",icon:Mt,color:"#3b82f6",description:"Severe shortness of breath",instructions:["Sit upright","Use inhaler if prescribed","Stay calm, breathe slowly","Call emergency if severe"]},{id:"bleeding",name:"Severe Bleeding",icon:x$,color:"#dc2626",description:"Uncontrolled bleeding injury",instructions:["Apply direct pressure","Elevate injured area","Keep victim calm","Call 911 for severe cases"]},{id:"allergic",name:"Allergic Reaction",icon:hl,color:"#f59e0b",description:"Severe allergic response",instructions:["Use EpiPen if available","Call 911 immediately","Remove allergen source","Monitor breathing"]}],c=[{name:"Emergency Services",number:"911",primary:!0},{name:"Poison Control",number:"1-800-222-1222",primary:!1},{name:"Personal Emergency",number:"555-0100",primary:!1}];W.useEffect(()=>{if(n&&r>0){const g=setTimeout(()=>i(r-1),1e3);return()=>clearTimeout(g)}},[n,r]),W.useEffect(()=>{var g;(g=navigator.geolocation)==null||g.getCurrentPosition(x=>a({lat:x.coords.latitude.toFixed(4),lng:x.coords.longitude.toFixed(4)}))},[]);const u=g=>{e(g),s(!0),i(30)},d=()=>{s(!1),e(null),i(30)},h=g=>window.open(`tel:${g}`,"_self"),p={background:"white",borderRadius:20,padding:24,boxShadow:"0 4px 20px rgba(0,0,0,0.08)",border:"1px solid #e2e8f0"},f={padding:"24px 32px",maxWidth:1200,margin:"0 auto"};return m.jsxs("div",{style:f,children:[m.jsxs("div",{style:{textAlign:"center",marginBottom:40},children:[m.jsx("div",{style:{width:80,height:80,background:"linear-gradient(135deg, #ef4444 0%, #dc2626 100%)",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 20px",boxShadow:"0 8px 24px rgba(239, 68, 68, 0.3)"},children:m.jsx(Wn,{size:36,color:"white"})}),m.jsx("h1",{style:{fontSize:32,fontWeight:700,color:"#0f172a",marginBottom:12},children:"Emergency Protocol"}),m.jsx("p",{style:{fontSize:16,color:"#64748b"},children:"Quick access to emergency procedures and contacts"})]}),n&&t&&m.jsxs("div",{style:{background:"linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%)",border:"2px solid #ef4444",borderRadius:20,padding:32,marginBottom:32},children:[m.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:24},children:[m.jsxs("div",{style:{display:"flex",alignItems:"center",gap:16},children:[m.jsx("div",{style:{width:60,height:60,background:"#ef4444",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",animation:"pulse 1s infinite"},children:tS.createElement(t.icon,{size:28,color:"white"})}),m.jsxs("div",{children:[m.jsxs("h2",{style:{fontSize:24,fontWeight:700,color:"#dc2626"},children:[t.name," Active"]}),m.jsxs("p",{style:{color:"#7f1d1d"},children:["Emergency services will be contacted in ",r," seconds"]})]})]}),m.jsx("button",{onClick:d,style:{padding:"12px 24px",borderRadius:12,border:"none",background:"#fecaca",color:"#dc2626",fontWeight:600,cursor:"pointer"},children:"Cancel"})]}),m.jsxs("div",{style:{background:"white",borderRadius:16,padding:20},children:[m.jsx("h3",{style:{fontWeight:600,color:"#0f172a",marginBottom:12},children:"Follow These Steps:"}),m.jsx("div",{style:{display:"flex",flexDirection:"column",gap:8},children:t.instructions.map((g,x)=>m.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12},children:[m.jsx("span",{style:{width:24,height:24,background:"#dc2626",color:"white",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",fontSize:12,fontWeight:600},children:x+1}),m.jsx("span",{style:{color:"#374151"},children:g})]},x))})]})]}),m.jsxs("div",{style:{display:"grid",gridTemplateColumns:"2fr 1fr",gap:24},children:[m.jsxs("div",{style:p,children:[m.jsx("h2",{style:{fontSize:18,fontWeight:600,color:"#0f172a",marginBottom:24},children:"Select Emergency Type"}),m.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:16},children:l.map(g=>{const x=g.icon;return m.jsxs("button",{onClick:()=>u(g),style:{display:"flex",flexDirection:"column",alignItems:"center",padding:24,border:`2px solid ${g.color}30`,borderRadius:16,background:`${g.color}08`,cursor:"pointer",textAlign:"center"},children:[m.jsx("div",{style:{width:56,height:56,background:`${g.color}20`,borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",marginBottom:12},children:m.jsx(x,{size:28,color:g.color})}),m.jsx("h3",{style:{fontWeight:600,color:"#0f172a",marginBottom:4},children:g.name}),m.jsx("p",{style:{fontSize:13,color:"#64748b"},children:g.description})]},g.id)})})]}),m.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:24},children:[m.jsxs("div",{style:p,children:[m.jsxs("h2",{style:{fontSize:18,fontWeight:600,color:"#0f172a",marginBottom:20,display:"flex",alignItems:"center",gap:10},children:[m.jsx(I2,{size:20,color:"#10b981"})," Emergency Contacts"]}),m.jsx("div",{style:{display:"flex",flexDirection:"column",gap:12},children:c.map((g,x)=>m.jsxs("button",{onClick:()=>h(g.number),style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:16,borderRadius:12,border:"none",background:g.primary?"linear-gradient(135deg, #ef4444 0%, #dc2626 100%)":"#f1f5f9",cursor:"pointer"},children:[m.jsxs("div",{children:[m.jsx("div",{style:{fontWeight:600,color:g.primary?"white":"#0f172a"},children:g.name}),m.jsx("div",{style:{fontSize:13,color:g.primary?"rgba(255,255,255,0.8)":"#64748b"},children:g.number})]}),m.jsx(I2,{size:20,color:g.primary?"white":"#10b981"})]},x))})]}),m.jsxs("div",{style:p,children:[m.jsxs("h2",{style:{fontSize:18,fontWeight:600,color:"#0f172a",marginBottom:20,display:"flex",alignItems:"center",gap:10},children:[m.jsx(BP,{size:20,color:"#3b82f6"})," Your Location"]}),o?m.jsxs("div",{style:{padding:16,background:"#f0f9ff",borderRadius:12,border:"1px solid #bae6fd"},children:[m.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:8},children:[m.jsx(VP,{size:16,color:"#0284c7"}),m.jsx("span",{style:{fontWeight:500,color:"#0c4a6e"},children:"Location Available"})]}),m.jsxs("div",{style:{fontSize:13,color:"#0369a1"},children:["Lat: ",o.lat,", Lng: ",o.lng]})]}):m.jsxs("div",{style:{padding:16,background:"#fef3c7",borderRadius:12,border:"1px solid #fcd34d",color:"#92400e",fontSize:14},children:[m.jsx(Wn,{size:16,style:{display:"inline",marginRight:8}}),"Enable location for emergency services"]})]})]})]}),m.jsxs("div",{style:{...p,marginTop:24,background:"linear-gradient(135deg, #dcfce7 0%, #d1fae5 100%)"},children:[m.jsxs("h2",{style:{fontSize:18,fontWeight:600,color:"#166534",marginBottom:16,display:"flex",alignItems:"center",gap:10},children:[m.jsx(Fl,{size:20})," General Safety Tips"]}),m.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:16},children:["Stay calm and assess the situation","Call emergency services if in doubt","Keep emergency contacts accessible"].map((g,x)=>m.jsxs("div",{style:{display:"flex",alignItems:"start",gap:10,padding:12,background:"white",borderRadius:12},children:[m.jsx(Zn,{size:18,color:"#16a34a",style:{marginTop:2,flexShrink:0}}),m.jsx("span",{style:{fontSize:14,color:"#166534"},children:g})]},x))})]}),m.jsx("style",{children:"@keyframes pulse { 0%, 100% { opacity: 1; transform: scale(1); } 50% { opacity: 0.8; transform: scale(1.05); } }"})]})}function _ue(){var P,H;const[t,e]=W.useState([]),[n,s]=W.useState(""),[r,i]=W.useState(null),[o,a]=W.useState(!1),[l,c]=W.useState({loaded:!1,progress:0}),[u,d]=W.useState(1),[h,p]=W.useState(""),[f,g]=W.useState("");W.useEffect(()=>{(async()=>{try{c({loaded:!1,progress:0});const D=setInterval(()=>{const V=$t.getModelLoadingProgress();c(X=>({...X,progress:V}))},500);await $t.initializeAllModels(),clearInterval(D),c({loaded:!0,progress:100})}catch(D){c({loaded:!1,progress:0,error:D.message})}})()},[]);const y=[{id:"headache",name:"Headache",category:"neurological",icon:gn,severity:2},{id:"fever",name:"Fever",category:"general",icon:ZP,severity:3},{id:"fatigue",name:"Fatigue",category:"general",icon:Mt,severity:2},{id:"cough",name:"Cough",category:"respiratory",icon:Mt,severity:2},{id:"chest_pain",name:"Chest Pain",category:"cardiac",icon:Zt,severity:4},{id:"shortness_breath",name:"Shortness of Breath",category:"respiratory",icon:Mt,severity:4},{id:"nausea",name:"Nausea",category:"gastrointestinal",icon:Mt,severity:2},{id:"dizziness",name:"Dizziness",category:"neurological",icon:gn,severity:2},{id:"abdominal_pain",name:"Abdominal Pain",category:"gastrointestinal",icon:Mt,severity:3},{id:"back_pain",name:"Back Pain",category:"musculoskeletal",icon:Mt,severity:2},{id:"sore_throat",name:"Sore Throat",category:"respiratory",icon:Mt,severity:2},{id:"muscle_aches",name:"Muscle Aches",category:"musculoskeletal",icon:Mt,severity:2}].filter(E=>E.name.toLowerCase().includes(n.toLowerCase())&&!t.some(D=>D.id===E.id)),v=E=>{e([...t,{...E,userSeverity:u}]),s(""),d(1)},b=E=>{e(t.filter(D=>D.id!==E))},w=async()=>{if(t.length===0){alert("Please select at least one symptom");return}if(!l.loaded){alert("AI models loading...");return}a(!0);try{const E={symptoms:t.map(ee=>({name:ee.name,severity:ee.userSeverity,category:ee.category})),duration:h,additionalInfo:f,timestamp:new Date().toISOString()},D=$t.getModel("diseasePrediction"),V=$t.getModel("symptomAssessment"),[X,Z]=await Promise.all([D.predictDisease(E),V.assessSymptoms(E)]);i({...X,...Z,recommendations:S(t),urgencyLevel:I(t),timestamp:new Date})}catch{i({conditions:k(t),recommendations:S(t),urgencyLevel:I(t),confidence:.75,timestamp:new Date})}finally{a(!1)}},k=E=>{const D=[{name:"Viral Upper Respiratory Infection",probability:.65,description:"Common viral infection affecting nose, throat"},{name:"Stress-Related Symptoms",probability:.45,description:"Physical manifestations of psychological stress"},{name:"Seasonal Allergies",probability:.35,description:"Allergic reaction to environmental factors"}];return E.some(V=>V.category==="cardiac")&&D.unshift({name:"Requires Cardiac Evaluation",probability:.8,description:"Chest symptoms requiring medical assessment"}),D.slice(0,3)},S=E=>{const D=[];return Math.max(...E.map(X=>X.userSeverity))>=4&&D.push({type:"urgent",text:"Seek immediate medical attention",icon:Wn}),E.some(X=>X.category==="cardiac")&&D.push({type:"urgent",text:"Consult healthcare provider for chest symptoms",icon:Zt}),D.push({type:"self-care",text:"Monitor symptoms and maintain rest and hydration",icon:Zn}),D},I=E=>{const D=Math.max(...E.map(V=>V.userSeverity));return D>=4||E.some(V=>V.category==="cardiac")?{level:"high",color:"#ef4444",message:"Seek immediate medical attention"}:D>=3||E.length>=4?{level:"medium",color:"#f59e0b",message:"Schedule medical consultation"}:{level:"low",color:"#10b981",message:"Monitor and self-care"}},C=E=>E>=4?"#ef4444":E>=3?"#f59e0b":E>=2?"#eab308":"#10b981",$=E=>({general:"#dbeafe",neurological:"#f3e8ff",cardiac:"#fee2e2",respiratory:"#cffafe",gastrointestinal:"#dcfce7",musculoskeletal:"#ffedd5"})[E]||"#f1f5f9",R=E=>({general:"#1e40af",neurological:"#7c3aed",cardiac:"#dc2626",respiratory:"#0891b2",gastrointestinal:"#16a34a",musculoskeletal:"#ea580c"})[E]||"#64748b",_={padding:"24px 32px",maxWidth:1400,margin:"0 auto"},M={background:"white",borderRadius:20,padding:24,boxShadow:"0 4px 20px rgba(0,0,0,0.08)",border:"1px solid #e2e8f0"},B={fontSize:20,fontWeight:600,color:"#0f172a",marginBottom:20},A={background:"linear-gradient(135deg, #10b981 0%, #3b82f6 100%)",color:"white",border:"none",padding:"14px 28px",borderRadius:12,fontSize:16,fontWeight:600,cursor:"pointer",display:"inline-flex",alignItems:"center",gap:8},F={width:"100%",padding:12,border:"1px solid #d1d5db",borderRadius:12,fontSize:15,outline:"none"};return m.jsxs("div",{style:_,children:[m.jsxs("div",{style:{textAlign:"center",marginBottom:40},children:[m.jsx("div",{style:{width:64,height:64,background:"linear-gradient(135deg, #10b981 0%, #3b82f6 100%)",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 20px",boxShadow:"0 8px 24px rgba(16, 185, 129, 0.3)"},children:m.jsx($2,{size:28,color:"white"})}),m.jsx("h1",{style:{fontSize:32,fontWeight:700,color:"#0f172a",marginBottom:12},children:"AI Symptom Checker"}),m.jsx("p",{style:{fontSize:16,color:"#64748b",maxWidth:600,margin:"0 auto"},children:"Analyze your symptoms with AI-powered health insights"}),m.jsxs("div",{style:{marginTop:20},children:[!l.loaded&&!l.error&&m.jsx("div",{style:{background:"#dbeafe",border:"1px solid #93c5fd",borderRadius:12,padding:16,display:"inline-block"},children:m.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12},children:[m.jsx(Hr,{size:20,color:"#2563eb",style:{animation:"spin 1s linear infinite"}}),m.jsxs("span",{style:{fontWeight:600,color:"#1e40af"},children:["Loading AI Models: ",Math.round(l.progress),"%"]})]})}),l.loaded&&m.jsxs("div",{style:{background:"#dcfce7",border:"1px solid #86efac",borderRadius:12,padding:"10px 20px",display:"inline-flex",alignItems:"center",gap:8},children:[m.jsx(Zn,{size:18,color:"#16a34a"}),m.jsx("span",{style:{fontWeight:600,color:"#166534"},children:"AI Models Ready"})]})]})]}),m.jsxs("div",{style:{display:"grid",gridTemplateColumns:"2fr 1fr",gap:24},children:[m.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:24},children:[m.jsxs("div",{style:M,children:[m.jsx("h2",{style:B,children:"Select Your Symptoms"}),m.jsxs("div",{style:{position:"relative",marginBottom:20},children:[m.jsx($2,{size:18,color:"#9ca3af",style:{position:"absolute",left:12,top:"50%",transform:"translateY(-50%)"}}),m.jsx("input",{type:"text",placeholder:"Search symptoms...",value:n,onChange:E=>s(E.target.value),style:{...F,paddingLeft:40}})]}),n&&m.jsxs("div",{style:{background:"#f8fafc",borderRadius:12,padding:16,marginBottom:20},children:[m.jsx("label",{style:{fontSize:14,fontWeight:500,color:"#374151",marginBottom:8,display:"block"},children:"Symptom Severity (1-5):"}),m.jsx("div",{style:{display:"flex",gap:8},children:[1,2,3,4,5].map(E=>m.jsx("button",{onClick:()=>d(E),style:{width:40,height:40,borderRadius:"50%",border:"none",fontWeight:600,cursor:"pointer",background:u===E?C(E):"#e5e7eb",color:u===E?"white":"#4b5563"},children:E},E))}),m.jsx("p",{style:{fontSize:12,color:"#6b7280",marginTop:8},children:"1=Mild, 3=Moderate, 5=Very Severe"})]}),n&&m.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12,marginBottom:20},children:y.map(E=>{const D=E.icon;return m.jsxs("button",{onClick:()=>v(E),style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:12,border:"1px solid #e5e7eb",borderRadius:12,background:"white",cursor:"pointer",textAlign:"left"},children:[m.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[m.jsx(D,{size:18,color:"#64748b"}),m.jsxs("div",{children:[m.jsx("div",{style:{fontWeight:500,color:"#0f172a"},children:E.name}),m.jsx("span",{style:{fontSize:11,padding:"2px 8px",borderRadius:12,background:$(E.category),color:R(E.category)},children:E.category})]})]}),m.jsx(GP,{size:18,color:"#10b981"})]},E.id)})}),t.length>0&&m.jsxs("div",{children:[m.jsx("h3",{style:{fontWeight:600,color:"#0f172a",marginBottom:12},children:"Selected Symptoms:"}),m.jsx("div",{style:{display:"flex",flexDirection:"column",gap:8},children:t.map(E=>m.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:12,background:"#dcfce7",border:"1px solid #86efac",borderRadius:12},children:[m.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[m.jsx("span",{style:{fontWeight:500},children:E.name}),m.jsxs("span",{style:{fontSize:13,fontWeight:500,color:C(E.userSeverity)},children:["(Severity: ",E.userSeverity,")"]})]}),m.jsx("button",{onClick:()=>b(E.id),style:{background:"none",border:"none",cursor:"pointer",color:"#ef4444",padding:4},children:m.jsx(Rf,{size:16})})]},E.id))})]})]}),m.jsxs("div",{style:M,children:[m.jsx("h2",{style:B,children:"Additional Information"}),m.jsxs("div",{style:{marginBottom:20},children:[m.jsx("label",{style:{fontSize:14,fontWeight:500,color:"#374151",marginBottom:8,display:"block"},children:"Duration:"}),m.jsxs("select",{value:h,onChange:E=>p(E.target.value),style:F,children:[m.jsx("option",{value:"",children:"Select duration"}),m.jsx("option",{value:"hours",children:"A few hours"}),m.jsx("option",{value:"1-day",children:"1 day"}),m.jsx("option",{value:"2-3-days",children:"2-3 days"}),m.jsx("option",{value:"week",children:"About a week"}),m.jsx("option",{value:"months",children:"Months"})]})]}),m.jsxs("div",{style:{marginBottom:24},children:[m.jsx("label",{style:{fontSize:14,fontWeight:500,color:"#374151",marginBottom:8,display:"block"},children:"Additional details:"}),m.jsx("textarea",{value:f,onChange:E=>g(E.target.value),placeholder:"Describe any triggers or relevant history...",rows:3,style:{...F,resize:"none"}})]}),m.jsx("div",{style:{textAlign:"center"},children:m.jsx("button",{onClick:w,disabled:t.length===0||o||!l.loaded,style:{...A,opacity:t.length===0||!l.loaded?.5:1},children:o?m.jsxs(m.Fragment,{children:[m.jsx(Hr,{size:20,style:{animation:"spin 1s linear infinite"}})," Analyzing..."]}):m.jsxs(m.Fragment,{children:[m.jsx(w$,{size:20})," Analyze Symptoms"]})})})]})]}),m.jsx("div",{style:{display:"flex",flexDirection:"column",gap:24},children:r?m.jsxs(m.Fragment,{children:[m.jsx("div",{style:{...M,background:r.urgencyLevel.level==="high"?"#fef2f2":r.urgencyLevel.level==="medium"?"#fffbeb":"#f0fdf4",borderColor:r.urgencyLevel.color,borderWidth:2},children:m.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12},children:[m.jsx("div",{style:{width:48,height:48,borderRadius:"50%",background:r.urgencyLevel.level==="high"?"#fee2e2":r.urgencyLevel.level==="medium"?"#fef3c7":"#dcfce7",display:"flex",alignItems:"center",justifyContent:"center"},children:r.urgencyLevel.level==="high"?m.jsx(Wn,{size:24,color:"#dc2626"}):r.urgencyLevel.level==="medium"?m.jsx(Sp,{size:24,color:"#f59e0b"}):m.jsx(Zn,{size:24,color:"#16a34a"})}),m.jsxs("div",{children:[m.jsxs("h3",{style:{fontSize:18,fontWeight:700,color:r.urgencyLevel.color,textTransform:"uppercase"},children:[r.urgencyLevel.level," Urgency"]}),m.jsx("p",{style:{fontSize:14,color:"#64748b"},children:r.urgencyLevel.message})]})]})}),m.jsxs("div",{style:M,children:[m.jsxs("h3",{style:{...B,display:"flex",alignItems:"center",gap:8},children:[m.jsx(gn,{size:20,color:"#3b82f6"})," Possible Conditions"]}),m.jsx("div",{style:{display:"flex",flexDirection:"column",gap:12},children:(P=r.conditions)==null?void 0:P.map((E,D)=>m.jsxs("div",{style:{border:"1px solid #e5e7eb",borderRadius:12,padding:16},children:[m.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8},children:[m.jsx("h4",{style:{fontWeight:600,color:"#0f172a"},children:E.name}),m.jsxs("span",{style:{fontSize:13,fontWeight:500,color:"#3b82f6"},children:[Math.round(E.probability*100),"%"]})]}),m.jsx("p",{style:{fontSize:13,color:"#64748b",marginBottom:8},children:E.description}),m.jsx("div",{style:{background:"#e5e7eb",borderRadius:4,height:4,overflow:"hidden"},children:m.jsx("div",{style:{background:"#3b82f6",height:"100%",width:`${E.probability*100}%`}})})]},D))})]}),m.jsxs("div",{style:M,children:[m.jsxs("h3",{style:{...B,display:"flex",alignItems:"center",gap:8},children:[m.jsx(QP,{size:20,color:"#8b5cf6"})," Recommendations"]}),m.jsx("div",{style:{display:"flex",flexDirection:"column",gap:8},children:(H=r.recommendations)==null?void 0:H.map((E,D)=>{const V=E.icon,X=E.type==="urgent";return m.jsxs("div",{style:{display:"flex",alignItems:"start",gap:12,padding:12,background:X?"#fef2f2":"#f0fdf4",border:`1px solid ${X?"#fecaca":"#86efac"}`,borderRadius:12},children:[m.jsx(V,{size:18,color:X?"#dc2626":"#16a34a",style:{marginTop:2,flexShrink:0}}),m.jsx("span",{style:{fontSize:14,color:X?"#7f1d1d":"#166534"},children:E.text})]},D)})})]}),m.jsxs("div",{style:{textAlign:"center",fontSize:13,color:"#64748b"},children:[m.jsx(Sp,{size:14,style:{verticalAlign:"middle",marginRight:6}}),"Analyzed at ",r.timestamp.toLocaleTimeString()]})]}):m.jsxs("div",{style:{...M,textAlign:"center",padding:48},children:[m.jsx(Jx,{size:48,color:"#9ca3af",style:{marginBottom:16}}),m.jsx("h3",{style:{fontSize:18,fontWeight:600,color:"#0f172a",marginBottom:8},children:"Analysis Results"}),m.jsx("p",{style:{color:"#64748b"},children:"Select symptoms and click analyze"})]})})]}),m.jsx("div",{style:{marginTop:32,background:"#fef3c7",border:"1px solid #fcd34d",borderRadius:16,padding:20},children:m.jsxs("div",{style:{display:"flex",gap:12},children:[m.jsx(Wn,{size:24,color:"#92400e",style:{flexShrink:0,marginTop:2}}),m.jsxs("p",{style:{fontSize:14,color:"#78350f"},children:[m.jsx("strong",{children:"Medical Disclaimer:"})," This AI symptom checker is for informational purposes only and should not replace professional medical advice. Always consult healthcare professionals for accurate diagnosis. In emergencies, seek immediate medical attention."]})]})}),m.jsx("style",{children:"@keyframes spin { to { transform: rotate(360deg); } }"})]})}function Due(){const[t,e]=W.useState(!1),[n,s]=W.useState({name:"John Doe",age:35,gender:"Male",bloodType:"O+",height:"175 cm",weight:"72 kg",allergies:["Peanuts","Penicillin"],conditions:["Mild Asthma"],medications:["Ventolin (as needed)"]}),[r,i]=W.useState({...n}),o=[{type:"Vital Signs",date:"2024-01-15",result:"Normal",icon:Zt},{type:"Eye Screening",date:"2024-01-14",result:"Low Risk",icon:ks},{type:"Voice Analysis",date:"2024-01-12",result:"Good",icon:Ws},{type:"Disease Risk",date:"2024-01-10",result:"Low Risk",icon:gn}],a=[{goal:"Exercise 3x/week",progress:67,color:"#10b981"},{goal:"Sleep 7+ hours",progress:85,color:"#3b82f6"},{goal:"Drink 8 glasses water",progress:50,color:"#8b5cf6"}],l=()=>{s(r),e(!1)},c=()=>{i({...n}),e(!1)},u={background:"white",borderRadius:20,padding:24,boxShadow:"0 4px 20px rgba(0,0,0,0.08)",border:"1px solid #e2e8f0"},d={padding:"24px 32px",maxWidth:1200,margin:"0 auto"},h={width:"100%",padding:"10px 14px",border:"1px solid #d1d5db",borderRadius:10,fontSize:14};return m.jsxs("div",{style:d,children:[m.jsxs("div",{style:{textAlign:"center",marginBottom:40},children:[m.jsx("div",{style:{width:80,height:80,background:"linear-gradient(135deg, #10b981 0%, #059669 100%)",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 20px",boxShadow:"0 8px 24px rgba(16, 185, 129, 0.3)"},children:m.jsx(e1,{size:36,color:"white"})}),m.jsx("h1",{style:{fontSize:32,fontWeight:700,color:"#0f172a",marginBottom:12},children:"Health Profile"}),m.jsx("p",{style:{fontSize:16,color:"#64748b"},children:"Manage your personal health information"})]}),m.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:24},children:[m.jsxs("div",{style:u,children:[m.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:24},children:[m.jsx("h2",{style:{fontSize:18,fontWeight:600,color:"#0f172a"},children:"Personal Information"}),t?m.jsxs("div",{style:{display:"flex",gap:8},children:[m.jsxs("button",{onClick:l,style:{display:"flex",alignItems:"center",gap:4,padding:"8px 16px",borderRadius:10,border:"none",background:"#10b981",color:"white",fontWeight:500,cursor:"pointer"},children:[m.jsx(HP,{size:16})," Save"]}),m.jsxs("button",{onClick:c,style:{display:"flex",alignItems:"center",gap:4,padding:"8px 16px",borderRadius:10,border:"none",background:"#f1f5f9",color:"#64748b",fontWeight:500,cursor:"pointer"},children:[m.jsx(Rf,{size:16})," Cancel"]})]}):m.jsxs("button",{onClick:()=>e(!0),style:{display:"flex",alignItems:"center",gap:6,padding:"8px 16px",borderRadius:10,border:"none",background:"#dbeafe",color:"#2563eb",fontWeight:500,cursor:"pointer"},children:[m.jsx(UP,{size:16})," Edit"]})]}),m.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:16},children:[{label:"Full Name",field:"name"},{label:"Age",field:"age"},{label:"Gender",field:"gender"},{label:"Blood Type",field:"bloodType"},{label:"Height",field:"height"},{label:"Weight",field:"weight"}].map(({label:p,field:f})=>m.jsxs("div",{children:[m.jsx("label",{style:{fontSize:13,fontWeight:500,color:"#64748b",display:"block",marginBottom:6},children:p}),t?m.jsx("input",{value:r[f],onChange:g=>i({...r,[f]:g.target.value}),style:h}):m.jsx("div",{style:{padding:"10px 14px",background:"#f8fafc",borderRadius:10,fontWeight:500,color:"#0f172a"},children:n[f]})]},f))})]}),m.jsxs("div",{style:u,children:[m.jsxs("h2",{style:{fontSize:18,fontWeight:600,color:"#0f172a",marginBottom:24,display:"flex",alignItems:"center",gap:10},children:[m.jsx(Jx,{size:20,color:"#8b5cf6"})," Health Goals"]}),m.jsx("div",{style:{display:"flex",flexDirection:"column",gap:20},children:a.map((p,f)=>m.jsxs("div",{children:[m.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:8},children:[m.jsx("span",{style:{fontWeight:500,color:"#0f172a"},children:p.goal}),m.jsxs("span",{style:{fontWeight:600,color:p.color},children:[p.progress,"%"]})]}),m.jsx("div",{style:{background:"#e5e7eb",borderRadius:8,height:8,overflow:"hidden"},children:m.jsx("div",{style:{background:p.color,height:"100%",width:`${p.progress}%`,borderRadius:8,transition:"width 0.5s"}})})]},f))})]}),m.jsxs("div",{style:u,children:[m.jsxs("h2",{style:{fontSize:18,fontWeight:600,color:"#0f172a",marginBottom:24,display:"flex",alignItems:"center",gap:10},children:[m.jsx(Wn,{size:20,color:"#f59e0b"})," Medical Information"]}),m.jsxs("div",{style:{marginBottom:20},children:[m.jsx("label",{style:{fontSize:14,fontWeight:500,color:"#374151",marginBottom:8,display:"block"},children:"Allergies"}),m.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:8},children:n.allergies.map((p,f)=>m.jsx("span",{style:{background:"#fef2f2",color:"#dc2626",padding:"6px 12px",borderRadius:20,fontSize:13,fontWeight:500},children:p},f))})]}),m.jsxs("div",{style:{marginBottom:20},children:[m.jsx("label",{style:{fontSize:14,fontWeight:500,color:"#374151",marginBottom:8,display:"block"},children:"Medical Conditions"}),m.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:8},children:n.conditions.map((p,f)=>m.jsx("span",{style:{background:"#fef3c7",color:"#92400e",padding:"6px 12px",borderRadius:20,fontSize:13,fontWeight:500},children:p},f))})]}),m.jsxs("div",{children:[m.jsx("label",{style:{fontSize:14,fontWeight:500,color:"#374151",marginBottom:8,display:"block"},children:"Medications"}),m.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:8},children:n.medications.map((p,f)=>m.jsx("span",{style:{background:"#dbeafe",color:"#1e40af",padding:"6px 12px",borderRadius:20,fontSize:13,fontWeight:500},children:p},f))})]})]}),m.jsxs("div",{style:u,children:[m.jsxs("h2",{style:{fontSize:18,fontWeight:600,color:"#0f172a",marginBottom:24,display:"flex",alignItems:"center",gap:10},children:[m.jsx(Mt,{size:20,color:"#3b82f6"})," Recent Screenings"]}),m.jsx("div",{style:{display:"flex",flexDirection:"column",gap:12},children:o.map((p,f)=>{const g=p.icon;return m.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:16,background:"#f8fafc",borderRadius:12},children:[m.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12},children:[m.jsx("div",{style:{width:40,height:40,background:"#e0f2fe",borderRadius:10,display:"flex",alignItems:"center",justifyContent:"center"},children:m.jsx(g,{size:20,color:"#0284c7"})}),m.jsxs("div",{children:[m.jsx("div",{style:{fontWeight:500,color:"#0f172a"},children:p.type}),m.jsx("div",{style:{fontSize:12,color:"#64748b"},children:p.date})]})]}),m.jsx("span",{style:{background:"#dcfce7",color:"#166534",padding:"4px 12px",borderRadius:12,fontSize:12,fontWeight:500},children:p.result})]},f)})})]})]})]})}function Fue(){const t=[{id:1,type:"vitals",title:"rPPG Scan",summary:"HR 72 BPM, HRV stable, SpO 98%"},{id:2,type:"eye",title:"Eye Screening",summary:"No signs of jaundice; image quality good"},{id:3,type:"symptom",title:"Symptom Check: Headache",summary:"Likely tension-type; OTC guidance provided"}];return m.jsxs("div",{style:{padding:24},children:[m.jsx("h1",{style:{fontSize:24,fontWeight:700,marginBottom:16},children:"Health Journal"}),m.jsx("div",{style:{marginBottom:12,display:"flex",justifyContent:"flex-end"},children:m.jsx("button",{onClick:async()=>{try{const n=await(await fetch("/api/analytics/reports/generate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({range:"7d"})})).json();alert(`Report requested (id: ${n.reportId}). Status: ${n.status}`)}catch{alert("Failed to request report")}},style:{background:"linear-gradient(135deg, var(--primary-green), #16a34a)",color:"white",border:"none",padding:"8px 12px",borderRadius:10,fontSize:13,cursor:"pointer"},children:"Generate PDF (stub)"})}),m.jsx("div",{style:{backgroundColor:"white",border:"1px solid #e2e8f0",borderRadius:12,overflow:"hidden"},children:t.map((e,n)=>m.jsxs("div",{style:{padding:16,borderBottom:n<t.length-1?"1px solid #f1f5f9":"none"},children:[m.jsx("div",{style:{fontSize:14,fontWeight:600},children:e.title}),m.jsx("div",{style:{fontSize:12,color:"#64748b"},children:e.summary})]},e.id))})]})}function Oue(){const[t,e]=W.useState(!1),[n,s]=W.useState(!1),[r,i]=W.useState(!1);W.useEffect(()=>{const c=localStorage.getItem("privacy.onDeviceOnly")==="true",u=localStorage.getItem("privacy.researchOptIn")==="true";e(c),s(u)},[]);const o=()=>{localStorage.setItem("privacy.onDeviceOnly",String(t)),localStorage.setItem("privacy.researchOptIn",String(n)),i(!0),setTimeout(()=>i(!1),1500)},a=()=>{localStorage.removeItem("consent.accepted.v1"),alert("Consent has been reset. You will be prompted again next time.")},l=()=>{window.dispatchEvent(new CustomEvent("app:showDisclaimer"))};return m.jsxs("div",{style:{padding:24,maxWidth:900},children:[m.jsx("h1",{style:{fontSize:24,fontWeight:700,marginBottom:8},children:"Privacy & Consent"}),m.jsx("p",{style:{color:"#475569",marginBottom:24},children:"Control how your data is processed and shared."}),m.jsxs("div",{style:{display:"grid",gap:16},children:[m.jsx("div",{style:{backgroundColor:"white",border:"1px solid #e2e8f0",borderRadius:12,padding:16},children:m.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[m.jsxs("div",{children:[m.jsx("div",{style:{fontWeight:600},children:"On-device processing only"}),m.jsx("div",{style:{fontSize:12,color:"#64748b"},children:"Process supported analyses locally; do not upload raw media."})]}),m.jsx("input",{type:"checkbox",checked:t,onChange:c=>e(c.target.checked)})]})}),m.jsx("div",{style:{backgroundColor:"white",border:"1px solid #e2e8f0",borderRadius:12,padding:16},children:m.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[m.jsxs("div",{children:[m.jsx("div",{style:{fontWeight:600},children:"Research data opt-in"}),m.jsx("div",{style:{fontSize:12,color:"#64748b"},children:"Share de-identified results to improve models."})]}),m.jsx("input",{type:"checkbox",checked:n,onChange:c=>s(c.target.checked)})]})}),m.jsxs("div",{style:{textAlign:"right"},children:[m.jsx("button",{onClick:o,style:{background:"linear-gradient(135deg, var(--primary-green), #16a34a)",color:"white",border:"none",padding:"10px 16px",borderRadius:12,fontSize:14,cursor:"pointer"},children:"Save"}),r&&m.jsx("span",{style:{marginLeft:8,fontSize:12,color:"#16a34a"},children:"Saved"})]}),m.jsxs("div",{style:{backgroundColor:"#f8fafc",border:"1px solid #e2e8f0",borderRadius:12,padding:16},children:[m.jsx("div",{style:{fontWeight:600,marginBottom:8},children:"Safety Disclaimer"}),m.jsx("div",{style:{fontSize:13,color:"#334155",lineHeight:1.6},children:"This app provides wellness and health insights based on non-invasive signals and AI models. It does not diagnose, treat, cure, or prevent any disease and is not a substitute for professional medical advice. Always seek the advice of your physician or other qualified health provider with any questions regarding a medical condition. If you believe you may be experiencing a medical emergency, call your local emergency number immediately."}),m.jsxs("div",{style:{marginTop:12,display:"flex",gap:8},children:[m.jsx("button",{onClick:a,style:{backgroundColor:"#e2e8f0",border:"1px solid #cbd5e1",color:"#0f172a",padding:"8px 12px",borderRadius:8,fontSize:12,cursor:"pointer"},children:"Reset consent"}),m.jsx("button",{onClick:l,style:{backgroundColor:"#2563eb",border:"1px solid #1d4ed8",color:"white",padding:"8px 12px",borderRadius:8,fontSize:12,cursor:"pointer"},children:"View disclaimer"})]})]})]})]})}function Fs({children:t}){const[e,n]=W.useState(!1);W.useEffect(()=>{const r=localStorage.getItem("consent.accepted.v1");n(r==="true");const i=()=>n(!1);return window.addEventListener("app:showDisclaimer",i),()=>window.removeEventListener("app:showDisclaimer",i)},[]);const s=()=>{localStorage.setItem("consent.accepted.v1","true"),n(!0)};return m.jsxs("div",{style:{minHeight:"100vh",background:"linear-gradient(135deg, var(--primary-green-50) 0%, var(--white) 50%, var(--primary-green-50) 100%)"},children:[m.jsx(aj,{}),m.jsxs("div",{style:{overflowY:"auto",position:"relative",minHeight:"100vh"},children:[t,m.jsx(QD,{}),m.jsx(vue,{visible:!e,onAccept:s})]})]})}function Pue(){return m.jsx(oj,{children:m.jsx(IP,{children:m.jsxs(yP,{children:[m.jsx(un,{path:"/",element:m.jsx(bue,{})}),m.jsx(un,{path:"/login",element:m.jsx(wue,{})}),m.jsx(un,{path:"/register",element:m.jsx(kue,{})}),m.jsx(un,{path:"/dashboard",element:m.jsx(Ds,{children:m.jsx(Fs,{children:m.jsx(Cue,{})})})}),m.jsx(un,{path:"/disease-prediction",element:m.jsx(Ds,{children:m.jsx(Fs,{children:m.jsx($ue,{})})})}),m.jsx(un,{path:"/vital-signs",element:m.jsx(Ds,{children:m.jsx(Fs,{children:m.jsx(Tue,{})})})}),m.jsx(un,{path:"/voice-analysis",element:m.jsx(Ds,{children:m.jsx(Fs,{children:m.jsx(Eue,{})})})}),m.jsx(un,{path:"/eye-screening",element:m.jsx(Ds,{children:m.jsx(Fs,{children:m.jsx(Rue,{})})})}),m.jsx(un,{path:"/health-analytics",element:m.jsx(Ds,{children:m.jsx(Fs,{children:m.jsx(Nue,{})})})}),m.jsx(un,{path:"/emergency-protocol",element:m.jsx(Ds,{children:m.jsx(Fs,{children:m.jsx(Aue,{})})})}),m.jsx(un,{path:"/symptom-checker",element:m.jsx(Ds,{children:m.jsx(Fs,{children:m.jsx(_ue,{})})})}),m.jsx(un,{path:"/health-profile",element:m.jsx(Ds,{children:m.jsx(Fs,{children:m.jsx(Due,{})})})}),m.jsx(un,{path:"/journal",element:m.jsx(Ds,{children:m.jsx(Fs,{children:m.jsx(Fue,{})})})}),m.jsx(un,{path:"/settings/privacy",element:m.jsx(Ds,{children:m.jsx(Fs,{children:m.jsx(Oue,{})})})}),m.jsx(un,{path:"*",element:m.jsx(m$,{to:"/",replace:!0})})]})})})}async function Mue(){return console.log("Telemetry: Initialization skipped (Sentry not configured)"),Promise.resolve()}const Lue=document.getElementById("root"),zue=r$(Lue);Mue().finally(()=>{zue.render(m.jsx(Pue,{}))});
